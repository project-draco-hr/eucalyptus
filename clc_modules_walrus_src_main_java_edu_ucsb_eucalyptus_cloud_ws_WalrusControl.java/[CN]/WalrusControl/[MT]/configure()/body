{
  WalrusInfo walrusInfo=WalrusInfo.getWalrusInfo();
  storageManager=BackendStorageManagerFactory.getStorageManager();
  storageManager.setRootDirectory(walrusInfo.getStorageDir());
  walrusImageManager=new WalrusImageManager(storageManager,imageMessenger);
  walrusManager=new WalrusManager(storageManager,walrusImageManager);
  WalrusManager.configure();
  walrusBlockStorageManager=new WalrusBlockStorageManager(storageManager,walrusManager);
  String limits=System.getProperty(WalrusProperties.USAGE_LIMITS_PROPERTY);
  if (limits != null) {
    WalrusProperties.shouldEnforceUsageLimits=Boolean.parseBoolean(limits);
  }
  try {
    walrusManager.check();
  }
 catch (  EucalyptusCloudException ex) {
    LOG.error("Error initializing walrus",ex);
    SystemUtil.shutdownWithError(ex.getMessage());
  }
  Tracker.initialize();
  if (System.getProperty("euca.virtualhosting.disable") != null) {
    WalrusProperties.enableVirtualHosting=false;
  }
}
