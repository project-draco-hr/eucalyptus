{
  if ((!Entities.hasTransaction(this))) {
    throw new RuntimeException("Error allocating resource " + PersistentReference.this.getClass().getSimpleName() + " with id "+ this.getDisplayName()+ " as there is no ongoing transaction.");
  }
  if ((this.getState() != null) && (preconditionState != null) && !preconditionState.equals(this.getState())) {
    throw new RuntimeException("Error allocating resource " + PersistentReference.this.getClass().getSimpleName() + " with id "+ this.getDisplayName()+ " as the state is not "+ preconditionState.name()+ " (currently "+ this.getState()+ ").");
  }
}
