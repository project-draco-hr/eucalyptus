{
  long size=0;
  File volumeFile=new File(volumeFileName);
  File snapshotFile=new File(snapshotFileName);
  assert(snapshotFile.exists() && volumeFile.exists());
  size+=shouldTransferVolume ? snapshotFile.length() + volumeFile.length() : snapshotFile.length();
  SnapshotProgressCallback callback=new SnapshotProgressCallback(snapshotId,size,StorageProperties.TRANSFER_CHUNK_SIZE);
  HttpWriter httpWriter;
  if (shouldTransferVolume) {
    httpWriter=new HttpWriter(volumeFile,StorageProperties.TRANSFER_CHUNK_SIZE,callback,volumeBucket,volumeKey,"StoreSnapshot",null);
    httpWriter.run();
  }
  httpWriter=new HttpWriter(snapshotFile,StorageProperties.TRANSFER_CHUNK_SIZE,callback,volumeBucket,snapshotId,"StoreSnapshot",volumeKey);
  httpWriter.run();
}
