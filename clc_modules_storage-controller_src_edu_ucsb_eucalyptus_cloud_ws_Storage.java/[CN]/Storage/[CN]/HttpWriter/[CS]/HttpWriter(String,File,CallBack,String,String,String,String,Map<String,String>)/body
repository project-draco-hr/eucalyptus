{
  httpClient=new HttpClient();
  String walrusAddr=System.getProperty(StorageProperties.WALRUS_URL);
  if (walrusAddr != null) {
    String addr=walrusAddr + "/" + bucket+ "/"+ key;
    Set<String> paramKeySet=httpParameters.keySet();
    boolean first=true;
    for (    String paramKey : paramKeySet) {
      if (!first) {
        addr+="&";
      }
 else {
        addr+="?";
      }
      first=false;
      addr+=paramKey;
      String value=httpParameters.get(paramKey);
      if (value != null)       addr+="=" + value;
    }
    method=constructHttpMethod(httpVerb,addr,eucaOperation,eucaHeader);
    method.setRequestHeader("Content-Length",String.valueOf(file.length()));
    ((PutMethodWithProgress)method).setOutFile(file);
    ((PutMethodWithProgress)method).setCallBack(callback);
  }
}
