{
  if (null != getRequestHeader("expect") && getStatusCode() != HttpStatus.SC_CONTINUE) {
    return false;
  }
  InputStream inputStream;
  if (outFile != null) {
    inputStream=new FileInputStream(outFile);
    GZIPOutputStream gzipOutStream=new GZIPOutputStream(conn.getRequestOutputStream());
    byte[] buffer=new byte[StorageProperties.TRANSFER_CHUNK_SIZE];
    int bytesRead;
    int numberProcessed=0;
    long totalBytesProcessed=0;
    while ((bytesRead=inputStream.read(buffer)) > 0) {
      gzipOutStream.write(buffer,0,bytesRead);
      totalBytesProcessed+=bytesRead;
      if (++numberProcessed >= callback.getUpdateThreshold()) {
        callback.run();
        numberProcessed=0;
      }
    }
    if (totalBytesProcessed == outFile.length()) {
      callback.finish();
    }
 else {
      callback.failed();
    }
    gzipOutStream.flush();
    gzipOutStream.finish();
    inputStream.close();
    if (deleteOnXfer) {
      snapshotStorageManager.deleteAbsoluteObject(outFile.getAbsolutePath());
    }
  }
 else {
    return false;
  }
  return true;
}
