{
  EntityWrapper<SnapshotInfo> db=new EntityWrapper<SnapshotInfo>();
  SnapshotInfo snapshotInfo=new SnapshotInfo();
  snapshotInfo.setStatus(Status.creating.toString());
  List<SnapshotInfo> snapshotInfos=db.query(snapshotInfo);
  for (  SnapshotInfo snapInfo : snapshotInfos) {
    String snapshotId=snapInfo.getSnapshotId();
    blockManager.cleanSnapshot(snapshotId);
    try {
      snapshotStorageManager.deleteObject("",snapshotId);
    }
 catch (    Exception ex) {
      LOG.warn(ex);
    }
    db.delete(snapInfo);
  }
  snapshotInfo.setStatus(Status.failed.toString());
  snapshotInfos=db.query(snapshotInfo);
  for (  SnapshotInfo snapInfo : snapshotInfos) {
    String snapshotId=snapInfo.getSnapshotId();
    blockManager.cleanSnapshot(snapshotId);
    try {
      snapshotStorageManager.deleteObject("",snapshotId);
    }
 catch (    Exception ex) {
      LOG.warn(ex);
    }
    db.delete(snapInfo);
  }
  db.commit();
}
