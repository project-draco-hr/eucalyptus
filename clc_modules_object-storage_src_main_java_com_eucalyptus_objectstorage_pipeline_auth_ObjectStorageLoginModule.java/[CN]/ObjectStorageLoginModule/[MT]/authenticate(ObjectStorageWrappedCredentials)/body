{
  String signature=credentials.getSignature().replaceAll("=","");
  final AccessKey key;
  try {
    key=AccessKeys.lookupAccessKey(credentials.getQueryId(),credentials.getSecurityToken());
  }
 catch (  AuthException e) {
    throw new InvalidAccessKeyIdException(credentials.getQueryId());
  }
  final User user=key.getUser();
  final String queryKey=key.getSecretKey();
  final String authSig=checkSignature(queryKey,credentials.getLoginData());
  if (authSig.equals(signature)) {
    super.setCredential(credentials.getQueryId());
    super.setPrincipal(user);
    super.setSecurityToken(credentials.getSecurityToken());
    return true;
  }
 else {
    LOG.debug("Invalid signature found. Calculated: " + authSig + " Client provided: "+ signature);
  }
  return false;
}
