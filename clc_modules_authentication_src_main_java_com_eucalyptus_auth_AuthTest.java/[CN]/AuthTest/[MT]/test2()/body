{
  Accounts.addAccount("test");
  Users.addAccountAdmin("test","foobar");
  Users.addUser("tom","/",true,true,null,true,true,true,"test");
  Users.addUser("jack","/",true,true,null,true,true,true,"test");
  Users.addUser("chris","/",true,true,null,true,true,true,"test");
  Groups.addGroup("sales","/","test");
  Groups.addGroup("marketing","/","test");
  String policy="{" + "'Statement':[{" + "'Effect':'Allow',"+ "'Action':'ec2:RunInstances',"+ "'Resource':'*',"+ "'Condition':{"+ "'DateLessThanEquals':{"+ "'aws:currenttime':'2010-12-31'"+ "}"+ "}"+ "}]"+ "}";
  Policies.attachGroupPolicy(policy,"sales","test");
  final User user=Users.lookupUserByName("tom","test");
  ContextUtils.setAdaptor(new ContextAdaptor(){
    @Override public User getRequestUser(){
      return user;
    }
    @Override public Class<? extends BaseMessage> getRequestMessageClass(){
      return RunInstancesType.class;
    }
    @Override public SocketAddress getRemoteAddress(){
      return new InetSocketAddress("192.168.7.54",80808);
    }
  }
);
  PolicyEngine engine=new PolicyEngineImpl();
  engine.evaluateAuthorization(Image.class,"emi-12345678");
}
