{
  for (  String ctx : PersistenceContexts.list()) {
    try {
      DriverDatabaseClusterMBean cluster=findDbClusterMBean(ctx);
      for (      String dbId : cluster.getActiveDatabases()) {
        try {
          Iterables.find(Hosts.list(),filterDbHost(dbId));
          if (!cluster.isAlive(dbId)) {
            cluster.deactivate(dbId);
          }
        }
 catch (        NoSuchElementException ex) {
          cluster.deactivate(dbId);
        }
      }
      for (      final String dbId : cluster.getInactiveDatabases()) {
        try {
          Iterables.find(Hosts.list(),filterDbHost(dbId));
          if (cluster.isAlive(dbId)) {
            cluster.activate(dbId);
          }
        }
 catch (        NoSuchElementException ex) {
          cluster.remove(dbId);
        }
      }
    }
 catch (    Exception ex) {
      LOG.error(ex,ex);
    }
  }
}
