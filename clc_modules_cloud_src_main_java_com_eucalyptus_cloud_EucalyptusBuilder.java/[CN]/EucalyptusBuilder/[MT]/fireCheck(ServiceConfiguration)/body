{
  if (!Bootstrap.isFinished()) {
    return;
  }
  for (  String ctx : PersistenceContexts.list()) {
    final String contextName=ctx.startsWith("eucalyptus_") ? ctx : "eucalyptus_" + ctx;
    try {
      DriverDatabaseClusterMBean cluster=Mbeans.lookup(jdbcJmxDomain,ImmutableMap.builder().put("cluster",contextName).build(),DriverDatabaseClusterMBean.class);
      for (      String dbId : cluster.getActiveDatabases()) {
        if (!cluster.isAlive(dbId)) {
          cluster.deactivate(dbId);
        }
      }
      for (      String dbId : cluster.getInactiveDatabases()) {
        if (cluster.isAlive(dbId)) {
          cluster.activate(dbId);
        }
      }
    }
 catch (    Exception ex) {
      LOG.error(ex,ex);
    }
  }
}
