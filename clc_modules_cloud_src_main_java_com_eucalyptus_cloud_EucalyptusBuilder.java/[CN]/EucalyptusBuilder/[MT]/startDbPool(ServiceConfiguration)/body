{
  for (  String ctx : PersistenceContexts.list()) {
    final String contextName=ctx.startsWith("eucalyptus_") ? ctx : "eucalyptus_" + ctx;
    String dbUrl="jdbc:" + ServiceUris.remote(Database.class,config.getInetAddress(),contextName);
    try {
      DriverDatabaseClusterMBean cluster=findDbClusterMBean(contextName);
      String dbPass=SystemIds.databasePassword();
      final String hostName=config.getHostName();
      String realJdbcDriver=Databases.getDriverName();
      if (!cluster.getActiveDatabases().contains(hostName) && !cluster.getInactiveDatabases().contains(hostName)) {
        cluster.add(hostName,realJdbcDriver,dbUrl);
      }
 else       if (cluster.getActiveDatabases().contains(hostName)) {
        continue;
      }
      InactiveDatabaseMBean database=Mbeans.lookup(jdbcJmxDomain,ImmutableMap.builder().put("cluster",contextName).put("database",hostName).build(),InactiveDatabaseMBean.class);
      database.setUser("eucalyptus");
      database.setPassword(dbPass);
      if (Hosts.Coordinator.INSTANCE.isLocalhost()) {
        cluster.activate(hostName,"full");
      }
 else {
        cluster.activate(hostName,"passive");
      }
    }
 catch (    NoSuchElementException ex1) {
      LOG.error(ex1,ex1);
    }
catch (    Exception ex1) {
      LOG.error(ex1,ex1);
    }
  }
}
