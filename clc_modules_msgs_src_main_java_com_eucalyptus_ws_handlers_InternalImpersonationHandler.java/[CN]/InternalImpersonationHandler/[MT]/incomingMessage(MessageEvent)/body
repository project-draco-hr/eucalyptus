{
  final Object o=event.getMessage();
  if (o instanceof MappingHttpRequest) {
    final MappingHttpMessage httpRequest=(MappingHttpMessage)o;
    if (httpRequest.getMessage() instanceof BaseMessage) {
      final BaseMessage baseMessage=(BaseMessage)httpRequest.getMessage();
      final String userId=baseMessage.getEffectiveUserId();
      try {
        final Context context=Contexts.lookup(httpRequest.getCorrelationId());
        if (userId != null && !Principals.isFakeIdentify(userId) && context.hasAdministrativePrivileges()) {
          final User user=Accounts.lookupUserById(userId);
          context.setUser(user);
        }
      }
 catch (      final NoSuchContextException e) {
      }
catch (      final AuthException e) {
        throw new EucalyptusCloudException("User not found: " + userId);
      }
    }
  }
}
