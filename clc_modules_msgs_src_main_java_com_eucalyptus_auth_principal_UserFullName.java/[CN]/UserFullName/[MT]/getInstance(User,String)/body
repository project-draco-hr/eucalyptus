{
  try {
    if ((user != null) && !Principals.isFakeIdentify(user.getUserId())) {
      if (!userIdMap.containsKey(user.getUserId())) {
        userIdMap.put(user.getUserId(),new UserFullName(user));
      }
      return userIdMap.get(user.getUserId());
    }
 else     if (Principals.systemUser().equals(user)) {
      return new UserFullName(Principals.systemUser());
    }
 else {
      return new UserFullName(Principals.nobodyUser());
    }
  }
 catch (  final AuthException ex) {
    LOG.error(ex.getMessage());
    try {
      return new UserFullName(Principals.nobodyUser());
    }
 catch (    final AuthException ex1) {
      LOG.error(ex1,ex1);
      throw new UndeclaredThrowableException(ex);
    }
  }
catch (  final Exception ex) {
    throw new UndeclaredThrowableException(ex);
  }
}
