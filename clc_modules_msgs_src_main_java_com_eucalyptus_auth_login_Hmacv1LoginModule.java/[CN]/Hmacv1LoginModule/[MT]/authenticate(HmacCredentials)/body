{
  String sig=credentials.getSignature();
  checkForReplay(sig);
  AccessKey accessKey=lookupAccessKey(credentials);
  User user=accessKey.getUser();
  String secretKey=accessKey.getSecretKey();
  String canonicalString=this.makeSubjectString(credentials.getParameters());
  String computedSig=this.getSignature(secretKey,canonicalString,credentials.getSignatureMethod());
  String decodedSig=sanitize(urldecode(sig));
  if (!computedSig.equals(sanitize(sig)) && !computedSig.equals(decodedSig) && !computedSig.equals(sig)) {
    return false;
  }
  super.setCredential(credentials.getQueryId());
  super.setPrincipal(user);
  return true;
}
