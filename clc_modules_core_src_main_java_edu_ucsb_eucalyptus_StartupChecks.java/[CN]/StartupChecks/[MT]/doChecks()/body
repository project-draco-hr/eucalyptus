{
  StartupChecks.checkDirectories();
  boolean wwwKs=false;
  try {
    wwwKs=EucaKeyStore.getInstance().check();
  }
 catch (  GeneralSecurityException e) {
    LOG.error(e,e);
  }
  boolean hasDb=StartupChecks.checkDatabase();
  if (!wwwKs) {
    try {
      StartupChecks.createKeyStores();
      wwwKs=EucaKeyStore.getInstance().check();
    }
 catch (    Exception e) {
      LOG.error(e,e);
      StartupChecks.fail("Error creating keystore instance.");
    }
  }
  if (!hasDb) {
    StartupChecks.createDb();
    hasDb=StartupChecks.checkDatabase();
  }
  if (!hasDb || !wwwKs) {
    LOG.fatal(String.format(HEADER_FSTRING,"STARTUP FAILURE"));
    if (!hasDb)     LOG.fatal("Failed to initialize the database in: " + SubDirectory.DB);
    if (!wwwKs)     LOG.fatal("Failed to read the www keystore: " + EucaKeyStore.getInstance().getFileName());
    StartupChecks.fail("See errors messages above.");
  }
  EntityWrapper<UserGroupInfo> db3=new EntityWrapper<UserGroupInfo>();
  try {
    db3.getUnique(new UserGroupInfo("all"));
  }
 catch (  EucalyptusCloudException e) {
    db3.add(new UserGroupInfo("all"));
  }
 finally {
    db3.commit();
  }
  EntityWrapper<ImageInfo> db2=new EntityWrapper<ImageInfo>();
  try {
    List<ImageInfo> imageList=db2.query(new ImageInfo());
    for (    ImageInfo image : imageList) {
      if (image.getImageLocation().split("/").length != 2) {
        LOG.info("Image with invalid location, needs to be reregistered: " + image.getImageId());
        LOG.info("Removing entry for: " + image.getImageId());
        db2.delete(image);
      }
    }
    db2.commit();
  }
 catch (  Exception e1) {
    db2.rollback();
  }
  checkWalrus();
  checkStorage();
  return true;
}
