{
  ListAllMyBucketsResponseType reply=(ListAllMyBucketsResponseType)request.getReply();
  try {
    User requestUser=getRequestUser(request);
    ListAllMyBucketsList myBucketList=new ListAllMyBucketsList();
    myBucketList.setBuckets(new ArrayList<BucketListEntry>());
    AmazonS3Client s3Client=this.getS3Client(requestUser,request.getAccessKeyID());
    ListBucketsRequest listRequest=new ListBucketsRequest();
    List<Bucket> result=s3Client.listBuckets(listRequest);
    for (    Bucket b : result) {
      myBucketList.getBuckets().add(new BucketListEntry(b.getName(),OSGUtil.dateToHeaderFormattedString(b.getCreationDate())));
    }
    reply.setBucketList(myBucketList);
    reply.setOwner(getCanonicalUser(requestUser));
  }
 catch (  Exception e) {
    LOG.debug(e,e);
    throw new EucalyptusCloudException(e);
  }
  return reply;
}
