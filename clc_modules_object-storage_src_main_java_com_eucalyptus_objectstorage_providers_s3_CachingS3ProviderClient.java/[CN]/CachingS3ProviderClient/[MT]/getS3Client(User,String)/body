{
  if (localS3Client == null) {
synchronized (this) {
      Protocol protocol=null;
      boolean useHttps=false;
      if (S3ProviderConfiguration.getS3UseHttps() != null && S3ProviderConfiguration.getS3UseHttps()) {
        useHttps=true;
      }
      AWSCredentials credentials=mapCredentials(requestUser,requestAWSAccessKeyId);
      localS3Client=new S3Client(credentials,useHttps);
      localS3Client.setS3Endpoint(S3ProviderConfiguration.getS3Endpoint());
      localS3Client.setUsePathStyle(!S3ProviderConfiguration.getS3UseBackendDns());
    }
  }
  return localS3Client.getS3Client();
}
