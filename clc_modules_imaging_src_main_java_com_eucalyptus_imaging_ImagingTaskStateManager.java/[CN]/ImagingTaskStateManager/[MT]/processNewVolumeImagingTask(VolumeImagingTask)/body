{
  if (volumeTask.getVolumeId() == null || volumeTask.getVolumeId().length() <= 0) {
    final String zone=volumeTask.getAvailabilityZone();
    final int size=volumeTask.getVolumeSize();
    try {
      final String volumeId=EucalyptusActivityTasks.getInstance().createVolume(zone,size);
      ImagingTasks.setVolumeId(volumeTask,volumeId);
    }
 catch (    final Exception ex) {
      throw new Exception("Failed to create the volume",ex);
    }
  }
 else {
    final List<Volume> volumes=EucalyptusActivityTasks.getInstance().describeVolumes(Lists.newArrayList(volumeTask.getVolumeId()));
    final Volume volume=volumes.get(0);
    final String volumeStatus=volume.getStatus();
    if ("available".equals(volumeStatus)) {
      final ConversionTask conversionTask=volumeTask.getTask();
      if (conversionTask.getImportVolume() != null) {
        ImagingTasks.setState(volumeTask,ImportTaskState.PENDING,null);
      }
 else {
        throw new Exception("No importVolume detail is found in the conversion task");
      }
    }
 else     if ("creating".equals(volumeStatus)) {
      ;
    }
 else {
      throw new Exception("The volume " + volume.getVolumeId() + "'s state is "+ volumeStatus);
    }
  }
}
