{
  CancelBundleTaskResponseType reply=request.getReply();
  reply.set_return(true);
  try {
    VmInstance v=VmInstances.getInstance().lookupByBundleId(request.getBundleId());
    if (request.isAdministrator() || v.getOwnerId().equals(request.getUserId())) {
      v.getBundleTask().setState("canceling");
      LOG.info(EventRecord.here(BundleCallback.class,EventType.BUNDLE_CANCELING,request.getUserId(),v.getBundleTask().getBundleId(),v.getInstanceId()));
    }
 else {
      throw new EucalyptusCloudException("Failed to find bundle task: " + request.getBundleId());
    }
  }
 catch (  NoSuchElementException e) {
    throw new EucalyptusCloudException("Failed to find bundle task: " + request.getBundleId());
  }
  return reply;
}
