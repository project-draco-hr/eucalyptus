{
  Map<String,String> kvMap=new HashMap<String,String>();
  if (volumeId != null)   kvMap.put("volume_id",volumeId);
  if (ntpServer != null)   kvMap.put("ntp_server",ntpServer);
  if (logServer != null)   kvMap.put("log_server",logServer);
  if (logServerPort != null)   kvMap.put("log_server_port",logServerPort);
  kvMap.put(PASSWORD_PROPERTY,masterPasswordEnc);
  kvMap.put(CERT_PROPERTY,serverCertArn);
  kvMap.put("euare_service_url",String.format("euare.%s",DNSProperties.DOMAIN));
  kvMap.put("compute_service_url",String.format("compute.%s",DNSProperties.DOMAIN));
  final StringBuilder sb=new StringBuilder("#!/bin/bash").append("\n");
  if (initScript != null && initScript.length() > 0)   sb.append(initScript);
  sb.append("\n");
  sb.append(CONFIG_COMMMENT);
  sb.append("\n");
  sb.append("mkdir -p /etc/eucalyptus-database-server/\n");
  sb.append("yum -y --disablerepo \\* --enablerepo eucalyptus-service-image install eucalyptus-database-server\n");
  sb.append("echo \"");
  for (  String key : kvMap.keySet()) {
    String value=kvMap.get(key);
    sb.append(String.format("\n%s=%s",key,value));
  }
  sb.append("\n\" > /etc/eucalyptus-database-server/database-server.conf");
  sb.append("\ntouch /var/lib/eucalyptus-database-server/ntp.lock");
  sb.append("\nchown -R eucalyptus:eucalyptus /etc/eucalyptus-database-server");
  sb.append("\nservice eucalyptus-database-server start");
  return sb.toString();
}
