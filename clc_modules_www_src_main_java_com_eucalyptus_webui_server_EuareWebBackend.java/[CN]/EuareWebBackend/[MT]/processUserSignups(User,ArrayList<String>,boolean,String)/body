{
  ArrayList<String> success=Lists.newArrayList();
  for (  String userId : userIds) {
    try {
      User user=Accounts.lookupUserById(userId);
      if (Privileged.allowProcessUserSignup(authContext(requestUser),user)) {
        if (user.getRegistrationStatus().equals(RegistrationStatus.REGISTERED)) {
          if (approve) {
            user.setRegistrationStatus(RegistrationStatus.APPROVED);
            notifyUserApproval(user,backendUrl);
          }
 else {
            notifyUserRejection(user,backendUrl);
            Account account=user.getAccount();
            account.deleteUser(user.getName(),false,true);
          }
          success.add(userId);
        }
 else {
          throw new IllegalArgumentException("User " + user + " can not be approved or rejected.");
        }
      }
    }
 catch (    Exception e) {
      LOG.error("Failed to " + (approve ? "approve" : "reject") + " user "+ userId,e);
      LOG.debug(e,e);
    }
  }
  return success;
}
