{
  try {
    Account account=Accounts.lookupAccountByName(accountName);
    Map<String,String> info=Maps.newHashMap();
    info.put(User.EMAIL,email);
    User user=account.addUser(userName,"/",false,true,info);
    user.createToken();
    user.createConfirmationCode();
    user.setPassword(Crypto.generateHashedPassword(password));
    user.setPasswordExpires(System.currentTimeMillis() + User.PASSWORD_LIFETIME);
    return user;
  }
 catch (  Exception e) {
    LOG.error("Failed to create user " + userName + " in "+ accountName,e);
    LOG.debug(e,e);
    throw new EucalyptusServiceException("Failed to create user");
  }
}
