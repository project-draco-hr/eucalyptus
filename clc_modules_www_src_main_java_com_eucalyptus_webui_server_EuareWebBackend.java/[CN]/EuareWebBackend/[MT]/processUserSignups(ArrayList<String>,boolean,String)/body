{
  ArrayList<String> success=Lists.newArrayList();
  for (  String userId : userIds) {
    try {
      User user=Accounts.lookupUserById(userId);
      if (approve) {
        if (user.getRegistrationStatus().equals(RegistrationStatus.REGISTERED)) {
          user.setRegistrationStatus(RegistrationStatus.APPROVED);
          notifyUserApproval(user,backendUrl);
        }
      }
 else {
        notifyUserRejection(user,backendUrl);
        Account account=user.getAccount();
        account.deleteUser(user.getName(),false,true);
      }
      success.add(userId);
    }
 catch (    Exception e) {
      LOG.error("Failed to " + (approve ? "approve" : "reject") + " user "+ userId,e);
      LOG.debug(e,e);
    }
  }
  return success;
}
