{
  try {
    Account account=Accounts.lookupAccountByName(accountName);
    User user=account.lookupUserByName(userName);
    if (!user.isEnabled() || !RegistrationStatus.CONFIRMED.equals(user.getRegistrationStatus())) {
      throw new IllegalArgumentException("User is in invalid state");
    }
    if (email != null && email.equals(user.getInfo(User.EMAIL))) {
      long expires=System.currentTimeMillis() + User.RECOVERY_EXPIRATION;
      user.setConfirmationCode(String.format("%015d",expires) + Crypto.generateSessionToken());
      notifyUserPasswordReset(account.lookupUserByName(userName),backendUrl);
    }
 else {
      throw new IllegalArgumentException("Invalid user email address");
    }
  }
 catch (  Exception e) {
    LOG.error("Failed to initiate password reset for " + userName + " in "+ accountName,e);
    LOG.debug(e,e);
  }
}
