{
  try {
    User user=Accounts.lookupUserByConfirmationCode(confirmationCode);
    if (RegistrationStatus.APPROVED.equals(user.getRegistrationStatus())) {
      user.setRegistrationStatus(RegistrationStatus.CONFIRMED);
      user.setConfirmationCode(null);
    }
 else     if (RegistrationStatus.REGISTERED.equals(user.getRegistrationStatus())) {
      throw new IllegalArgumentException("User " + user + " is not approved");
    }
  }
 catch (  Exception e) {
    LOG.error("Failed to confirm user signup",e);
    LOG.debug(e,e);
    throw new EucalyptusServiceException("Failed to confirm user or account signup");
  }
}
