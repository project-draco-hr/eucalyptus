{
  if (userId == null) {
    throw new EucalyptusServiceException("Empty user ID");
  }
  try {
    User user=Accounts.lookupUserById(userId);
    if (!user.isEnabled() || !user.getRegistrationStatus().equals(RegistrationStatus.CONFIRMED)) {
      throw new EucalyptusServiceException("User is not enabled or confirmed");
    }
    return user;
  }
 catch (  EucalyptusServiceException e) {
    LOG.debug(e,e);
    throw e;
  }
catch (  Exception e) {
    LOG.error("Failed to verify user " + userId,e);
    LOG.debug(e,e);
    throw new EucalyptusServiceException("Failed to verify user " + userId + ": "+ e.getMessage());
  }
}
