{
  String remoteBrokerUrl=null;
  Component reportingComponent=Components.lookup(Reporting.class);
  if (null != reportingComponent && !reportingComponent.isEnabledLocally()) {
    log.info("Searching for remote reporting broker");
    if (remoteBrokerUrl == null) {
      throw new QueueRuntimeException("Unable to locate reporting broker over network");
    }
  }
 else {
    log.info("Reporting broker will run locally");
    remoteBrokerUrl=null;
  }
  try {
    brokerService=new BrokerService();
    brokerService.setBrokerName(brokerName);
    brokerService.setDataDirectory(brokerDataDir);
    brokerService.addConnector(brokerUrl);
    if (remoteBrokerUrl != null) {
      brokerService.addNetworkConnector(remoteBrokerUrl);
    }
    brokerService.setUseJmx(false);
    brokerService.start();
  }
 catch (  Exception ex) {
    throw new QueueRuntimeException(ex);
  }
  log.info("Broker started");
}
