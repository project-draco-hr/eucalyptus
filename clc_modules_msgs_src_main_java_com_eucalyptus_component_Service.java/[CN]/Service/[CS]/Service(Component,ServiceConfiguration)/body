{
  this.parent=parent;
  this.serviceConfiguration=serviceConfig;
  if ("cluster".equals(parent.getName()) && Components.lookup("eucalyptus").isLocal()) {
    this.name=parent.getName() + "@" + serviceConfig.getHostName();
    URI uri=this.parent.getIdentity().makeRemoteUri(serviceConfig.getHostName(),serviceConfig.getPort());
    this.endpoint=new ServiceEndpoint(this,false,uri);
  }
 else   if (serviceConfig.isLocal()) {
    URI uri=this.parent.getIdentity().getLocalEndpointUri();
    this.name=parent.getName() + LOCAL_HOSTNAME;
    this.endpoint=new ServiceEndpoint(this,true,uri);
  }
 else {
    Boolean local=false;
    try {
      if (serviceConfig.getHostName() != null) {
        local=NetworkUtil.testLocal(serviceConfig.getHostName());
      }
 else {
        local=true;
      }
    }
 catch (    Exception e) {
      local=true;
    }
    URI uri=null;
    if (!local) {
      this.name=parent.getName() + "@" + serviceConfig.getHostName();
      uri=this.parent.getIdentity().makeRemoteUri(serviceConfig.getHostName(),serviceConfig.getPort());
    }
 else {
      this.name=parent.getName() + LOCAL_HOSTNAME;
      uri=this.parent.getIdentity().getLocalEndpointUri();
    }
    this.endpoint=new ServiceEndpoint(this,local,uri);
  }
  this.keys=new ServiceCredentials(this);
  this.dispatcher=DispatcherFactory.build(parent,this);
}
