{
  this.id=id;
  this.serviceConfiguration=serviceConfig;
  this.fullName=this.id.getMyFullName(this.serviceConfiguration);
  if ("cluster".equals(id.getName()) && Components.lookup("eucalyptus").isLocal()) {
    this.name=id.getName() + "@" + serviceConfig.getHostName();
    URI uri=this.id.makeRemoteUri(serviceConfig.getHostName(),serviceConfig.getPort());
    this.endpoint=new ServiceEndpoint(this,false,uri);
  }
 else   if (serviceConfig.isLocal()) {
    URI uri=this.id.getLocalEndpointUri();
    this.name=id.getName() + LOCAL_HOSTNAME;
    this.endpoint=new ServiceEndpoint(this,true,uri);
  }
 else {
    Boolean local=false;
    try {
      if (serviceConfig.getHostName() != null) {
        local=NetworkUtil.testLocal(serviceConfig.getHostName());
      }
 else {
        local=true;
      }
    }
 catch (    Exception e) {
      local=true;
    }
    URI uri=null;
    if (!local) {
      this.name=id.getName() + "@" + serviceConfig.getHostName();
      uri=this.id.makeRemoteUri(serviceConfig.getHostName(),serviceConfig.getPort());
    }
 else {
      this.name=id.getName() + LOCAL_HOSTNAME;
      uri=this.id.getLocalEndpointUri();
    }
    this.endpoint=new ServiceEndpoint(this,local,uri);
  }
  this.dispatcher=DispatcherFactory.build(Components.lookup(id),this);
}
