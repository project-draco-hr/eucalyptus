{
  ServiceKey serviceKey=null;
  try {
    serviceKey=ServiceKey.create(config);
    Future<ServiceConfiguration> transition=ServiceTransitions.pathTo(config,Component.State.DISABLED);
    ServiceConfiguration result=transition.get();
    return result;
  }
 catch (  InterruptedException ex) {
    Thread.currentThread().interrupt();
    throw Exceptions.toUndeclared(ex);
  }
catch (  Exception ex) {
    LOG.error(ex,ex);
    throw Exceptions.toUndeclared(ex);
  }
 finally {
    if (serviceKey != null) {
      try {
        Topology.getInstance().getGuard().tryDisable(config);
      }
 catch (      ServiceRegistrationException ex) {
        LOG.error(ex,ex);
      }
    }
  }
}
