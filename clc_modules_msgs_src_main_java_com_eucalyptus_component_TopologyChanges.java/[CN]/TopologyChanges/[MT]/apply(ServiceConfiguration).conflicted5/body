{
  if (!Bootstrap.isFinished()) {
    return config;
  }
 else   if (!config.lookupStateMachine().isBusy()) {
    State initialState=config.lookupState();
    State nextState=config.lookupState();
    if (initialState.ordinal() < State.NOTREADY.ordinal()) {
      return config;
    }
 else     if (State.NOTREADY.equals(initialState)) {
      nextState=State.DISABLED;
    }
    try {
      Future<ServiceConfiguration> result=config.lookupStateMachine().transition(nextState);
      State endState=result.get().lookupState();
      LOG.debug(this.toString() + " completed for: " + result+ " trying "+ initialState+ "->"+ nextState+ " ended in: "+ endState);
      return result.get();
    }
 catch (    InterruptedException ex) {
      Thread.currentThread().interrupt();
      return config;
    }
catch (    Exception ex) {
      LOG.error(ex,ex);
      throw new UndeclaredThrowableException(ex);
    }
  }
 else {
    return config;
  }
}
