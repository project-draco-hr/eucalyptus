{
  LoadBalancer lb=null;
  try {
    lb=LoadBalancers.getLoadbalancer(evt.getContext().getUserFullName(),evt.getLoadBalancer());
  }
 catch (  NoSuchElementException ex) {
    throw new EventHandlerException("can't find the specified loadbalancer user owns",ex);
  }
catch (  Exception ex) {
    throw new EventHandlerException("can't query the loadbalancer due to unknown reason",ex);
  }
  final EntityTransaction db=Entities.get(LoadBalancerServoInstance.class);
  try {
    for (    String zoneName : evt.getZones()) {
      LoadBalancerZone lbZone=null;
      try {
        lbZone=LoadBalancers.findZone(lb,zoneName);
      }
 catch (      NoSuchElementException ex) {
        throw new EventHandlerException("Can't find the zone in user's loadbalancer (" + zoneName + ")",ex);
      }
catch (      Exception ex) {
        throw new EventHandlerException("Can't find the zone due to unknown reason");
      }
      final LoadBalancerServoInstance instance=LoadBalancerServoInstance.named(lbZone);
      instance.generateUniqueName();
      this.uniqueEntries.add(instance.getUniqueName());
      Entities.persist(instance);
    }
    db.commit();
  }
 catch (  Exception ex) {
    db.rollback();
    this.uniqueEntries.clear();
    throw new EventHandlerException("failed to persist the new loadbalancer VMs");
  }
}
