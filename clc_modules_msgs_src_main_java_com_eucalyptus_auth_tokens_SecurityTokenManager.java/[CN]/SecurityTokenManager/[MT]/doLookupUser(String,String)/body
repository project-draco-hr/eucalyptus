{
  Preconditions.checkNotNull(accessKeyId,"Access key identifier is required");
  Preconditions.checkNotNull(token,"Token is required");
  final EncryptedSecurityToken encryptedToken;
  try {
    encryptedToken=EncryptedSecurityToken.decrypt(accessKeyId,getEncryptionKey(accessKeyId),token);
  }
 catch (  GeneralSecurityException e) {
    log.debug(e,e);
    throw new AuthException("Invalid security token");
  }
  final Role role=lookupRoleById(encryptedToken.getRoleId());
  User user=roleAsUser(role);
  return user;
}
