{
  String certPem=new String(UrlBase64.encode(Hashes.getPemBytes(cert)));
  EntityWrapper<UserEntity> db=Credentials.getEntityWrapper();
  UserEntity u=null;
  try {
    u=db.getUnique(new UserEntity(userName));
    X509Cert x509cert=new X509Cert(alias);
    x509cert.setPemCertificate(certPem);
    u.getCertificates().add(x509cert);
    db.commit();
  }
 catch (  EucalyptusCloudException e) {
    LOG.error(e,e);
    LOG.error("username=" + userName + " \nalias="+ alias+ " \ncert="+ cert);
    db.rollback();
    throw new GeneralSecurityException(e);
  }
  return u;
}
