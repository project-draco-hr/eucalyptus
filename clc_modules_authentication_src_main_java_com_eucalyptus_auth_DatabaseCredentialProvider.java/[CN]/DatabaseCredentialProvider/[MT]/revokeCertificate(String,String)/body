{
  EntityWrapper<UserEntity> db=Credentials.getEntityWrapper();
  UserEntity u=null;
  try {
    u=db.getUnique(new UserEntity(userName));
  }
 catch (  EucalyptusCloudException e) {
    LOG.error(e,e);
    db.rollback();
    throw new NoSuchUserException("Failed to find user " + userName,e);
  }
  try {
    X509Cert remove=db.recast(X509Cert.class).getUnique(new X509Cert(alias));
    u.getCertificates().remove(remove);
    db.commit();
    return u;
  }
 catch (  EucalyptusCloudException e) {
    LOG.error(e,e);
    db.rollback();
    throw new NoSuchCertificateException("Failed to find certificate " + alias + " for user "+ userName,e);
  }
}
