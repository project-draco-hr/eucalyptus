{
  ServiceConfiguration config=Partitions.lookupService(ClusterController.class,allocInfo.getPartition());
  Cluster cluster=Clusters.lookup(config);
  final ResourceState state=cluster.getNodeState();
  final List<ResourceToken> tokens=state.requestResourceAllocation(allocInfo,tryAmount,maxAmount);
  final Supplier<ResourceToken> allocator=new Supplier<ResourceToken>(){
    Iterator<ResourceToken> iter=tokens.iterator();
    @Override public ResourceToken get(){
      return this.iter.next();
    }
  }
;
  List<ResourceToken> pendingTokens=RestrictedTypes.doAllocations(tokens.size(),allocator);
  allocInfo.getAllocationTokens().addAll(pendingTokens);
  return pendingTokens;
}
