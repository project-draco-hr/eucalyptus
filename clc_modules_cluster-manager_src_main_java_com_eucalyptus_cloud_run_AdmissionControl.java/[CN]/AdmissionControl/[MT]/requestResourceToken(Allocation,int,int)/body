{
  ServiceConfiguration config=Topology.lookup(ClusterController.class,allocInfo.getPartition());
  Cluster cluster=Clusters.lookup(config);
  final ResourceState state=cluster.getNodeState();
  final List<ResourceToken> tokens=state.requestResourceAllocation(allocInfo,tryAmount,maxAmount);
  final Supplier<ResourceToken> allocator=new Supplier<ResourceToken>(){
    Iterator<ResourceToken> iter=tokens.iterator();
    @Override public ResourceToken get(){
      ResourceToken ret=this.iter.next();
      allocInfo.getAllocationTokens().add(ret);
      return ret;
    }
  }
;
  RestrictedTypes.allocateUnitlessResources(tokens.size(),allocator);
  return allocInfo.getAllocationTokens();
}
