{
  final Long idStart;
  if (tempId.compareAndSet(-1l,this.messageId)) {
    lastSave.set(tempId.addAndGet(Counters.period));
    idStart=tempId.addAndGet(length);
  }
 else {
    idStart=tempId.addAndGet(length);
    if ((idStart - lastSave.get()) > 1000) {
      try {
        Transactions.one(Counters.uninitialized(),new Tx<Counters>(){
          @Override public void fire(          Counters t) throws Throwable {
            t.setMessageId(idStart);
          }
        }
);
      }
 catch (      ExecutionException ex) {
        LOG.error(ex,ex);
      }
      lastSave.set(idStart);
    }
  }
  return idStart;
}
