{
  EntityTransaction db=Entities.get(BlockStorageImageInfo.class);
  try {
    BlockStorageImageInfo ret=Entities.uniqueResult(Images.exampleBlockStorageWithImageId(identifier));
    if (ret.getKernelId().equals("windows") || ret.getImageName().startsWith("windows"))     ret.setPlatform(Platform.windows);
    if (!ImageMetadata.State.available.equals(ret.getState())) {
      db.rollback();
      throw new NoSuchElementException("Unable to start instance with deregistered image : " + ret);
    }
 else {
      db.rollback();
      return ret;
    }
  }
 catch (  Exception ex) {
    Logs.exhaust().error(ex,ex);
    db.rollback();
    throw new NoSuchElementException("Failed to lookup image: " + identifier + " because of "+ ex.getMessage());
  }
}
