{
  BootableSet bootSet=null;
  try {
    bootSet=new BootableSet(Lookups.doPrivileged(imageId,LookupMachine.INSTANCE));
  }
 catch (  Exception e) {
    try {
      bootSet=new BootableSet(Lookups.doPrivileged(imageId,LookupBlockStorage.INSTANCE));
    }
 catch (    AuthException ex) {
      LOG.error(ex,ex);
      throw new EucalyptusCloudException(ex);
    }
catch (    IllegalContextAccessException ex) {
      LOG.error(ex,ex);
      throw new EucalyptusCloudException(ex);
    }
catch (    NoSuchElementException ex) {
      LOG.error(ex,ex);
      throw new EucalyptusCloudException(ex);
    }
catch (    PersistenceException ex) {
      LOG.error(ex,ex);
      throw new EucalyptusCloudException(ex);
    }
  }
  if (bootSet.isLinux()) {
    bootSet=Emis.bootsetWithKernel(bootSet);
    bootSet=Emis.bootsetWithRamdisk(bootSet);
  }
  Emis.checkStoredImage(bootSet);
  bootSet.populateVirtualBootRecord(vmType);
  return bootSet;
}
