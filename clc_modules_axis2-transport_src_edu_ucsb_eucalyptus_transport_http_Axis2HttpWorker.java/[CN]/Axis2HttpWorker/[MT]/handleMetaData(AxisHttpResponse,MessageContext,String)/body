{
  try {
    String newUri=null;
    if (uri.startsWith("/latest/"))     newUri=uri.replaceAll("/latest/",msgContext.getProperty(MessageContext.REMOTE_ADDR) + ":");
 else     newUri=uri.replaceAll("/\\d\\d\\d\\d-\\d\\d-\\d\\d/",msgContext.getProperty(MessageContext.REMOTE_ADDR) + ":");
    LOG.debug("Metadata request: " + newUri);
    Object reply=Messaging.send("vm://VmMetadata",newUri);
    if (!(reply instanceof NullPayload)) {
      response.setStatus(HttpStatus.SC_OK);
      response.setContentType("text/html");
      OutputStream out=response.getOutputStream();
      out.write(EncodingUtils.getBytes(((String)reply),HTTP.ISO_8859_1));
    }
 else     response.setStatus(HttpStatus.SC_NOT_FOUND);
    return true;
  }
 catch (  Exception e) {
    LOG.error(e,e);
  }
  return false;
}
