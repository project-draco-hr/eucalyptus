{
  if (message instanceof MappingHttpRequest) {
    MappingHttpRequest httpRequest=(MappingHttpRequest)message;
    if (httpRequest.getMethod().equals(HttpMethod.POST)) {
      Map<String,String> parameters=new HashMap<String,String>(httpRequest.getParameters());
      Set<String> nonQueryParameters=Sets.newHashSet();
      final String query=httpRequest.getContentAsString();
      for (      String p : query.split("&")) {
        String[] splitParam=p.split("=",2);
        String lhs=splitParam[0];
        String rhs=splitParam.length == 2 ? splitParam[1] : null;
        try {
          if (lhs != null)           lhs=new URLCodec().decode(lhs);
        }
 catch (        DecoderException e) {
        }
        try {
          if (rhs != null)           rhs=new URLCodec().decode(rhs);
        }
 catch (        DecoderException e) {
        }
        parameters.put(lhs,rhs);
        nonQueryParameters.add(lhs);
      }
      for (      RequiredQueryParams p : requiredQueryParams) {
        if (!parameters.containsKey(p.toString())) {
          return false;
        }
      }
      httpRequest.getParameters().putAll(parameters);
      httpRequest.addNonQueryParameterKeys(nonQueryParameters);
    }
 else {
      for (      RequiredQueryParams p : requiredQueryParams) {
        if (!httpRequest.getParameters().containsKey(p.toString())) {
          return false;
        }
      }
    }
    final boolean usesServicePath=Iterables.any(servicePathPrefixes,Strings.isPrefixOf(message.getUri()));
    final boolean noPath=message.getUri().isEmpty() || message.getUri().equals("/") || message.getUri().startsWith("/?");
    return usesServicePath || (noPath && resolvesByHost(message.getHeader(HttpHeaders.Names.HOST)));
  }
  return false;
}
