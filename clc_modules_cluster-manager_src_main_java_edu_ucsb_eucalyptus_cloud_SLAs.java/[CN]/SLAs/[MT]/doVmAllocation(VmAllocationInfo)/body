{
  Collection<Cluster> clusterList=Clusters.getInstance().getEntries();
  SortedSet<ClusterNodeState> clusterStateList=new ConcurrentSkipListSet<ClusterNodeState>(ClusterNodeState.getComparator(vmAllocInfo.getVmTypeInfo()));
  for (  Cluster c : clusterList)   clusterStateList.add(c.getNodeState());
  Allocator blah=this.getAllocator();
  RunInstancesType request=vmAllocInfo.getRequest();
  List<ResourceToken> allocTokenList=blah.allocate(request.getCorrelationId(),request.getUserId(),vmAllocInfo.getVmTypeInfo().getName(),request.getMinCount(),request.getMaxCount(),clusterStateList);
  return allocTokenList;
}
