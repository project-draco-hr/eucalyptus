{
  try {
    Network existingNet=Networks.getInstance().lookup(net.getName());
    List<PacketFilterRule> rules=Lists.newArrayList();
    if (net.getRules().isEmpty()) {
      for (      PacketFilterRule pf : existingNet.getRules())       rules.add(PacketFilterRule.revoke(pf));
      existingNet.setRules(net.getRules());
    }
 else {
      existingNet.setRules(net.getRules());
      rules.addAll(existingNet.getRules());
    }
    ConfigureNetworkCallback configureNetwork=new ConfigureNetworkCallback(existingNet.getUserName(),rules);
    for (    Cluster c : Clusters.getInstance().listValues()) {
      Callbacks.newRequest(configureNetwork.newInstance()).dispatch(c.getServiceEndpoint());
    }
  }
 catch (  NoSuchElementException e) {
    LOG.error("Changed network rules not applied to inactive network: " + net.getName());
  }
}
