{
  if (!host.hasBootstrapped() || !host.hasDatabase() || host.isLocalHost()) {
    return;
  }
  for (  final String ctx : PersistenceContexts.list()) {
    final String contextName=ctx.startsWith("eucalyptus_") ? ctx : "eucalyptus_" + ctx;
    final String dbUrl="jdbc:" + ServiceUris.remote(Database.class,host.getBindAddress(),contextName);
    try {
      final DriverDatabaseClusterMBean cluster=findDbClusterMBean(contextName);
      final String dbPass=SystemIds.databasePassword();
      final String hostName=host.getBindAddress().getHostAddress();
      final String realJdbcDriver=Databases.getDriverName();
      if (!cluster.getActiveDatabases().contains(hostName) && !cluster.getInactiveDatabases().contains(hostName)) {
        cluster.add(hostName,realJdbcDriver,dbUrl);
      }
 else       if (cluster.getActiveDatabases().contains(hostName)) {
        cluster.deactivate(hostName);
      }
      final InactiveDatabaseMBean database=Mbeans.lookup(jdbcJmxDomain,ImmutableMap.builder().put("cluster",contextName).put("database",hostName).build(),InactiveDatabaseMBean.class);
      database.setUser("eucalyptus");
      database.setPassword(dbPass);
      if (!cluster.getActiveDatabases().contains(hostName)) {
        if (Hosts.Coordinator.INSTANCE.isLocalhost()) {
          cluster.activate(hostName,"full");
        }
 else {
          cluster.activate(hostName,"passive");
        }
      }
    }
 catch (    final NoSuchElementException ex1) {
      LOG.error(ex1,ex1);
    }
catch (    final Exception ex1) {
      LOG.error(ex1,ex1);
    }
  }
}
