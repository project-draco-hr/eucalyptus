{
  try {
    VolumeEntityWrapperManager volumeManager=new VolumeEntityWrapperManager();
    List<LVMVolumeInfo> volumes=volumeManager.getAllVolumeInfos();
    volumeManager.abort();
    for (    LVMVolumeInfo foundLVMVolumeInfo : volumes) {
      if (foundLVMVolumeInfo.getCleanup()) {
        VolumeOpMonitor monitor=getMonitor(foundLVMVolumeInfo.getVolumeId());
synchronized (monitor) {
          try {
            volumeManager=new VolumeEntityWrapperManager();
            String volumeId=foundLVMVolumeInfo.getVolumeId();
            LVMVolumeInfo volInfo=volumeManager.getVolumeInfo(volumeId);
            if (!volInfo.getCleanup()) {
              LOG.info("Volume: " + volumeId + " no longer marked for cleanup...aborting");
              volumeManager.abort();
              continue;
            }
            LOG.info("Cleaning up volume: " + foundLVMVolumeInfo.getVolumeId());
            try {
              exportManager.cleanup(volInfo);
              volumeManager.finish();
              LOG.info("Done cleaning up: " + volumeId);
              volInfo.setCleanup(false);
            }
 catch (            EucalyptusCloudException ee) {
              LOG.error(ee,ee);
              volumeManager.abort();
              continue;
            }
          }
  finally {
            monitor.notifyAll();
          }
        }
      }
    }
  }
 catch (  Exception ex) {
    LOG.error(ex,ex);
  }
}
