{
  try {
    User requestUser=ContextUtils.getRequestUser();
    Class<? extends BaseMessage> requestMessageClass=ContextUtils.getRequestMessageClass();
    String userId=requestUser.getUserId();
    String accountId=requestUser.getAccount().getAccountId();
    String resourceType=getResourceType(resourceClass);
    String action=getAction(requestMessageClass);
    List<Authorization> matchedAuths=lookupMatchedAuthorizations(resourceType,userId,accountId);
    return processAuthorizations(matchedAuths,action,resourceName);
  }
 catch (  AuthException e) {
    throw e;
  }
catch (  IllegalContextAccessException e) {
    throw new AuthException("Cannot invoke without a corresponding service context available.",e);
  }
catch (  Throwable e) {
    throw new AuthException("An error occurred while trying to evaluate policy for resource access",e);
  }
}
