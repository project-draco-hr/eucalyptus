{
  try {
    ContractKeyEvaluator contractEval=new ContractKeyEvaluator(contracts);
    CachedKeyEvaluator keyEval=new CachedKeyEvaluator();
    if (!requestUser.isSystemAdmin() && !requestUser.isSystemInternal()) {
      String userId=requestUser.getUserId();
      Account account=requestUser.getAccount();
      if (!requestUser.isAccountAdmin()) {
        Decision decision=processAuthorizations(lookupLocalAuthorizations(resourceType,requestUser),action,resourceName,keyEval,contractEval);
        if (decision == Decision.DENY || decision == Decision.DEFAULT) {
          LOG.debug("Request is rejected by local authorization check, due to decision " + decision);
          throw new AuthException(AuthException.ACCESS_DENIED);
        }
      }
    }
  }
 catch (  AuthException e) {
    LOG.debug(e,e);
    throw e;
  }
catch (  Throwable e) {
    LOG.debug(e,e);
    throw new AuthException("An error occurred while trying to evaluate policy for resource access",e);
  }
}
