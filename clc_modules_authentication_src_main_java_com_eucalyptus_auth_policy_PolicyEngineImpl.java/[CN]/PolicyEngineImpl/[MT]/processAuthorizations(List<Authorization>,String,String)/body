{
  CachedKeyEvaluator keyEval=new CachedKeyEvaluator();
  for (  Authorization auth : authorizations) {
    if (!Pattern.matches(PatternUtils.toJavaPattern(auth.getActionPattern()),action)) {
      continue;
    }
    if (!Pattern.matches(PatternUtils.toJavaPattern(auth.getResourcePattern()),resource)) {
      continue;
    }
    if (!evaluateConditions(auth,keyEval)) {
      continue;
    }
    if (auth.getEffect() == EffectType.Deny) {
      throw new AuthException(AuthException.ACCESS_DENIED);
    }
 else {
      return;
    }
  }
  throw new AuthException(AuthException.ACCESS_DENIED);
}
