{
  CachedKeyEvaluator keyEval=new CachedKeyEvaluator();
  ContractKeyEvaluator contractEval=new ContractKeyEvaluator();
  for (  Authorization auth : authorizations) {
    if (!Pattern.matches(PatternUtils.toJavaPattern(auth.getActionPattern()),action)) {
      continue;
    }
    if (!Pattern.matches(PatternUtils.toJavaPattern(auth.getResourcePattern()),resource)) {
      continue;
    }
    if (!evaluateConditions(auth.getConditions(),action,auth.getResourceType(),keyEval,contractEval)) {
      continue;
    }
    if (auth.getEffect() == EffectType.Deny) {
      throw new AuthException(AuthException.ACCESS_DENIED);
    }
 else {
      return contractEval.getContracts();
    }
  }
  throw new AuthException(AuthException.ACCESS_DENIED);
}
