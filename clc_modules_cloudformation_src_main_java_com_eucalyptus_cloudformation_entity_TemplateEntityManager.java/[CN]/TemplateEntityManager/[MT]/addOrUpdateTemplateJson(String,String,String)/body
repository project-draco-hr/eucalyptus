{
  try (TransactionResource db=Entities.transactionFor(TemplateEntity.class)){
    Criteria criteria=Entities.createCriteria(TemplateEntity.class).add(Restrictions.eq("accountId",accountId)).add(Restrictions.eq("stackId",stackId)).add(Restrictions.eq("recordDeleted",Boolean.FALSE));
    List<TemplateEntity> entityList=criteria.list();
    if (entityList != null && !entityList.isEmpty()) {
      for (      TemplateEntity templateEntity : entityList) {
        templateEntity.setTemplateJson(templateJson);
      }
    }
 else {
      TemplateEntity templateEntity=new TemplateEntity();
      templateEntity.setTemplateJson(templateJson);
      templateEntity.setAccountId(accountId);
      templateEntity.setStackId(stackId);
      templateEntity.setRecordDeleted(Boolean.FALSE);
      Entities.persist(templateEntity);
    }
    db.commit();
  }
 }
