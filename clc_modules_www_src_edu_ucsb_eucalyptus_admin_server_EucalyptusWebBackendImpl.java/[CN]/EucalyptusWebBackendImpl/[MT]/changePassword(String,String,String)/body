{
  SessionInfo session=verifySession(sessionId);
  UserInfoWeb user=verifyUser(session,session.getUserId(),false);
  if (!user.isConfirmed()) {
    throw new SerializableException("Unconfirmed account (click on the link in confirmation email)");
  }
  if (!isPasswordExpired((UserInfoWeb)user)) {
    if (!oldPassword.equals(user.getBCryptedPassword())) {
      throw new SerializableException("Old password is incorrect");
    }
  }
  user.setBCryptedPassword(newPassword);
  final long now=System.currentTimeMillis();
  user.setPasswordExpires(new Long(now + pass_expiration_ms));
  EucalyptusManagement.commitWebUser(user);
  return "Your password has been changed";
}
