{
  SessionInfo session=verifySession(sessionId);
  UserInfoWeb callerRecord=verifyUser(session,session.getUserId(),true);
  String userName=newRecord.getUserName();
  UserInfoWeb oldRecord;
  try {
    oldRecord=EucalyptusManagement.getWebUser(userName);
  }
 catch (  Exception e) {
    throw new SerializableException("Username '" + userName + "' not found");
  }
  if (!callerRecord.isAdministrator() && !callerRecord.getUserName().equals(userName)) {
    throw new SerializableException("Operation restricted to owner and administrator");
  }
  oldRecord.setRealName(newRecord.getRealName());
  oldRecord.setEmail(newRecord.getEmail());
  oldRecord.setBCryptedPassword(newRecord.getBCryptedPassword());
  oldRecord.setTelephoneNumber(newRecord.getTelephoneNumber());
  oldRecord.setAffiliation(newRecord.getAffiliation());
  oldRecord.setProjectDescription(newRecord.getProjectDescription());
  oldRecord.setProjectPIName(newRecord.getProjectPIName());
  oldRecord.setIsAdministrator(newRecord.isAdministrator());
  if (!oldRecord.isConfirmed() && newRecord.isConfirmed()) {
    oldRecord.setIsConfirmed(true);
    oldRecord.setIsEnabled(true);
    oldRecord.setIsApproved(true);
  }
  EucalyptusManagement.commitWebUser(oldRecord);
  return "Account updated";
}
