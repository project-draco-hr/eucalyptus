{
  final Name name=query.getName();
  InetAddress requestIp=InstanceDomainName.toInetAddress(name.relativize(InstanceDomainName.INSTANCE.get()));
  Address addr=Addresses.getInstance().lookup(requestIp.getHostAddress());
  String instancePrivAddr=addr.getInstanceAddress();
  if (addr.isAssigned()) {
    return DnsResponse.forName(name).answer(DomainNameRecords.addressRecord(name,InetAddresses.forString(instancePrivAddr)));
  }
 else {
    return DnsResponse.forName(name).answer(DomainNameRecords.addressRecord(name,requestIp));
  }
}
