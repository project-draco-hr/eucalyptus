{
  final Optional<VmDnsInfo> vmInfo=lookupPublic(address);
  if (vmInfo.isPresent()) {
    final String vpcId=vmInfo.get().getVpcId();
    if (vpcId != null) {
      return vpcCache.getUnchecked(vpcId).transform(VpcDnsInfo.cidr());
    }
 else {
      final InetAddress privateAddress=AddressRegistry.getInstance().contains(address.getHostAddress()) ? InetAddresses.forString(vmInfo.get().getPrivateIp()) : address;
      for (      final Cidr cidr : clusterSubnetsSupplier.get()) {
        if (cidr.contains(privateAddress.getHostAddress())) {
          return Optional.of(cidr);
        }
      }
    }
  }
  return Optional.absent();
}
