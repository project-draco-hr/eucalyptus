{
  Collection<Cluster> clusterList=Clusters.getInstance().getEntries();
  Comparator<ClusterState> comparator=ClusterState.getComparator(vmAllocInfo.getVmTypeInfo());
  SortedSet<ClusterState> clusterStateList=new ConcurrentSkipListSet<ClusterState>(comparator);
  for (  Cluster c : clusterList)   clusterStateList.add(c.getState());
  Allocator blah=this.getAllocator();
  RunInstancesType request=vmAllocInfo.getRequest();
  List<ResourceToken> allocTokenList=blah.allocate(request.getCorrelationId(),request.getUserId(),vmAllocInfo.getVmTypeInfo().getName(),request.getMinCount(),request.getMaxCount(),clusterStateList);
  return allocTokenList;
}
