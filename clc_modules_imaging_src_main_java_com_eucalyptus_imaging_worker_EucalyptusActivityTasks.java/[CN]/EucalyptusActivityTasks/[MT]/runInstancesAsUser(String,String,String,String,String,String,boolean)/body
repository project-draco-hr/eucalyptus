{
  if (userId == null || userId.length() <= 0)   throw new IllegalArgumentException("User ID is required");
  if (imageId == null || imageId.length() <= 0)   throw new IllegalArgumentException("Image ID is required");
  final EucalyptusRunInstancesTask task=new EucalyptusRunInstancesTask(imageId);
  task.setGroupName(groupName);
  task.setUserData(userData);
  task.setInstanceType(instanceType);
  task.setAvailabilityZone(availabilityZone);
  task.setMonitoring(monitoring);
  final CheckedListenableFuture<Boolean> result=task.dispatch(new EucalyptusUserActivity(userId));
  try {
    if (result.get())     return task.getInstanceId();
 else     throw new EucalyptusActivityException("failed to run instances");
  }
 catch (  final Exception ex) {
    throw Exceptions.toUndeclared(ex);
  }
}
