{
  if (SubDirectory.DB.getChildFile("data","disabled.lock").exists()) {
    LOG.error("WARNING : DISABLED CLC STARTED OUT OF ORDER, REMOVE THE disabled.lock FILE TO PROCEED WITH RISK");
    System.exit(1);
  }
  Hosts.awaitDatabases();
  Groovyness.run("setup_dbpool.groovy");
  OrderedShutdown.registerShutdownHook(Empyrean.class,new Runnable(){
    @Override public void run(){
      try {
        for (        String ctx : PersistenceContexts.list()) {
          try {
            DriverDatabaseClusterMBean db=Databases.lookup(ctx);
            for (            String host : db.getInactiveDatabases()) {
              Databases.disable(host);
            }
            for (            String host : db.getActiveDatabases()) {
              Databases.disable(host);
            }
          }
 catch (          Exception ex) {
            LOG.error(ex);
          }
        }
      }
 catch (      NoSuchElementException ex) {
        LOG.error(ex);
      }
    }
  }
);
  TimeUnit.SECONDS.sleep(INITIAL_DB_SYNC_RETRY_WAIT);
  if (!Hosts.isCoordinator() && Hosts.localHost().hasDatabase()) {
    while (!Databases.enable(Hosts.localHost())) {
      LOG.warn(LogUtil.subheader("Synchronization of the database failed: " + Hosts.localHost()));
      if (counter.decrementAndGet() == 0) {
        LOG.fatal("Restarting process to force re-synchronization.");
        System.exit(123);
      }
 else {
        LOG.warn("Sleeping for " + INITIAL_DB_SYNC_RETRY_WAIT + " seconds before trying again.");
        TimeUnit.SECONDS.sleep(INITIAL_DB_SYNC_RETRY_WAIT);
      }
    }
    if (SubDirectory.DB.getChildFile("data","disabled.lock").createNewFile()) {
      LOG.debug("The disabled.lock file was created.");
    }
    Hosts.UpdateEntry.INSTANCE.apply(Hosts.localHost());
    LOG.info(LogUtil.subheader("Database synchronization complete: " + Hosts.localHost()));
  }
  return true;
}
