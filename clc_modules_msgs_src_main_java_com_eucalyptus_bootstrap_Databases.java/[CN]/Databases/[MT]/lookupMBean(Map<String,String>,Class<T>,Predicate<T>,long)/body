{
  long until=System.currentTimeMillis() + timeout;
  do   try {
    final T bean=Mbeans.lookup(jdbcJmxDomain,props,type);
    tester.apply(bean);
    return bean;
  }
 catch (  UndeclaredThrowableException e) {
    if (Exceptions.isCausedBy(e,InstanceNotFoundException.class)) {
      if (System.currentTimeMillis() < until) {
        try {
          TimeUnit.SECONDS.sleep(5);
        }
 catch (        InterruptedException e1) {
          Thread.interrupted();
          break;
        }
        LOG.debug("Waiting for MBean " + type.getSimpleName() + "/"+ props);
        continue;
      }
      throw new NoSuchElementException(type.getSimpleName() + " " + props.toString());
    }
 else {
      throw Exceptions.toUndeclared(e);
    }
  }
 while (System.currentTimeMillis() < until);
  throw new NoSuchElementException(type.getSimpleName() + " " + props.toString());
}
