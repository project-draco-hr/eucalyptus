{
  EntityWrapper<ClusterCredentials> credDb=EntityWrapper.get(ClusterCredentials.class);
  try {
    for (    ClusterCredentials ccert : credDb.query(new ClusterCredentials())) {
      LOG.debug("Checking cluster certificate: " + ccert.getClusterName() + "\n"+ X509Cert.toCertificate(ccert.getClusterCertificate())+ "\n"+ X509Cert.toCertificate(ccert.getNodeCertificate()));
      if (config.getName().equals(ccert.getClusterName())) {
        credDb.recast(X509Cert.class).delete(ccert.getClusterCertificate());
        credDb.recast(X509Cert.class).delete(ccert.getNodeCertificate());
        credDb.delete(ccert);
        LOG.debug("Deleting cluster certificate: " + ccert.getClusterName() + "\n"+ X509Cert.toCertificate(ccert.getClusterCertificate())+ "\n"+ X509Cert.toCertificate(ccert.getNodeCertificate()));
      }
    }
    credDb.commit();
  }
 catch (  Exception e) {
    LOG.error(e,e);
    credDb.rollback();
  }
}
