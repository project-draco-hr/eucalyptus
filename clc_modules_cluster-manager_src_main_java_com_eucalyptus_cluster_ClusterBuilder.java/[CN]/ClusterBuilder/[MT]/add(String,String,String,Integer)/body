{
  ClusterConfiguration prelimConfig=this.newInstance(partitionName,name,host,port);
  try {
    Partition part=Partitions.lookup(prelimConfig);
    ServiceConfigurations.getInstance().store(prelimConfig);
    try {
      GroovyUtil.exec("ln -sf " + part.getKeyDirectory().getAbsolutePath() + " "+ SubDirectory.KEYS.getChildPath(name));
    }
 catch (    ScriptExecutionFailedException ex) {
      LOG.error(ex,ex);
    }
  }
 catch (  ServiceRegistrationException ex) {
    Partitions.maybeRemove(prelimConfig.getPartition());
    throw ex;
  }
catch (  Throwable ex) {
    Partitions.maybeRemove(prelimConfig.getPartition());
    LOG.error(ex,ex);
    throw new ServiceRegistrationException(String.format("Unexpected error caused cluster registration to fail for: partition=%s name=%s host=%s port=%d",partitionName,name,host,port),ex);
  }
  return prelimConfig;
}
