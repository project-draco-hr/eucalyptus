{
  ClusterConfiguration config=this.newInstance(partitionName,name,host,port);
  try {
    Partition part=Partitions.lookup(config);
    ServiceConfigurations.getInstance().store(config);
    part.link(config);
  }
 catch (  ServiceRegistrationException ex) {
    Partitions.maybeRemove(config.getPartition());
    throw ex;
  }
catch (  Throwable ex) {
    Partitions.maybeRemove(config.getPartition());
    LOG.error(ex,ex);
    throw new ServiceRegistrationException(String.format("Unexpected error caused cluster registration to fail for: partition=%s name=%s host=%s port=%d",partitionName,name,host,port),ex);
  }
  return config;
}
