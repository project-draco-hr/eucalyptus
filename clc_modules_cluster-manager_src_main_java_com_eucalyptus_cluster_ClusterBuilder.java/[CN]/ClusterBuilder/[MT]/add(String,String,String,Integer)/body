{
  ClusterConfiguration prelimConfig=this.newInstance(partition,name,host,port);
  try {
    Partitions.lookup(prelimConfig);
    ServiceConfigurations.getInstance().store(prelimConfig);
  }
 catch (  ServiceRegistrationException ex) {
    Partitions.maybeRemove(prelimConfig.getPartition());
    throw ex;
  }
catch (  Throwable ex) {
    Partitions.maybeRemove(prelimConfig.getPartition());
    LOG.error(ex,ex);
    throw new ServiceRegistrationException(String.format("Unexpected error caused cluster registration to fail for: partition=%s name=%s host=%s port=%d",partition,name,host,port),ex);
  }
  return prelimConfig;
}
