{
  Cluster cluster=Clusters.getInstance().lookup(config.getName());
  EntityWrapper<ClusterCredentials> credDb=Authentication.getEntityWrapper();
  try {
    ClusterCredentials creds=credDb.getUnique(new ClusterCredentials(cluster.getName()));
    credDb.delete(creds);
    credDb.commit();
  }
 catch (  EucalyptusCloudException ex) {
    LOG.error(ex,ex);
    credDb.rollback();
  }
  Clusters.stop(cluster.getName());
  for (  Group g : Groups.listAllGroups()) {
    for (    Authorization auth : g.getAuthorizations()) {
      if (auth instanceof AvailabilityZonePermission && config.getName().equals(auth.getValue())) {
        g.removeAuthorization(auth);
      }
    }
  }
  String directory=SubDirectory.KEYS.toString() + File.separator + config.getName();
  File keyDir=new File(directory);
  if (keyDir.exists()) {
    for (    File f : keyDir.listFiles()) {
      if (f.delete()) {
        LOG.info("Removing cluster key file: " + f.getAbsolutePath());
      }
 else {
        LOG.info("Failed to remove cluster key file: " + f.getAbsolutePath());
      }
    }
    if (keyDir.delete()) {
      LOG.info("Removing cluster key directory: " + keyDir.getAbsolutePath());
    }
 else {
      LOG.info("Failed to remove cluster key directory: " + keyDir.getAbsolutePath());
    }
  }
  super.fireStop(config);
}
