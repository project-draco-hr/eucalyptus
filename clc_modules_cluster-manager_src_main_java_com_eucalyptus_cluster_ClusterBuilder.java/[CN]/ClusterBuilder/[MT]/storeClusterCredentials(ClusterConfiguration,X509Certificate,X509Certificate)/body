{
  EntityWrapper<ClusterCredentials> credDb=EntityWrapper.get(ClusterCredentials.class);
  try {
    List<ClusterCredentials> ccCreds=credDb.query(new ClusterCredentials(config.getName()));
    for (    ClusterCredentials ccert : ccCreds) {
      credDb.delete(ccert);
    }
    ClusterCredentials componentCredentials=new ClusterCredentials(config.getName());
    componentCredentials.setClusterCertificate(X509CertHelper.fromCertificate(clusterX509));
    componentCredentials.setNodeCertificate(X509CertHelper.fromCertificate(nodeX509));
    credDb.add(componentCredentials);
    credDb.commit();
  }
 catch (  Throwable e) {
    LOG.error(e,e);
    credDb.rollback();
    throw new ServiceRegistrationException("Failed to store cluster credentials during registration: " + config,e);
  }
}
