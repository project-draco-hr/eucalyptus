{
  String name=Param.name.get(req);
  String type=Param.type.get(req);
  String url=String.format("%s_%s?createDatabaseIfNotExist=true",Component.db.getUri().toString(),"records");
  Type reportType=Type.valueOf(type);
  final JRExporter exporter=reportType.setup(res);
  try {
    JasperDesign jasperDesign=JRXmlLoader.load(BaseDirectory.CONF.toString() + File.separator + name+ ".jrxml");
    JasperReport jasperReport=JasperCompileManager.compileReport(jasperDesign);
    Connection jdbcConnection=DriverManager.getConnection(url,"eucalyptus",Hmacs.generateSystemSignature());
    JasperPrint jasperPrint=JasperFillManager.fillReport(jasperReport,null,jdbcConnection);
    exporter.setParameter(JRExporterParameter.JASPER_PRINT,jasperPrint);
    exporter.exportReport();
  }
 catch (  Throwable ex) {
    res.setContentType("text/plain");
    LOG.error("Could not create the report stream " + ex.getMessage() + " "+ ex.getLocalizedMessage());
    ex.printStackTrace(res.getWriter());
  }
 finally {
    reportType.close(res);
  }
}
