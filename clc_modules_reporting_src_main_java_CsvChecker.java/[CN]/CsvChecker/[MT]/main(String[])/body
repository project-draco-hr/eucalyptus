{
  if (args.length != 3) {
    printHelp();
    System.exit(-1);
  }
  final double errorMargin=Double.parseDouble(args[0]);
  final File checkedFile=new File(args[1]);
  final File referenceFile=new File(args[2]);
  final List<ReferenceLine> refLines=new ArrayList<ReferenceLine>();
  boolean passed=true;
  BufferedReader checkedReader=null;
  BufferedReader refReader=null;
  try {
    checkedReader=new BufferedReader(new FileReader(checkedFile));
    refReader=new BufferedReader(new FileReader(referenceFile));
    for (String line=refReader.readLine(); line != null; line=refReader.readLine()) {
      refLines.add(ReferenceLine.parseLine(line));
    }
    String[] fields;
    int lineCnt=0;
    int refLineNum=0;
    for (String line=checkedReader.readLine(); line != null; line=checkedReader.readLine()) {
      fields=line.split(",");
      refLineNum=0;
      for (      ReferenceLine refLine : refLines) {
        passed=passed && (refLine.shouldMatch(fields) && refLine.doesMatch(fields,errorMargin));
        if (!passed) {
          System.err.printf("Failed checkLine:%d refLine:%d\n",lineCnt,refLineNum);
          break;
        }
        refLineNum++;
      }
      lineCnt++;
    }
  }
 catch (  IOException iox) {
    if (checkedReader != null)     checkedReader.close();
    if (refReader != null)     refReader.close();
  }
  System.exit(passed ? 0 : 1);
}
