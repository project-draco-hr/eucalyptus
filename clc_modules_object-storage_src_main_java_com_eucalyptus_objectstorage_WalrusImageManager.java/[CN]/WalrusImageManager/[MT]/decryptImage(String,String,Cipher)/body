{
  LOG.info("Decrypting image: " + decryptedImageName);
  BufferedOutputStream out=new BufferedOutputStream(new FileOutputStream(new File(decryptedImageName)));
  File inFile=new File(encryptedImageName);
  BufferedInputStream in=new BufferedInputStream(new FileInputStream(inFile));
  int bytesRead=0;
  byte[] bytes=new byte[8192];
  try {
    while ((bytesRead=in.read(bytes)) > 0) {
      byte[] outBytes=cipher.update(bytes,0,bytesRead);
      out.write(outBytes);
    }
    byte[] outBytes=cipher.doFinal();
    out.write(outBytes);
  }
 catch (  IOException ex) {
    LOG.error(ex);
    Logs.extreme().error(ex,ex);
    throw ex;
  }
 finally {
    try {
      out.close();
    }
 catch (    IOException ex) {
      LOG.error(ex);
    }
    try {
      in.close();
    }
 catch (    IOException ex) {
      LOG.error(ex);
    }
  }
  LOG.info("Done decrypting: " + decryptedImageName);
}
