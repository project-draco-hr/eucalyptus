{
  Bucket bucket;
  try {
    bucket=getBucketAndCheckAuthorization(request);
  }
 catch (  NoSuchBucketException e) {
    bucket=null;
  }
  if (bucket != null) {
    try {
      if (ObjectMetadataManagers.getInstance().countValid(bucket) > 0) {
        throw new BucketNotEmptyException(bucket.getBucketName());
      }
    }
 catch (    S3Exception e) {
      throw e;
    }
catch (    Exception e) {
      LOG.warn("Problem with bucket deletion during emptiness checks",e);
      throw new InternalErrorException(e);
    }
    try {
      OsgBucketFactory.getFactory().deleteBucket(ospClient,bucket,request.getCorrelationId(),Contexts.lookup().getUser());
    }
 catch (    Exception e) {
      LOG.warn("CorrelationId: " + Contexts.lookup().getCorrelationId() + " Responding to client with 500 InternalError because of:",e);
      throw new InternalErrorException(request.getKey(),e);
    }
  }
  DeleteBucketResponseType reply=request.getReply();
  reply.setStatus(HttpResponseStatus.NO_CONTENT);
  reply.setStatusMessage("NoContent");
  LOG.info("CorrelationId: " + request.getCorrelationId() + " Responding with "+ reply.getStatus().toString());
  return reply;
}
