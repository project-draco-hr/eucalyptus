{
  T output=null;
  CephRbdConnectionManager conn=null;
  try {
    if (imageName.contains("vol-")) {
      conn=CephRbdConnectionManager.getRandomVolumePoolConnection(config);
    }
 else {
      conn=CephRbdConnectionManager.getRandomSnapshotPoolConnection(config);
    }
    output=function.apply(conn);
  }
 catch (  EucalyptusCephException e) {
    throw e;
  }
catch (  Exception e) {
    throw new EucalyptusCephException("Caught error during ceph operation" + e);
  }
 finally {
    if (conn != null) {
      conn.disconnect();
    }
  }
  return output;
}
