{
  SystemConfiguration sysConf=s != null ? s : new SystemConfiguration();
  if (sysConf.getRegistrationId() == null) {
    sysConf.setRegistrationId(UUID.randomUUID().toString());
  }
  if (sysConf.getCloudHost() == null) {
    String ipAddr=SystemConfiguration.getInternalIpAddress();
    sysConf.setCloudHost(ipAddr);
  }
  if (sysConf.getDefaultKernel() == null) {
    EntityWrapper<KernelImageInfo> db2=EntityWrapper.get(KernelImageInfo.class);
    try {
      List<KernelImageInfo> res=db2.query(Images.exampleKernelWithImageId(null));
      if (res.size() > 0)       sysConf.setDefaultKernel(res.get(0).getDisplayName());
      db2.commit();
    }
 catch (    Exception e) {
      db2.rollback();
    }
  }
  if (sysConf.getDefaultRamdisk() == null) {
    EntityWrapper<RamdiskImageInfo> db2=EntityWrapper.get(RamdiskImageInfo.class);
    try {
      List<RamdiskImageInfo> res=db2.query(Images.exampleRamdiskWithImageId(null));
      if (res.size() > 0)       sysConf.setDefaultRamdisk(res.get(0).getDisplayName());
      db2.commit();
    }
 catch (    Exception e) {
      db2.rollback();
    }
  }
  if (sysConf.getDnsDomain() == null) {
    sysConf.setDnsDomain(DNSProperties.DOMAIN);
  }
  if (sysConf.getNameserver() == null) {
    sysConf.setNameserver(DNSProperties.NS_HOST);
  }
  if (sysConf.getNameserverAddress() == null) {
    sysConf.setNameserverAddress(DNSProperties.NS_IP);
  }
  if (sysConf.getMaxUserPublicAddresses() == null) {
    sysConf.setMaxUserPublicAddresses(5);
  }
  if (sysConf.isDoDynamicPublicAddresses() == null) {
    sysConf.setDoDynamicPublicAddresses(true);
  }
  if (sysConf.getSystemReservedPublicAddresses() == null) {
    sysConf.setSystemReservedPublicAddresses(10);
  }
  return sysConf;
}
