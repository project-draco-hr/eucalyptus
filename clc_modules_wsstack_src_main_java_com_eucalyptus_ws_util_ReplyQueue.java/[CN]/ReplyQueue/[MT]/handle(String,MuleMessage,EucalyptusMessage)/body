{
  EucalyptusMessage reply=null;
  if (responseMessage.getExceptionPayload() == null) {
    reply=(EucalyptusMessage)responseMessage.getPayload();
  }
 else {
    Throwable t=responseMessage.getExceptionPayload().getException();
    t=(t.getCause() == null) ? t : t.getCause();
    reply=new EucalyptusErrorMessageType(service,request,t.getMessage());
  }
  String corrId=reply.getCorrelationId();
  ChannelHandlerContext ctx=pending.remove(corrId);
  Channels.write(ctx.getChannel(),reply);
}
