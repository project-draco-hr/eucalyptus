{
  final String accountName=credentials.getAccount();
  final String username=credentials.getUsername();
  final String password=credentials.getPassword();
  final String newPassword=credentials.getNewPassword();
  final Account account;
  final User user;
  try {
    account=Accounts.lookupAccountByName(accountName);
    user=account.lookupUserByName(username);
  }
 catch (  final AuthException e) {
    throw new FailedLoginException();
  }
  PasswordAuthentication.authenticate(user,password,newPassword);
  super.setCredential(credentials.getAccountUsername());
  super.setPrincipal(user);
  return true;
}
