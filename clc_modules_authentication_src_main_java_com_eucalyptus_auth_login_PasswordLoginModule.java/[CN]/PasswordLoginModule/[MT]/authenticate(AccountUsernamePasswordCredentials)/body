{
  final String accountName=credentials.getAccount();
  final String username=credentials.getUsername();
  final String password=credentials.getPassword();
  final Account account;
  final User user;
  try {
    account=Accounts.lookupAccountByName(accountName);
    user=account.lookupUserByName(username);
  }
 catch (  final AuthException e) {
    throw new FailedLoginException();
  }
  PasswordAuthentication.authenticate(user,password);
  if (Objects.firstNonNull(user.getPasswordExpires(),Long.MAX_VALUE) < System.currentTimeMillis()) {
    throw new CredentialExpiredException();
  }
  super.setCredential(credentials.getAccountUsername());
  super.setPrincipal(user);
  return true;
}
