{
  signature=signature.replaceAll("=","");
  try {
    final AccessKey key=AccessKeys.lookupAccessKey(accessKeyID,httpRequest.getHeader(WalrusProperties.X_AMZ_SECURITY_TOKEN));
    final User user=key.getUser();
    final String queryKey=key.getSecretKey();
    final String authSig=checkSignature(queryKey,data);
    if (!authSig.equals(signature))     throw new AuthenticationException("User authentication failed. Could not verify signature");
    Contexts.lookup(httpRequest.getCorrelationId()).setUser(user);
  }
 catch (  Exception ex) {
    throw new AuthenticationException("User authentication failed. Unable to obtain query key");
  }
}
