{
  ConfirmProductInstanceResponseType reply=(ConfirmProductInstanceResponseType)request.getReply();
  reply.set_return(false);
  VmInstance vm=null;
  try {
    vm=VmInstances.getInstance().lookup(request.getInstanceId());
    EntityWrapper<ImageInfo> db=new EntityWrapper<ImageInfo>();
    try {
      ImageInfo found=db.getUnique(new ImageInfo(vm.getImageInfo().getImageId()));
      if (found.getProductCodes().contains(new ProductCode(request.getProductCode()))) {
        reply.set_return(true);
        reply.setOwnerId(found.getImageOwnerId());
      }
    }
 catch (    EucalyptusCloudException e) {
    }
 finally {
      db.commit();
    }
  }
 catch (  NoSuchElementException e) {
  }
  return reply;
}
