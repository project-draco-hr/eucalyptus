{
  DeregisterImageResponseType reply=(DeregisterImageResponseType)request.getReply();
  EntityWrapper<ImageInfo> db=new EntityWrapper<ImageInfo>();
  ImageInfo imgInfo=null;
  try {
    imgInfo=db.getUnique(new ImageInfo(request.getImageId()));
    if (!imgInfo.getImageOwnerId().equals(request.getUserId()) && !request.isAdministrator())     throw new EucalyptusCloudException("Only the owner of a registered image or the administrator can deregister it.");
    WalrusUtil.invalidate(imgInfo);
    db.commit();
    reply.set_return(true);
  }
 catch (  EucalyptusCloudException e) {
    reply.set_return(false);
    db.rollback();
  }
  return reply;
}
