{
  try {
    VolumeToken tok=getCurrentValidToken();
    if (tok == null) {
      LOG.warn("Got request for attachment token, no valid token found for volume  " + this.getVolumeId());
      throw new EucalyptusCloudException("No valid token found");
    }
 else {
      if (!tokenValue.equals(tok.getToken())) {
        LOG.warn("Token requested is not the current valid token for volume " + this.getVolumeId() + " request token: "+ tokenValue+ " current token: "+ tok.getToken());
        throw new EucalyptusCloudException("Requested token is not the current valid token");
      }
 else {
        return tok;
      }
    }
  }
 catch (  Exception e) {
    LOG.error("Error checking for valid attachment token",e);
    throw new EucalyptusCloudException(e);
  }
}
