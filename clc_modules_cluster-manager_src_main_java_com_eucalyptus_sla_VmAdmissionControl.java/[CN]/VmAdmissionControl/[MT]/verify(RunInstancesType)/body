{
  VmAllocationInfo vmAllocInfo=new VmAllocationInfo(request);
  if (vmAllocInfo.getRequest().getInstanceType() == null || "".equals(vmAllocInfo.getRequest().getInstanceType())) {
    vmAllocInfo.getRequest().setInstanceType(VmInstance.DEFAULT_TYPE);
  }
  vmAllocInfo.setReservationIndex(Counters.getIdBlock(request.getMaxCount()));
  byte[] userData=new byte[0];
  if (vmAllocInfo.getRequest().getUserData() != null) {
    try {
      userData=Base64.decode(vmAllocInfo.getRequest().getUserData());
    }
 catch (    Exception e) {
    }
  }
  vmAllocInfo.setUserData(userData);
  vmAllocInfo.getRequest().setUserData(new String(Base64.encode(userData)));
  return vmAllocInfo;
}
