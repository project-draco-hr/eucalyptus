{
  this.txUuid=String.format("%s:%s:%s",ctx,LogLevels.TRACE ? EntityWrapper.getMyStackTraceElement() : "n.a",UUID.randomUUID().toString());
  this.startTime=Calendar.getInstance();
  this.stopWatch=new StopWatch();
  this.stopWatch.start();
  EntityManagerFactory anemf=(EntityManagerFactoryImpl)PersistenceContexts.getEntityManagerFactory(ctx);
  try {
    this.em=anemf.createEntityManager();
    this.delegate=em.getTransaction();
    this.delegate.begin();
    this.session=new WeakReference<Session>((Session)em.getDelegate());
    outstanding.put(txUuid,this);
  }
 catch (  Throwable e) {
    this.rollback();
    LOG.error(e,e);
    throw new RuntimeException(e);
  }
}
