{
  final ArrayList<String> ancestorIds=Lists.newArrayList();
  try {
    final String[] imagePathParts=manifestPath.split("/");
    final String bucketName=imagePathParts[0];
    final String objectName=imagePathParts[1];
    GetObjectResponseType reply=null;
    try {
      final GetObjectType msg=new GetObjectType(bucketName,objectName,true,false,true).regardingUserRequest(parentMsg);
      reply=(GetObjectResponseType)ServiceDispatcher.lookupSingle(Components.lookup("walrus")).send(msg);
    }
 catch (    final Exception e) {
      throw new EucalyptusCloudException("Failed to read manifest file: " + bucketName + "/"+ objectName,e);
    }
    Document inputSource=null;
    try {
      final DocumentBuilder builder=DocumentBuilderFactory.newInstance().newDocumentBuilder();
      inputSource=builder.parse(new ByteArrayInputStream(Hashes.base64decode(reply.getBase64Data()).getBytes()));
    }
 catch (    final Exception e) {
      throw new EucalyptusCloudException("Failed to read manifest file: " + bucketName + "/"+ objectName,e);
    }
    final XPath xpath=XPathFactory.newInstance().newXPath();
    NodeList ancestors=null;
    try {
      ancestors=(NodeList)xpath.evaluate("/manifest/image/ancestry/ancestor_ami_id/text()",inputSource,XPathConstants.NODESET);
      if (ancestors == null)       return ancestorIds;
      for (int i=0; i < ancestors.getLength(); i++) {
        for (        final String ancestorId : ancestors.item(i).getNodeValue().split(",")) {
          ancestorIds.add(ancestorId);
        }
      }
    }
 catch (    final XPathExpressionException e) {
      LOG.error(e,e);
    }
  }
 catch (  final EucalyptusCloudException e) {
    LOG.error(e,e);
  }
catch (  final DOMException e) {
    LOG.error(e,e);
  }
  return ancestorIds;
}
