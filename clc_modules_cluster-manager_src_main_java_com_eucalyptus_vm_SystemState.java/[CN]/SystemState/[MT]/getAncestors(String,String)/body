{
  ArrayList<String> ancestorIds=Lists.newArrayList();
  try {
    String[] imagePathParts=manifestPath.split("/");
    String bucketName=imagePathParts[0];
    String objectName=imagePathParts[1];
    GetObjectResponseType reply=null;
    try {
      GetObjectType msg=new GetObjectType(bucketName,objectName,true,false,true);
      msg.setUserId(userId);
      reply=(GetObjectResponseType)RemoteDispatcher.lookupSingle(Component.walrus).send(msg);
    }
 catch (    Exception e) {
      throw new EucalyptusCloudException("Failed to read manifest file: " + bucketName + "/"+ objectName,e);
    }
    Document inputSource=null;
    try {
      DocumentBuilder builder=DocumentBuilderFactory.newInstance().newDocumentBuilder();
      inputSource=builder.parse(new ByteArrayInputStream(Hashes.base64decode(reply.getBase64Data()).getBytes()));
    }
 catch (    Exception e) {
      throw new EucalyptusCloudException("Failed to read manifest file: " + bucketName + "/"+ objectName,e);
    }
    XPath xpath=XPathFactory.newInstance().newXPath();
    NodeList ancestors=null;
    try {
      ancestors=(NodeList)xpath.evaluate("/manifest/image/ancestry/ancestor_ami_id/text()",inputSource,XPathConstants.NODESET);
      if (ancestors == null)       return ancestorIds;
      for (int i=0; i < ancestors.getLength(); i++) {
        for (        String ancestorId : ancestors.item(i).getNodeValue().split(",")) {
          ancestorIds.add(ancestorId);
        }
      }
    }
 catch (    XPathExpressionException e) {
      LOG.error(e,e);
    }
  }
 catch (  EucalyptusCloudException e) {
    LOG.error(e,e);
  }
catch (  DOMException e) {
    LOG.error(e,e);
  }
  return ancestorIds;
}
