{
  VmInstances.flushBuried();
  String originCluster=request.getOriginCluster();
  for (  VmInfo runVm : request.getVms()) {
    SystemState.updateVmInstance(originCluster,runVm);
  }
  final List<String> unreportedVms=Lists.transform(VmInstances.listValues(),new Function<VmInstance,String>(){
    @Override public String apply(    VmInstance input){
      return input.getInstanceId();
    }
  }
);
  final List<String> runningVmIds=Lists.transform(request.getVms(),new Function<VmInfo,String>(){
    @Override public String apply(    VmInfo arg0){
      String vmId=arg0.getImageId();
      unreportedVms.remove(vmId);
      return vmId;
    }
  }
);
  for (  String vmId : unreportedVms) {
    try {
      VmInstance vm=VmInstances.lookup(vmId);
      if (vm.getSplitTime() > VmInstances.SHUT_DOWN_TIME) {
        vm.setState(VmState.TERMINATED,Reason.EXPIRED);
      }
    }
 catch (    NoSuchElementException e) {
    }
  }
}
