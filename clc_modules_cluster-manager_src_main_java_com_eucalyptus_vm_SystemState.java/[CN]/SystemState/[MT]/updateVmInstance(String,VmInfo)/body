{
  VmState state=VmState.Mapper.get(runVm.getStateName());
  VmInstance vm=null;
  try {
    vm=VmInstances.lookup(runVm.getInstanceId());
  }
 catch (  NoSuchElementException e) {
    try {
      vm=VmInstances.lookupDisabled(runVm.getInstanceId());
      if (!VmState.BURIED.equals(vm.getRuntimeState()) && vm.getSplitTime() > VmInstances.BURY_TIME) {
        vm.setState(VmState.BURIED,Reason.BURIED);
      }
      return;
    }
 catch (    NoSuchElementException e1) {
      if ((VmState.PENDING.equals(state) || VmState.RUNNING.equals(state))) {
        SystemState.restoreInstance(originCluster,runVm);
      }
      return;
    }
  }
  vm.doUpdate().apply(runVm);
}
