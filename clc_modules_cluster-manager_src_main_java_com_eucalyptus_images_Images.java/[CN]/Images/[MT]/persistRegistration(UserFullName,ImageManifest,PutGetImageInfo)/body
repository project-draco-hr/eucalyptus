{
  EntityTransaction tx=Entities.get(PutGetImageInfo.class);
  try {
    ret=Entities.merge(ret);
    tx.commit();
    LOG.info("Registering image pk=" + ret.getDisplayName() + " ownerId="+ creator);
  }
 catch (  Exception e) {
    tx.rollback();
    throw new EucalyptusCloudException("Failed to register image: " + manifest + " because of: "+ e.getMessage(),e);
  }
  LOG.info("Triggering cache population in Walrus for: " + ret.getDisplayName());
  if (ret instanceof ImageMetadata.StaticDiskImage && ret.getRunManifestLocation() != null) {
    StaticDiskImages.prepare(ret.getRunManifestLocation());
  }
  return ret;
}
