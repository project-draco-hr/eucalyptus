{
  if (userId == null || imgName == null)   throw new IllegalArgumentException();
  try {
    final User requestingUser=Accounts.lookupUserById(userId);
    final Account account=requestingUser.getAccount();
    final String accountNumber=account.getAccountNumber();
    final List<ImageInfo> allImages=Images.listAllImages();
    for (    final ImageInfo img : allImages) {
      if (accountNumber.equals(img.getOwnerAccountNumber()) && imgName.equals(img.getImageName()) && (ImageMetadata.State.available.equals(img.getState()) || ImageMetadata.State.pending.equals(img.getState()))) {
        return img.getDisplayName();
      }
    }
    throw new NoSuchElementException();
  }
 catch (  final NoSuchElementException ex) {
    throw ex;
  }
catch (  final Exception ex) {
    throw Exceptions.toUndeclared(ex);
  }
}
