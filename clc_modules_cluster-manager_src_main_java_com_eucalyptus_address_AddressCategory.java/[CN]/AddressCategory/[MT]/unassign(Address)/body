{
  final String instanceId=addr.getInstanceId();
  if (!VmInstance.DEFAULT_IP.equals(addr.getInstanceAddress())) {
    return Callbacks.newClusterRequest(addr.unassign().getCallback()).then(new Callback.Success<BaseMessage>(){
      public void fire(      BaseMessage response){
        try {
          VmInstance vm=VmInstances.getInstance().lookup(instanceId);
          EventRecord.here(AddressCategory.class,EventClass.ADDRESS,EventType.ADDRESS_UNASSIGNING).withDetails(vm.getOwnerId(),addr.getName(),"instanceid",vm.getInstanceId()).withDetails("type",addr.isSystemOwned() ? "SYSTEM" : "USER").withDetails("cluster",addr.getCluster());
          Addresses.system(vm);
        }
 catch (        NoSuchElementException e) {
        }
      }
    }
);
  }
 else {
    return Callbacks.newClusterRequest(new NOOP());
  }
}
