{
  Component walrus=Components.lookup(Walrus.class);
  NavigableSet<ServiceConfiguration> configs=walrus.lookupServiceConfigurations();
  if (configs.isEmpty() || !Component.State.ENABLED.equals(configs.first().lookupState())) {
    throw new ServiceStateException("Failed to bundle instance because there is no available walrus service at the moment.");
  }
  final String walrusUrl=configs.first().getUri().toASCIIString();
  request.setUrl(walrusUrl);
  request.setAwsAccessKeyId(Accounts.getFirstActiveAccessKeyId(Contexts.lookup().getUser()));
  return new BundleCallback(request);
}
