{
  SplitTransition assign=new SplitTransition(Transition.assigning){
    public void top(){
      EventRecord.here(Address.class,EventClass.ADDRESS,EventType.ADDRESS_ASSIGNING).withDetails(vm.getOwner().toString(),Address.this.getName(),"instanceid",vm.getInstanceId()).withDetails("type",Address.this.isSystemOwned() ? "SYSTEM" : "USER").withDetails("cluster",Address.this.getCluster()).info();
      Address.this.setInstanceId(vm.getInstanceId());
      Address.this.setInstanceAddress(vm.getPrivateAddress());
      Address.this.stateUuid=UUID.randomUUID().toString();
    }
    public void bottom(){
      String userId=Address.this.getOwner().toString();
      EventRecord.here(Address.class,EventClass.ADDRESS,EventType.ADDRESS_ASSIGN).withDetails(userId,Address.this.getDisplayName(),"instance",Address.this.instanceId).withDetails("instance-address",Address.this.instanceAddress).withDetails("type",Address.this.isSystemOwned() ? "SYSTEM" : "USER").info();
    }
  }
;
  if (State.impending.equals(this.atomicState.getReference())) {
    this.transition(State.impending,State.assigned,true,true,assign);
  }
 else {
    this.transition(State.allocated,State.assigned,false,true,assign);
  }
  return this;
}
