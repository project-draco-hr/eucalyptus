{
  this.transition=transition;
  LOG.debug(EventRecord.caller(this.getClass(),this.state.getReference(),this.toString()));
  if (!this.state.compareAndSet(expectedState,newState,expectedMark,newMark)) {
    throw new IllegalStateException(String.format("Cannot mark address as %s[%s.%s->%s.%s] when it is %s.%s: %s",transition.getName(),expectedState,expectedMark,newState,newMark,this.state.getReference(),this.state.isMarked(),this.toString()));
  }
  LOG.debug(EventRecord.caller(this.getClass(),this.state.getReference(),"TOP",this.transition.getName().name(),this.toString()));
  this.transition.top();
  return true;
}
