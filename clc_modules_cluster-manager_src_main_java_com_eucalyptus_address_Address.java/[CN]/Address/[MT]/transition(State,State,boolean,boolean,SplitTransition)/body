{
  this.transition=transition;
  if (!this.atomicState.compareAndSet(expectedState,newState,expectedMark,newMark)) {
    throw new IllegalStateException(String.format("Cannot mark address as %s[%s.%s->%s.%s] when it is %s.%s: %s",transition.getName(),expectedState,expectedMark,newState,newMark,this.atomicState.getReference(),this.atomicState.isMarked(),this.toString()));
  }
  EventRecord.caller(this.getClass(),EventType.ADDRESS_STATE,"TOP",this.toString()).info();
  try {
    this.transition.top();
  }
 catch (  RuntimeException ex) {
    LOG.error(ex);
    Logs.extreme().error(ex,ex);
    throw ex;
  }
  return true;
}
