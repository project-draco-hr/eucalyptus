{
  if (channelEvent instanceof MessageEvent && componentIdClass != null) {
    final MessageEvent messageEvent=(MessageEvent)channelEvent;
    final Object message=messageEvent.getMessage();
    final ComponentMessage componentMessage=Ats.inClassHierarchy(message).get(ComponentMessage.class);
    if (componentMessage == null || !componentIdClass.equals(componentMessage.value())) {
      LOG.warn("Message does not match pipeline component " + componentIdClass.getSimpleName());
      final MappingHttpMessage mappingHttpMessage=MappingHttpMessage.extractMessage(channelEvent);
      final BaseMessage baseMessage=BaseMessage.extractMessage(channelEvent);
      if (baseMessage != null) {
        Contexts.clear(Contexts.lookup(baseMessage.getCorrelationId()));
      }
      channelHandlerContext.getChannel().write(new MappingHttpResponse(mappingHttpMessage == null ? HttpVersion.HTTP_1_1 : mappingHttpMessage.getProtocolVersion(),HttpResponseStatus.BAD_REQUEST));
      return;
    }
  }
  channelHandlerContext.sendUpstream(channelEvent);
}
