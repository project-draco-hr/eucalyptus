{
  final MappingHttpRequest request=MappingHttpMessage.extractMessage(e);
  final BaseMessage msg=BaseMessage.extractMessage(e);
  if (msg != null) {
    try {
      if (msg instanceof ServiceTransitionType) {
        Topology.touch((ServiceTransitionType)msg);
        ctx.sendUpstream(e);
      }
 else       if (Topology.check(msg)) {
        ctx.sendUpstream(e);
      }
 else {
        Class<? extends ComponentId> compClass=ComponentMessages.lookup(msg);
        Handlers.sendError(ctx,e,compClass,request.getServicePath());
      }
    }
 catch (    Exception ex) {
      Logs.extreme().error(ex,ex);
      ctx.sendUpstream(e);
    }
  }
}
