{
  List<SecurityGroupItemType> groupInfoList=Lists.newArrayList();
  if (groupNames.isEmpty()) {
    try {
      for (      User u : Accounts.listAllUsers()) {
        try {
          AccountFullName userAccountFn=AccountFullName.getInstance(u.getAccount());
          groupInfoList.addAll(NetworkGroupUtil.getUserNetworks(Accounts.lookupAccountFullNameByUserId(u.getUserId()),groupNames));
        }
 catch (        AuthException e) {
          Logs.exhaust().debug("Getting user information failed for: " + UserFullName.getInstance(u),Exceptions.filterStackTrace(e));
        }
      }
    }
 catch (    AuthException ex) {
      throw new EucalyptusCloudException("Fail to get all users",ex);
    }
  }
 else {
    for (    String groupName : groupNames) {
      if (!NetworkGroupUtil.isUserGroupRef(groupName)) {
        groupInfoList.addAll(NetworkGroupUtil.getUserNetworks(accountFullName,Lists.newArrayList(groupName)));
      }
 else {
        groupInfoList.addAll(NetworkGroupUtil.getUserNetworksAdmin(groupName));
      }
    }
  }
  return groupInfoList;
}
