{
  List<NetworkRule> ruleList=new ArrayList<NetworkRule>();
  if (!ipPerm.getGroups().isEmpty()) {
    if (ipPerm.getFromPort() == 0 && ipPerm.getToPort() == 0) {
      ipPerm.setToPort(65535);
    }
    if (ipPerm.getIpProtocol() == null) {
      NetworkRule rule=new NetworkRule("tcp",ipPerm.getFromPort(),ipPerm.getToPort());
      rule.getNetworkPeers().addAll(getNetworkPeers(ipPerm));
      ruleList.add(rule);
      NetworkRule rule1=new NetworkRule("udp",ipPerm.getFromPort(),ipPerm.getToPort());
      rule1.getNetworkPeers().addAll(getNetworkPeers(ipPerm));
      ruleList.add(rule1);
      NetworkRule rule2=new NetworkRule("icmp",-1,-1);
      rule2.getNetworkPeers().addAll(getNetworkPeers(ipPerm));
      ruleList.add(rule2);
    }
 else {
      NetworkRule rule=new NetworkRule(ipPerm.getIpProtocol(),ipPerm.getFromPort(),ipPerm.getToPort());
      rule.getNetworkPeers().addAll(getNetworkPeers(ipPerm));
      ruleList.add(rule);
    }
  }
 else   if (!ipPerm.getIpRanges().isEmpty()) {
    List<IpRange> ipRanges=new ArrayList<IpRange>();
    for (    String range : ipPerm.getIpRanges()) {
      String[] rangeParts=range.split("/");
      try {
        if (Integer.parseInt(rangeParts[1]) > 32 || Integer.parseInt(rangeParts[1]) < 0)         continue;
        if (rangeParts.length != 2)         continue;
        if (InetAddress.getByName(rangeParts[0]) != null) {
          ipRanges.add(new IpRange(range));
        }
      }
 catch (      NumberFormatException e) {
      }
catch (      UnknownHostException e) {
      }
    }
    NetworkRule rule=new NetworkRule(ipPerm.getIpProtocol(),ipPerm.getFromPort(),ipPerm.getToPort(),ipRanges);
    ruleList.add(rule);
  }
  return ruleList;
}
