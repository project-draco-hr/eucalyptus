{
  if (request.getImage().getDiskImageSet() == null || request.getImage().getDiskImageSet().size() <= 0)   throw new ImagingServiceException("Image detail for imported image is required");
  if (request.getImage().getConvertedImage() == null)   throw new ImagingServiceException("Image detail for converted image is required");
  for (  final DiskImageDetail image : request.getImage().getDiskImageSet()) {
    final String format=image.getFormat();
    final String manifestUrl=image.getImportManifestUrl();
    if (format == null || format.length() <= 0)     throw new ImagingServiceException("Image format is required");
    try {
      final IMAGE_FORMAT imgFormat=IMAGE_FORMAT.valueOf(format.toUpperCase());
    }
 catch (    final Exception ex) {
      throw new ImagingServiceException("Unsupported image format");
    }
    if (manifestUrl == null || manifestUrl.length() <= 0)     throw new ImagingServiceException("Import manifest url is required");
  }
  InstanceStoreImagingTask transform=null;
  try {
    transform=TypeMappers.transform(request,InstanceStoreImagingTask.class);
  }
 catch (  final Exception ex) {
    if (ex.getCause() instanceof ImagingServiceException)     throw (ImagingServiceException)ex.getCause();
 else     throw new ImagingServiceException(ImagingServiceException.INTERNAL_SERVER_ERROR,"Failed to create InstanceStoreImagingTask",ex);
  }
  try (final TransactionResource db=Entities.transactionFor(InstanceStoreImagingTask.class)){
    try {
      Entities.persist(transform);
      db.commit();
    }
 catch (    final Exception ex) {
      throw new ImagingServiceException(ImagingServiceException.INTERNAL_SERVER_ERROR,"Failed to persist EMIConversionImagingTask",ex);
    }
  }
   return transform;
}
