{
  try (final TransactionResource db=Entities.transactionFor(VolumeImagingTask.class)){
    try {
      final ImagingTask task=Entities.uniqueResult(ImagingTask.named(owner,taskId));
      task.setState(state);
      if (stateReason != null)       task.setStateReason(stateReason);
      Entities.persist(task);
      db.commit();
    }
 catch (    final TransactionException ex) {
      throw Exceptions.toUndeclared(ex);
    }
  }
 }
