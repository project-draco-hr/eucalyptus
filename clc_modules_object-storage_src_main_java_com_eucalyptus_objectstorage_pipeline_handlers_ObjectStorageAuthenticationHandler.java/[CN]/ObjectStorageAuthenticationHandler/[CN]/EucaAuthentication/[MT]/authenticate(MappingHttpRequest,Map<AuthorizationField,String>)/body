{
  if (authMap == null || !EUCA_AUTH_TYPE.equals(authMap.get(AuthorizationField.Type))) {
    throw new AccessDeniedException("Mismatch between expected and found authentication types");
  }
  cleanHeaders(httpRequest,authMap.get(AuthorizationField.SignedHeaders));
  checkDate(httpRequest);
  String certString=null;
  if (authMap.containsKey(AuthorizationField.CertFingerPrint)) {
    certString=authMap.get(AuthorizationField.CertFingerPrint);
  }
 else {
    throw new AccessDeniedException();
  }
  String verb=httpRequest.getMethod().getName();
  String canonicalURI=getCanonicalURI(httpRequest);
  String canonicalQueryString=getCanonicalQueryString(httpRequest);
  String canonicalHeaders=getCanonicalHeaders(httpRequest,authMap.get(AuthorizationField.SignedHeaders));
  String signedHeaders=getSignedHeaders(httpRequest,authMap);
  String data=verb + "\n" + canonicalURI+ "\n"+ canonicalQueryString+ "\n"+ canonicalHeaders+ "\n"+ signedHeaders;
  String AWSAccessKeyID=httpRequest.getAndRemoveHeader(SecurityParameter.AWSAccessKeyId.toString());
  String signature=authMap.get(AuthorizationField.Signature);
  try {
    SecurityContext.getLoginContext(new ObjectStorageWrappedComponentCredentials(httpRequest.getCorrelationId(),data,AWSAccessKeyID,signature,certString)).login();
  }
 catch (  Exception ex) {
    LOG.error(ex);
    throw new AccessDeniedException();
  }
}
