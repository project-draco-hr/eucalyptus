{
  try {
    if (event.getMessage() instanceof MappingHttpRequest) {
      MappingHttpRequest httpRequest=(MappingHttpRequest)event.getMessage();
      removeDuplicateHeaderValues(httpRequest);
      canonicalizeHeaders(httpRequest);
      if (httpRequest.containsHeader(ObjectStorageProperties.Headers.S3UploadPolicy.toString())) {
        checkUploadPolicy(httpRequest);
      }
      handle(httpRequest);
    }
  }
 catch (  Throwable e) {
    Channels.fireExceptionCaught(ctx,e);
  }
}
