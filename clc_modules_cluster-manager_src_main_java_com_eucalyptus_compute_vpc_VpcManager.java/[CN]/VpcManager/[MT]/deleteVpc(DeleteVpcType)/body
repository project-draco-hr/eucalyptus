{
  final DeleteVpcResponseType reply=request.getReply();
  delete(Identifier.vpc,request.getVpcId(),new Function<Pair<AccountFullName,String>,Vpc>(){
    @Override public Vpc apply(    final Pair<AccountFullName,String> accountAndId){
      try {
        final Vpc vpc=vpcs.lookupByName(accountAndId.getLeft(),accountAndId.getRight(),Functions.<Vpc>identity());
        if (RestrictedTypes.filterPrivileged().apply(vpc)) {
          if (Boolean.TRUE.equals(vpc.getDefaultVpc()) && Contexts.lookup().isAdministrator())           try {
            final InternetGateway internetGateway=internetGateways.lookupByVpc(null,vpc.getDisplayName(),Functions.<InternetGateway>identity());
            internetGateways.delete(internetGateway);
          }
 catch (          VpcMetadataNotFoundException e) {
          }
          networkAcls.delete(networkAcls.lookupDefault(vpc.getDisplayName(),Functions.<NetworkAcl>identity()));
          routeTables.delete(routeTables.lookupMain(vpc.getDisplayName(),Functions.<RouteTable>identity()));
          try {
            securityGroups.delete(securityGroups.lookupDefault(vpc.getDisplayName(),Functions.<NetworkGroup>identity()));
          }
 catch (          VpcMetadataNotFoundException e) {
          }
          vpcs.delete(vpc);
        }
 else {
          throw Exceptions.toUndeclared(new ClientUnauthorizedComputeException("Not authorized to delete vpc"));
        }
        return null;
      }
 catch (      Exception ex) {
        throw new RuntimeException(ex);
      }
    }
  }
);
  return reply;
}
