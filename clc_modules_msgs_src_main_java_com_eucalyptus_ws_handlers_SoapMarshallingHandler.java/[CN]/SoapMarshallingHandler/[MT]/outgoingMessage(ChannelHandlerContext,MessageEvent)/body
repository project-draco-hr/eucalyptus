{
  if (event.getMessage() instanceof MappingHttpMessage) {
    MappingHttpMessage httpMessage=(MappingHttpMessage)event.getMessage();
    ByteArrayOutputStream byteOut=new ByteArrayOutputStream();
    HoldMe.canHas.lock();
    try {
      httpMessage.getSoapEnvelope().serialize(byteOut);
    }
  finally {
      HoldMe.canHas.unlock();
    }
    ChannelBuffer buffer=ChannelBuffers.wrappedBuffer(byteOut.toByteArray());
    httpMessage.addHeader(HttpHeaders.Names.CONTENT_LENGTH,String.valueOf(buffer.readableBytes()));
    httpMessage.addHeader(HttpHeaders.Names.CONTENT_TYPE,"text/xml; charset=UTF-8");
    httpMessage.setContent(buffer);
  }
}
