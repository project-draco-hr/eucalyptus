{
synchronized (EntityWrapper.class) {
    if (!emf.containsKey(persistenceContext)) {
      EntityManagerFactoryImpl entityManagerFactory=(EntityManagerFactoryImpl)config.buildEntityManagerFactory();
      LOG.info("-> Setting up persistence context for : " + persistenceContext);
      LOG.info(LogUtil.subheader(LogUtil.dumpObject(config)));
      emf.put(persistenceContext,entityManagerFactory);
    }
    return emf.get(persistenceContext);
  }
}
