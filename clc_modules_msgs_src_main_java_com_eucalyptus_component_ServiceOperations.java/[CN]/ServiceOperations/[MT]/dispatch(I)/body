{
  if (!serviceOperations.containsKey(request.getClass())) {
    try {
      ServiceContext.dispatch(RequestQueue.ENDPOINT,request);
    }
 catch (    Exception ex) {
      Contexts.responseError(request.getCorrelationId(),ex);
    }
  }
 else {
    try {
      final Context ctx=Contexts.lookup(request.getCorrelationId());
      final Function<I,O> op=(Function<I,O>)serviceOperations.get(request.getClass());
      Timers.loggingWrapper(new Callable(){
        @Override public Object call() throws Exception {
          if (ASYNCHRONOUS) {
            Threads.enqueue(queueConfig.get(),new Runnable(){
              @Override public void run(){
                executeOperation(request,ctx,op);
              }
            }
);
          }
 else {
            executeOperation(request,ctx,op);
          }
          return null;
        }
      }
).call();
    }
 catch (    final Exception ex) {
      Logs.extreme().error(ex,ex);
      Contexts.responseError(request.getCorrelationId(),ex);
    }
  }
}
