{
  Contexts.threadLocal(ctx);
  try {
    final O reply=op.apply(request);
    Contexts.response(reply);
  }
 catch (  final Exception ex) {
    Logs.extreme().error(ex,ex);
    Contexts.responseError(request.getCorrelationId(),ex);
  }
 finally {
    Contexts.removeThreadLocal();
  }
}
