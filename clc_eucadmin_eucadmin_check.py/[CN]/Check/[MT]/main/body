def main(self):
    rootwrap = os.path.join(self.config['EUCALYPTUS'], RootWrapPath)
    if (not os.path.isfile(rootwrap)):
        raise IOError(('Cannot find %s or not executable' % rootwrap))
    self.euca_user_name = self.config['EUCA_USER']
    root_data = pwd.getpwname('root')
    if ((self.user_name is None) or (self.euca_user_name == 'root')):
        self.euca_user_id = root_data.pw_uid
        self.euca_group_id = root_data.pw_gid
    else:
        try:
            user_data = pwd.getpwnam(self.euca_user_name)
        except KeyError:
            raise ValueError('Is EUCA_USER defined?')
        self.euca_user_id = user_data.pw_uid
        self.euca_user_group_id = user_data.pw_gid
        os.chown(root_data.pw_uid, self.euca_user_group_id)
        os.chmod(rootwrap, 2536)
    if (self.service == 'nc'):
        self.instance_path = self.config['INSTANCE_PATH']
        if (self.instance_path is None):
            raise ValueError('INSTANCE_PATH is not defined')
        if (not os.path.isdir(self.instance_path)):
            msg = ('%s does not exist: ' % self.instance_path)
            msg += 'did you run euca_conf --setup?'
            raise ValueError(msg)
    d = os.path.join(self.config['EUCALYPTUS'], 'var/run/eucalyptus')
    if (not os.path.isdir(d)):
        os.mkdir(d)
    os.chown(d, self.euca_user_id, self.euca_user_group_id)
    if (self.service == 'cc'):
        d = os.path.join(self.config['EUCALYPTUS'], 'var/run/eucalyptus/net')
        if (not os.path.isdir(d)):
            os.mkdir(d)
        os.chown(d, self.euca_user_id, self.euca_user_group_id)
    if (self.service == 'vmware'):
        s = os.path.join(self.config['EUCALYPTUS'], 'usr/share/eucalyptus/euca_vmware')
        s += ' --config '
        s += os.path.join(self.config['EUCALYPTUS'], 'etc/eucalyptus/vmware_conf.xml')
        cmd = Command(s)
        if (cmd.status != 0):
            raise RuntimeError(cmd.stderr)
