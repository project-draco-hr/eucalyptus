{
  boolean[] bit=new boolean[1];
  MuleContext ref=null;
  if ((ref=context.get(bit)) == null && bit[0]) {
    Integer i=0;
    do {
      try {
        TimeUnit.MILLISECONDS.sleep(500);
        i+=500;
      }
 catch (      InterruptedException ex) {
        LOG.error(ex,ex);
      }
    }
 while (i < SERVICE_CONTEXT_RELOAD_TIMEOUT && (ref=context.get(bit)) == null && bit[0]);
    if (ref == null) {
      throw new ServiceStateException("Timed-out obtaining reference service context.  Waited for : " + SERVICE_CONTEXT_RELOAD_TIMEOUT + " milliseconds.");
    }
 else {
      return ref;
    }
  }
 else   if (!bit[0]) {
    throw new ServiceStateException("Attempt to reference service context before it is ready.");
  }
 else {
    return ref;
  }
}
