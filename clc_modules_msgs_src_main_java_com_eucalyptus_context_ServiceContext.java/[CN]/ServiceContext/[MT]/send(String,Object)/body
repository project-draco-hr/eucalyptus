{
  dest=ServiceContextManager.mapEndpointToService(dest);
  MuleEvent context=RequestContext.getEvent();
  Context ctx=null;
  if (msg instanceof BaseMessage) {
    ctx=Contexts.createWrapped(dest,(BaseMessage)msg);
  }
  try {
    LOG.debug("ServiceContext.send(" + dest + ":"+ msg.getClass().getCanonicalName());
    MuleMessage reply=ServiceContextManager.getClient().sendDirect(dest,null,new DefaultMuleMessage(msg));
    if (reply.getExceptionPayload() != null) {
      throw Exceptions.trace(new ServiceDispatchException(reply.getExceptionPayload().getRootException().getMessage(),reply.getExceptionPayload().getRootException()));
    }
 else {
      return (T)reply.getPayload();
    }
  }
 catch (  Throwable e) {
    throw Exceptions.trace(new ServiceDispatchException("Failed to send message " + msg.getClass().getSimpleName() + " to service "+ dest+ " because: "+ e.getMessage(),e));
  }
 finally {
    Contexts.clear(ctx);
    RequestContext.setEvent(context);
  }
}
