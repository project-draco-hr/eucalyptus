{
  dest=ServiceContextManager.mapEndpointToService(dest);
  MuleEvent context=RequestContext.getEvent();
  try {
    LOG.debug("ServiceContext.send(" + dest + ":"+ msg.getClass().getCanonicalName(),Exceptions.filterStackTrace(new RuntimeException(),3));
    MuleMessage reply=ServiceContextManager.getClient().sendDirect(dest,null,new DefaultMuleMessage(msg));
    if (reply.getExceptionPayload() != null) {
      throw Exceptions.trace(new ServiceDispatchException(reply.getExceptionPayload().getRootException().getMessage(),reply.getExceptionPayload().getRootException()));
    }
 else {
      return (T)reply.getPayload();
    }
  }
 catch (  Throwable e) {
    throw Exceptions.trace(new ServiceDispatchException("Failed to send message " + msg.getClass().getSimpleName() + " to service "+ dest+ " because of "+ e.getMessage(),e));
  }
 finally {
    RequestContext.setEvent(context);
  }
}
