{
  MuleContextFactory contextFactory=new DefaultMuleContextFactory();
  try {
    MuleContext context=contextFactory.createMuleContext(builder);
    if (!ServiceContext.context.compareAndSet(null,context)) {
      throw new ServiceInitializationException("Service context initialized twice.");
    }
  }
 catch (  Exception e) {
    LOG.error(e,e);
    throw new ServiceInitializationException("Failed to build service context.",e);
  }
}
