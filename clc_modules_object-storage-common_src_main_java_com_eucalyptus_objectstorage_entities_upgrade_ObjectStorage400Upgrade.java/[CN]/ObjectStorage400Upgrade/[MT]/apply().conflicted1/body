{
  EntityTransaction walrusdb=Entities.get(BucketInfo.class);
  try {
    List<BucketInfo> walrusBuckets=Entities.query(new BucketInfo());
    if (walrusBuckets != null && !walrusBuckets.isEmpty()) {
      for (      BucketInfo walrusBucket : walrusBuckets) {
        try {
          walrusBucket.setOwnerId(getEucalyptusAccount().getAccountNumber());
          walrusBucket.setUserId(getEucalyptusAdmin().getUserId());
          walrusBucket.resetGlobalGrants();
          List<GrantInfo> grantInfos=new ArrayList<GrantInfo>();
          GrantInfo.setFullControl(walrusBucket.getOwnerId(),grantInfos);
          walrusBucket.setGrants(grantInfos);
          if (walrusBucket.getVersioning() != null && (WalrusProperties.VersioningStatus.Enabled.toString().equals(walrusBucket.getVersioning()) || WalrusProperties.VersioningStatus.Suspended.toString().equals(walrusBucket.getVersioning()))) {
            walrusBucket.setVersioning(WalrusProperties.VersioningStatus.Disabled.toString());
          }
        }
 catch (        Exception e) {
          LOG.error("Failed to modify Walrus bucket " + walrusBucket.getBucketName(),e);
          throw e;
        }
      }
    }
 else {
    }
    walrusdb.commit();
  }
 catch (  Exception e) {
    walrusdb.rollback();
    throw e;
  }
 finally {
    if (walrusdb.isActive()) {
      walrusdb.commit();
    }
  }
}
