{
  EntityTransaction osgTran=Entities.get(Bucket.class);
  try {
    List<Bucket> osgBuckets=Entities.query(new Bucket());
    if (osgBuckets != null && osgBuckets.isEmpty()) {
      EntityTransaction walrusTran=Entities.get(BucketInfo.class);
      try {
        List<BucketInfo> walrusBuckets=Entities.query(new BucketInfo(),Boolean.TRUE);
        if (walrusBuckets != null && !walrusBuckets.isEmpty()) {
          populateSnapshotBucketsAndObjects();
          for (          Bucket osgBucket : Lists.transform(walrusBuckets,bucketTransformationFunction())) {
            Entities.persist(osgBucket);
          }
        }
 else {
        }
        walrusTran.commit();
      }
 catch (      Exception e) {
        walrusTran.rollback();
        throw e;
      }
 finally {
        if (walrusTran.isActive()) {
          walrusTran.commit();
        }
      }
    }
 else {
    }
    osgTran.commit();
  }
 catch (  Exception e) {
    osgTran.rollback();
    throw e;
  }
 finally {
    if (osgTran.isActive()) {
      osgTran.commit();
    }
  }
}
