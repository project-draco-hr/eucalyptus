{
  if (grants == null) {
    grants=new ArrayList<Grant>();
  }
  if (grantInfos == null) {
    return grants;
  }
  for (  GrantInfo grantInfo : grantInfos) {
    if (grantInfo.getGrantGroup() != null) {
      Group group=new Group(grantInfo.getGrantGroup());
      transferPermissions(grants,grantInfo,new Grantee(group));
    }
 else {
      AccountIdentifiers account=null;
      if (accountIdAccountMap.containsKey(grantInfo.getUserId())) {
        account=accountIdAccountMap.get(grantInfo.getUserId());
      }
 else       if (deletedAccountIds.contains(grantInfo.getUserId())) {
        LOG.warn("Account ID " + grantInfo.getUserId() + " does not not exist. Skipping this grant");
        continue;
      }
 else       if (noCanonicalIdAccountIds.contains(grantInfo.getUserId())) {
        LOG.warn("Account ID " + grantInfo.getUserId() + " does not not have a canonical ID. Skipping this grant");
        continue;
      }
 else {
        try {
          account=Accounts.lookupAccountIdentifiersById(grantInfo.getUserId());
          if (StringUtils.isBlank(grantInfo.getUserId())) {
            LOG.warn("Account ID " + grantInfo.getUserId() + " does not not have a canonical ID. Skipping this grant");
            noCanonicalIdAccountIds.add(grantInfo.getUserId());
            continue;
          }
 else {
            accountIdAccountMap.put(grantInfo.getUserId(),account);
          }
        }
 catch (        Exception e) {
          LOG.warn("Account ID " + grantInfo.getUserId() + " does not not exist. Skipping this grant");
          deletedAccountIds.add(grantInfo.getUserId());
          continue;
        }
      }
      CanonicalUser user=new CanonicalUser(account.getCanonicalId(),account.getAccountAlias());
      transferPermissions(grants,grantInfo,new Grantee(user));
    }
  }
  return grants;
}
