{
  Map<String,Map<String,Map<String,String>>> mapping=StackEntityHelper.jsonToMapping(template.getStackEntity().getMappingJson());
  JsonNode mappingsJsonNode=JsonHelper.checkObject(templateJsonNode,TemplateSection.Mappings.toString());
  if (mappingsJsonNode == null)   return;
  for (  String mapName : Lists.newArrayList(mappingsJsonNode.fieldNames())) {
    JsonNode mappingJsonNode=JsonHelper.checkObject(mappingsJsonNode,mapName,"Every " + TemplateSection.Mappings + " member "+ mapName+ " must be a map");
    for (    String mapKey : Lists.newArrayList(mappingJsonNode.fieldNames())) {
      JsonNode attributesJsonNode=JsonHelper.checkObject(mappingJsonNode,mapKey,"Every " + TemplateSection.Mappings + " member "+ mapKey+ " must be a map");
      for (      String attribute : Lists.newArrayList(attributesJsonNode.fieldNames())) {
        JsonNode valueJsonNode=JsonHelper.checkStringOrArray(attributesJsonNode,attribute,"Every " + TemplateSection.Mappings + " attribute must be a String or a List.");
        if (!mapping.containsKey(mapName)) {
          mapping.put(mapName,Maps.<String,Map<String,String>>newLinkedHashMap());
        }
        if (!mapping.get(mapName).containsKey(mapKey)) {
          mapping.get(mapName).put(mapKey,Maps.<String,String>newLinkedHashMap());
        }
        mapping.get(mapName).get(mapKey).put(attribute,JsonHelper.getStringFromJsonNode(valueJsonNode));
      }
    }
  }
  template.getStackEntity().setMappingJson(StackEntityHelper.mappingToJson(mapping));
}
