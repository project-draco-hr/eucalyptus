{
  Template template=new Template();
  template.setStackEntity(new StackEntity());
  template.setResourceInfoMap(Maps.<String,ResourceInfo>newLinkedHashMap());
  Map<String,String> paramMap=Maps.newHashMap();
  JsonNode templateJsonNode=null;
  try {
    templateJsonNode=objectMapper.readTree(templateBody);
  }
 catch (  IOException ex) {
    throw new ValidationErrorException(ex.getMessage());
  }
  if (!templateJsonNode.isObject()) {
    throw new ValidationErrorException("Template body is not a JSON object");
  }
  template.getStackEntity().setTemplateBody(templateBody);
  addPseudoParameters(template,pseudoParameterValues);
  buildResourceMap(template,templateJsonNode);
  parseValidTopLevelKeys(templateJsonNode);
  parseVersion(template,templateJsonNode);
  parseDescription(template,templateJsonNode);
  parseMappings(template,templateJsonNode);
  parseParameters(userParameters,paramMap,template,templateJsonNode);
  parseConditions(template,templateJsonNode);
  parseResources(template,templateJsonNode);
  parseOutputs(template,templateJsonNode);
  return template;
}
