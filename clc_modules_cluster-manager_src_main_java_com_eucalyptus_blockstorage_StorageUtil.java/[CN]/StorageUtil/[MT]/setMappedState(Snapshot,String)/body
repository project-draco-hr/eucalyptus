{
  final Optional<State> mapped=mapState(state);
  if (mapped.isPresent()) {
    snapshot.setState(mapped.get());
  }
}
