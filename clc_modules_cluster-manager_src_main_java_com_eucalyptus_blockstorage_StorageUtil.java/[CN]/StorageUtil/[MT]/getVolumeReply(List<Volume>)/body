{
  Multimap<String,Volume> partitionVolumeMap=HashMultimap.create();
  for (  Volume v : volumes) {
    partitionVolumeMap.put(v.getPartition(),v);
  }
  ArrayList<edu.ucsb.eucalyptus.msgs.Volume> reply=Lists.newArrayList();
  for (  String partition : partitionVolumeMap.keySet()) {
    try {
      Map<String,StorageVolume> idStorageVolumeMap=updateVolumesInPartition(partitionVolumeMap,partition);
      for (      Volume v : partitionVolumeMap.get(partition)) {
        try {
          reply.add(volumeStateTransform(idStorageVolumeMap,v));
        }
 catch (        Exception ex) {
          Logs.extreme().error(ex);
          reply.add(v.morph(new edu.ucsb.eucalyptus.msgs.Volume()));
        }
      }
    }
 catch (    EucalyptusCloudException ex) {
      LOG.error(ex);
      Logs.extreme().error(ex,ex);
      for (      Volume v : partitionVolumeMap.get(partition)) {
        reply.add(v.morph(new edu.ucsb.eucalyptus.msgs.Volume()));
      }
    }
  }
  return reply;
}
