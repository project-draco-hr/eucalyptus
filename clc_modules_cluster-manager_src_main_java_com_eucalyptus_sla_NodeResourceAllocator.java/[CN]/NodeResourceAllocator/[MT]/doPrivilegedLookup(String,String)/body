{
  if (clusterName != null && !"default".equals(clusterName)) {
    try {
      final Cluster cluster=Clusters.getInstance().lookup(clusterName);
      return cluster;
    }
 catch (    NoSuchElementException e) {
      throw new NotEnoughResourcesAvailable("Not enough resources: request cluster does not exist " + clusterName);
    }
  }
 else {
    Iterable<Cluster> authorizedClusters=Clusters.getInstance().listValues();
    NavigableMap<VmTypeAvailability,Cluster> sorted=Maps.newTreeMap();
    for (    Cluster c : authorizedClusters) {
      sorted.put(c.getNodeState().getAvailability(vmTypeName),c);
    }
    if (sorted.isEmpty()) {
      throw new NotEnoughResourcesAvailable("Not enough resources: no cluster is available on which you have permissions to run instances.");
    }
 else {
      return sorted.firstEntry().getValue();
    }
  }
}
