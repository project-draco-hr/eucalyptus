{
  for (  ClusterStateType c : clusterChanges) {
    EntityWrapper<ClusterInfo> db=new EntityWrapper<ClusterInfo>();
    try {
      ClusterInfo clusterInfo=db.getUnique(new ClusterInfo(c.getName()));
      if (!clusterInfo.getHost().equals(c.getHost()) || clusterInfo.getPort() != c.getPort()) {
        clusterInfo.setHost(c.getHost());
        clusterInfo.setPort(c.getPort());
        Cluster cluster=this.lookup(c.getName());
        this.deregister(c.getName());
        cluster.stop();
        Cluster newCluster=new Cluster(clusterInfo);
        this.register(newCluster);
        db.commit();
        newCluster.start();
      }
 else       db.rollback();
    }
 catch (    Exception e) {
      ClusterInfo clusterInfo=setupCluster(c);
      db.add(clusterInfo);
      db.commit();
    }
  }
}
