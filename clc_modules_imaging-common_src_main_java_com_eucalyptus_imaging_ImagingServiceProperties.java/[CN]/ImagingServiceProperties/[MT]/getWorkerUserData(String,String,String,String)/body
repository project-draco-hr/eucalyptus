{
  Map<String,String> kvMap=new HashMap<String,String>();
  if (ntpServer != null)   kvMap.put("ntp_server",ntpServer);
  if (logServer != null)   kvMap.put("log_server",logServer);
  if (logServerPort != null)   kvMap.put("log_server_port",logServerPort);
  kvMap.put("imaging_service_url",String.format("imaging.%s",DNSProperties.DOMAIN));
  kvMap.put("euare_service_url",String.format("euare.%s",DNSProperties.DOMAIN));
  kvMap.put("compute_service_url",String.format("compute.%s",DNSProperties.DOMAIN));
  final StringBuilder sb=new StringBuilder("#!/bin/bash").append("\n");
  if (initScript != null && initScript.length() > 0)   sb.append(initScript);
  sb.append("\n#System generated Imaging worker config\n");
  sb.append("mkdir -p /etc/eucalyptus-imaging-worker/\n");
  sb.append("yum -y --disablerepo \\* --enablerepo eucalyptus-service-image install eucalyptus-imaging-worker\n");
  sb.append("echo \"");
  for (  String key : kvMap.keySet()) {
    String value=kvMap.get(key);
    sb.append(String.format("\n%s=%s",key,value));
  }
  sb.append("\" > /etc/eucalyptus-imaging-worker/imaging-worker.conf");
  sb.append("\ntouch /var/lib/eucalyptus-imaging-worker/ntp.lock");
  sb.append("\nchown -R imaging-worker:imaging-worker /etc/eucalyptus-imaging-worker");
  sb.append("\nservice eucalyptus-imaging-worker start");
  return sb.toString();
}
