{
  try {
    LOG.info("stackId=" + stack.getStackId());
    for (    StackResourceEntity stackResourceEntity : StackResourceEntityManager.getStackResources(stack.getStackId(),accountId)) {
      ResourceAction resourceAction=null;
      LOG.info("resourceType=" + stackResourceEntity.getResourceType());
      LOG.info("physicalResourceId=" + stackResourceEntity.getPhysicalResourceId());
      if (stackResourceEntity.getResourceType().equals("AWS::EC2::Instance")) {
        LOG.info("It's an instance!");
        AWSEC2InstanceResourceInfo awsec2Instance=new AWSEC2InstanceResourceInfo();
        awsec2Instance.setEffectiveUserId(effectiveUserId);
        awsec2Instance.setLogicalResourceId(stackResourceEntity.getLogicalResourceId());
        awsec2Instance.setType(stackResourceEntity.getResourceType());
        awsec2Instance.setPhysicalResourceId(stackResourceEntity.getPhysicalResourceId());
        resourceAction=new AWSEC2InstanceResourceAction();
        resourceAction.setResourceInfo(awsec2Instance);
      }
      try {
        resourceAction.delete();
      }
 catch (      Throwable ex) {
        LOG.error(ex,ex);
      }
    }
    StackResourceEntityManager.deleteStackResources(stack.getStackId(),accountId);
    StackEventEntityManager.deleteStackEvents(stack.getStackId(),accountId);
    StackEntityManager.deleteStack(stack.getStackId(),accountId);
  }
 catch (  Throwable ex) {
    LOG.error(ex,ex);
  }
}
