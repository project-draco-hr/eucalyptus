{
  Address address=null;
  try {
    address=Addresses.getInstance().lookup(addr);
  }
 catch (  NoSuchElementException e) {
    throw new EucalyptusCloudException("Permission denied while trying to release address: " + addr);
  }
  if (!isAdmin && !address.getUserId().equals(userId)) {
    throw new EucalyptusCloudException("Permission denied while trying to release address: " + addr);
  }
 else   if (address.isPending()) {
    throw new EucalyptusCloudException("A previous assign/unassign is still pending for this address: " + address.getName());
  }
 else   if (address.isSystemOwned() && !isAdmin) {
    throw new EucalyptusCloudException("Cannot manipulate system owned address: " + address.getName());
  }
  return address;
}
