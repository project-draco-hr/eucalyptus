{
  Context ctx=Contexts.lookup();
  String action=PolicySpec.requestToAction(request);
  if (!ctx.hasAdministrativePrivileges()) {
    if (!Permissions.isAuthorized(PolicySpec.VENDOR_EC2,PolicySpec.EC2_RESOURCE_ADDRESS,"",ctx.getAccount(),action,ctx.getUser())) {
      throw new EucalyptusCloudException("Not authorized to allocate address by " + ctx.getUser().getName());
    }
    if (!Permissions.canAllocate(PolicySpec.VENDOR_EC2,PolicySpec.EC2_RESOURCE_ADDRESS,"",action,ctx.getUser(),1L)) {
      throw new EucalyptusCloudException("Exceeded quota in allocating address by " + ctx.getUser().getName());
    }
  }
  return Addresses.getAddressManager().allocateNext(ctx.getUserFullName());
}
