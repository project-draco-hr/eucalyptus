{
  final String instanceId=addr.getInstanceId();
  try {
    final VmInstance vm=VmInstances.getInstance().lookup(instanceId);
    return new Callback.Success<BaseMessage>(){
      public void fire(      BaseMessage response){
        try {
          if (!addr.isSystemOwned()) {
            addr.release();
          }
 else {
            Addresses.getAddressManager().releaseSystemAddress(addr);
          }
        }
 catch (        IllegalStateException e) {
        }
catch (        Throwable e) {
          LOG.debug(e,e);
        }
        Addresses.system(vm);
      }
    }
;
  }
 catch (  NoSuchElementException e) {
    return new Callback.Success<BaseMessage>(){
      public void fire(      BaseMessage response){
        if (!addr.isSystemOwned()) {
          addr.release();
        }
 else {
          Addresses.getAddressManager().releaseSystemAddress(addr);
        }
      }
    }
;
  }
}
