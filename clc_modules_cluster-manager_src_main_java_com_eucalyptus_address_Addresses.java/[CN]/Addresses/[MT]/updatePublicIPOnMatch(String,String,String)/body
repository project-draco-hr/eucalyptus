{
  Entities.asTransaction(VmInstance.class,new Predicate<Void>(){
    @Override public boolean apply(    @Nullable final Void nothing){
      try {
        final VmInstance vm=VmInstances.lookupByPrivateIp(privateIp);
        if (expectedPublicIp == null || expectedPublicIp.equals(vm.getPublicAddress())) {
          vm.updatePublicAddress(publicIp);
        }
      }
 catch (      NoSuchElementException e) {
        LOG.debug("Instance not found for private IP " + privateIp);
      }
catch (      Exception t) {
        LOG.error(t,t);
      }
      return true;
    }
  }
).apply(null);
}
