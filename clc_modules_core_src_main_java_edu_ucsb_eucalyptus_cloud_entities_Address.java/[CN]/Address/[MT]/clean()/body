{
  this.canHas.writeLock().lock();
  try {
    String user=this.userId;
    if (!this.pending.get()) {
      this.release();
      if (!Component.eucalyptus.name().equals(user) || edu.ucsb.eucalyptus.util.EucalyptusProperties.getSystemConfiguration().isDoDynamicPublicAddresses() && !allocatedAddr.isAssigned() && !allocatedAddr.isPending()) {
        this.allocate(userId);
      }
    }
  }
  finally {
    this.canHas.writeLock().unlock();
  }
}
