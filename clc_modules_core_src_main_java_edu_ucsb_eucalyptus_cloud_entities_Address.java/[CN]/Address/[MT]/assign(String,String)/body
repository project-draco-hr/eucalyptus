{
  if (!this.pending.compareAndSet(false,true)) {
    throw new IllegalStateException("Trying to assign an address which is currently pending: " + this);
  }
 else   if (!this.state.compareAndSet(State.allocated,State.assigned)) {
    this.pending.set(false);
    throw new IllegalStateException("Address is not currently unassigned: " + this);
  }
 else {
    this.canHas.writeLock().lock();
    try {
      this.instanceId=instanceId;
      this.instanceAddress=instanceAddr;
      return true;
    }
  finally {
      this.canHas.writeLock().unlock();
      LOG.debug(EventRecord.caller(this.getClass(),State.assigning,this.toString()));
    }
  }
}
