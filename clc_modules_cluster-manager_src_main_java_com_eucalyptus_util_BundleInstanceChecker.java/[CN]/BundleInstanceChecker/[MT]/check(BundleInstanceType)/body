{
  String policy=new String(Base64.decode(request.getUploadPolicy()));
  String bucketName=request.getBucket();
  String prefix=request.getPrefix();
  if (policy == null || bucketName == null || prefix == null)   throw new EucalyptusCloudException("One or more required parameters are null");
  LOG.info("bundle-instance policy: " + policy);
  int idxOpenBracket=policy.indexOf("{");
  int idxClosingBracket=policy.lastIndexOf("}");
  if (idxOpenBracket < 0 || idxClosingBracket < 0 || idxOpenBracket >= idxClosingBracket)   throw new EucalyptusCloudException("Custom policy is not acceptable for bundle instance");
  String bucketAndAcl=policy.substring(idxOpenBracket,idxClosingBracket - idxOpenBracket);
  if (!bucketAndAcl.contains(bucketName))   throw new EucalyptusCloudException("Custom policy is not acceptable for bundle instance");
  if (!bucketAndAcl.contains("ec2-bundle-read"))   throw new EucalyptusCloudException("Custom policy is not acceptable for bundle instance");
  if (!checkBucketName(bucketName))   throw new EucalyptusCloudException("Bucket name is invalid");
  if (!prefix.startsWith("windows"))   throw new EucalyptusCloudException("Prefix name should start with 'windows'");
}
