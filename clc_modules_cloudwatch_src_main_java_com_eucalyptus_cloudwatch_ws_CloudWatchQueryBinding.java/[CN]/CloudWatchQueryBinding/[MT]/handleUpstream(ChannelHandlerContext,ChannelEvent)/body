{
  try {
    super.handleUpstream(ctx,channelEvent);
  }
 catch (  Exception ex) {
    final WrappedBindingException cause=Exceptions.findCause(ex,WrappedBindingException.class);
    if (cause != null) {
      CloudWatchException cloudWatchException=Exceptions.findCause(cause,CloudWatchException.class);
      if (cloudWatchException != null) {
        final QueryBindingInfo info=Ats.inClassHierarchy(cloudWatchException.getClass()).get(QueryBindingInfo.class);
        HttpResponseStatus status=info == null ? HttpResponseStatus.INTERNAL_SERVER_ERROR : new HttpResponseStatus(info.statusCode(),cloudWatchException.getCode());
        final BaseMessage errorResp=new CloudWatchErrorHandler().buildErrorResponse(cause.getMappingHttpRequest().getCorrelationId(),cloudWatchException.getRole(),cloudWatchException.getCode(),cloudWatchException.getMessage());
        Contexts.response(new BaseMessageSupplier(errorResp,status));
        return;
      }
    }
    throw ex;
  }
}
