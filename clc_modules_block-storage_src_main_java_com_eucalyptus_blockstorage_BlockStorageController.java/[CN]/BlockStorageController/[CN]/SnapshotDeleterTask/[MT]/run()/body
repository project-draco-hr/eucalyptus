{
  EntityWrapper<SnapshotInfo> db=StorageProperties.getEntityWrapper();
  SnapshotInfo searchSnap=new SnapshotInfo();
  searchSnap.setStatus(StorageProperties.Status.deleting.toString());
  List<SnapshotInfo> snapshots=db.query(searchSnap);
  db.commit();
  for (  SnapshotInfo snap : snapshots) {
    String snapshotId=snap.getSnapshotId();
    LOG.info("Snapshot: " + snapshotId + " was marked for deletion. Cleaning up...");
    try {
      blockManager.deleteSnapshot(snapshotId);
    }
 catch (    EucalyptusCloudException e1) {
      LOG.error(e1);
      continue;
    }
    SnapshotInfo snapInfo=new SnapshotInfo(snapshotId);
    db=StorageProperties.getEntityWrapper();
    SnapshotInfo foundSnapshotInfo;
    try {
      foundSnapshotInfo=db.getUnique(snapInfo);
      foundSnapshotInfo.setStatus(StorageProperties.Status.deleted.toString());
      db.commit();
    }
 catch (    EucalyptusCloudException e) {
      db.rollback();
      LOG.error(e);
      continue;
    }
    try {
      snapshotOps.deleteSnapshot(foundSnapshotInfo.getSnapshotLocation(),snapshotId);
    }
 catch (    EucalyptusCloudException e) {
      LOG.error(e);
    }
  }
}
