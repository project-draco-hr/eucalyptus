{
  String tmpUncompressedFileName=null;
  File tmpUncompressedFile=null;
  int retry=0;
  int maxRetry=5;
  do {
    tmpUncompressedFileName=StorageProperties.storageRootDirectory + File.separator + key+ "-"+ String.valueOf(randomGenerator.nextInt());
    tmpUncompressedFile=new File(tmpUncompressedFileName);
  }
 while (tmpUncompressedFile.exists() && retry++ < maxRetry);
  if (retry >= maxRetry) {
    throw new EucalyptusCloudException("Could not get a temporary file for snapshot download after " + maxRetry + " attempts");
  }
  try {
    snapshotOps.downloadSnapshot(bucket,key,tmpUncompressedFile);
  }
 catch (  Exception ex) {
    cleanupFile(tmpUncompressedFile);
    throw new EucalyptusCloudException("Failed to download snapshot object with key " + key + " from ObjectStorage bucket "+ bucket,ex);
  }
  return tmpUncompressedFileName;
}
