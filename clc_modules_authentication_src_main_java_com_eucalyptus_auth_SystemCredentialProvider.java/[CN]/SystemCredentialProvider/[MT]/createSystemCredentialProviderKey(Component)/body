{
  try {
    KeyPair sysKp=Credentials.generateKeyPair();
    X509Certificate sysX509=Credentials.generateServiceCertificate(sysKp,name.name());
    SystemCredentialProvider.certs.put(name,sysX509);
    SystemCredentialProvider.keypairs.put(name,sysKp);
    EucaKeyStore.getInstance().addKeyPair(name.name(),sysX509,sysKp.getPrivate(),name.name());
    EucaKeyStore.getInstance().store();
  }
 catch (  Exception e) {
    SystemCredentialProvider.certs.remove(name);
    SystemCredentialProvider.keypairs.remove(name);
    EucaKeyStore.getInstance().remove();
    throw e;
  }
}
