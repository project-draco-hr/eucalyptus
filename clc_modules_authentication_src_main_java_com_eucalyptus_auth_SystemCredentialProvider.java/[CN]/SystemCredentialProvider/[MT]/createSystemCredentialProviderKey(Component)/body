{
  KeyTool keyTool=new KeyTool();
  try {
    KeyPair sysKp=keyTool.getKeyPair();
    X509Certificate sysX509=keyTool.getCertificate(sysKp,EucalyptusProperties.getDName(name.name()));
    SystemCredentialProvider.certs.put(name,sysX509);
    SystemCredentialProvider.keypairs.put(name,sysKp);
    EucaKeyStore.getInstance().addKeyPair(name.name(),sysX509,sysKp.getPrivate(),name.name());
    EucaKeyStore.getInstance().store();
  }
 catch (  Exception e) {
    SystemCredentialProvider.certs.remove(name);
    SystemCredentialProvider.keypairs.remove(name);
    EucaKeyStore.getInstance().remove();
    throw e;
  }
}
