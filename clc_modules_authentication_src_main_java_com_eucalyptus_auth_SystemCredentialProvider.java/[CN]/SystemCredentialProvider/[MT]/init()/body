{
  if (EucaKeyStore.getInstance().containsEntry(this.name.name())) {
    try {
      SystemCredentialProvider.certs.put(this.name,EucaKeyStore.getInstance().getCertificate(this.name.name()));
      SystemCredentialProvider.keypairs.put(this.name,EucaKeyStore.getInstance().getKeyPair(this.name.name(),this.name.name()));
      return;
    }
 catch (    Exception e) {
      SystemCredentialProvider.certs.remove(this);
      SystemCredentialProvider.keypairs.remove(this);
      LOG.fatal("Failed to read keys from the keystore.  Please repair the keystore by hand.");
      LOG.fatal(e,e);
      throw e;
    }
  }
 else   if (Component.eucalyptus.isLocal()) {
    this.createSystemCredentialProviderKey(this.name);
    return;
  }
  for (  Service s : Components.lookup(this.name).getServices()) {
    try {
      s.getCredentials().setCertificate(this.getCertificate());
      s.getCredentials().setKeys(this.getKeyPair());
    }
 catch (    Throwable ex) {
      LOG.trace(ex,ex);
    }
  }
  throw new RuntimeException("Failed to load credentials because of an unknown error.");
}
