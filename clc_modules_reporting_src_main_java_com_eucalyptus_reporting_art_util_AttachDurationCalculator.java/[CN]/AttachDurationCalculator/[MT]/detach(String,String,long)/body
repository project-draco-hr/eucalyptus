{
  if (timestampMs < reportBeginMs)   return 0l;
  if (!attachments.containsKey(resourceId)) {
    attachments.put(resourceId,new HashMap<String,TreeSet<Long>>());
  }
  Map<String,TreeSet<Long>> innerMap=attachments.get(resourceId);
  if (!innerMap.containsKey(attachedResourceId)) {
    innerMap.put(attachedResourceId,new TreeSet<Long>());
  }
  TreeSet<Long> timestamps=innerMap.get(attachedResourceId);
  Long attachTimestamp=timestamps.floor(timestampMs);
  if (attachTimestamp != null) {
    return (Math.min(timestampMs,reportEndMs) - attachTimestamp.longValue());
  }
 else {
    return 0;
  }
}
