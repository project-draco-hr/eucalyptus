{
  if (timestampMs < reportBeginMs)   return 0l;
  if (!attachments.containsKey(resourceKey)) {
    attachments.put(resourceKey,new HashMap<B,TreeSet<Long>>());
  }
  Map<B,TreeSet<Long>> innerMap=attachments.get(resourceKey);
  if (!innerMap.containsKey(attachedResourceKey)) {
    innerMap.put(attachedResourceKey,new TreeSet<Long>());
  }
  TreeSet<Long> timestamps=innerMap.get(attachedResourceKey);
  Long attachTimestamp=timestamps.floor(timestampMs);
  if (attachTimestamp != null) {
    return DurationCalculator.boundDuration(reportBeginMs,reportEndMs,attachTimestamp.longValue(),timestampMs);
  }
 else {
    return 0;
  }
}
