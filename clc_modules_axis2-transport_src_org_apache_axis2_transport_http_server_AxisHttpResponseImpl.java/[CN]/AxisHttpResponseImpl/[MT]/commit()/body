{
  if (this.commited) {
    return;
  }
  this.commited=true;
  this.context.setAttribute(ExecutionContext.HTTP_CONNECTION,this.conn);
  this.context.setAttribute(ExecutionContext.HTTP_RESPONSE,this.response);
  BasicHttpEntity entity=new BasicHttpEntity();
  entity.setChunked(true);
  entity.setContentType(this.contentType);
  Header header=response.getFirstHeader(HTTP.CONTENT_LEN);
  if (header != null) {
    String contentLengthAsString=header.getValue();
    entity.setContentLength(Long.parseLong(contentLengthAsString));
    entity.setChunked(false);
    response.removeHeader(header);
  }
  this.response.setEntity(entity);
  this.httpproc.process(this.response,this.context);
  this.conn.sendResponse(this.response);
}
