{
  ServiceTransitionCallback trans=null;
  try {
    if (Hosts.isServiceLocal(parent)) {
      trans=ServiceLocalTransitionCallbacks.valueOf(transitionAction.name());
    }
 else     if (Hosts.isCoordinator()) {
      trans=CloudRemoteTransitionCallbacks.valueOf(transitionAction.name());
    }
 else {
      trans=ServiceRemoteTransitionNotification.valueOf(transitionAction.name());
    }
    if (trans != null) {
      Logs.exhaust().debug("Executing transition: " + trans.getClass() + "."+ transitionAction.name()+ " for "+ parent);
      trans.fire(parent);
    }
    transitionCallback.fire();
  }
 catch (  Exception ex) {
    LOG.error(parent.getFullName() + " failed transition " + transitionAction.name()+ " because of "+ ex.getMessage());
    if (Faults.filter(parent,ex)) {
      try {
        Faults.persist(Faults.failure(parent,ex));
      }
  finally {
        transitionCallback.fireException(ex);
      }
      throw Exceptions.toUndeclared(ex);
    }
 else {
      try {
        Faults.persist(Faults.advisory(parent,ex));
      }
  finally {
        transitionCallback.fire();
      }
    }
  }
}
