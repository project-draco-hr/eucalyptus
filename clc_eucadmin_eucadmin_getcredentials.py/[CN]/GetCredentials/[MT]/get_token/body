def get_token(self, num_retries=10):
    i = 0
    while (i < num_retries):
        cmd_string = get_cmdstring('mysql_get_token')
        cmd = Command((cmd_string % (self.account, self.user, self.db_pass)))
        self.token = cmd.stdout.strip()
        if self.token:
            break
        print 'waiting for MySQL to respond'
        time.sleep(10)
        i += 1
    if (not self.token):
        raise ValueError('cannot find code in database')
