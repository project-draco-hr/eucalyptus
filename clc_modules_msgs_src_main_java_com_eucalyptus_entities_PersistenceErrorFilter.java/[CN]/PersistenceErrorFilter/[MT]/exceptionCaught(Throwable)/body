{
  if (e instanceof RuntimeException) {
    Class<? extends Throwable> type=e.getClass();
    for (Class<? extends Throwable> t=type; type != null && type != Exception.class; t=(Class<? extends Throwable>)t.getSuperclass()) {
      for (      ErrorCategory category : ErrorCategory.values()) {
        if (errorCategorization.containsEntry(category,t)) {
          throw category.handleException((RuntimeException)e);
        }
      }
    }
    return new RecoverablePersistenceException(ErrorCategory.RUNTIME.handleException(new PersistenceException("Unclassified error occurred: " + e.getMessage(),e)));
  }
 else {
    return new RecoverablePersistenceException(ErrorCategory.APPLICATION.handleException(new PersistenceException("Unclassified error occurred: " + e.getMessage(),e)));
  }
}
