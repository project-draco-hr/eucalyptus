{
  try {
    VmInstance vm=VmInstances.getInstance().lookup(msg.getInstanceId());
    VmState vmState=vm.getState();
    if (!VmState.RUNNING.equals(vmState) && !VmState.PENDING.equals(vmState)) {
      LOG.debug(EventRecord.here(AssignAddressCallback.class,Address.State.assigning,LogUtil.FAIL,parentAddr.toString()));
      this.parentAddr.clearPending();
      this.parentAddr.release();
      throw new IllegalStateException("Ignoring assignment to a vm which is not running: " + msg);
    }
 else {
      this.parentVm.getNetworkConfig().setIgnoredPublicIp(msg.getSource());
      LOG.debug(EventRecord.here(AssignAddressCallback.class,Address.State.assigning,parentAddr.toString()));
    }
  }
 catch (  Exception e) {
    LOG.debug(e,e);
    this.parentAddr.clearPending();
    throw e;
  }
}
