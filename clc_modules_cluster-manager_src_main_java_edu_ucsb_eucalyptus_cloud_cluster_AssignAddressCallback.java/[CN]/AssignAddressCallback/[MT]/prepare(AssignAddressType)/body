{
  try {
    VmInstance vm=VmInstances.getInstance().lookup(msg.getInstanceId());
    VmState vmState=vm.getState();
    if (!VmState.RUNNING.equals(vmState) && !VmState.PENDING.equals(vmState)) {
      LOG.debug(EventRecord.here(AssignAddressCallback.class,Transition.assigning,LogUtil.FAIL,address.toString()));
      this.address.clearPending();
      this.address.release();
      throw new IllegalStateException("Ignoring assignment to a vm which is not running: " + msg);
    }
  }
 catch (  Exception e) {
    LOG.debug(e,e);
    this.address.clearPending();
    throw e;
  }
  LOG.debug(EventRecord.here(AssignAddressCallback.class,Transition.assigning,address.toString()));
}
