{
  String bucketName=request.getBucket();
  EntityWrapper<BucketInfo> db=EntityWrapper.get(BucketInfo.class);
  BucketInfo searchBucket=new BucketInfo(bucketName);
  List<BucketInfo> bucketList=db.query(searchBucket);
  if (bucketList.size() > 0) {
    BucketInfo bucketFound=bucketList.get(0);
    EntityWrapper<ObjectInfo> dbObject=db.recast(ObjectInfo.class);
    ObjectInfo searchObject=new ObjectInfo();
    searchObject.setBucketName(bucketName);
    searchObject.setDeleted(false);
    List<ObjectInfo> objectInfos=dbObject.query(searchObject);
    if (objectInfos.size() == 0) {
      db.delete(bucketFound);
      try {
        storageManager.deleteBucket(bucketName);
        if (WalrusProperties.trackUsageStatistics)         walrusStatistics.decrementBucketCount();
      }
 catch (      IOException ex) {
        LOG.error(ex);
      }
    }
 else {
      db.rollback();
      throw new BucketNotEmptyException(bucketName);
    }
  }
 else {
    db.rollback();
    throw new NoSuchBucketException(bucketName);
  }
  db.commit();
}
