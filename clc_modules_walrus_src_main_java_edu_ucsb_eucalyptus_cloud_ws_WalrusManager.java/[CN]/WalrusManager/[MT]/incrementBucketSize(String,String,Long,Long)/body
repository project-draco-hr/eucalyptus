{
  EntityWrapper<BucketInfo> db=EntityWrapper.get(BucketInfo.class);
  try {
    BucketInfo searchBucket=new BucketInfo(bucketName);
    BucketInfo bucket=null;
    try {
      bucket=db.getUniqueEscape(searchBucket);
    }
 catch (    EucalyptusCloudException ex) {
      LOG.error(ex);
      throw new NoSuchBucketException(bucketName);
    }
    Long bucketSize=bucket.getBucketSize();
    long newSize=bucketSize + oldBucketSize + size;
    if (WalrusProperties.shouldEnforceUsageLimits && !Contexts.lookup().hasAdministrativePrivileges()) {
      if (newSize > (WalrusInfo.getWalrusInfo().getStorageMaxBucketSizeInMB() * WalrusProperties.M)) {
        throw new EntityTooLargeException("Key",objectKey);
      }
    }
    bucket.setBucketSize(newSize);
    db.commit();
  }
 catch (  RollbackException ex) {
    throw ex;
  }
catch (  EucalyptusCloudException ex) {
    db.rollback();
    throw ex;
  }
}
