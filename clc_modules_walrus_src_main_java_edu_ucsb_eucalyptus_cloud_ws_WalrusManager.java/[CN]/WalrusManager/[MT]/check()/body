{
  File bukkitDir=new File(WalrusProperties.bucketRootDirectory);
  if (!bukkitDir.exists()) {
    if (!bukkitDir.mkdirs()) {
      LOG.fatal("Unable to make bucket root directory: " + WalrusProperties.bucketRootDirectory);
      throw new EucalyptusCloudException("Invalid bucket root directory");
    }
  }
 else   if (!bukkitDir.canWrite()) {
    LOG.fatal("Cannot write to bucket root directory: " + WalrusProperties.bucketRootDirectory);
    throw new EucalyptusCloudException("Invalid bucket root directory");
  }
  EntityWrapper<BucketInfo> db=WalrusControl.getEntityWrapper();
  BucketInfo bucketInfo=new BucketInfo();
  List<BucketInfo> bucketInfos=db.query(bucketInfo);
  for (  BucketInfo bucket : bucketInfos) {
    if (!storageManager.bucketExists(bucket.getBucketName()))     bucket.setHidden(true);
 else     bucket.setHidden(false);
  }
  db.commit();
}
