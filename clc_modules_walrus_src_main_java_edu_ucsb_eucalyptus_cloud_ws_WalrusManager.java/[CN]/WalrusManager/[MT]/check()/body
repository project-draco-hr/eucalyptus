{
  String bukkitDir=WalrusInfo.getWalrusInfo().getStorageDir();
  File bukkits=new File(WalrusInfo.getWalrusInfo().getStorageDir());
  if (!bukkits.exists()) {
    if (!bukkits.mkdirs()) {
      LOG.fatal("Unable to make bucket root directory: " + bukkitDir);
      throw new EucalyptusCloudException("Invalid bucket root directory");
    }
  }
 else   if (!bukkits.canWrite()) {
    LOG.fatal("Cannot write to bucket root directory: " + bukkitDir);
    throw new EucalyptusCloudException("Invalid bucket root directory");
  }
  try {
    SystemUtil.setEucaReadWriteOnly(bukkitDir);
  }
 catch (  EucalyptusCloudException ex) {
    LOG.fatal(ex);
  }
  EntityWrapper<BucketInfo> db=EntityWrapper.get(BucketInfo.class);
  BucketInfo bucketInfo=new BucketInfo();
  List<BucketInfo> bucketInfos=db.query(bucketInfo);
  for (  BucketInfo bucket : bucketInfos) {
    if (!storageManager.bucketExists(bucket.getBucketName()))     bucket.setHidden(true);
 else     bucket.setHidden(false);
  }
  db.commit();
}
