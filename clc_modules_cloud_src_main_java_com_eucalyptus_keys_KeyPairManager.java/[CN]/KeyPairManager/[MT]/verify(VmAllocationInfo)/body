{
  if (SshKeyPair.NO_KEY_NAME.equals(vmAllocInfo.getRequest().getKeyName()) || vmAllocInfo.getRequest().getKeyName() == null) {
    vmAllocInfo.setKeyInfo(new VmKeyInfo());
    return vmAllocInfo;
  }
  SshKeyPair keypair=KeyPairUtil.getUserKeyPair(vmAllocInfo.getRequest().getUserId(),vmAllocInfo.getRequest().getKeyName());
  if (keypair == null) {
    throw new EucalyptusCloudException("Failed to find keypair: " + vmAllocInfo.getRequest().getKeyName());
  }
  vmAllocInfo.setKeyInfo(new VmKeyInfo(keypair.getDisplayName(),keypair.getPublicKey(),keypair.getFingerPrint()));
  return vmAllocInfo;
}
