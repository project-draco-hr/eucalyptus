{
  BaseMessage reply=null;
  if (responseMessage.getExceptionPayload() == null) {
    reply=(BaseMessage)responseMessage.getPayload();
  }
 else {
    Throwable t=responseMessage.getExceptionPayload().getException();
    t=(t.getCause() == null) ? t : t.getCause();
    reply=new EucalyptusErrorMessageType(service,request,t.getMessage());
  }
  String corrId=reply.getCorrelationId();
  EventRecord.here(ReplyQueue.class,EventType.MSG_REPLY,reply.getCorrelationId(),reply.getClass().getSimpleName()).debug();
  try {
    Context context=Contexts.lookup(corrId);
    Channel channel=context.getChannel();
    Channels.write(channel,reply);
    Contexts.clear(context);
  }
 catch (  NoSuchContextException e) {
    LOG.trace(e,e);
  }
}
