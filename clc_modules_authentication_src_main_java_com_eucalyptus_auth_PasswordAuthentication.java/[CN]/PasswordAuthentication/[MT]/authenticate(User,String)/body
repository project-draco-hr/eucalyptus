{
  if (authenticateWithLdap(user))   try {
    LdapSync.authenticate(user,password);
  }
 catch (  LdapException e) {
    throw new AuthException(INVALID_USERNAME_OR_PASSWORD);
  }
 else   if (!Crypto.verifyPassword(password,user.getPassword())) {
    throw new AuthException(INVALID_USERNAME_OR_PASSWORD);
  }
  checkPasswordExpiration(user);
}
