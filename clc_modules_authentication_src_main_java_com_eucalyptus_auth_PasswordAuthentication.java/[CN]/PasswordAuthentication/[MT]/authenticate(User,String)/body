{
  boolean checkExpiration=true;
  if (authenticateWithLdap(user))   try {
    LdapSync.authenticate(user,password);
    checkExpiration=false;
  }
 catch (  LdapException e) {
    throw new AuthException(INVALID_USERNAME_OR_PASSWORD);
  }
 else   if (!Crypto.verifyPassword(password,user.getPassword())) {
    throw new AuthException(INVALID_USERNAME_OR_PASSWORD);
  }
  if (checkExpiration) {
    checkPasswordExpiration(user);
  }
}
