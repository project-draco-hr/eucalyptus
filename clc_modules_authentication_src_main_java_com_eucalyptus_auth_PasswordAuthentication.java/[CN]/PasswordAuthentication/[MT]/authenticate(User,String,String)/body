{
  if (newPassword == null) {
    authenticate(user,password);
  }
 else   if (authenticateWithLdap(user)) {
    throw new AuthException(PASSWORD_CHANGE_NOT_SUPPORTED);
  }
 else   try {
    authenticate(user,password);
    updatePassword(user,newPassword);
  }
 catch (  CredentialExpiredException ex) {
    updatePassword(user,newPassword);
  }
}
