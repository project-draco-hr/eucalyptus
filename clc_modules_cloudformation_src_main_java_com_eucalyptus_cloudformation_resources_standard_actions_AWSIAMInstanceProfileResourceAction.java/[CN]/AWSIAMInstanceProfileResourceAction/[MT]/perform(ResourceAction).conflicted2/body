{
  AWSIAMInstanceProfileResourceAction action=(AWSIAMInstanceProfileResourceAction)resourceAction;
  ServiceConfiguration configuration=Topology.lookup(Euare.class);
  if (action.info.getPhysicalResourceId() == null)   return action;
  boolean seenAllInstanceProfiles=false;
  boolean foundInstanceProfile=false;
  String instanceProfileMarker=null;
  while (!seenAllInstanceProfiles && !foundInstanceProfile) {
    ListInstanceProfilesType listInstanceProfilesType=MessageHelper.createMessage(ListInstanceProfilesType.class,action.info.getEffectiveUserId());
    if (instanceProfileMarker != null) {
      listInstanceProfilesType.setMarker(instanceProfileMarker);
    }
    ListInstanceProfilesResponseType listInstanceProfilesResponseType=AsyncRequests.<ListInstanceProfilesType,ListInstanceProfilesResponseType>sendSync(configuration,listInstanceProfilesType);
    if (listInstanceProfilesResponseType.getListInstanceProfilesResult().getIsTruncated() == Boolean.TRUE) {
      instanceProfileMarker=listInstanceProfilesResponseType.getListInstanceProfilesResult().getMarker();
    }
 else {
      seenAllInstanceProfiles=true;
    }
    if (listInstanceProfilesResponseType.getListInstanceProfilesResult().getInstanceProfiles() != null && listInstanceProfilesResponseType.getListInstanceProfilesResult().getInstanceProfiles().getMember() != null) {
      for (      InstanceProfileType instanceProfileType : listInstanceProfilesResponseType.getListInstanceProfilesResult().getInstanceProfiles().getMember()) {
        if (instanceProfileType.getInstanceProfileName().equals(action.info.getPhysicalResourceId())) {
          foundInstanceProfile=true;
          break;
        }
      }
    }
  }
  if (!foundInstanceProfile)   return action;
  DeleteInstanceProfileType deleteInstanceProfileType=MessageHelper.createMessage(DeleteInstanceProfileType.class,action.info.getEffectiveUserId());
  deleteInstanceProfileType.setInstanceProfileName(action.info.getPhysicalResourceId());
  AsyncRequests.<DeleteInstanceProfileType,DeleteInstanceProfileResponseType>sendSync(configuration,deleteInstanceProfileType);
  return action;
}
