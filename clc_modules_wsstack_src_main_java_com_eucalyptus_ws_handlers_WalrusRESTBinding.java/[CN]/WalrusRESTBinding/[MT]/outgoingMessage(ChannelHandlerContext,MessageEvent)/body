{
  if (event.getMessage() instanceof MappingHttpResponse) {
    MappingHttpResponse httpResponse=(MappingHttpResponse)event.getMessage();
    EucalyptusMessage msg=(EucalyptusMessage)httpResponse.getMessage();
    Binding binding;
    if (!(msg instanceof EucalyptusErrorMessageType)) {
      binding=BindingManager.getBinding(BindingManager.sanitizeNamespace(namespace));
      if (msg instanceof PutObjectResponseType) {
        if (putQueue != null) {
          putQueue=null;
        }
      }
    }
 else {
      binding=BindingManager.getBinding(BindingManager.sanitizeNamespace("http://msgs.eucalyptus.ucsb.edu"));
      if (putQueue != null) {
        putQueue=null;
      }
    }
    if (msg != null) {
      OMElement omMsg=binding.toOM(msg);
      ByteArrayOutputStream byteOut=new ByteArrayOutputStream();
      HoldMe.canHas.lock();
      try {
        omMsg.serialize(byteOut);
      }
  finally {
        HoldMe.canHas.unlock();
      }
      byte[] req=byteOut.toByteArray();
      ChannelBuffer buffer=ChannelBuffers.copiedBuffer(req);
      httpResponse.addHeader(HttpHeaders.Names.CONTENT_LENGTH,String.valueOf(buffer.readableBytes()));
      httpResponse.addHeader(HttpHeaders.Names.CONTENT_TYPE,"application/xml");
      httpResponse.setContent(buffer);
    }
  }
}
