{
  AccessControlPolicyType accessControlPolicy=new AccessControlPolicyType();
  try {
    BufferedInputStream bufferedIn=new BufferedInputStream(in);
    byte[] bytes=new byte[DATA_MESSAGE_SIZE];
    int bytesRead;
    String aclString="";
    while ((bytesRead=bufferedIn.read(bytes)) > 0) {
      aclString+=new String(bytes,0,bytesRead);
    }
    if (aclString.length() > 0) {
      XMLParser xmlParser=new XMLParser(aclString);
      String ownerId=xmlParser.getValue("//Owner/ID");
      String displayName=xmlParser.getValue("//Owner/DisplayName");
      CanonicalUserType canonicalUser=new CanonicalUserType(ownerId,displayName);
      accessControlPolicy.setOwner(canonicalUser);
      AccessControlListType accessControlList=new AccessControlListType();
      ArrayList<Grant> grants=new ArrayList<Grant>();
      List<String> permissions=xmlParser.getValues("//AccessControlList/Grant/Permission");
      DTMNodeList grantees=xmlParser.getNodes("//AccessControlList/Grant/Grantee");
      for (int i=0; i < grantees.getLength(); ++i) {
        String id=xmlParser.getValue(grantees.item(i),"ID");
        if (id.length() > 0) {
          String canonicalUserName=xmlParser.getValue(grantees.item(i),"DisplayName");
          Grant grant=new Grant();
          Grantee grantee=new Grantee();
          grantee.setCanonicalUser(new CanonicalUserType(id,canonicalUserName));
          grant.setGrantee(grantee);
          grant.setPermission(permissions.get(i));
          grants.add(grant);
        }
 else {
          String groupUri=xmlParser.getValue(grantees.item(i),"URI");
          if (groupUri.length() == 0)           throw new EucalyptusCloudException("malformed access control list");
          Grant grant=new Grant();
          Grantee grantee=new Grantee();
          grantee.setGroup(new Group(groupUri));
          grant.setGrantee(grantee);
          grant.setPermission(permissions.get(i));
          grants.add(grant);
        }
      }
      accessControlList.setGrants(grants);
      accessControlPolicy.setAccessControlList(accessControlList);
    }
  }
 catch (  Exception ex) {
    LOG.warn(ex);
    throw new EucalyptusCloudException(ex.getMessage());
  }
  return accessControlPolicy;
}
