{
  byte[] bytes=new byte[DATA_MESSAGE_SIZE];
  try {
synchronized (putQueue) {
      putQueue.wait();
    }
    LOG.info("Starting upload");
    putQueue.put(WalrusDataMessage.StartOfData(dataLength));
    int bytesRead;
    while ((bytesRead=in.read(bytes)) > 0) {
      putQueue.put(WalrusDataMessage.DataMessage(bytes,bytesRead));
    }
    putQueue.put(WalrusDataMessage.EOF());
  }
 catch (  Exception ex) {
    LOG.warn(ex,ex);
  }
}
