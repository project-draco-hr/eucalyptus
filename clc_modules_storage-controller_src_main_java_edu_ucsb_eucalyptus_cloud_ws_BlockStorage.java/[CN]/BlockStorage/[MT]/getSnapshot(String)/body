{
  if (!StorageProperties.enableSnapshots) {
    StorageProperties.updateWalrusUrl();
    if (!StorageProperties.enableSnapshots) {
      LOG.error("Snapshot functionality disabled. Please check the Walrus url");
      throw new EucalyptusCloudException("could not connect to Walrus.");
    }
  }
  String snapshotLocation="snapshots" + "/" + snapshotId;
  String absoluteSnapshotPath=StorageProperties.storageRootDirectory + "/" + snapshotId;
  File file=new File(absoluteSnapshotPath);
  if (file.exists()) {
    file.delete();
  }
  HttpReader snapshotGetter=new HttpReader(snapshotLocation,null,file,"GetWalrusSnapshot","",true);
  snapshotGetter.run();
  int snapshotSize=(int)(file.length() / StorageProperties.GB);
  if (snapshotSize == 0) {
    throw new EucalyptusCloudException("could not download snapshot: " + snapshotId + " from Walrus.");
  }
  EntityWrapper<SnapshotInfo> db=StorageController.getEntityWrapper();
  SnapshotInfo snapshotInfo=new SnapshotInfo(snapshotId);
  snapshotInfo.setProgress("100");
  snapshotInfo.setStartTime(new Date());
  snapshotInfo.setStatus(StorageProperties.Status.available.toString());
  blockManager.addSnapshot(snapshotId);
}
