{
  GetVolumeTokenResponseType reply=(GetVolumeTokenResponseType)request.getReply();
  String volumeId=request.getVolumeId();
  if (null == volumeId) {
    LOG.error("Cannot get token for a null-valued volumeId");
    throw new EucalyptusCloudException("No volumeId specified in token request");
  }
  VolumeToken token=VolumeExports.issueToken(volumeId);
  if (ENCRYPT_TOKEN) {
    String encryptedToken=BlockStorageUtil.encryptForNode(token.getToken());
    reply.setToken(encryptedToken);
  }
 else {
    reply.setToken(token.getToken());
  }
  reply.setVolumeId(volumeId);
  return reply;
}
