{
  StorageProperties.enableSnapshots=StorageProperties.enableStorage=true;
  String walrusAddr=StorageProperties.WALRUS_URL;
  if (walrusAddr == null) {
    LOG.warn("Walrus host addr not set");
  }
  checker=new BlockStorageChecker(volumeStorageManager,snapshotStorageManager,blockManager);
  try {
    blockManager.checkPreconditions();
    blockManager.configure();
    startupChecks();
    if (!WalrusProperties.sharedMode)     BlockStorageChecker.checkWalrusConnection();
  }
 catch (  Exception ex) {
    StorageProperties.enableStorage=false;
    LOG.error(ex.getMessage());
    LOG.warn("Could not initialize block manager. BlockStorage has been disabled.");
    LOG.error("Could not initialize block manager. BlockStorage has been disabled.");
    if (System.getProperty("euca.ebs.disable") == null) {
      SystemUtil.shutdownWithError("EBS is enabled but preconditions failed. Please resolve preconditions or restart with euca.ebs.disable");
    }
  }
}
