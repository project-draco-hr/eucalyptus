{
  DetachStorageVolumeResponseType reply=request.getReply();
  String volumeId=request.getVolumeId();
  if (request.getNodeIqn() != null) {
    throw new EucalyptusCloudException("DetachVolume from single host not supported. Call UnexportVolume instead or set iqn to null to detach all");
  }
  EntityWrapper<VolumeInfo> db=StorageProperties.getEntityWrapper();
  try {
    VolumeInfo volumeInfo=db.getUnique(new VolumeInfo(volumeId));
  }
 catch (  EucalyptusCloudException ex) {
    LOG.error("Unable to find volume: " + volumeId + ex);
    throw new NoSuchEntityException("Unable to find volume: " + volumeId + ex);
  }
 finally {
    db.commit();
  }
  LOG.debug("Detaching volume " + volumeId + " from ALL hosts");
  try {
    blockManager.unexportVolumeFromAll(volumeId);
  }
 catch (  EucalyptusCloudException ex) {
    throw ex;
  }
  return reply;
}
