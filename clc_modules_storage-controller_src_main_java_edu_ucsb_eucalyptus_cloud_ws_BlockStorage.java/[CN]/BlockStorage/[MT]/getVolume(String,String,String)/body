{
  BlockStorageChecker.checkWalrusConnection();
  if (!StorageProperties.enableSnapshots) {
    LOG.error("Could not connect to Walrus. Snapshot functionality disabled. Please check the Walrus url");
    throw new EucalyptusCloudException("could not connect to Walrus.");
  }
  String walrusSnapshotPath=snapshotBucket + "/" + snapshotId;
  String volumePath=StorageProperties.storageRootDirectory + "/" + volumeId+ Hashes.getRandom(10);
  File file=new File(volumePath);
  if (!file.exists()) {
    HttpReader volumeReader=new HttpReader(walrusSnapshotPath,null,file,"GetWalrusSnapshot","",true);
    volumeReader.run();
  }
 else {
    throw new EucalyptusCloudException("volume file already exists");
  }
  if (file.length() == 0) {
    throw new EucalyptusCloudException("could not get volume");
  }
  return volumePath;
}
