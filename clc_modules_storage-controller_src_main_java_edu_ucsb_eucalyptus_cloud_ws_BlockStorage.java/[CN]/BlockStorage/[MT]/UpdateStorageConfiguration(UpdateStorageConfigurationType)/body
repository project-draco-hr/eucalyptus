{
  UpdateStorageConfigurationResponseType reply=(UpdateStorageConfigurationResponseType)request.getReply();
  if (Component.eucalyptus.name().equals(request.getEffectiveUserId()))   throw new AccessDeniedException("Only admin can change walrus properties.");
  String storageRootDirectory=request.getStorageRootDirectory();
  Integer maxTotalVolumeSize=request.getMaxTotalVolumeSize();
  if (maxTotalVolumeSize != null)   StorageProperties.MAX_TOTAL_VOLUME_SIZE=maxTotalVolumeSize;
  Integer maxVolumeSize=request.getMaxVolumeSize();
  if (maxVolumeSize != null)   StorageProperties.MAX_VOLUME_SIZE=maxVolumeSize;
  StorageProperties.updateWalrusUrl();
  try {
    blockManager.checkPreconditions();
    StorageProperties.enableStorage=true;
  }
 catch (  Exception ex) {
    StorageProperties.enableStorage=false;
    LOG.error(ex);
  }
  if (request.getStorageParams() != null) {
    for (    ComponentProperty param : request.getStorageParams()) {
      LOG.info("Storage Param: " + param.getDisplayName() + " Qname: "+ param.getQualifiedName()+ " Value: "+ param.getValue());
    }
    blockManager.setStorageProps(request.getStorageParams());
  }
  return reply;
}
