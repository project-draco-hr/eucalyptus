{
  UpdateStorageConfigurationResponseType reply=(UpdateStorageConfigurationResponseType)request.getReply();
  if (Component.eucalyptus.name().equals(request.getEffectiveUserId()))   throw new AccessDeniedException("Only admin can change walrus properties.");
  String storageRootDirectory=request.getStorageRootDirectory();
  if (storageRootDirectory != null) {
    volumeStorageManager.setRootDirectory(storageRootDirectory);
    snapshotStorageManager.setRootDirectory(storageRootDirectory);
    StorageProperties.storageRootDirectory=storageRootDirectory;
  }
  Integer maxTotalVolumeSize=request.getMaxTotalVolumeSize();
  if (maxTotalVolumeSize != null)   StorageProperties.MAX_TOTAL_VOLUME_SIZE=maxTotalVolumeSize;
  Integer maxVolumeSize=request.getMaxVolumeSize();
  if (maxVolumeSize != null)   StorageProperties.MAX_VOLUME_SIZE=maxVolumeSize;
  String storageInterface=request.getStorageInterface();
  if (storageInterface != null)   StorageProperties.iface=storageInterface;
  Boolean zeroFillVolumes=request.getZeroFillVolumes();
  if (zeroFillVolumes != null)   StorageProperties.zeroFillVolumes=zeroFillVolumes;
  if (request.getSanHost() != null)   StorageProperties.SAN_HOST=request.getSanHost();
  if (request.getSanUser() != null)   StorageProperties.SAN_USERNAME=request.getSanUser();
  if (request.getSanPassword() != null)   StorageProperties.SAN_PASSWORD=request.getSanPassword();
  if (request.getDASDevice() != null)   StorageProperties.DAS_DEVICE=request.getDASDevice();
  check();
  StorageProperties.updateWalrusUrl();
  try {
    blockManager.checkPreconditions();
    StorageProperties.enableStorage=true;
  }
 catch (  Exception ex) {
    StorageProperties.enableStorage=false;
    LOG.error(ex);
  }
  if (request.getStorageParams() != null) {
    for (    String param : request.getStorageParams()) {
      LOG.info("Storage Param: " + param);
    }
  }
  updateConfig();
  return reply;
}
