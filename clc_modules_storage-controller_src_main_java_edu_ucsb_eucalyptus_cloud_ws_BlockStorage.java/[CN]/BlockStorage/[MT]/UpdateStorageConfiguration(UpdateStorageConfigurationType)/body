{
  UpdateStorageConfigurationResponseType reply=(UpdateStorageConfigurationResponseType)request.getReply();
  String storageRootDirectory=request.getStorageRootDirectory();
  if (storageRootDirectory != null) {
    volumeStorageManager.setRootDirectory(storageRootDirectory);
    snapshotStorageManager.setRootDirectory(storageRootDirectory);
  }
  check();
  if (!WalrusProperties.sharedMode)   BlockStorageChecker.checkWalrusConnection();
  try {
    blockManager.checkPreconditions();
    StorageProperties.enableStorage=true;
  }
 catch (  Exception ex) {
    StorageProperties.enableStorage=false;
    LOG.error(ex);
  }
  return reply;
}
