{
  UpdateStorageConfigurationResponseType reply=(UpdateStorageConfigurationResponseType)request.getReply();
  if (EucalyptusProperties.NAME.equals(request.getEffectiveUserId()))   throw new AccessDeniedException("Only admin can change walrus properties.");
  String storageRootDirectory=request.getStorageRootDirectory();
  if (storageRootDirectory != null) {
    volumeStorageManager.setRootDirectory(storageRootDirectory);
    snapshotStorageManager.setRootDirectory(storageRootDirectory);
    StorageProperties.storageRootDirectory=storageRootDirectory;
  }
  Integer maxTotalVolumeSize=request.getMaxTotalVolumeSize();
  if (maxTotalVolumeSize != null)   StorageProperties.MAX_TOTAL_VOLUME_SIZE=maxTotalVolumeSize;
  Integer maxVolumeSize=request.getMaxVolumeSize();
  if (maxVolumeSize != null)   StorageProperties.MAX_VOLUME_SIZE=maxVolumeSize;
  String storageInterface=request.getStorageInterface();
  if (storageInterface != null)   StorageProperties.iface=storageInterface;
  Boolean zeroFillVolumes=request.getZeroFillVolumes();
  if (zeroFillVolumes != null)   StorageProperties.zeroFillVolumes=zeroFillVolumes;
  check();
  if (!WalrusProperties.sharedMode)   BlockStorageChecker.checkWalrusConnection();
  try {
    blockManager.checkPreconditions();
    StorageProperties.enableStorage=true;
  }
 catch (  Exception ex) {
    StorageProperties.enableStorage=false;
    LOG.error(ex);
  }
  getConfig();
  return reply;
}
