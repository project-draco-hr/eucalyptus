{
  try {
    blockManager.createSnapshot(volumeId,snapshotId);
    if (WalrusProperties.sharedMode) {
      EntityWrapper<SnapshotInfo> dbSnap=new EntityWrapper<SnapshotInfo>();
      SnapshotInfo snapshotInfo=new SnapshotInfo(snapshotId);
      SnapshotInfo foundSnapshotInfo=dbSnap.getUnique(snapshotInfo);
      foundSnapshotInfo.setProgress("100");
      foundSnapshotInfo.setTransferred(true);
      foundSnapshotInfo.setStatus(StorageProperties.Status.available.toString());
      dbSnap.commit();
      return;
    }
 else {
      List<String> returnValues=blockManager.prepareForTransfer(volumeId,snapshotId);
      snapshotFileName=returnValues.get(0);
      transferSnapshot();
    }
  }
 catch (  EucalyptusCloudException ex) {
    LOG.error(ex);
  }
}
