{
  final EucalyptusActivityTasks client=EucalyptusActivityTasks.getInstance();
  List<AddressInfoType> addresses=client.describeSystemAddresses(true);
  String allocationId=null;
  for (  final AddressInfoType address : addresses) {
    if (exclude.contains(address.getAllocationId()))     continue;
    if (address.getAssociationId() != null || address.getInstanceId() != null)     continue;
    if (address.getPublicIp() != null) {
      allocationId=address.getAllocationId();
      break;
    }
  }
  if (allocationId == null) {
    final String ipAddress=client.allocateSystemVpcAddress();
    addresses=client.describeSystemAddresses(true,ipAddress);
    allocationId=addresses.get(0).getAllocationId();
  }
  return allocationId;
}
