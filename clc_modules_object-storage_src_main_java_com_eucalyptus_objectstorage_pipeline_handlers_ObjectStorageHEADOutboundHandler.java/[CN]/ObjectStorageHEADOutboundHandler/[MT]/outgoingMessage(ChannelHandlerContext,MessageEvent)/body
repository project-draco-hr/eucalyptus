{
  if (event.getMessage() instanceof MappingHttpResponse) {
    MappingHttpResponse httpResponse=(MappingHttpResponse)event.getMessage();
    BaseMessage msg=(BaseMessage)httpResponse.getMessage();
    httpResponse.setHeader("Date",DateFormatter.dateToHeaderFormattedString(new Date()));
    httpResponse.setHeader("x-amz-request-id",msg.getCorrelationId());
    if (msg instanceof ObjectStorageDataResponseType) {
      httpResponse.addHeader(HttpHeaders.Names.ETAG,"\"" + ((ObjectStorageDataResponseType)msg).getEtag() + "\"");
      String contentType=((ObjectStorageDataResponseType)msg).getContentType();
      if (!Strings.isNullOrEmpty(contentType)) {
        httpResponse.setHeader(HttpHeaders.Names.CONTENT_TYPE,contentType);
      }
      String contentLength=String.valueOf(((ObjectStorageDataResponseType)msg).getSize());
      if (!Strings.isNullOrEmpty(contentLength)) {
        httpResponse.addHeader(HttpHeaders.Names.CONTENT_LENGTH,contentLength);
      }
      if (!Strings.isNullOrEmpty(((ObjectStorageDataResponseType)msg).getVersionId()) && !ObjectStorageProperties.NULL_VERSION_ID.equals(((ObjectStorageDataResponseType)msg).getVersionId())) {
        httpResponse.addHeader(ObjectStorageProperties.X_AMZ_VERSION_ID,((ObjectStorageDataResponseType)msg).getVersionId());
      }
      for (      MetaDataEntry m : ((ObjectStorageDataResponseType)msg).getMetaData()) {
        httpResponse.addHeader(ObjectStorageProperties.AMZ_META_HEADER_PREFIX + m.getName(),m.getValue());
      }
    }
    httpResponse.setMessage(null);
  }
}
