{
  RunInstancesType request=vmAllocInfo.getRequest();
  String instanceType=request.getInstanceType();
  VmType v=VmTypes.getVmType((instanceType == null) ? "m1.small" : instanceType);
  if (v == null) {
    throw new EucalyptusCloudException("instance type does not exist: " + request.getInstanceType());
  }
  User requestUser=Permissions.getUserById(request.getUserId());
  String action=PolicySpec.requestToAction(vmAllocInfo.getRequest());
  if (!Permissions.isAuthorized(PolicySpec.EC2_RESOURCE_VMTYPE,instanceType,null,action,requestUser)) {
    throw new EucalyptusCloudException("Not authorized to allocate vm type " + instanceType + " for "+ requestUser.getName());
  }
  vmAllocInfo.setVmTypeInfo(v.getAsVmTypeInfo());
  return vmAllocInfo;
}
