{
  try {
    if (alarmEntity.getActionsEnabled()) {
      Collection<String> actions=AlarmUtils.getActionsByState(alarmEntity,state);
      CountDownLatch actionCountDownLatch=new CountDownLatch(actions != null ? actions.size() : 0);
      for (      String action : actions) {
        Action actionToExecute=ActionManager.getAction(action,alarmEntity.getDimensionMap());
        if (actionToExecute == null) {
          LOG.warn("Unsupported action " + action);
          actionCountDownLatch.countDown();
        }
 else         if (actionToExecute.alwaysExecute() || stateJustChanged) {
          LOG.debug("Executing alarm " + alarmEntity.getAccountId() + "/"+ alarmEntity.getAlarmName()+ " action "+ action);
          actionToExecute.executeActionAndRecord(action,alarmEntity.getDimensionMap(),alarmEntity,now,historyList,actionCountDownLatch);
        }
 else {
          actionCountDownLatch.countDown();
        }
      }
      actionCountDownLatch.await();
    }
  }
 catch (  InterruptedException e) {
    LOG.error(e);
  }
 finally {
    alarmHistoryCountDownLatch.countDown();
  }
}
