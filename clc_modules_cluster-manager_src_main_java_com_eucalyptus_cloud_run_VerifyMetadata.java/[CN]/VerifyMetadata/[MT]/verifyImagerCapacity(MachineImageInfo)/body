{
  String workerType=com.eucalyptus.imaging.ImagingServiceProperties.IMAGING_WORKER_INSTANCE_TYPE;
  String emiName=com.eucalyptus.imaging.ImagingServiceProperties.IMAGING_WORKER_EMI;
  if (workerType == null)   return false;
  if (emiName == null || "NULL".equals(emiName))   throw new MetadataException("Partition image cannot be deployed without an enabled Imaging Service." + " Please contact your cloud administrator.");
  List<VmTypeDetails> allTypes=com.eucalyptus.imaging.EucalyptusActivityTasks.getInstance().describeVMTypes();
  long diskSizeBytes=0;
  for (  VmTypeDetails type : allTypes) {
    if (type.getName().equalsIgnoreCase(workerType)) {
      diskSizeBytes=type.getDisk() * GIG;
      break;
    }
  }
  MachineImageInfo emi;
  try {
    emi=LookupMachine.INSTANCE.apply(emiName);
  }
 catch (  NoSuchElementException ex) {
    throw new MetadataException("Partition image cannot be deployed without an enabled Imaging Service." + " Please contact your cloud administrator.");
  }
  long spaceLeft=diskSizeBytes - emi.getImageSizeBytes() - img.getImageSizeBytes()- 100 * 2 * MB;
  if (spaceLeft > 0)   return true;
  return false;
}
