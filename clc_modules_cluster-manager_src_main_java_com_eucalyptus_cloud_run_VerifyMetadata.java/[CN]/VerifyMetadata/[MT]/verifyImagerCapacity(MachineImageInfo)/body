{
  String workerType=null;
  try {
    workerType=PropertyDirectory.getPropertyEntry("services.imaging.worker.instance_type").getValue();
  }
 catch (  IllegalAccessException e) {
  }
  if (workerType == null)   return false;
  String emiName=null;
  try {
    emiName=PropertyDirectory.getPropertyEntry("services.imaging.worker.image").getValue();
  }
 catch (  IllegalAccessException e) {
  }
  if (!ImagingServiceProperties.stackExists(true))   throw new MetadataException("Partition image cannot be deployed without an enabled Imaging Service." + " Please contact your cloud administrator.");
  List<VmTypeDetails> allTypes=EucalyptusClient.getInstance().describeVMTypes();
  long diskSizeBytes=0;
  for (  VmTypeDetails type : allTypes) {
    if (type.getName().equalsIgnoreCase(workerType)) {
      diskSizeBytes=type.getDisk() * GIG;
      break;
    }
  }
  MachineImageInfo emi;
  try {
    emi=LookupMachine.INSTANCE.apply(emiName);
  }
 catch (  NoSuchElementException ex) {
    throw new MetadataException("Partition image cannot be deployed without an enabled Imaging Service." + " Please contact your cloud administrator.");
  }
  long spaceLeft=diskSizeBytes - emi.getImageSizeBytes() - img.getImageSizeBytes()- 100 * 2 * MB;
  if (spaceLeft > 0)   return true;
  return false;
}
