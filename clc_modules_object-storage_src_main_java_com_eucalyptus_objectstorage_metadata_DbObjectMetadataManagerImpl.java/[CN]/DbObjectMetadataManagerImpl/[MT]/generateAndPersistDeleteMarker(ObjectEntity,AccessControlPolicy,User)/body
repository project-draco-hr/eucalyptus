{
  final ObjectEntity deleteMarker=currentObject.generateNewDeleteMarkerFrom();
  try (TransactionResource trans=Entities.transactionFor(ObjectEntity.class)){
    deleteMarker.setAcl(acp);
    deleteMarker.setOwnerCanonicalId(owningUser.getAccount().getCanonicalId());
    deleteMarker.setOwnerDisplayName(owningUser.getAccount().getName());
    deleteMarker.setOwnerIamUserDisplayName(owningUser.getName());
    deleteMarker.setObjectModifiedTimestamp(new Date());
    deleteMarker.setIsLatest(true);
    deleteMarker.setIsDeleteMarker(true);
    deleteMarker.setSize(-1L);
    ObjectEntity persistedDeleteMarker=Entities.persist(deleteMarker);
    trans.commit();
    return persistedDeleteMarker;
  }
 catch (  Exception e) {
    LOG.warn("Failed to persist the delete marker " + deleteMarker.getObjectUuid());
    throw new MetadataOperationFailureException(e);
  }
}
