{
  LifecycleRule testRule=new LifecycleRule();
  testRule.setId("test-rule");
  testRule.setStatus(BucketLifecycleManager.RULE_STATUS_ENABLED);
  testRule.setPrefix("/some/test/data");
  Expiration expiration=new Expiration();
  Transition transition=new Transition();
  transition.setDestinationClass("GLACIER");
  expiration.setCreationDelayDays(3);
  Calendar now=Calendar.getInstance();
  now.add(Calendar.DATE,2);
  Date dtNow=now.getTime();
  transition.setEffectiveDate(dtNow);
  testRule.setExpiration(expiration);
  testRule.setTransition(transition);
  List<LifecycleRule> rules=new ArrayList<>();
  rules.add(testRule);
  mgr.addLifecycleRules(rules,"my-unit-test-bucket");
  List<LifecycleRule> retrievedRules=mgr.getLifecycleRules("my-unit-test-bucket");
  assertTrue("expected to be able to retrieve rules after adding",retrievedRules != null);
  assertTrue("expected 1 rule to be retrieved after adding 1 rule",retrievedRules.size() == 1);
  LifecycleRule retrieved=retrievedRules.get(0);
  assertTrue("expected the retrieved rule id to match",retrieved.getId().equals("test-rule"));
  assertTrue("expected the retrieved rule status to match",retrieved.getStatus().equals(BucketLifecycleManager.RULE_STATUS_ENABLED));
  assertTrue("expected the retrieved rule status to match",retrieved.getPrefix().equals("/some/test/data"));
  Expiration retrievedExpiration=retrieved.getExpiration();
  assertTrue("expected the retrieved rule expiration creation delay days to match",retrievedExpiration.getCreationDelayDays() == 3);
  Transition retrievedTransition=retrieved.getTransition();
  assertTrue("expected the retrieved rule transition destination class to match",retrievedTransition.getDestinationClass().equals("GLACIER"));
  Calendar nowAgain=Calendar.getInstance();
  nowAgain.add(Calendar.DATE,2);
  Date dtNowAgain=now.getTime();
  long difference=dtNowAgain.getTime() - retrievedTransition.getEffectiveDate().getTime();
  assertTrue("expected the retrieved rule transition effective date to be relatively close",difference <= 30l);
  cleanRules("my-unit-test-bucket");
}
