{
  EntityWrapper<PrivateNetworkIndex> db=Entities.get(PrivateNetworkIndex.class);
  try {
    Example ex=Example.create(PrivateNetworkIndex.free(exNet)).enableLike(MatchMode.EXACT);
    List<PrivateNetworkIndex> ret=db.createCriteria(PrivateNetworkIndex.class).setCacheable(true).add(ex).setMaxResults(1).setFetchSize(1).list();
    if (ret.isEmpty()) {
      throw new NotEnoughResourcesAvailable("Failed to find a free network index: " + ret);
    }
 else {
      PrivateNetworkIndex idx=ret.get(0);
      db.commit();
      return idx;
    }
  }
 catch (  Exception ex) {
    db.rollback();
    Logs.extreme().error(ex,ex);
    throw new ResourceAllocationException("Failed to allocate network index: " + ex.getMessage(),ex);
  }
}
