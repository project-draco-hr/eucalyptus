{
  List<PrivateNetworkIndex> ret=Entities.get(PrivateNetworkIndex.class).query(PrivateNetworkIndex.free(exNet));
  if (ret.isEmpty()) {
    throw new NotEnoughResourcesAvailable("Failed to find a free network index: " + ret);
  }
 else {
    PrivateNetworkIndex idx=ret.get(0);
    try {
      SetReference<PrivateNetworkIndex,VmInstance> setRef=idx.allocate();
      Entities.get(PrivateNetworkIndex.class).commit();
      return setRef;
    }
 catch (    ResourceAllocationException ex) {
      throw ex;
    }
  }
}
