{
  log.info(String.format("purge earlierThan:%d ",earlierThanMs));
  EntityWrapper entityWrapper=EntityWrapper.get(InstanceAttributes.class);
  Session sess=null;
  try {
    sess=entityWrapper.getSession();
    sess.createSQLQuery("DELETE FROM instance_usage_snapshot WHERE timestamp_ms < ?").setLong(0,new Long(earlierThanMs)).executeUpdate();
    sess.createSQLQuery("DELETE instance_attributes" + " FROM instance_attributes" + " LEFT OUTER JOIN instance_usage_snapshot"+ " ON instance_attributes.uuid = instance_usage_snapshot.uuid"+ " WHERE instance_usage_snapshot.uuid IS NULL").executeUpdate();
    entityWrapper.commit();
  }
 catch (  Exception ex) {
    log.error(ex);
    entityWrapper.rollback();
  }
}
