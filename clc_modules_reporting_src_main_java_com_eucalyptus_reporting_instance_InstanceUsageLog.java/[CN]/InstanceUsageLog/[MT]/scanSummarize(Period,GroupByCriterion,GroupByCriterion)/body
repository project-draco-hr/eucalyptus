{
  Map<String,Map<String,InstanceUsageSummary>> results=new HashMap<String,Map<String,InstanceUsageSummary>>();
  for (  LogScanResult result : scanLog(period)) {
    Period resPeriod=result.getPeriod();
    UsageData usageData=result.getUsageData();
    String outerAttrValue=getAttributeValue(outerCriterion,result.getInstanceAttributes());
    Map<String,InstanceUsageSummary> innerMap;
    if (results.containsKey(outerAttrValue)) {
      innerMap=results.get(outerAttrValue);
    }
 else {
      innerMap=new HashMap<String,InstanceUsageSummary>();
      results.put(outerAttrValue,innerMap);
    }
    String innerAttrValue=getAttributeValue(innerCriterion,result.getInstanceAttributes());
    InstanceUsageSummary summary;
    if (innerMap.containsKey(innerAttrValue)) {
      summary=innerMap.get(innerAttrValue);
    }
 else {
      summary=new InstanceUsageSummary();
      innerMap.put(innerAttrValue,summary);
    }
    String insType=result.getInstanceAttributes().getInstanceType();
    summary.sumFromPeriodType(resPeriod,insType);
    summary.sumFromUsageData(usageData);
  }
  return results;
}
