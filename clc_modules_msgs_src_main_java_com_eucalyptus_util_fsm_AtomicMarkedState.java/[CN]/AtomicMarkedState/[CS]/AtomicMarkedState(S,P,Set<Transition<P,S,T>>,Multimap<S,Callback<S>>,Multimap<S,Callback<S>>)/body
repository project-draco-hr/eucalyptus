{
  this.startState=startState;
  this.name=String.format("State-%s-%s",parent.getClass().getSimpleName(),parent.getName());
  this.parent=parent;
  S[] states=this.startState.getDeclaringClass().getEnumConstants();
  this.immutableStates=ImmutableList.of(states);
  this.state=new AtomicMarkableReference<S>(this.startState,false);
  this.immutableTransitions=ImmutableList.copyOf(transitions);
  for (  Transition<P,S,T> t : transitions) {
    this.transitions.put(t.getName(),t);
  }
  this.inStateListeners.putAll(inStateListeners);
  this.outStateListeners.putAll(outStateListeners);
}
