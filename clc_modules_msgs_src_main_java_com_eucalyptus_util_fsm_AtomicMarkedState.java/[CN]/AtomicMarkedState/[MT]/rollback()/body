{
  if (this.currentTransition.get() == null) {
    throw new IllegalStateException("There is no currently pending transition.");
  }
 else {
    ActiveTransition tr=this.currentTransition.get();
    if (!this.state.compareAndSet(tr.getToState(),tr.getFromState(),true,tr.getFromStateMark())) {
      this.state.set(this.state.getReference(),false);
      IllegalStateException ex=new IllegalStateException("Failed to apply toState for the transition: " + tr.toString() + " for current state: "+ this.toString());
      LOG.error(ex,ex);
    }
    this.currentTransition.set(null);
  }
}
