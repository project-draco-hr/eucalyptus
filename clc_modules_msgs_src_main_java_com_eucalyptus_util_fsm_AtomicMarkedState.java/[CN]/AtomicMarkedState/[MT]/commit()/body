{
  Logs.exhaust().trace("Transition commit(): " + this.currentTransition.get());
  if (!this.state.isMarked()) {
    IllegalStateException ex=Exceptions.trace(new IllegalStateException("commit() called when there is no currently pending transition: " + this.toString()));
    Logs.extreme().error(ex);
    throw ex;
  }
 else {
    ActiveTransition tr=this.currentTransition.getAndSet(null);
    this.state.set(tr.getTransitionRule().getToState(),tr.getTransitionRule().getToStateMark());
    if (!tr.getTransitionRule().getFromState().equals(tr.getTransitionRule().getToState())) {
      this.state.set(tr.getTransitionRule().getToState(),false);
      this.fireInListeners(tr.getTransitionRule().getToState());
    }
 else {
      this.state.set(tr.getTransitionRule().getToState(),false);
    }
    EventRecord.caller(this.getClass(),EventType.TRANSITION_FUTURE,"set(" + this.parent.toString() + ":"+ this.parent.getClass().getCanonicalName()+ ")").trace();
    tr.getTransitionFuture().set(this.parent);
  }
}
