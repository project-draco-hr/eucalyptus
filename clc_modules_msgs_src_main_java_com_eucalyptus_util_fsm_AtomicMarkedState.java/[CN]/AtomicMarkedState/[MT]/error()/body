{
  LOG.debug("Transition error(): " + this.toString());
  if (!this.state.isMarked()) {
    Exceptions.trace(new IllegalStateException("commit() called when there is no currently pending transition: " + this.toString()));
  }
 else {
    ActiveTransition tr=this.currentTransition.getAndSet(null);
    this.state.set(tr.getTransitionRule().getErrorState(),tr.getTransitionRule().getErrorStateMark());
    if (!tr.getTransitionRule().getFromState().equals(tr.getTransitionRule().getErrorState())) {
      this.state.set(tr.getTransitionRule().getErrorState(),false);
      this.fireInListeners(tr.getTransitionRule().getErrorState());
    }
 else {
      this.state.set(tr.getTransitionRule().getErrorState(),false);
    }
  }
}
