{
  final DescribeLoadBalancersByServoResponseType reply=request.getReply();
  final String instanceId=request.getInstanceId();
  LoadBalancerZoneCoreView zoneView=null;
  LoadBalancerZone zone=null;
  try {
    isValidServoRequest(instanceId);
    final LoadBalancerServoInstance instance=LoadBalancers.lookupServoInstance(instanceId);
    zoneView=instance.getAvailabilityZone();
    zone=LoadBalancerZoneEntityTransform.INSTANCE.apply(zoneView);
  }
 catch (  NoSuchElementException ex) {
    ;
  }
catch (  Exception ex) {
    LOG.warn("failed to find loadbalancer for servo instance: " + instanceId,ex);
  }
  final Function<LoadBalancerZone,Set<LoadBalancerDescription>> lookupLBDescriptions=new Function<LoadBalancerZone,Set<LoadBalancerDescription>>(){
    @Override public Set<LoadBalancerDescription> apply(    LoadBalancerZone zone){
      final Set<LoadBalancerDescription> descs=Sets.newHashSet();
      final LoadBalancerCoreView lbView=zone.getLoadbalancer();
      final String lbName=lbView.getDisplayName();
      LoadBalancerDescription desc=new LoadBalancerDescription();
      desc.setLoadBalancerName(lbName);
      desc.setCreatedTime(lbView.getCreationTimestamp());
      LoadBalancer lb=null;
      try {
        lb=LoadBalancerEntityTransform.INSTANCE.apply(lbView);
      }
 catch (      final Exception ex) {
        Sets.<LoadBalancerDescription>newHashSet();
      }
      final LoadBalancerDnsRecordCoreView dnsView=lb.getDns();
      desc.setDnsName(dnsView.getDnsName());
      Collection<LoadBalancerBackendInstanceCoreView> notInError=Collections2.filter(zone.getBackendInstances(),new Predicate<LoadBalancerBackendInstanceCoreView>(){
        @Override public boolean apply(        @Nullable LoadBalancerBackendInstanceCoreView arg0){
          return !LoadBalancerBackendInstance.STATE.Error.equals(arg0.getBackendState());
        }
      }
);
      if (notInError.size() > 0) {
        desc.setInstances(new Instances());
        desc.getInstances().setMember(new ArrayList<Instance>(Collections2.transform(notInError,new Function<LoadBalancerBackendInstanceCoreView,Instance>(){
          @Override public Instance apply(          final LoadBalancerBackendInstanceCoreView be){
            Instance instance=new Instance();
            instance.setInstanceId(be.getInstanceId() + ":" + be.getIpAddress());
            return instance;
          }
        }
)));
      }
      desc.setAvailabilityZones(new AvailabilityZones());
      desc.getAvailabilityZones().setMember(Lists.newArrayList(zone.getName()));
      if (lb.getListeners().size() > 0) {
        desc.setListenerDescriptions(new ListenerDescriptions());
        desc.getListenerDescriptions().setMember(new ArrayList<ListenerDescription>(Collections2.transform(lb.getListeners(),new Function<LoadBalancerListenerCoreView,ListenerDescription>(){
          @Override public ListenerDescription apply(          final LoadBalancerListenerCoreView input){
            ListenerDescription desc=new ListenerDescription();
            Listener listener=new Listener();
            listener.setLoadBalancerPort(input.getLoadbalancerPort());
            listener.setInstancePort(input.getInstancePort());
            if (input.getInstanceProtocol() != PROTOCOL.NONE)             listener.setInstanceProtocol(input.getInstanceProtocol().name());
            listener.setProtocol(input.getProtocol().name());
            if (input.getCertificateId() != null)             listener.setSslCertificateId(input.getCertificateId());
            desc.setListener(listener);
            return desc;
          }
        }
)));
      }
      try {
        int interval=lb.getHealthCheckInterval();
        String target=lb.getHealthCheckTarget();
        int timeout=lb.getHealthCheckTimeout();
        int healthyThresholds=lb.getHealthyThreshold();
        int unhealthyThresholds=lb.getHealthCheckUnhealthyThreshold();
        final HealthCheck hc=new HealthCheck();
        hc.setInterval(interval);
        hc.setHealthyThreshold(healthyThresholds);
        hc.setTarget(target);
        hc.setTimeout(timeout);
        hc.setUnhealthyThreshold(unhealthyThresholds);
        desc.setHealthCheck(hc);
      }
 catch (      IllegalStateException ex) {
        ;
      }
catch (      Exception ex) {
        ;
      }
      try {
        final List<LoadBalancerPolicyDescription> lbPolicies=LoadBalancerPolicies.getLoadBalancerPolicyDescription(lb);
        final ArrayList<AppCookieStickinessPolicy> appCookiePolicies=Lists.newArrayList();
        final ArrayList<LBCookieStickinessPolicy> lbCookiePolicies=Lists.newArrayList();
        final ArrayList<String> otherPolicies=Lists.newArrayList();
        for (        final LoadBalancerPolicyDescription policy : lbPolicies) {
          if ("LBCookieStickinessPolicyType".equals(policy.getPolicyTypeName())) {
            final LBCookieStickinessPolicy lbp=new LBCookieStickinessPolicy();
            lbp.setPolicyName(policy.getPolicyName());
            lbp.setCookieExpirationPeriod(Long.parseLong(policy.findAttributeDescription("CookieExpirationPeriod").getAttributeValue()));
            lbCookiePolicies.add(lbp);
          }
 else           if ("AppCookieStickinessPolicyType".equals(policy.getPolicyTypeName())) {
            final AppCookieStickinessPolicy app=new AppCookieStickinessPolicy();
            app.setPolicyName(policy.getPolicyName());
            app.setCookieName(policy.findAttributeDescription("CookieName").getAttributeValue());
            appCookiePolicies.add(app);
          }
 else           otherPolicies.add(policy.getPolicyName());
        }
        final Policies p=new Policies();
        final LBCookieStickinessPolicies lbp=new LBCookieStickinessPolicies();
        lbp.setMember(lbCookiePolicies);
        final AppCookieStickinessPolicies app=new AppCookieStickinessPolicies();
        app.setMember(appCookiePolicies);
        final PolicyNames other=new PolicyNames();
        other.setMember(otherPolicies);
        p.setAppCookieStickinessPolicies(app);
        p.setLbCookieStickinessPolicies(lbp);
        p.setOtherPolicies(other);
        desc.setPolicies(p);
      }
 catch (      final Exception ex) {
        LOG.error("Failed to retrieve policies",ex);
      }
      descs.add(desc);
      return descs;
    }
  }
;
  Set<LoadBalancerDescription> descs=null;
  LoadBalancer lb=null;
  try {
    lb=LoadBalancerEntityTransform.INSTANCE.apply(zone.getLoadbalancer());
    if (zone != null && LoadBalancingMetadatas.filterPrivilegedWithoutOwner().apply(lb) && zone.getState().equals(LoadBalancerZone.STATE.InService)) {
      descs=lookupLBDescriptions.apply(zone);
    }
 else     descs=Sets.<LoadBalancerDescription>newHashSet();
  }
 catch (  final Exception ex) {
    descs=Sets.<LoadBalancerDescription>newHashSet();
  }
  DescribeLoadBalancersResult descResult=new DescribeLoadBalancersResult();
  LoadBalancerDescriptions lbDescs=new LoadBalancerDescriptions();
  lbDescs.setMember(new ArrayList<LoadBalancerDescription>(descs));
  descResult.setLoadBalancerDescriptions(lbDescs);
  reply.setDescribeLoadBalancersResult(descResult);
  reply.set_return(true);
  return reply;
}
