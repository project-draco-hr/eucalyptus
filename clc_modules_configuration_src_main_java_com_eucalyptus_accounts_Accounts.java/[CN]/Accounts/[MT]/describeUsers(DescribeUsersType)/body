{
  DescribeUsersResponseType reply=request.getReply();
  EntityWrapper<UserInfo> db=new EntityWrapper<UserInfo>();
  try {
    List<UserGroupEntity> groupList=db.recast(UserGroupEntity.class).query(new UserGroupEntity());
    for (    User u : Users.listAllUsers()) {
      try {
        UserInfo otherInfo=db.getUnique(UserInfo.named(u.getName()));
        String accessKey=u.getQueryId();
        String secretKey=u.getSecretKey();
        X509Certificate cert=u.getX509Certificate();
        String dn=cert.getSubjectX500Principal().toString();
        String certSerial=cert.getSerialNumber().toString();
        ArrayList<String> groups=Lists.newArrayList();
        db.recast(UserGroupEntity.class).query(new UserGroupEntity());
        for (        UserGroupEntity g : groupList) {
          if (g.getUsers().contains(otherInfo)) {
            groups.add(g.getName());
          }
        }
        UserInfoType userInfo=new UserInfoType(u.getName(),otherInfo.getEmail(),otherInfo.getCertificateCode(),otherInfo.getConfirmationCode(),accessKey,secretKey,dn,certSerial,groups,u.getIsAdministrator(),u.getIsEnabled(),otherInfo.isConfirmed());
        reply.getUsers().add(userInfo);
      }
 catch (      EucalyptusCloudException e) {
      }
    }
    db.commit();
  }
 catch (  Exception e) {
    db.rollback();
  }
  return reply;
}
