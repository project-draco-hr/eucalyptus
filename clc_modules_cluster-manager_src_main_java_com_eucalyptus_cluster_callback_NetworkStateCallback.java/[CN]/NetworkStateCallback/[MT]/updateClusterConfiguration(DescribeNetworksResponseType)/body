{
  EntityTransaction db=Entities.get(NetworkStateCallback.class);
  try {
    ClusterConfiguration config=Entities.uniqueResult(this.getSubject().getConfiguration());
    config.setNetworkMode(reply.getMode());
    config.setUseNetworkTags(reply.getUseVlans() == 1);
    config.setMinNetworkTag(reply.getVlanMin());
    config.setMaxNetworkTag(reply.getVlanMax());
    config.setAddressesPerNetwork(reply.getAddrsPerNet());
    config.setVnetNetmask(reply.getVnetNetmask());
    config.setVnetSubnet(reply.getVnetSubnet());
    db.commit();
  }
 catch (  Exception ex) {
    Logs.exhaust().error(ex,ex);
    db.rollback();
    throw ex;
  }
}
