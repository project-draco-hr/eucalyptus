{
  if (Strings.isNullOrEmpty(newPass)) {
    throw new AuthException(AuthException.INVALID_PASSWORD);
  }
  String newEncrypted=Crypto.generateHashedPassword(newPass);
  if (newEncrypted.equals(Crypto.generateHashedPassword(user.getName()))) {
    throw new AuthException(AuthException.INVALID_PASSWORD);
  }
  user.setPassword(newEncrypted);
  user.setPasswordExpires(System.currentTimeMillis() + User.PASSWORD_LIFETIME);
}
