{
  try (TransactionResource tran=Entities.transactionFor(SANVolumeInfo.class)){
    Entities.uniqueResult(new SANVolumeInfo(snapshotId));
    throw new EucalyptusCloudException("Snapshot " + snapshotId + " already exists. Import failed.");
  }
 catch (  NoSuchElementException ex) {
  }
catch (  TransactionException ex) {
    throw new EucalyptusCloudException(ex);
  }
  String sanSnapshotId=resourceIdOnSan(snapshotId);
  String iqn=connectionManager.createVolume(sanSnapshotId,size);
  if (iqn != null) {
    String deviceName=connectionManager.connectTarget(iqn).getPath();
    try {
      SystemUtil.run(new String[]{StorageProperties.EUCA_ROOT_WRAPPER,"dd","if=" + snapPath,"of=" + deviceName,"bs=" + StorageProperties.blockSize});
    }
  finally {
      connectionManager.disconnectTarget(sanSnapshotId,iqn);
    }
    SANVolumeInfo volumeInfo=new SANVolumeInfo(snapshotId,iqn,size).withSanVolumeId(sanSnapshotId).withSnapshotOf(volumeId);
    try (TransactionResource tran=Entities.transactionFor(SANVolumeInfo.class)){
      Entities.persist(volumeInfo);
      tran.commit();
    }
   }
}
