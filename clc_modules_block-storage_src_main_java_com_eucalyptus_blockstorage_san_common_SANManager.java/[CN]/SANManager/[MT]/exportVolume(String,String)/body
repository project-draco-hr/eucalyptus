{
  String sanVolumeId=null;
  EntityWrapper<SANVolumeInfo> db=StorageProperties.getEntityWrapper();
  try {
    SANVolumeInfo volumeInfo=db.getUnique(new SANVolumeInfo(volumeId));
    if (volumeInfo == null || StringUtils.isBlank(volumeInfo.getSanVolumeId())) {
      throw new EucalyptusCloudException("Backend ID not found for " + volumeId);
    }
    sanVolumeId=volumeInfo.getSanVolumeId();
  }
 catch (  EucalyptusCloudException ex) {
    throw ex;
  }
 finally {
    db.commit();
  }
  LOG.info("Exporting backend volume " + sanVolumeId + " mapping to "+ volumeId+ " to NC host IQN "+ nodeIqn);
  Integer lun=connectionManager.addInitiatorRule(sanVolumeId,nodeIqn);
  if (lun == null) {
    throw new EucalyptusCloudException("No LUN found from connection manager");
  }
  String volumeConnectionString=connectionManager.getVolumeConnectionString(volumeId);
  if (Strings.isNullOrEmpty(volumeConnectionString)) {
    throw new EucalyptusCloudException("Could not get valid volume property");
  }
  String auth=connectionManager.getAuthType();
  String optionalUser=connectionManager.getOptionalChapUser();
  StringBuilder sb=new StringBuilder();
  sb.append(optionalUser == null ? "" : optionalUser).append(',');
  sb.append(auth == null ? "" : auth).append(',');
  sb.append(lun.toString()).append(',');
  sb.append(volumeConnectionString);
  return sb.toString();
}
