{
  String sanSnapshotId=null;
  EntityWrapper<SANVolumeInfo> db=StorageProperties.getEntityWrapper();
  try {
    SANVolumeInfo volumeInfo=db.getUnique(new SANVolumeInfo(snapshotId));
    if (volumeInfo == null || StringUtils.isBlank(volumeInfo.getSanVolumeId())) {
      throw new EucalyptusCloudException(snapshotId + ": Backend ID not found");
    }
    sanSnapshotId=volumeInfo.getSanVolumeId();
  }
  finally {
    db.commit();
  }
  LOG.info("Deleting backend snapshot " + sanSnapshotId + " mapping to "+ snapshotId);
  if (connectionManager.deleteVolume(sanSnapshotId)) {
    db=StorageProperties.getEntityWrapper();
    try {
      SANVolumeInfo snapInfo=db.getUnique(new SANVolumeInfo(snapshotId).withSanVolumeId(sanSnapshotId));
      db.delete(snapInfo);
    }
 catch (    EucalyptusCloudException ex) {
      LOG.error(snapshotId + ": Failed to delete database entity post snapshot deletion",ex);
    }
 finally {
      db.commit();
    }
  }
}
