{
  String sanSnapshotId=null;
  try (TransactionResource tran=Entities.transactionFor(SANVolumeInfo.class)){
    SANVolumeInfo volumeInfo=Entities.uniqueResult(new SANVolumeInfo(snapshotId));
    if (volumeInfo == null || StringUtils.isBlank(volumeInfo.getSanVolumeId())) {
      throw new EucalyptusCloudException(snapshotId + ": Backend ID not found");
    }
    sanSnapshotId=volumeInfo.getSanVolumeId();
    tran.commit();
  }
 catch (  TransactionException|NoSuchElementException|EucalyptusCloudException ex) {
    LOG.debug("Blockstorage backend record for " + snapshotId + " not found, skipping clean up");
    return;
  }
  LOG.info("Deleting backend snapshot " + sanSnapshotId + " mapping to "+ snapshotId);
  if (connectionManager.deleteVolume(sanSnapshotId)) {
    try (TransactionResource tran=Entities.transactionFor(SANVolumeInfo.class)){
      SANVolumeInfo snapInfo=Entities.uniqueResult(new SANVolumeInfo(snapshotId).withSanVolumeId(sanSnapshotId));
      Entities.delete(snapInfo);
      tran.commit();
    }
 catch (    TransactionException|NoSuchElementException ex) {
      LOG.error(snapshotId + ": Unable to clean failed snapshot",ex);
      return;
    }
  }
}
