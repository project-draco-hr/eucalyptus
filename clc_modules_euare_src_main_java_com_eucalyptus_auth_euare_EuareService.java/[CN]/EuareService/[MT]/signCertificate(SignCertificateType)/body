{
  SignCertificateResponseType reply=request.getReply();
  final Context ctx=Contexts.lookup();
  final User requestUser=ctx.getUser();
  final String certPem=request.getCertificate();
  if (certPem == null || certPem.length() <= 0)   throw new EuareException(HttpResponseStatus.BAD_REQUEST,EuareException.INVALID_VALUE,"No certificate to sign is provided");
  if (!requestUser.isSystemAdmin()) {
    throw new EuareException(HttpResponseStatus.FORBIDDEN,EuareException.NOT_AUTHORIZED,"SignCertificate can be called by only system admin");
  }
  try {
    final String cert=B64.standard.decString(certPem);
    final String signature=EuareServerCertificateUtil.generateSignatureWithEuare(cert);
    final SignCertificateResultType result=new SignCertificateResultType();
    result.setCertificate(certPem);
    result.setSignature(signature);
    reply.setSignCertificateResult(result);
  }
 catch (  final Exception ex) {
    LOG.error("failed to sign certificate",ex);
    throw new EuareException(HttpResponseStatus.INTERNAL_SERVER_ERROR,EuareException.INTERNAL_FAILURE);
  }
  reply.set_return(true);
  return reply;
}
