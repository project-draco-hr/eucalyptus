{
  super();
  this.context=Contexts.lookup();
  this.request=request;
  this.minCount=request.getMinCount();
  this.maxCount=request.getMaxCount();
  this.ownerFullName=this.context.getUserFullName();
  if (this.request.getInstanceType() == null || "".equals(this.request.getInstanceType())) {
    this.request.setInstanceType(VmTypes.defaultTypeName());
  }
  this.reservationIndex=Counters.getIdBlock(request.getMaxCount());
  this.reservationId=VmInstances.getId(this.reservationIndex,0).replaceAll("i-","r-");
  byte[] tmpData=new byte[0];
  if (this.request.getUserData() != null) {
    try {
      this.userData=Base64.decode(this.request.getUserData());
      this.request.setUserData(new String(Base64.encode(tmpData)));
    }
 catch (    Exception e) {
    }
  }
 else {
    try {
      this.request.setUserData(new String(Base64.encode(tmpData)));
    }
 catch (    Exception ex) {
      LOG.error(ex,ex);
    }
  }
}
