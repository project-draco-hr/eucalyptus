{
  NetworkGroup net=this.getPrimaryNetwork();
  ExtantNetwork extantNetwork=net.extantNetwork();
  for (  ResourceToken rscToken : this.allocationTokens) {
    for (int i=0; i < rscToken.getAmount(); i++) {
      PrivateNetworkIndex addrIndex;
      try {
        addrIndex=extantNetwork.allocateNetworkIndex();
      }
 catch (      Exception ex) {
        throw new NotEnoughResourcesAvailable("Not enough addresses left in the network subnet assigned to requested group: " + net,ex);
      }
      rscToken.getPrimaryNetwork().getIndexes().add(addrIndex);
    }
    ClusterState clusterState=Clusters.getInstance().lookup(rscToken.getCluster()).getState();
    NetworkToken networkToken=clusterState.getNetworkAllocation(this.ownerFullName,rscToken,net.getName());
    rscToken.getNetworkTokens().add(networkToken);
  }
}
