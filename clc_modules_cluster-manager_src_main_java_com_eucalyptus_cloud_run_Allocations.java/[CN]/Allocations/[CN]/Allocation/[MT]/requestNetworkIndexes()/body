{
  Network net=this.getPrimaryNetwork();
  for (  ResourceToken rscToken : this.allocationTokens) {
    for (int i=0; i < rscToken.getAmount(); i++) {
      Integer addrIndex=net.allocateNetworkIndex(rscToken.getCluster());
      if (addrIndex == null) {
        throw new NotEnoughResourcesAvailable("Not enough addresses left in the network subnet assigned to requested group: " + net.getNetworkName());
      }
      rscToken.getPrimaryNetwork().getIndexes().add(addrIndex);
    }
    ClusterState clusterState=Clusters.getInstance().lookup(rscToken.getCluster()).getState();
    NetworkToken networkToken=clusterState.getNetworkAllocation(this.ownerFullName,rscToken,net.getName());
    rscToken.getNetworkTokens().add(networkToken);
  }
}
