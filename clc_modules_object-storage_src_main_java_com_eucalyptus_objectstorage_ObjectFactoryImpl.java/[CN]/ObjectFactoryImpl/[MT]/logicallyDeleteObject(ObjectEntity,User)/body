{
  if (entity.getBucket() == null) {
    throw new InternalErrorException();
  }
switch (entity.getBucket().getVersioning()) {
case Suspended:
case Enabled:
    if (!entity.getIsDeleteMarker()) {
      try {
        AccessControlPolicy acp=AclUtils.processNewResourcePolicy(requestUser,null,entity.getBucket().getOwnerCanonicalId());
        ObjectMetadataManagers.getInstance().generateAndPersistDeleteMarker(entity,acp,requestUser);
      }
 catch (      Exception e) {
        LOG.warn("Failure configuring and persisting the delete marker for object " + entity.getResourceFullName());
        throw new InternalErrorException(e);
      }
    }
 else {
    }
  break;
case Disabled:
ObjectMetadataManagers.getInstance().transitionObjectToState(entity,ObjectState.deleting);
break;
}
}
