from eucadmin.command import Command
import re
Commands = {'openssl': {'get_version_fn': get_openssl_version, 'commands': [(re.compile('OpenSSL 1\\.0\\..*'), 'openssl pkcs12 -in %s -name eucalyptus -name "eucalyptus" -password pass:eucalyptus  -passin pass:eucalyptus -passout pass:eucalyptus -nodes | grep -A30 "friendlyName: eucalyptus" | grep -A27 "BEGIN PRIVATE" >  %s '), (re.compile('.*'), 'openssl pkcs12 -in %s -name eucalyptus -name "eucalyptus" -password pass:eucalyptus  -passin pass:eucalyptus -passout pass:eucalyptus -nodes | grep -A30 "friendlyName: eucalyptus" | grep -A26 "BEGIN RSA" >  %s ')], }, 'dbpass': {'get_version_fn': get_openssl_version, 'commands': [(re.compile('OpenSSL 1\\.0\\..*'), 'echo -n eucalyptus | openssl dgst -sha256 -sign %s/var/lib/eucalyptus/keys/cloud-pk.pem -hex'), (re.compile('.*'), "echo -n eucalyptus | openssl dgst -sha256 -sign %s/var/lib/eucalyptus/keys/cloud-pk.pem -hex | cut -d' ' -f2")], }, 'mysql': {'get_version_fn': get_mysql_version, 'commands': [(re.compile('.*'), 'echo "select u.auth_user_token from auth_user u inner join auth_group_has_users gu on u.id=gu.auth_user_id join auth_group g on gu.auth_group_id=g.id join auth_account a on g.auth_group_owning_account=a.id where a.auth_account_name=\'%s\' and g.auth_group_name=\'_%s\';" | mysql -u eucalyptus -P 8777 --protocol=TCP --password=%s eucalyptus_auth | tail -n1 ')], }, }
