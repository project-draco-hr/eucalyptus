{
  DeleteSnapshotResponseType reply=(DeleteSnapshotResponseType)request.getReply();
  reply.set_return(false);
  EntityWrapper<Snapshot> db=SnapshotManager.getEntityWrapper();
  String userName=request.isAdministrator() ? null : request.getUserId();
  try {
    Snapshot snap=db.getUnique(Snapshot.named(userName,request.getSnapshotId()));
    DeleteStorageSnapshotResponseType scReply=(DeleteStorageSnapshotResponseType)Messaging.send(StorageProperties.STORAGE_REF,new DeleteStorageSnapshotType(snap.getDisplayName()));
    LOG.debug(scReply);
    db.delete(snap);
    db.commit();
  }
 catch (  EucalyptusCloudException e) {
    LOG.debug(e,e);
    db.rollback();
    throw new EucalyptusCloudException("Error deleting storage volume:" + e.getMessage());
  }
  reply.set_return(true);
  return reply;
}
