{
  EntityWrapper<SystemConfiguration> db=new EntityWrapper<SystemConfiguration>();
  try {
    SystemConfiguration sysConf=db.getUnique(new SystemConfiguration());
    return new SystemConfigWeb(sysConf.getStorageUrl(),sysConf.getStorageDir(),sysConf.getStorageMaxBucketsPerUser(),sysConf.getStorageMaxBucketSizeInMB(),sysConf.getStorageMaxCacheSizeInMB(),sysConf.getStorageMaxTotalSnapshotSizeInGb(),sysConf.getStorageMaxTotalVolumeSizeInGb(),sysConf.getStorageMaxVolumeSizeInGB(),sysConf.getStorageVolumesDir(),sysConf.getDefaultKernel(),sysConf.getDefaultRamdisk());
  }
 catch (  EucalyptusCloudException e) {
    String ipAddr=getInternalIpAddress();
    String wUrl=String.format("http://%s:8773/services/" + WalrusProperties.SERVICE_NAME,ipAddr);
    String defKernel="", defRamdisk="";
    ImageInfo q=new ImageInfo();
    EntityWrapper<ImageInfo> db2=new EntityWrapper<ImageInfo>();
    q.setImageType(EucalyptusProperties.IMAGE_KERNEL);
    List<ImageInfo> res=db2.query(q);
    if (res.size() > 0)     defKernel=res.get(0).getImageId();
    q.setImageType(EucalyptusProperties.IMAGE_RAMDISK);
    res=db2.query(q);
    if (res.size() > 0)     defRamdisk=res.get(0).getImageId();
    return new SystemConfigWeb(wUrl,WalrusProperties.bucketRootDirectory.replaceAll("//","/"),WalrusProperties.MAX_BUCKETS_PER_USER,(int)(WalrusProperties.MAX_BUCKET_SIZE / WalrusProperties.M),(int)(WalrusProperties.IMAGE_CACHE_SIZE / WalrusProperties.M),StorageProperties.MAX_TOTAL_SNAPSHOT_SIZE,StorageProperties.MAX_TOTAL_VOLUME_SIZE,StorageProperties.MAX_VOLUME_SIZE,StorageProperties.storageRootDirectory,defKernel,defRamdisk);
  }
 finally {
    db.commit();
  }
}
