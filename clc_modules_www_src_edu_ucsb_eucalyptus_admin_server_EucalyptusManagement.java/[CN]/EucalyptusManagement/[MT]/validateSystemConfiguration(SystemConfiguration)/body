{
  if (sysConf == null) {
    sysConf=new SystemConfiguration();
  }
  if (sysConf.getStorageUrl() == null) {
    String ipAddr=getInternalIpAddress();
    String wUrl=String.format("http://%s:8773/services/" + WalrusProperties.SERVICE_NAME,ipAddr);
    sysConf.setStorageUrl(wUrl);
  }
  if (sysConf.getStorageDir() == null) {
    sysConf.setStorageDir(WalrusProperties.bucketRootDirectory.replaceAll("//","/"));
  }
  if (sysConf.getStorageMaxBucketsPerUser() == null) {
    sysConf.setStorageMaxBucketsPerUser(WalrusProperties.MAX_BUCKETS_PER_USER);
  }
  if (sysConf.getStorageMaxBucketSizeInMB() == null) {
    sysConf.setStorageMaxBucketSizeInMB((int)(WalrusProperties.MAX_BUCKET_SIZE / WalrusProperties.M));
  }
  if (sysConf.getStorageMaxCacheSizeInMB() == null) {
    sysConf.setStorageMaxCacheSizeInMB((int)(WalrusProperties.IMAGE_CACHE_SIZE / WalrusProperties.M));
  }
  if (sysConf.getStorageMaxTotalSnapshotSizeInGb() == null) {
    sysConf.setStorageMaxTotalSnapshotSizeInGb(StorageProperties.MAX_TOTAL_SNAPSHOT_SIZE);
  }
  if (sysConf.getStorageMaxTotalVolumeSizeInGb() == null) {
    sysConf.setStorageMaxTotalVolumeSizeInGb(StorageProperties.MAX_TOTAL_VOLUME_SIZE);
  }
  if (sysConf.getStorageMaxVolumeSizeInGB() == null) {
    sysConf.setStorageMaxVolumeSizeInGB(StorageProperties.MAX_VOLUME_SIZE);
  }
  if (sysConf.getStorageVolumesDir() == null) {
    sysConf.setStorageVolumesDir(StorageProperties.storageRootDirectory);
  }
  if (sysConf.getDefaultKernel() == null) {
    ImageInfo q=new ImageInfo();
    EntityWrapper<ImageInfo> db2=new EntityWrapper<ImageInfo>();
    q.setImageType(EucalyptusProperties.IMAGE_KERNEL);
    List<ImageInfo> res=db2.query(q);
    if (res.size() > 0)     sysConf.setDefaultKernel(res.get(0).getImageId());
  }
  if (sysConf.getDefaultRamdisk() == null) {
    ImageInfo q=new ImageInfo();
    EntityWrapper<ImageInfo> db2=new EntityWrapper<ImageInfo>();
    q.setImageType(EucalyptusProperties.IMAGE_RAMDISK);
    List<ImageInfo> res=db2.query(q);
    if (res.size() > 0)     sysConf.setDefaultRamdisk(res.get(0).getImageId());
  }
  if (sysConf.getDnsDomain() == null) {
    sysConf.setDnsDomain(DNSProperties.DOMAIN);
  }
  if (sysConf.getNameserver() == null) {
    sysConf.setNameserver(DNSProperties.NS_HOST);
  }
  if (sysConf.getNameserverAddress() == null) {
    sysConf.setNameserverAddress(DNSProperties.NS_IP);
  }
  if (sysConf.getMaxUserPublicAddresses() == null) {
    sysConf.setMaxUserPublicAddresses(5);
  }
  if (sysConf.isDoDynamicPublicAddresses() == null) {
    sysConf.setDoDynamicPublicAddresses(true);
  }
  if (sysConf.getSystemReservedPublicAddresses() == null) {
    sysConf.setSystemReservedPublicAddresses(10);
  }
  return sysConf;
}
