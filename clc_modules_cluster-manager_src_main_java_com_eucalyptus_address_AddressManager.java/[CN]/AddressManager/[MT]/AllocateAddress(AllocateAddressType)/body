{
  AllocateAddressResponseType reply=(AllocateAddressResponseType)request.getReply();
  String userId=request.getUserId();
  Address address;
  try {
    address=Addresses.allocate(userId,request.isAdministrator());
    EventRecord.here(AddressManager.class,EventClass.ADDRESS,EventType.ADDRESS_ALLOCATE,request.getUserId(),address.getName()).info();
  }
 catch (  NotEnoughResourcesAvailable e) {
    LOG.debug(e,e);
    throw new EucalyptusCloudException(e);
  }
  reply.setPublicIp(address.getName());
  return reply;
}
