{
  InetAddress result=hostAddress;
  try {
    final NetworkInterface networkInterface=NetworkInterface.getByInetAddress(listenerAddress);
    short prefix=networkInterface.getInterfaceAddresses().get(0).getNetworkPrefixLength();
    for (    final InterfaceAddress ifaddr : networkInterface.getInterfaceAddresses()) {
      if (listenerAddress.equals(ifaddr.getAddress())) {
        prefix=ifaddr.getNetworkPrefixLength();
        break;
      }
    }
    final Cidr listenerCidr=Cidr.fromAddress(listenerAddress,prefix);
    final Host host=Hosts.lookup(hostAddress);
    if (host.isLocalHost()) {
      result=listenerAddress;
    }
 else     if (host != null) {
      result=Iterables.tryFind(host.getHostAddresses(),listenerCidr).or(result);
    }
  }
 catch (  final Exception ex) {
    LOG.error("failed to map the host address: " + ex.getMessage());
  }
  return result;
}
