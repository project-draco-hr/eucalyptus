{
  if ((this.uploadSize=new File(snapshotFileName).length()) <= 0) {
    try {
      CommandOutput result=SystemUtil.runWithRawOutput(new String[]{StorageProperties.EUCA_ROOT_WRAPPER,"blockdev","--getsize64",snapshotFileName});
      this.uploadSize=Long.parseLong(StringUtils.trimToEmpty(result.output));
    }
 catch (    Exception ex) {
      throw new UnknownFileSizeException(snapshotFileName,ex);
    }
  }
  this.snapshotId=snapshotId;
  this.bytesTransferred=0L;
  this.scConfig=Components.lookup(Storage.class).getLocalServiceConfiguration();
  this.lastProgress=1;
  Threads.enqueue(scConfig,SnapshotProgressCallback.class,1,new ProgressSetter(this.snapshotId,this.lastProgress));
}
