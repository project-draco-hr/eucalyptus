{
  final Partition partition=((maybePartition != null) && (maybePartition.length > 0) ? (ComponentIds.lookup(compClass).isPartitioned() ? maybePartition[0] : null) : null);
  ServiceConfiguration res=Topology.getInstance().getServices().get(ServiceKey.create(ComponentIds.lookup(compClass),partition));
  String err="Failed to lookup ENABLED service of type " + compClass.getSimpleName() + (partition != null ? " in partition " + partition : ".");
  if (res == null) {
    throw new NoSuchElementException(err);
  }
 else   if (!Component.State.ENABLED.apply(res)) {
    throw new NoSuchElementException(err + "  Service is currently ENABLING.");
  }
 else {
    return res;
  }
}
