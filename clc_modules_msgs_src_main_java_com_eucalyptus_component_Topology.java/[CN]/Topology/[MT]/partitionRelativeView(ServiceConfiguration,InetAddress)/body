{
  Partition partition;
  try {
    partition=Partitions.lookup(config);
  }
 catch (  ServiceRegistrationException ex) {
    LOG.error(ex,ex);
    partition=Partitions.lookupInternal(config);
  }
  final String localhostAddr=localAddr.getHostAddress();
  Function<ServiceConfiguration,ServiceId> toServiceId=new Function<ServiceConfiguration,ServiceId>(){
    @Override public ServiceId apply(    final ServiceConfiguration input){
      return new ServiceId(){
{
          setPartition(input.getPartition());
          setName(input.getName());
          setType(input.getComponentId().name());
          if (input.isVmLocal()) {
            getUris().add(input.getComponentId().makeExternalRemoteUri(localhostAddr,input.getComponentId().getPort(),StackConfiguration.EXTERNAL_URI_SCHEME).toASCIIString());
          }
 else {
            getUris().add(input.getUri().toASCIIString());
          }
        }
      }
;
    }
  }
;
  return Lists.transform(Topology.getInstance().lookupPartitionView(partition),toServiceId);
}
