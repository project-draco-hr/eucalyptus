{
  return new TransitionGuard(){
    @Override public boolean nextEpoch(){
      Topology.this.currentEpoch++;
      return true;
    }
    @Override public boolean tryEnable(    final ServiceConfiguration config) throws ServiceRegistrationException {
      final ServiceKey serviceKey=ServiceKey.create(config);
      ServiceConfiguration curr=Topology.this.services.putIfAbsent(serviceKey,config);
      if (curr != null && !curr.equals(config)) {
        return false;
      }
 else       if (curr != null && curr.equals(config)) {
        return true;
      }
 else {
        Topology.this.currentEpoch++;
        return true;
      }
    }
    @Override public boolean tryDisable(    final ServiceConfiguration config) throws ServiceRegistrationException {
      final ServiceKey serviceKey=ServiceKey.create(config);
      return (Topology.this.services.remove(serviceKey,config) || !config.equals(Topology.this.services.get(serviceKey))) && this.nextEpoch();
    }
  }
;
}
