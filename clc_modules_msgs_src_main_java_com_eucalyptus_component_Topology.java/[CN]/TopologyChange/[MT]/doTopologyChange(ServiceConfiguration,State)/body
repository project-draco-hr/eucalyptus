{
  final State initialState=input.lookupState();
  ServiceConfiguration endResult=input;
  try {
    endResult=ServiceTransitions.pathTo(input,nextState).get();
    Logs.extreme().debug(this.toString(endResult,initialState,nextState));
    return endResult;
  }
 catch (  final Exception ex) {
    Exceptions.maybeInterrupted(ex);
    LOG.error(this.toString(input,initialState,nextState,ex));
    Logs.extreme().error(ex,Throwables.getRootCause(ex));
    Logs.extreme().error(ex,ex);
    throw Exceptions.toUndeclared(ex);
  }
 finally {
    boolean enabledEndState=Component.State.ENABLED.equals(endResult.lookupState());
    if (Bootstrap.isFinished() && !enabledEndState && Topology.getInstance().services.containsValue(input)) {
      Topology.guard().tryDisable(endResult);
    }
  }
}
