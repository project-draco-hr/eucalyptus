{
  final List<String> instances=servoInstances.get();
  final List<Promise<String>> activities=Lists.newArrayList();
  for (  final String instanceId : instances) {
    final ActivitySchedulingOptions scheduler=new ActivitySchedulingOptions();
    scheduler.setTaskList(instanceId);
    scheduler.setScheduleToCloseTimeoutSeconds(10L);
    activities.add(vmClient.getInstanceStatus(scheduler));
  }
  final WorkflowClock clock=contextProvider.getDecisionContext().getWorkflowClock();
  final Promise<Void> timer=clock.createTimer(POLLING_PERIOD_SEC);
  final Promise<List<String>> allActivities=Promises.listOfPromisesToPromise(activities);
  final Promise<Void> merge=client.updateInstanceStatus(Promise.asPromise(accountId),Promise.asPromise(loadbalancer),allActivities);
  pollInstanceStatusPeriodic(count + 1,new AndPromise(merge,timer));
}
