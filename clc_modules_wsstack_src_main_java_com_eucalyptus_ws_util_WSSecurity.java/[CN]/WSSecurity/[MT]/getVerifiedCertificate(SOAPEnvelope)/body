{
  final StAXOMBuilder doomBuilder=new StAXOMBuilder(DOOMAbstractFactory.getOMFactory(),envelope.getXMLStreamReader());
  final OMElement elem=doomBuilder.getDocumentElement();
  elem.build();
  final Element env=((Element)elem);
  final Element securityNode=getSecurityElement(env);
  final Element signatureNode=getSignatureElement(securityNode);
  final XMLSignature sig=getXmlSignature(signatureNode);
  if (sig.getKeyInfo() == null)   throw new WSSecurityException(WSSecurityException.SECURITY_TOKEN_UNAVAILABLE);
  X509Certificate cert=verifySignature(securityNode,sig);
  return cert;
}
