{
  Long ret=nextIndex();
  Entities.asTransaction(new Function<PersistedCounter,Long>(){
    @Override public Long apply(    PersistedCounter input){
      final PersistedCounter entity=Entities.merge(input);
      return entity.nextBlock(extent);
    }
  }
).apply(this);
  return ret;
}
