{
  EntityWrapper<CHAPUserInfo> db=StorageProperties.getEntityWrapper();
  try {
    CHAPUserInfo userInfo=db.getUnique(new CHAPUserInfo(userName));
    db.commit();
    enabled=true;
  }
 catch (  EucalyptusCloudException ex) {
    db.rollback();
    try {
      String returnValue=execCommand("stty hardwrap off\rchapuser create " + userName + "\r");
      String password=matchPattern(returnValue,USER_CREATE_PATTERN);
      if (password != null) {
        db=StorageProperties.getEntityWrapper();
        CHAPUserInfo userInfo=new CHAPUserInfo(userName,BlockStorageUtil.encryptSCTargetPassword(password));
        db.add(userInfo);
        db.commit();
        enabled=true;
      }
 else {
        returnValue=execCommand("stty hardwrap off\rchapuser show " + userName + "\r");
        password=matchPattern(returnValue,USER_SHOW_PATTERN).trim();
        if (password != null) {
          db=StorageProperties.getEntityWrapper();
          CHAPUserInfo userInfo=new CHAPUserInfo(userName,BlockStorageUtil.encryptSCTargetPassword(password));
          db.add(userInfo);
          db.commit();
          enabled=true;
        }
      }
      returnValue=execCommand("stty hardwrap off\rcli-settings confirmation off\r");
    }
 catch (    EucalyptusCloudException e) {
      LOG.error(e);
    }
  }
}
