{
  StackUpdateInfoEntity stackUpdateInfoEntity=StackUpdateInfoEntityManager.getStackUpdateInfoEntity(stackId,accountId);
  if (stackUpdateInfoEntity == null) {
    throw new ResourceFailureException("Unable to find update info record for stack " + stackId);
  }
  StackWorkflowTags stackWorkflowTags=new StackWorkflowTags(stackUpdateInfoEntity.getStackId(),stackUpdateInfoEntity.getStackName(),stackUpdateInfoEntity.getAccountId(),stackUpdateInfoEntity.getAccountAlias());
  WorkflowClientFactory updateRollbackStackWorkflowClientFactory=new WorkflowClientFactory(WorkflowClientManager.getSimpleWorkflowClient(),CloudFormationProperties.SWF_DOMAIN,CloudFormationProperties.SWF_TASKLIST);
  WorkflowDescriptionTemplate updateRollbackStackWorkflowDescriptionTemplate=new UpdateRollbackStackWorkflowDescriptionTemplate();
  InterfaceBasedWorkflowClient<UpdateRollbackStackWorkflow> updateRollbackStackWorkflowClient=updateRollbackStackWorkflowClientFactory.getNewWorkflowClient(UpdateRollbackStackWorkflow.class,updateRollbackStackWorkflowDescriptionTemplate,stackWorkflowTags);
  UpdateRollbackStackWorkflow updateRollbackStackWorkflow=new UpdateRollbackStackWorkflowClient(updateRollbackStackWorkflowClient);
  updateRollbackStackWorkflow.performUpdateRollbackStack(stackUpdateInfoEntity.getStackId(),stackUpdateInfoEntity.getAccountId(),outerStackArn,stackUpdateInfoEntity.getOldResourceDependencyManagerJson(),effectiveUserId,stackUpdateInfoEntity.getUpdatedStackVersion() + 1);
  StackWorkflowEntityManager.addOrUpdateStackWorkflowEntity(stackUpdateInfoEntity.getStackId(),StackWorkflowEntity.WorkflowType.UPDATE_ROLLBACK_STACK_WORKFLOW,CloudFormationProperties.SWF_DOMAIN,updateRollbackStackWorkflowClient.getWorkflowExecution().getWorkflowId(),updateRollbackStackWorkflowClient.getWorkflowExecution().getRunId());
}
