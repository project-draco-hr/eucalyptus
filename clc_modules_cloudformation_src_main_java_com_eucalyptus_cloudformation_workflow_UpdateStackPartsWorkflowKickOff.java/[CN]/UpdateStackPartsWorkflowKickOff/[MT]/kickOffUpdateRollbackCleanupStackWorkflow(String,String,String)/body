{
  StackUpdateInfoEntity stackUpdateInfoEntity=StackUpdateInfoEntityManager.getStackUpdateInfoEntity(stackId,accountId);
  if (stackUpdateInfoEntity == null) {
    throw new ResourceFailureException("Unable to find update info record for stack " + stackId);
  }
  StackWorkflowTags stackWorkflowTags=new StackWorkflowTags(stackUpdateInfoEntity.getStackId(),stackUpdateInfoEntity.getStackName(),stackUpdateInfoEntity.getAccountId(),stackUpdateInfoEntity.getAccountAlias());
  WorkflowClientFactory updateRollbackCleanupStackWorkflowClientFactory=new WorkflowClientFactory(WorkflowClientManager.getSimpleWorkflowClient(),CloudFormationProperties.SWF_DOMAIN,CloudFormationProperties.SWF_TASKLIST);
  WorkflowDescriptionTemplate updateRollbackCleanupStackWorkflowDescriptionTemplate=new UpdateRollbackCleanupStackWorkflowDescriptionTemplate();
  InterfaceBasedWorkflowClient<UpdateRollbackCleanupStackWorkflow> updateRollbackCleanupStackWorkflowClient=updateRollbackCleanupStackWorkflowClientFactory.getNewWorkflowClient(UpdateRollbackCleanupStackWorkflow.class,updateRollbackCleanupStackWorkflowDescriptionTemplate,stackWorkflowTags);
  UpdateRollbackCleanupStackWorkflow updateRollbackCleanupStackWorkflow=new UpdateRollbackCleanupStackWorkflowClient(updateRollbackCleanupStackWorkflowClient);
  updateRollbackCleanupStackWorkflow.performUpdateRollbackCleanupStack(stackUpdateInfoEntity.getStackId(),stackUpdateInfoEntity.getAccountId(),stackUpdateInfoEntity.getResourceDependencyManagerJson(),effectiveUserId,stackUpdateInfoEntity.getUpdatedStackVersion() + 1);
  StackWorkflowEntityManager.addOrUpdateStackWorkflowEntity(stackUpdateInfoEntity.getStackId(),StackWorkflowEntity.WorkflowType.UPDATE_ROLLBACK_CLEANUP_STACK_WORKFLOW,CloudFormationProperties.SWF_DOMAIN,updateRollbackCleanupStackWorkflowClient.getWorkflowExecution().getWorkflowId(),updateRollbackCleanupStackWorkflowClient.getWorkflowExecution().getRunId());
}
