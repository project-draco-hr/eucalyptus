{
  BundleState state=bundleTask.getState();
  if (BundleState.complete.equals(state) || BundleState.failed.equals(state) || BundleState.cancelled.equals(state)) {
    final BundleRestartInstanceType request=new BundleRestartInstanceType();
    final BundleRestartInstanceResponseType reply=request.getReply();
    reply.set_return(true);
    try {
      LOG.info(EventRecord.here(BundleCallback.class,EventType.BUNDLE_RESTART,vmInstance.getOwner().getUserName(),bundleTask.getBundleId(),vmInstance.getInstanceId()));
      ServiceConfiguration ccConfig=Topology.lookup(ClusterController.class,vmInstance.lookupPartition());
      final Cluster cluster=Clusters.lookup(ccConfig);
      request.setInstanceId(vmInstance.getInstanceId());
      reply.setTask(Bundles.transform(bundleTask));
      AsyncRequests.newRequest(Bundles.bundleRestartInstanceCallback(request)).dispatch(cluster.getConfiguration());
    }
 catch (    final Exception e) {
      Logs.extreme().trace("Failed to find bundle task: " + bundleTask.getBundleId());
    }
  }
}
