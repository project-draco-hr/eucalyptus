{
  BundleState next=BundleState.mapper.apply(state);
  if (this.getBundleTask() != null) {
    final BundleState current=this.getBundleTask().getState();
    if (BundleState.complete.equals(current) || BundleState.failed.equals(current) || BundleState.failed.equals(current)) {
      return;
    }
 else     if (BundleState.storing.equals(next) || BundleState.storing.equals(current)) {
      this.getBundleTask().setState(next);
      this.getBundleTask().setUpdateTime(new Date());
      EventRecord.here(BundleCallback.class,EventType.BUNDLE_TRANSITION,this.vmInstance.getOwner().toString(),"" + this.getBundleTask()).info();
    }
 else     if (BundleState.none.equals(next) && BundleState.canceling.equals(current)) {
      this.resetBundleTask();
    }
  }
 else {
    Logs.extreme().trace("Unhandle bundle task state update: " + state);
  }
}
