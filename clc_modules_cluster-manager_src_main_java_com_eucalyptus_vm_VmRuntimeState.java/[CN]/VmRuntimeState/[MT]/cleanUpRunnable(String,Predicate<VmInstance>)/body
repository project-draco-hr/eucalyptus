{
  Logs.extreme().info("Preparing to clean-up instance: " + this.getVmInstance().getInstanceId(),Exceptions.filterStackTrace(new RuntimeException()));
  final String instanceId=this.getVmInstance().getInstanceId();
  return new EucaCallable<Boolean>(){
    @Override public Boolean call(){
      cleaner.apply(VmRuntimeState.this.getVmInstance());
      if ((reason != null) && !VmRuntimeState.this.reasonDetails.contains(reason)) {
        VmRuntimeState.this.addReasonDetail(reason);
      }
      return Boolean.TRUE;
    }
    @Override public String getCorrelationId(){
      final BaseMessage req=MessageContexts.lookupLast(instanceId,Sets.<Class>newHashSet(edu.ucsb.eucalyptus.msgs.TerminateInstancesType.class,edu.ucsb.eucalyptus.msgs.StopInstancesType.class));
      return req == null ? null : req.getCorrelationId();
    }
  }
;
}
