{
  final String[] parts=path.split(":");
  try {
    final String requestIp=parts[0];
    final MetadataRequest request=new MetadataRequest(requestIp,parts.length == 2 ? parts[1] : "/",ipToVmIdCache.get(requestIp));
    if (instanceMetadataEndpoints.containsKey(request.getMetadataName()) && request.isInstance()) {
      return instanceMetadataEndpoints.get(request.getMetadataName()).apply(request).getBytes();
    }
 else     if (systemMetadataEndpoints.containsKey(request.getMetadataName()) && request.isSystem()) {
      return systemMetadataEndpoints.get(request.getMetadataName()).apply(request).getBytes();
    }
 else     if (publicMetadataEndpoints.containsKey(request.getMetadataName())) {
      return publicMetadataEndpoints.get(request.getMetadataName()).apply(request).getBytes();
    }
 else {
      throw new NoSuchElementException("Metadata request failed: " + path);
    }
  }
 catch (  NoSuchElementException ex) {
    throw ex;
  }
catch (  Exception ex) {
    NoSuchElementException noSuchElementException=Exceptions.findCause(ex,NoSuchElementException.class);
    if (noSuchElementException != null)     throw noSuchElementException;
    String errorMsg="Metadata request failed: " + path + (Logs.isExtrrreeeme() ? " cause: " + ex.getMessage() : "");
    LOG.error(errorMsg,ex);
    throw Exceptions.toUndeclared(ex);
  }
}
