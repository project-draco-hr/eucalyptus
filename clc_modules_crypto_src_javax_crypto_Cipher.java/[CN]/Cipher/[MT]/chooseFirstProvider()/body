{
  if (spi != null) {
    return;
  }
synchronized (lock) {
    if (spi != null) {
      return;
    }
    if (debug != null) {
      int w=--warnCount;
      if (w >= 0) {
        debug.println("Cipher.init() not first method " + "called, disabling delayed provider selection");
        if (w == 0) {
          debug.println("Further warnings of this type will " + "be suppressed");
        }
        new Exception("Call trace").printStackTrace();
      }
    }
    Exception lastException=null;
    while ((firstService != null) || serviceIterator.hasNext()) {
      Service s;
      CipherSpi thisSpi;
      if (firstService != null) {
        s=firstService;
        thisSpi=firstSpi;
        firstService=null;
        firstSpi=null;
      }
 else {
        s=(Service)serviceIterator.next();
        thisSpi=null;
      }
      Transform tr=getTransform(s,transforms);
      if (tr == null) {
        continue;
      }
      if (tr.supportsModePadding(s) == S_NO) {
        continue;
      }
      try {
        if (thisSpi == null) {
          Object obj=s.newInstance(null);
          if (obj instanceof CipherSpi == false) {
            continue;
          }
          thisSpi=(CipherSpi)obj;
        }
        tr.setModePadding(thisSpi);
        spi=thisSpi;
        provider=s.getProvider();
        firstService=null;
        serviceIterator=null;
        transforms=null;
        return;
      }
 catch (      Exception e) {
        lastException=e;
      }
    }
    ProviderException e=new ProviderException("Could not construct CipherSpi instance");
    if (lastException != null) {
      e.initCause(lastException);
    }
    throw e;
  }
}
