{
  UserEntity newUser=new UserEntity(userName);
  newUser.setQueryId(queryId);
  newUser.setSecretKey(secretKey);
  newUser.setAdministrator(isAdmin);
  newUser.setEnabled(isEnabled);
  EntityWrapper<UserEntity> db=Authentication.getEntityWrapper();
  try {
    db.add(newUser);
    db.commit();
  }
 catch (  Throwable t) {
    db.rollback();
    throw new UserExistsException(t);
  }
  return newUser;
}
