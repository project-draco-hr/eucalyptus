{
  String certPem=new String(UrlBase64.encode(Hashes.getPemBytes(cert)));
  UserEntity searchUser=new UserEntity();
  X509Cert searchCert=new X509Cert();
  searchCert.setPemCertificate(certPem);
  searchUser.setIsEnabled(true);
  Session session=DatabaseUtil.getEntityManagerFactory(Credentials.DB_NAME).getSessionFactory().openSession();
  try {
    Example qbeUser=Example.create(searchUser).enableLike(MatchMode.EXACT);
    Example qbeCert=Example.create(searchCert).enableLike(MatchMode.EXACT);
    List<User> users=(List<User>)session.createCriteria(User.class).setCacheable(true).add(qbeUser).createCriteria("certificates").setCacheable(true).add(qbeCert).list();
    User ret=users.size() == 1 ? users.get(0) : null;
    int size=users.size();
    if (ret != null) {
      return ret;
    }
 else {
      throw new GeneralSecurityException((size == 0) ? "No user with the specified certificate." : "Multiple users with the same certificate.");
    }
  }
 catch (  Throwable t) {
    throw new NoSuchUserException(t);
  }
 finally {
    try {
      session.close();
    }
 catch (    Throwable t) {
    }
  }
}
