{
  if (VERBOSE) {
    LOG.debug("Search users by: baseDn=" + baseDn + ", attributes="+ attrNames+ ", selection="+ selection);
  }
  List<Attributes> attrsList=Lists.newArrayList();
  try {
    NamingEnumeration<SearchResult> results=ldap.search(baseDn,selection.getSearchFilter(),attrNames);
    while (results.hasMore()) {
      SearchResult res=results.next();
      if (!selection.getNotSelected().contains(res.getNameInNamespace())) {
        attrsList.add(res.getAttributes());
      }
    }
    for (    String dn : selection.getSelected()) {
      attrsList.add(ldap.getContext().getAttributes(dn,attrNames));
    }
  }
 catch (  NamingException e) {
    LOG.error(e,e);
    throw new LdapException(e);
  }
  return attrsList;
}
