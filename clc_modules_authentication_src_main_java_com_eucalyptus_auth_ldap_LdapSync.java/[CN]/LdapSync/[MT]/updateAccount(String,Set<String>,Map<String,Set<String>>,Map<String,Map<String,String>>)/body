{
  try {
    Set<String> newUserSet=getAccountUserSet(accountMembers,groups);
    Set<String> oldUserSet=getLocalUserSet(accountName);
    for (    String user : newUserSet) {
      if (oldUserSet.contains(user)) {
        oldUserSet.remove(user);
        try {
          updateUser(accountName,user,users.get(user));
        }
 catch (        AuthException e) {
          LOG.error(e,e);
          LOG.warn("Failed to update user " + user + " in "+ accountName,e);
        }
      }
 else {
        try {
          addNewUser(accountName,user,users.get(user));
        }
 catch (        AuthException e) {
          LOG.error(e,e);
          LOG.warn("Failed to add new user " + user + " in "+ accountName,e);
        }
      }
    }
    removeObsoleteUsers(accountName,oldUserSet);
    Set<String> oldGroupSet=getLocalGroupSet(accountName);
    for (    String group : accountMembers) {
      if (oldGroupSet.contains(group)) {
        oldGroupSet.remove(group);
        updateGroup(accountName,group,groups.get(group));
      }
 else {
        addNewGroup(accountName,group,groups.get(group));
      }
    }
    removeObsoleteGroups(accountName,oldGroupSet);
  }
 catch (  AuthException e) {
    LOG.error(e,e);
    LOG.error("Failed to update account " + accountName,e);
  }
}
