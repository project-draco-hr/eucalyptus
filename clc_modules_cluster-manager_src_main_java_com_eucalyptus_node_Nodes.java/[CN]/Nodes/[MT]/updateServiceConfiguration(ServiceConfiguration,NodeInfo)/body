{
  if (Component.State.ENABLED.apply(ccConfig)) {
    ServiceConfiguration ncConfig=Nodes.lookup(ccConfig,nodeInfo.getName());
    Component component=Components.lookup(NodeController.class);
    if (!component.hasService(ncConfig)) {
      component.setup(ncConfig);
      try {
        Topology.disable(ncConfig);
      }
 catch (      Exception e) {
        LOG.debug(e,e);
      }
    }
    DescribeServicesResponseType reply=Nodes.send(ncConfig,new DescribeServicesType());
    for (    ServiceStatusType status : reply.getServiceStatuses()) {
      if (!ncConfig.lookupStateMachine().isBusy() && ncConfig.getName().equals(status.getServiceId().getName())) {
        Component.State reportedState=Component.State.ENABLED;
        final String lastMessage=Joiner.on(",").join(status.getDetails());
        nodeInfo.setLastMessage(lastMessage);
        Faults.CheckException checkException=null;
        try {
          reportedState=Component.State.valueOf(Strings.nullToEmpty(status.getLocalState()).toUpperCase());
          LOG.debug("Found service status for " + ncConfig.getName() + ": "+ reportedState);
        }
 catch (        IllegalArgumentException e) {
          LOG.debug("Failed to get service status for " + ncConfig.getName() + "; got "+ status.getLocalState());
        }
        try {
          if (Component.State.ENABLED.equals(reportedState)) {
            Topology.enable(ncConfig);
            checkException=Faults.advisory(ncConfig,Exceptions.toUndeclared(lastMessage));
          }
 else           if (!Component.State.STOPPED.apply(ncConfig) && Component.State.NOTREADY.equals(reportedState)) {
            Topology.disable(ncConfig);
            checkException=Faults.failure(ncConfig,Exceptions.toUndeclared(lastMessage));
          }
 else {
            Topology.stop(ncConfig);
            checkException=Faults.advisory(ncConfig,Exceptions.toUndeclared(lastMessage));
          }
        }
 catch (        Exception e) {
          LOG.debug(e,e);
        }
        Faults.submit(ncConfig,null,checkException);
      }
    }
  }
}
