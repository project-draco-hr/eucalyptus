{
  final DescribePoliciesResponseType reply=request.getReply();
  final Context ctx=Contexts.lookup();
  final boolean showAll=request.policyNames().remove("verbose");
  final OwnerFullName ownerFullName=ctx.hasAdministrativePrivileges() && showAll ? null : ctx.getUserFullName().asAccountFullName();
  try {
    final Predicate<ScalingPolicy> requestedAndAccessible=Predicates.and(AutoScalingMetadatas.filterPrivilegesByIdOrArn(request.policyNames()),AutoScalingResourceName.isResourceName().apply(request.getAutoScalingGroupName()) ? AutoScalingMetadatas.filterByProperty(AutoScalingResourceName.parse(request.getAutoScalingGroupName(),autoScalingGroup).getUuid(),ScalingPolicies.toGroupUuid()) : AutoScalingMetadatas.filterByProperty(request.getAutoScalingGroupName(),ScalingPolicies.toGroupName()));
    final List<ScalingPolicyType> results=reply.getDescribePoliciesResult().getScalingPolicies().getMember();
    final List<ScalingPolicy> scalingPolicies=this.scalingPolicies.list(ownerFullName,requestedAndAccessible);
    final List<String> scalingPolicyArns=Lists.transform(scalingPolicies,AutoScalingMetadatas.toArn());
    final Map<String,Collection<String>> policyArnToAlarmArns=activityManager.getAlarmsForPolicies(ctx.getUserFullName(),scalingPolicyArns);
    for (    final ScalingPolicy scalingPolicy : scalingPolicies) {
      final ScalingPolicyType scalingPolicyType=TypeMappers.transform(scalingPolicy,ScalingPolicyType.class);
      final Collection<String> alarmArns=policyArnToAlarmArns.get(scalingPolicy.getArn());
      if (alarmArns != null && !alarmArns.isEmpty()) {
        scalingPolicyType.setAlarms(new Alarms(alarmArns));
      }
      results.add(scalingPolicyType);
    }
  }
 catch (  Exception e) {
    handleException(e);
  }
  return reply;
}
