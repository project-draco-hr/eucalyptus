{
  final DescribeAutoScalingGroupsResponseType reply=request.getReply();
  final Context ctx=Contexts.lookup();
  final boolean showAll=request.autoScalingGroupNames().remove("verbose");
  final OwnerFullName ownerFullName=ctx.hasAdministrativePrivileges() && showAll ? null : ctx.getUserFullName().asAccountFullName();
  final Predicate<AutoScalingGroupMetadata> requestedAndAccessible=AutoScalingMetadatas.filterPrivilegesByIdOrArn(request.autoScalingGroupNames());
  try {
    final List<AutoScalingGroupType> results=reply.getDescribeAutoScalingGroupsResult().getAutoScalingGroups().getMember();
    final List<AutoScalingGroup> groups=autoScalingGroups.list(ownerFullName,requestedAndAccessible);
    final Map<String,List<Tag>> tagsMap=TagSupport.forResourceClass(AutoScalingGroup.class).getResourceTagMap(ctx.getUserFullName().asAccountFullName(),Iterables.transform(groups,AutoScalingMetadatas.toDisplayName()),Predicates.alwaysTrue());
    for (    final AutoScalingGroup autoScalingGroup : groups) {
      final AutoScalingGroupType type=TypeMappers.transform(autoScalingGroup,AutoScalingGroupType.class);
      final Instances instances=new Instances();
      Iterables.addAll(instances.getMember(),Iterables.transform(autoScalingInstances.listByGroup(autoScalingGroup),TypeMappers.lookup(AutoScalingInstance.class,Instance.class)));
      if (!instances.getMember().isEmpty()) {
        type.setInstances(instances);
      }
      final TagDescriptionList tags=new TagDescriptionList();
      Tags.addFromTags(tags.getMember(),TagDescription.class,tagsMap.get(autoScalingGroup.getAutoScalingGroupName()));
      if (!tags.getMember().isEmpty()) {
        type.setTags(tags);
      }
      results.add(type);
    }
  }
 catch (  Exception e) {
    handleException(e);
  }
  return reply;
}
