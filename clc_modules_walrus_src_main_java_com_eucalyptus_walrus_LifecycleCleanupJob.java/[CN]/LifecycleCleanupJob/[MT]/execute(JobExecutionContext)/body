{
  EntityTransaction tran=Entities.get(LifecycleRuleInfo.class);
  List<LifecycleRuleInfo> rules=null;
  try {
    rules=Entities.query(new LifecycleRuleInfo());
    tran.commit();
  }
 catch (  Exception ex) {
    LOG.error("exception occurred while retrieving lifecycle rules - " + ex.getMessage());
  }
 finally {
    if (tran.isActive()) {
      tran.rollback();
    }
  }
  if (rules != null && rules.size() > 0) {
    for (    LifecycleRuleInfo rule : rules) {
      if (rule.getEnabled() != null && rule.getEnabled().booleanValue()) {
        String ruleId=rule.getRuleId();
        String bucketName=rule.getBucketName();
        String prefix=rule.getPrefix();
        if (rule.getExpirationDate() != null) {
          processExpirationByDate(ruleId,bucketName,prefix,rule.getExpirationDate());
        }
 else         if (rule.getExpirationDays() != null) {
          processExpirationByDays(ruleId,bucketName,prefix,rule.getExpirationDays());
        }
        if (rule.getTransitionDate() != null) {
          processTransitionByDate(ruleId,bucketName,prefix,rule.getTransitionDate());
        }
 else         if (rule.getTransitionDays() != null) {
          processTransitionByDays(ruleId,bucketName,prefix,rule.getExpirationDays());
        }
      }
 else {
        LOG.debug("rule id - " + rule.getRuleId() + " on bucket "+ rule.getBucketName()+ " is not enabled");
      }
    }
  }
 else {
    LOG.info("there are no rules to process");
  }
  if (lock.tryLock()) {
    try {
      processExpirations();
    }
  finally {
      lock.unlock();
    }
  }
 else {
    LOG.error("unable to remove newly expired objects because prior delete tasks are not complete");
  }
}
