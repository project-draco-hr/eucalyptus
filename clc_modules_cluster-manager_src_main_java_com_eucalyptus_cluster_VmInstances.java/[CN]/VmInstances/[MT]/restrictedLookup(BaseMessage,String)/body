{
  final VmInstance vm=VmInstances.lookup(instanceId);
  final Context ctx=Contexts.lookup();
  Account addrAccount=null;
  try {
    addrAccount=Accounts.lookupUserById(vm.getOwner().getUniqueId()).getAccount();
  }
 catch (  final AuthException e) {
    throw new EucalyptusCloudException(e);
  }
  if (!Permissions.isAuthorized(PolicySpec.VENDOR_EC2,PolicySpec.EC2_RESOURCE_INSTANCE,instanceId,addrAccount,PolicySpec.requestToAction(request),ctx.getUser())) {
    throw new EucalyptusCloudException("Permission denied while trying to access instance " + instanceId + " by "+ ctx.getUser());
  }
  return vm;
}
