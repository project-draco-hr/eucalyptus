{
  try {
    final String networkFqName=!vm.getNetworkRulesGroups().isEmpty() ? vm.getOwner().getAccountNumber() + "-" + vm.getNetworkNames().first() : null;
    final Cluster cluster=Clusters.getInstance().lookup(vm.getPartition());
    VmInstances.cleanUpAttachedVolumes(vm);
    Address address=null;
    final Request<TerminateInstancesType,TerminateInstancesResponseType> req=AsyncRequests.newRequest(new TerminateCallback(vm.getInstanceId()));
    if (NetworkGroups.networkingConfiguration().hasNetworking()) {
      try {
        address=Addresses.getInstance().lookup(vm.getPublicAddress());
      }
 catch (      final NoSuchElementException e) {
      }
catch (      final Throwable e1) {
        LOG.debug(e1,e1);
      }
    }
    req.then(VmInstances.getCleanUpCallback(address,vm,networkFqName,cluster));
    req.dispatch(cluster.getConfiguration());
  }
 catch (  final Throwable e) {
    LOG.error(e,e);
  }
}
