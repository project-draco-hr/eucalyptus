{
  try {
    if (VmStateSet.DONE.apply(vm)) {
      if (terminateCache.containsKey(vm.getDisplayName())) {
        terminateCache.remove(vm.getDisplayName());
        terminateDescribeCache.remove(vm.getDisplayName());
      }
 else {
        RunningInstancesItemType ret=VmInstances.transform(vm);
        terminateCache.put(vm.getDisplayName(),vm);
        terminateDescribeCache.put(vm.getDisplayName(),ret);
      }
    }
  }
 catch (  Exception ex) {
    LOG.error(ex,ex);
  }
  return VmInstance.Transitions.DELETE.apply(vm);
}
