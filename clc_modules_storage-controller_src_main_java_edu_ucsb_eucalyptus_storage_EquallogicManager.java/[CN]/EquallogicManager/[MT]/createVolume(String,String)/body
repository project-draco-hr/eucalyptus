{
  EntityWrapper<EquallogicVolumeInfo> db=StorageController.getEntityWrapper();
  boolean locallyCreated=false;
  String sourceVolume;
  int size;
  try {
    EquallogicVolumeInfo snapInfo=db.getUnique(new EquallogicVolumeInfo(snapshotId));
    db.commit();
    locallyCreated=snapInfo.getLocallyCreated();
    sourceVolume=snapInfo.getSnapshotOf();
    size=snapInfo.getSize();
  }
 catch (  EucalyptusCloudException ex) {
    LOG.error(ex);
    db.rollback();
    throw ex;
  }
  String iqn=connectionManager.createVolume(volumeId,snapshotId,locallyCreated,sourceVolume);
  if (iqn != null) {
    EquallogicVolumeInfo volumeInfo=new EquallogicVolumeInfo(volumeId,iqn,size);
    db=StorageController.getEntityWrapper();
    db.add(volumeInfo);
    db.commit();
  }
  return size;
}
