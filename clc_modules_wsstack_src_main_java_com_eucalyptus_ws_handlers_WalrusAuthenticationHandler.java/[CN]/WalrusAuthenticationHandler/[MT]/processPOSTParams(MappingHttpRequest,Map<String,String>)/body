{
  String contentType=httpRequest.getHeader(WalrusProperties.CONTENT_TYPE);
  if (contentType != null) {
    if (contentType.startsWith(WalrusProperties.MULTIFORM_DATA_TYPE)) {
      String boundary=getFormFieldKeyName(contentType,"boundary");
      boundary="--" + boundary + "\r\n";
      String message=getMessageString(httpRequest);
      String[] parts=message.split(boundary);
      for (      String part : parts) {
        Map<String,String> keyMap=getFormField(part,"name");
        Set<String> keys=keyMap.keySet();
        for (        String key : keys) {
          if (WalrusProperties.FormField.file.toString().equals(key)) {
            getFirstChunk(formFields,part,boundary);
          }
          formFields.put(key,keyMap.get(key));
        }
      }
    }
    String[] target=getTarget(httpRequest);
    formFields.put(WalrusProperties.FormField.bucket.toString(),target[0]);
  }
 else {
    throw new AuthenticationException("No Content-Type specified");
  }
}
