{
  List<ImagingTask> allTasks=null;
  List<ImagingTask> imagePendingTasks=Lists.newArrayList();
  List<ImagingTask> pendingTasks=Lists.newArrayList();
  try {
    allTasks=ImagingTasks.getImagingTasks();
    for (    final ImagingTask t : allTasks) {
      if ((t instanceof InstanceStoreImagingTask) && ImportTaskState.PENDING.equals(t.getState()))       imagePendingTasks.add(t);
      if (ImportTaskState.PENDING.equals(t.getState()))       pendingTasks.add(t);
 else       if (ImportTaskState.CONVERTING.equals(t.getState()) && ((t instanceof InstanceImagingTask) && !(t instanceof InstanceStoreImagingTask)))       pendingTasks.add(t);
    }
    ImagingTask oldestTask=null;
    Date oldest=new Date(Long.MAX_VALUE);
    for (    final ImagingTask task : imagePendingTasks) {
      if (oldest.after(task.getCreationTimestamp())) {
        oldest=task.getCreationTimestamp();
        oldestTask=task;
      }
    }
    if (oldestTask != null)     return oldestTask;
    for (    final ImagingTask task : pendingTasks) {
      if (oldest.after(task.getCreationTimestamp())) {
        oldest=task.getCreationTimestamp();
        oldestTask=task;
      }
    }
    return oldestTask;
  }
 catch (  final Exception ex) {
    LOG.error("failed to schedule the task to imaging worker",ex);
    return null;
  }
}
