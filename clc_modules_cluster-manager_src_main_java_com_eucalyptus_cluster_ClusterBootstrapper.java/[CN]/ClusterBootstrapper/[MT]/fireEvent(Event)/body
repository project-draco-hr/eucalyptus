{
  if (event instanceof LifecycleEvent) {
    LifecycleEvent lifeEvent=((LifecycleEvent)event);
    if (lifeEvent.getConfiguration() instanceof ClusterConfiguration) {
      ClusterConfiguration conf=(ClusterConfiguration)lifeEvent.getConfiguration();
      if (event instanceof StartComponentEvent) {
        LOG.info("Starting up cluster: " + LogUtil.dumpObject(lifeEvent));
        EventRecord.here(ClusterBootstrapper.class,EventType.COMPONENT_SERVICE_START_REMOTE,conf.getComponent().name(),conf.getName(),conf.getUri()).info();
        try {
          Cluster newCluster=ClusterBootstrapper.lookupCluster(conf);
          this.registerClusterStateHandler(newCluster);
          ListenerRegistry.getInstance().fireEvent(new NewClusterEvent().setMessage(newCluster));
        }
 catch (        EucalyptusCloudException e) {
          LOG.error(e,e);
          return;
        }
catch (        EventVetoedException e) {
          LOG.error(e,e);
          return;
        }
      }
 else       if (event instanceof StopComponentEvent) {
        LOG.info("Tearing down cluster: " + LogUtil.dumpObject(lifeEvent));
        EventRecord.here(ClusterBootstrapper.class,EventType.COMPONENT_SERVICE_STOP_REMOTE,conf.getComponent().name(),conf.getName(),conf.getUri()).info();
        Cluster c=Clusters.getInstance().lookup(conf.getName());
        Clusters.getInstance().deregister(c.getName());
        c.stop();
        try {
          ListenerRegistry.getInstance().fireEvent(new TeardownClusterEvent().setMessage(c));
          this.deregisterClusterStateHandler(c);
          return;
        }
 catch (        EventVetoedException e1) {
          return;
        }
      }
    }
  }
}
