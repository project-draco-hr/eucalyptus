{
  while (!finished) {
    List<String> clusterNames=Lists.newArrayList();
    try {
      for (      ClusterConfiguration c : Configuration.getClusterConfigurations()) {
        clusterNames.add(c.getName());
        try {
          Cluster foundCluster=Clusters.getInstance().lookup(c.getName());
          if (initialized) {
            foundCluster.getThreadGroup().create();
          }
        }
 catch (        NoSuchElementException e) {
          try {
            Cluster newCluster=ClusterBootstrapper.getCluster(c);
            Clusters.getInstance().register(newCluster);
            if (initialized) {
              newCluster.getThreadGroup().create();
            }
            LOG.info("Registering cluster: " + newCluster.getName());
          }
 catch (          Exception e1) {
            LOG.error("Error loading cluster configuration: " + c.getName());
            LOG.error(e1,e1);
          }
        }
      }
      List<String> registeredClusters=Lists.newArrayList(Clusters.getInstance().listKeys());
      registeredClusters.removeAll(clusterNames);
      for (      String removeClusterName : registeredClusters) {
        try {
          Cluster removeCluster=Clusters.getInstance().lookup(removeClusterName);
          removeCluster.getThreadGroup().stopThreads();
          Clusters.getInstance().deregister(removeCluster.getName());
        }
 catch (        NoSuchElementException e) {
        }
      }
    }
 catch (    EucalyptusCloudException e) {
      LOG.error("Failed to load cluster configurations: " + e.getMessage());
      LOG.error(e,e);
    }
    if (!initialized) {
      initialized=true;
      return;
    }
 else {
      try {
        this.start();
        Thread.sleep(5000);
      }
 catch (      Exception e) {
        LOG.error(e,e);
      }
    }
  }
}
