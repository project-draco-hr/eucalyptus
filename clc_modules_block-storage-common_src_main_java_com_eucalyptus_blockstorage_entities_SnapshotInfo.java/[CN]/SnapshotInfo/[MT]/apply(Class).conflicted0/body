{
  EntityTransaction db=Entities.get(SnapshotInfo.class);
  try {
    SnapshotInfo example=new SnapshotInfo();
    List<SnapshotInfo> snaps=Entities.query(example);
    if (snaps != null && snaps.size() > 0) {
      for (      SnapshotInfo snapshot : snaps) {
        if (snapshot.getSizeGb() == null) {
          EntityTransaction volDb=Entities.get(VolumeInfo.class);
          try {
            VolumeInfo vol=Entities.uniqueResult(new VolumeInfo(snapshot.getVolumeId()));
            if (vol != null) {
              snapshot.setSizeGb(vol.getSize());
              LOG.debug("Setting snapshot size on entity: " + snapshot.getScName() + snapshot.getSnapshotId()+ " to : "+ snapshot.getSizeGb());
              db.commit();
            }
 else {
              LOG.debug("No volume record found for snapshot " + snapshot.getScName() + ", "+ snapshot.getSnapshotId()+ " will have size set on upgrade of the backend snapshot entity");
            }
          }
  finally {
            volDb.rollback();
            volDb=null;
          }
        }
 else {
        }
      }
    }
    db.commit();
  }
 catch (  Exception ex) {
    LOG.error("caught exception during upgrade, while attempting to set snapshot size");
    throw Exceptions.toUndeclared(ex);
  }
 finally {
    db.rollback();
  }
  return true;
}
