{
  EntityTransaction db=Entities.get(SnapshotInfo.class);
  try {
    SnapshotInfo example=new SnapshotInfo();
    example.setScName(null);
    List<SnapshotInfo> snaps=Entities.query(example);
    if (snaps != null & !snaps.isEmpty()) {
      Map<String,String> snapIDBucketNameMap=Maps.newHashMap();
      Map<String,Integer> snapIDSizeMap=Maps.newHashMap();
      EntityTransaction walrusSnapshotsdb=Entities.get(WalrusSnapshotInfo.class);
      try {
        List<WalrusSnapshotInfo> walrusSnapshots=Entities.query(new WalrusSnapshotInfo(),Boolean.TRUE);
        for (        WalrusSnapshotInfo walrusSnapshot : walrusSnapshots) {
          snapIDBucketNameMap.put(walrusSnapshot.getSnapshotId(),walrusSnapshot.getNaturalId());
          snapIDSizeMap.put(walrusSnapshot.getSnapshotId(),walrusSnapshot.getSize());
        }
      }
 catch (      Exception e) {
        walrusSnapshotsdb.rollback();
        return false;
      }
 finally {
        if (walrusSnapshotsdb.isActive()) {
          walrusSnapshotsdb.commit();
        }
      }
      for (      SnapshotInfo snap : snaps) {
        String snapId=snap.getSnapshotId();
        if (snapIDBucketNameMap.containsKey(snapId)) {
          if (snap.getSnapshotLocation() == null) {
            snap.setSnapshotLocation(SnapshotInfo.generateSnapshotLocationURI(SnapshotTransferConfiguration.OSG,snapIDBucketNameMap.get(snapId),snapId));
          }
          if (snap.getSizeGb() == null) {
            snap.setSizeGb(snapIDSizeMap.get(snapId));
          }
        }
      }
    }
 else {
    }
    db.commit();
  }
 catch (  Exception e) {
    LOG.error("Failed to upgrade location/size during SnapshotInfo entity upgrade",e);
    db.rollback();
    return false;
  }
 finally {
    if (db.isActive()) {
      db.commit();
    }
  }
  return true;
}
