{
  HoldMe.canHas.lock();
  try {
    final Element secNode=WSSecurity.getSecurityElement(wrappedCredentials.getLoginData());
    final XMLSignature sig=WSSecurity.getXMLSignature(secNode);
    SecurityContext.enqueueSignature(sig.getTextFromTextChild());
    final X509Certificate cert=WSSecurity.verifySignature(secNode,sig);
    try {
      final User user=Users.lookupCertificate(cert);
      super.setCredential(cert);
      super.setPrincipal(user);
      super.getGroups().addAll(Groups.lookupUserGroups(super.getPrincipal()));
    }
 catch (    NoSuchUserException e) {
      try {
        if (Users.getUserProvider().checkRevokedCertificate(cert)) {
          throw new NoSuchUserException("Certificate has been revoked: " + e.getMessage(),e);
        }
 else {
          throw e;
        }
      }
 catch (      Exception ex) {
        throw e;
      }
    }
  }
  finally {
    HoldMe.canHas.unlock();
  }
  return true;
}
