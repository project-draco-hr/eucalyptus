{
  if (!reply.get_return()) {
    LOG.debug("Trying to remove invalid volume attachment " + this.getRequest().getVolumeId() + " from instance "+ this.getRequest().getInstanceId());
    try {
      VmInstance vm=VmInstances.getInstance().lookup(this.getRequest().getInstanceId());
      AttachedVolume failVol=new AttachedVolume(this.getRequest().getVolumeId());
      vm.getVolumes().remove(failVol);
      LOG.debug("Removed failed attachment: " + failVol.getVolumeId() + " -> "+ vm.getInstanceId());
      LOG.debug("Final volume attachments for " + vm.getInstanceId() + " "+ vm.getVolumes());
    }
 catch (    NoSuchElementException e1) {
    }
  }
 else {
    try {
      VmInstance vm=VmInstances.getInstance().lookup(this.getRequest().getInstanceId());
      LOG.debug("Volumes marked as attached " + vm.getVolumes() + " to "+ vm.getInstanceId());
      vm.updateVolumeState(this.getRequest().getVolumeId(),"attached");
    }
 catch (    NoSuchElementException e1) {
    }
  }
}
