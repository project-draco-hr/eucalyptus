{
  final Function<String,VmInstance> funcName=new Function<String,VmInstance>(){
    public VmInstance apply(    final String input){
      VmInstance vm=VmInstances.lookup(VolumeAttachCallback.this.getRequest().getInstanceId());
      vm.updateVolumeAttachment(VolumeAttachCallback.this.getRequest().getVolumeId(),"attaching");
      return vm;
    }
  }
;
  Entities.asTransaction(VmInstance.class,funcName).apply(this.getRequest().getInstanceId());
  try {
    VmInstance vm=VmInstances.lookup(this.getRequest().getInstanceId());
    vm.updateVolumeAttachment(this.getRequest().getVolumeId(),"attaching");
  }
 catch (  NoSuchElementException e1) {
    LOG.error("Failed to lookup volume attachment state in order to update: " + this.getRequest().getVolumeId() + " due to "+ e1.getMessage(),e1);
  }
}
