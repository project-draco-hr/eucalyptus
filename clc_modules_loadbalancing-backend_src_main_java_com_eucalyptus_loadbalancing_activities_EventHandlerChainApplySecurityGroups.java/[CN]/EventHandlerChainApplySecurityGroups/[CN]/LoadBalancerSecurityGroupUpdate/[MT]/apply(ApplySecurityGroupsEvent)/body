{
  final LoadBalancer lb;
  try {
    lb=LoadBalancers.getLoadbalancer(evt.getContext(),evt.getLoadBalancer());
  }
 catch (  NoSuchElementException ex) {
    throw new EventHandlerException("Failed to find the loadbalancer " + evt.getLoadBalancer(),ex);
  }
catch (  Exception ex) {
    throw new EventHandlerException("Unable to access loadbalancer metadata",ex);
  }
  for (  final LoadBalancerAutoScalingGroupCoreView group : lb.getAutoScaleGroups()) {
    final String groupName=group.getName();
    final DescribeAutoScalingGroupsResponseType response=EucalyptusActivityTasks.getInstance().describeAutoScalingGroups(Lists.newArrayList(groupName),lb.useSystemAccount());
    final DescribeAutoScalingGroupsResult describeAutoScalingGroupsResult=response.getDescribeAutoScalingGroupsResult();
    if (describeAutoScalingGroupsResult != null) {
      final AutoScalingGroupsType autoScalingGroupsType=describeAutoScalingGroupsResult.getAutoScalingGroups();
      if (autoScalingGroupsType != null && autoScalingGroupsType.getMember() != null && !autoScalingGroupsType.getMember().isEmpty() && autoScalingGroupsType.getMember().get(0).getInstances() != null) {
        for (        final Instance instance : autoScalingGroupsType.getMember().get(0).getInstances().getMember()) {
          EucalyptusActivityTasks.getInstance().modifySecurityGroups(instance.getInstanceId(),evt.getSecurityGroupIdsToNames().keySet(),lb.useSystemAccount());
        }
      }
    }
  }
}
