{
  final Map<String,List<Long>> ipToTimesMap=Maps.newHashMap();
  while (eventIterator.hasNext()) {
    final ReportingEventSupport event=eventIterator.next();
    if (event.getTimestampMs() <= report.getEndMs()) {
      List<Long> endTimes=ipToTimesMap.get(getIpUuid(event));
      if (endTimes == null) {
        endTimes=Lists.newArrayList(event.getTimestampMs());
        ipToTimesMap.put(getIpUuid(event),endTimes);
      }
 else       if (endTimes.size() == 1 && event.getTimestampMs() < report.getBeginMs()) {
        endTimes.set(0,event.getTimestampMs());
      }
 else {
        endTimes.add(event.getTimestampMs());
      }
    }
  }
  return ipToTimesMap;
}
