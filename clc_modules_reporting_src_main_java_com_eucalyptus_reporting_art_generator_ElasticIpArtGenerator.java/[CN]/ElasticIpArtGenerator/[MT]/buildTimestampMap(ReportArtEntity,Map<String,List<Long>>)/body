{
  return new Predicate<ReportingEventSupport>(){
    @Override public boolean apply(    final ReportingEventSupport event){
      if (event.getTimestampMs() <= report.getEndMs()) {
        List<Long> endTimes=ipToTimesMap.get(getIpUuid(event));
        if (endTimes == null) {
          endTimes=Lists.newArrayList(event.getTimestampMs());
          ipToTimesMap.put(getIpUuid(event),endTimes);
        }
 else         if (endTimes.size() == 1 && event.getTimestampMs() < report.getBeginMs()) {
          endTimes.set(0,event.getTimestampMs());
        }
 else {
          endTimes.add(event.getTimestampMs());
        }
      }
 else {
        return false;
      }
      return true;
    }
  }
;
}
