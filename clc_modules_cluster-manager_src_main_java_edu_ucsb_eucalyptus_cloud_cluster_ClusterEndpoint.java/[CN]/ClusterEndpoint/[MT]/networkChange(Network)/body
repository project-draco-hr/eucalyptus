{
  try {
    Network existingNet=Networks.getInstance().lookup(net.getName());
    ConfigureNetworkType msg=null;
    if (net.getRules().isEmpty()) {
      msg=new ConfigureNetworkType().regarding();
      msg.setUserId(existingNet.getUserName());
      for (      PacketFilterRule pf : existingNet.getRules())       msg.getRules().add(PacketFilterRule.revoke(pf));
      existingNet.setRules(net.getRules());
    }
 else {
      existingNet.setRules(net.getRules());
      msg=new ConfigureNetworkType().regarding();
      msg.setUserId(existingNet.getUserName());
      msg.setRules(existingNet.getRules());
    }
    ConfigureNetworkCallback configureNetwork=new ConfigureNetworkCallback(msg);
    for (    Cluster c : Clusters.getInstance().listValues()) {
      configureNetwork.newInstance().dispatch(c);
    }
  }
 catch (  NoSuchElementException e) {
    LOG.error("Changed network rules not applied to inactive network: " + net.getName());
  }
}
