{
  Properties props=new Properties();
  props.put("hibernate.archive.autodetection","jar, class, hbm");
  props.put("hibernate.ejb.interceptor.session_scoped","com.eucalyptus.entities.DelegatingInterceptor");
  props.put("hibernate.show_sql","false");
  props.put("hibernate.format_sql","false");
  props.put("hibernate.generate_statistics","false");
  props.put("hibernate.bytecode.use_reflection_optimizer","true");
  props.put("javax.persistence.jdbc.driver","org.apache.derby.jdbc.EmbeddedDriver");
  props.put("javax.persistence.jdbc.user","root");
  props.put("javax.persistence.jdbc.password","root");
  props.put("hibernate.hbm2ddl.auto","create");
  props.put("hibernate.cache.use_second_level_cache","false");
  props.put("hibernate.dialect","org.hibernate.dialect.DerbyDialect");
  props.put("hibernate.connection.url","jdbc:derby:memory:test;create=true");
  Ejb3Configuration config=(new Ejb3Configuration()).configure(props).addAnnotatedClass(AccessKeyEntity.class).addAnnotatedClass(AccountEntity.class).addAnnotatedClass(InstanceProfileEntity.class).addAnnotatedClass(GroupEntity.class).addAnnotatedClass(PolicyEntity.class).addAnnotatedClass(UserEntity.class).addAnnotatedClass(RoleEntity.class).addAnnotatedClass(CertificateEntity.class).addAnnotatedClass(ServerCertificateEntity.class);
  PersistenceContexts.registerPersistenceContext("eucalyptus_auth",config);
  Accounts.setAccountProvider(new DatabaseAuthProvider());
}
