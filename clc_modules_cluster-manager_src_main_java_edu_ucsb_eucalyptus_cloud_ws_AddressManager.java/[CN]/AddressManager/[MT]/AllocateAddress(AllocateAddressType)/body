{
  AllocateAddressResponseType reply=(AllocateAddressResponseType)request.getReply();
  Addresses.checkUserLimits(request);
  String userId=request.getUserId();
  Address address;
  try {
    address=Addresses.getAddressManager().allocateNext(userId);
  }
 catch (  NotEnoughResourcesAvailable e) {
    LOG.debug(e,e);
    throw new EucalyptusCloudException(e);
  }
  reply.setPublicIp(address.getName());
  address.clearPending();
  return reply;
}
