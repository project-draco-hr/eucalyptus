{
  ReleaseAddressResponseType reply=(ReleaseAddressResponseType)request.getReply();
  reply.set_return(false);
  Addresses.updateAddressingMode();
  Address address=Addresses.checkPermissionsAndGet(request.getUserId(),request.isAdministrator(),request.getPublicIp());
  if (address.isAssigned()) {
    try {
      VmInstance oldVm=VmInstances.getInstance().lookup(address.getInstanceId());
      Addresses.getAddressManager().dispatchUnassignAddress(address.unassign(),oldVm);
      try {
        Addresses.getAddressManager().assignSystemAddress(oldVm);
      }
 catch (      NotEnoughResourcesAvailable e) {
        LOG.debug(e,e);
        throw new EucalyptusCloudException(e);
      }
    }
 catch (    NoSuchElementException e) {
    }
  }
  Addresses.getAddressManager().releaseAddress(address);
  reply.set_return(true);
  return reply;
}
