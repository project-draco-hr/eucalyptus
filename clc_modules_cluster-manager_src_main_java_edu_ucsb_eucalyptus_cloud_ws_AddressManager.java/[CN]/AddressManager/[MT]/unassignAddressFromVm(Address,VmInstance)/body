{
  EntityWrapper<Address> db=new EntityWrapper<Address>();
  try {
    try {
      UnassignAddressType unassignMsg=Admin.makeMsg(UnassignAddressType.class,address.getName(),address.getInstanceAddress());
      UnassignAddressCallback callback=new UnassignAddressCallback(address);
      Clusters.sendClusterEvent(address.getCluster(),QueuedEvent.make(callback,unassignMsg));
      callback.waitForResponse();
    }
 catch (    Throwable e) {
      LOG.debug(e,e);
    }
    vm.getNetworkConfig().setIgnoredPublicIp(vm.getNetworkConfig().getIpAddress());
    Address addr=db.getUnique(new Address(address.getName()));
    addr.unassign();
    address.unassign();
    db.commit();
  }
 catch (  EucalyptusCloudException e) {
    db.rollback();
  }
}
