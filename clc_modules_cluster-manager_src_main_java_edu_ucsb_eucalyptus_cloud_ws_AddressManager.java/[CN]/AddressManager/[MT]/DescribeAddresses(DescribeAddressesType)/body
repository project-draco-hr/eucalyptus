{
  AddressUtil.updateAddressingMode();
  DescribeAddressesResponseType reply=(DescribeAddressesResponseType)request.getReply();
  boolean isAdmin=request.isAdministrator();
  for (  Address address : Addresses.getInstance().listValues()) {
    if (address.isAssigned()) {
      VmInstance vm=null;
      try {
        vm=VmInstances.getInstance().lookup(address.getInstanceId());
      }
 catch (      NoSuchElementException e) {
      }
      if (vm == null || VmState.TERMINATED.equals(vm.getState()) || VmState.BURIED.equals(vm.getState())) {
        AddressUtil.clearAddress(address);
      }
    }
    if (isAdmin || address.getUserId().equals(request.getUserId())) {
      reply.getAddressesSet().add(address.getDescription(isAdmin));
    }
  }
  if (request.isAdministrator()) {
    for (    Address address : Addresses.getInstance().listDisabledValues()) {
      reply.getAddressesSet().add(new DescribeAddressesResponseItemType(address.getName(),Address.UNALLOCATED_USERID));
    }
  }
  return reply;
}
