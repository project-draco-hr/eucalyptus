{
  if (event.getMessage() instanceof MappingHttpResponse) {
    final MappingHttpResponse httpMessage=(MappingHttpResponse)event.getMessage();
    if (httpMessage.getMessage() instanceof EucalyptusErrorMessageType) {
      EucalyptusErrorMessageType errMsg=(EucalyptusErrorMessageType)httpMessage.getMessage();
      httpMessage.setSoapEnvelope(Binding.createFault(errMsg.getSource(),errMsg.getMessage(),errMsg.getStatusMessage()));
      httpMessage.setStatus(HttpResponseStatus.BAD_REQUEST);
    }
 else {
      httpMessage.setSoapEnvelope(HoldMe.getOMSOAP11Factory().getDefaultEnvelope());
      httpMessage.getSoapEnvelope().getBody().addChild(httpMessage.getOmMessage());
    }
  }
}
