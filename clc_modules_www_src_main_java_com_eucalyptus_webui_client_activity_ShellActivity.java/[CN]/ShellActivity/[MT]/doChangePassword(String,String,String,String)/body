{
  final String userId=this.clientFactory.getSessionData().getLoginUser().getUserId();
  this.clientFactory.getShellView().getFooterView().showStatus(StatusType.LOADING,"Changing password ...",0);
  this.clientFactory.getBackendService().changePassword(this.clientFactory.getLocalSession().getSession(),userId,oldPass,newPass,email,new AsyncCallback<Void>(){
    @Override public void onFailure(    Throwable caught){
      ActivityUtil.logoutForInvalidSession(clientFactory,caught);
      clientFactory.getShellView().getFooterView().showStatus(StatusType.ERROR,"Failed to change password",FooterView.DEFAULT_STATUS_CLEAR_DELAY);
      clientFactory.getShellView().getLogView().log(LogType.ERROR,"Failed to change password for user " + userId + ": "+ caught.getMessage());
      cancel(subject);
    }
    @Override public void onSuccess(    Void arg){
      clientFactory.getShellView().getFooterView().showStatus(StatusType.NONE,"Password changed",FooterView.DEFAULT_STATUS_CLEAR_DELAY);
      clientFactory.getShellView().getLogView().log(LogType.INFO,"Password changed for user " + userId);
      clientFactory.getSessionData().getLoginUser().setLoginAction(null);
      if (FIRST_TIME_SUBJECT.equals(subject) || PASSWORD_EXPIRED_SUBJECT.equals(subject)) {
        getSystemProperties();
      }
    }
  }
);
}
