{
  final Period defaultPeriod=Period.defaultPeriod();
  final String type=arguments.getArgument("type","instance");
  final String format=arguments.getArgument("format","html");
  final String start=arguments.getArgument("start",formatDate(defaultPeriod.getBeginningMs()));
  final String end=arguments.getArgument("end",formatDate(defaultPeriod.getEndingMs()));
  final String reportFilename=arguments.getArgument("file",null);
  long startTime=parseDate(start);
  long endTime=parseDate(end);
  if (endTime <= startTime) {
    throw new IllegalArgumentException("Invalid start or end time");
  }
  final String reportData;
  try {
    reportData=ReportGenerationFacade.generateReport(type,format,startTime,endTime);
  }
 catch (  ReportGenerationException e) {
    throw Exceptions.toUndeclared(e);
  }
  if (reportFilename != null) {
    try {
      Files.write(reportData,new File(reportFilename),Charsets.UTF_8);
    }
 catch (    IOException e) {
      throw Exceptions.toUndeclared(e);
    }
  }
 else {
    System.out.println(reportData);
  }
}
