{
  StringTokenizer stok=new StringTokenizer(receiptHandle,":");
  if (stok.countTokens() != 4) {
    throw new ReceiptHandleIsInvalidException("The input receipt handle \"" + receiptHandle + "\" is not a valid receipt handle.");
  }
  String receiptHandleAccountId=stok.nextToken();
  String receiptHandleQueueName=stok.nextToken();
  String messageId=stok.nextToken();
  int receiveCount=0;
  try {
    receiveCount=Integer.parseInt(stok.nextToken());
  }
 catch (  NumberFormatException e) {
    throw new ReceiptHandleIsInvalidException("The input receipt handle \"" + receiptHandle + "\" is not a valid receipt handle.");
  }
  if (!receiptHandleAccountId.equals(accountId) || !receiptHandleQueueName.equals(queueName)) {
    throw new ReceiptHandleIsInvalidException("The input receipt handle \"" + receiptHandle + "\" is not a valid for this queue.");
  }
  try (TransactionResource db=Entities.transactionFor(MessageEntity.class)){
    Criteria criteria=Entities.createCriteria(MessageEntity.class).add(Restrictions.eq("accountId",accountId)).add(Restrictions.eq("queueName",queueName)).add(Restrictions.eq("messageId",messageId)).add(Restrictions.eq("receiveCount",receiveCount));
    List<MessageEntity> messageEntityList=criteria.list();
    if (messageEntityList != null) {
      for (      MessageEntity messageEntity : messageEntityList) {
        Entities.delete(messageEntity);
      }
    }
    db.commit();
  }
 }
