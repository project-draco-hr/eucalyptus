{
  try {
    if (regionInfo.isPresent() && !RegionConfigurations.getRegionName().asSet().contains(regionInfo.get().getName())) {
      for (      final RegionInfo.RegionService service : regionInfo.get().getServices()) {
        if ("identity".equals(service.getType())) {
          final IdentityProvider remoteProvider=new RemoteIdentityProvider(service.getEndpoints());
          return invoker.apply(remoteProvider);
        }
      }
      return invoker.apply(localProvider);
    }
 else {
      return invoker.apply(localProvider);
    }
  }
 catch (  final RuntimeException e) {
    Exceptions.findAndRethrow(e,AuthException.class);
    throw e;
  }
}
