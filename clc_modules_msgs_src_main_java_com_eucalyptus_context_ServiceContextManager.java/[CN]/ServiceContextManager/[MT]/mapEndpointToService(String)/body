{
  assertThat(endpoint,notNullValue());
  if (singleton.canHasRead.tryLock(120,TimeUnit.SECONDS)) {
    try {
      String dest=endpoint;
      if ((endpoint.startsWith("vm://") && !singleton.endpointToService.containsKey(endpoint))) {
        throw new ServiceDispatchException("No such endpoint: " + endpoint + " in endpoints="+ singleton.endpointToService.entrySet());
      }
      if (endpoint.startsWith("vm://")) {
        dest=singleton.endpointToService.get(endpoint);
      }
      return dest;
    }
  finally {
      singleton.canHasRead.unlock();
    }
  }
  throw Exceptions.notFound("Failed to dispatch: " + endpoint);
}
