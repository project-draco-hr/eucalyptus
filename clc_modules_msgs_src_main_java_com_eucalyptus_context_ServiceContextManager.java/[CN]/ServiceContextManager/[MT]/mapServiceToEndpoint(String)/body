{
  if (singleton.canHasRead.tryLock(120,TimeUnit.SECONDS)) {
    try {
      String dest=service;
      if ((!service.startsWith("vm://") && !singleton.serviceToEndpoint.containsKey(service)) || (service == null)) {
        dest="vm://RequestQueue";
      }
 else       if (!service.startsWith("vm://")) {
        dest=singleton.serviceToEndpoint.get(dest);
      }
      return dest;
    }
  finally {
      singleton.canHasRead.unlock();
    }
  }
  throw Exceptions.notFound("Failed to dispatch: " + service);
}
