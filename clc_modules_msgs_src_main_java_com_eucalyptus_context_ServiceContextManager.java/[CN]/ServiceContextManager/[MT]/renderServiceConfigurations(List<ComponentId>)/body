{
  Set<ConfigResource> configs=Sets.newHashSet();
  for (  ComponentId thisComponent : components) {
    VelocityContext context=new VelocityContext();
    context.put("components",components);
    context.put("thisComponent",thisComponent);
    LOG.info("-> Rendering configuration for " + thisComponent.name());
    String templateName=thisComponent.getServiceModel();
    StringWriter out=new StringWriter();
    try {
      Velocity.evaluate(context,out,thisComponent.getServiceModelFileName(),thisComponent.getServiceModelAsReader());
      ConfigResource configRsc=new ConfigResource(thisComponent.getServiceModelFileName(),new ByteArrayInputStream(out.toString().getBytes()));
      configs.add(configRsc);
    }
 catch (    Throwable ex) {
      LOG.error("Failed to render service model configuration for: " + thisComponent + " because of: "+ ex.getMessage(),ex);
    }
  }
  return configs;
}
