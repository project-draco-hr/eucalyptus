{
  if (Internets.testLocal(updatedHost.getHostAddress())) {
    return Hosts.localHost();
  }
synchronized (Hosts.class) {
    List<Address> currentMembers=Lists.newArrayList(currentView.getMembers());
    Host entry=null;
    if (hostMap.containsKey(updatedHost.getGroupsId())) {
      entry=hostMap.get(updatedHost.getGroupsId());
      entry.update(currentView.getViewId(),updatedHost.hasDatabase(),updatedHost.hasBootstrapped(),updatedHost.getHostAddresses());
    }
 else {
      Component empyrean=Components.lookup(Empyrean.class);
      ComponentId empyreanId=empyrean.getComponentId();
      for (      InetAddress addr : updatedHost.getHostAddresses()) {
        ServiceConfiguration ephemeralConfig=ServiceConfigurations.createEphemeral(empyrean,addr);
        if (!empyrean.hasService(ephemeralConfig)) {
          try {
            ServiceConfiguration config=empyrean.initRemoteService(addr);
            empyrean.loadService(ephemeralConfig).get();
            entry=new Host(currentView.getViewId(),updatedHost.getGroupsId(),updatedHost.hasDatabase(),updatedHost.hasBootstrapped(),updatedHost.getHostAddresses(),config);
            Host temp=hostMap.putIfAbsent(entry.getGroupsId(),entry);
            entry=(temp != null) ? temp : entry;
            Mbeans.register(entry);
          }
 catch (          ServiceRegistrationException ex) {
            LOG.error(ex,ex);
          }
catch (          ExecutionException ex) {
            LOG.error(ex,ex);
          }
catch (          InterruptedException ex) {
            Thread.currentThread().interrupt();
            LOG.error(ex,ex);
          }
        }
      }
    }
    Logs.exhaust().debug("Current host entries: ");
    for (    Host host : hostMap.values()) {
      Logs.exhaust().debug("-> " + host);
    }
    return entry;
  }
}
