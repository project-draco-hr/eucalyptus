{
  InstanceUsageLog usageLog=InstanceUsageLog.getInstanceUsageLog();
  Map<String,Map<String,InstanceUsageSummary>> summaryMap=usageLog.scanSummarize(period,groupBy,criterion);
  List items=new ArrayList(summaryMap.size());
  for (  String outerKey : summaryMap.keySet()) {
    Map<String,InstanceUsageSummary> innerMap=summaryMap.get(outerKey);
    for (    String innerKey : innerMap.keySet()) {
      items.add(new InstanceReportLine(innerKey,outerKey,innerMap.get(innerKey)));
    }
  }
  generateReport(new File(baseDir,INSTANCE_REPORT_FILENAME),format,groupBy.toString(),criterion.toString(),items,dest);
}
