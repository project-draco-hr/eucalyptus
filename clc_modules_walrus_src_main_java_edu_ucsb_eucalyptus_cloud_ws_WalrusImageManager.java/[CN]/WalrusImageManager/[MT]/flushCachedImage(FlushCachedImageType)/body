{
  FlushCachedImageResponseType reply=(FlushCachedImageResponseType)request.getReply();
  String bucketName=request.getBucket();
  String manifestKey=request.getKey();
  EntityWrapper<ImageCacheInfo> db=WalrusControl.getEntityWrapper();
  ImageCacheInfo searchImageCacheInfo=new ImageCacheInfo(bucketName,manifestKey);
  List<ImageCacheInfo> foundImageCacheInfos=db.query(searchImageCacheInfo);
  if (foundImageCacheInfos.size() > 0) {
    ImageCacheInfo foundImageCacheInfo=foundImageCacheInfos.get(0);
    if (foundImageCacheInfo.getInCache() && (imageCachers.get(bucketName + manifestKey) == null)) {
      db.commit();
      ImageCacheFlusher imageCacheFlusher=new ImageCacheFlusher(bucketName,manifestKey);
      imageCacheFlusher.start();
    }
 else {
      db.rollback();
      throw new EucalyptusCloudException("not in cache");
    }
  }
 else {
    db.rollback();
    throw new NoSuchEntityException(bucketName + manifestKey);
  }
  return reply;
}
