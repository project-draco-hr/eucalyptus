{
  if (Logs.EXTREME) {
    Logs.extreme().debug(Joiner.on(":").join(EventType.PERSISTENCE,DbEvent.UNIQUE.begin(),this.tx.getTxUuid()));
  }
  try {
    Object id=null;
    try {
      id=this.getEntityManager().getEntityManagerFactory().getPersistenceUnitUtil().getIdentifier(example);
    }
 catch (    Exception ex) {
    }
    if (id != null) {
      TYPE res=(TYPE)this.getEntityManager().find(example.getClass(),id);
      if (res == null) {
        throw new NoSuchElementException("@Id: " + id);
      }
 else {
        return res;
      }
    }
 else     if (example instanceof HasNaturalId && ((HasNaturalId)example).getNaturalId() != null) {
      String natId=((HasNaturalId)example).getNaturalId();
      TYPE ret=(TYPE)this.createCriteria(example.getClass()).add(Restrictions.naturalId().set("naturalId",natId)).setCacheable(true).setMaxResults(1).setFetchSize(1).uniqueResult();
      if (ret == null) {
        throw new NoSuchElementException("@NaturalId: " + natId);
      }
      return ret;
    }
 else {
      TYPE ret=(TYPE)this.createCriteria(example.getClass()).add(Example.create(example).enableLike(MatchMode.EXACT)).setCacheable(true).setMaxResults(1).setFetchSize(1).uniqueResult();
      if (ret == null) {
        throw new NoSuchElementException("example: " + LogUtil.dumpObject(example));
      }
      return ret;
    }
  }
 catch (  NonUniqueResultException ex) {
    throw new EucalyptusCloudException("Get unique failed for " + example.getClass().getSimpleName() + " because "+ ex.getMessage(),ex);
  }
catch (  NoSuchElementException ex) {
    throw new EucalyptusCloudException("Get unique failed for " + example.getClass().getSimpleName() + " using "+ ex.getMessage(),ex);
  }
catch (  Exception ex) {
    RecoverablePersistenceException newEx=PersistenceErrorFilter.exceptionCaught(ex);
    throw new EucalyptusCloudException("Get unique failed for " + example.getClass().getSimpleName() + " because "+ newEx.getMessage(),newEx);
  }
}
