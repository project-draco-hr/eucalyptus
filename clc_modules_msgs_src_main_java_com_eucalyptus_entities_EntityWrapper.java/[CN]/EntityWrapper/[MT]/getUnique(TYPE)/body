{
  if (Logs.EXTREME) {
    Logs.extreme().debug(Joiner.on(":").join(EventType.PERSISTENCE,DbEvent.UNIQUE.begin(),this.tx.getTxUuid()));
  }
  Object id=null;
  try {
    id=this.getEntityManager().getEntityManagerFactory().getPersistenceUnitUtil().getIdentifier(example);
  }
 catch (  Exception ex) {
  }
  if (id != null) {
    TYPE res=(TYPE)this.getEntityManager().find(example.getClass(),id);
    if (res == null) {
      throw new EucalyptusCloudException("Get unique failed (returning 0 results for " + LogUtil.dumpObject(example));
    }
 else {
      return res;
    }
  }
 else   if (example instanceof HasNaturalId && ((HasNaturalId)example).getNaturalId() != null) {
    TYPE ret=(TYPE)this.createCriteria(example.getClass()).add(Restrictions.naturalId().set("naturalId",((HasNaturalId)example).getNaturalId())).setCacheable(true).uniqueResult();
    return ret;
  }
 else {
    List<TYPE> res=this.query(example);
    if (res.size() != 1) {
      throw new EucalyptusCloudException("Get unique failed (returning " + res.size() + " results for "+ LogUtil.dumpObject(example));
    }
    return res.get(0);
  }
}
