{
  if (LogLevels.EXTREME)   LOG.debug(Joiner.on(":").join(EventType.PERSISTENCE,DbEvent.UNIQUE.begin(),this.tx.getTxUuid()));
  Object id=null;
  try {
    id=this.getEntityManager().getEntityManagerFactory().getPersistenceUnitUtil().getIdentifier(example);
  }
 catch (  Exception ex) {
  }
  if (id != null) {
    return (TYPE)this.getEntityManager().find(example.getClass(),id);
  }
 else {
    List<TYPE> res=this.query(example);
    if (res.size() != 1) {
      String msg=null;
      try {
        msg=LogUtil.dumpObject(example);
      }
 catch (      Exception e) {
        msg=example.toString();
      }
      throw new EucalyptusCloudException("Get unique failed (returning " + res.size() + " results for "+ msg);
    }
    return res.get(0);
  }
}
