{
  for (Class c=type; c != Object.class; c=c.getSuperclass()) {
    if (c.isAnnotationPresent(PersistenceContext.class)) {
      return new EntityWrapper<T>(((PersistenceContext)c.getAnnotation(PersistenceContext.class)).name());
    }
  }
  throw new RuntimeException("Attempting to create an entity wrapper instance for non persistent type: " + type.getCanonicalName());
}
