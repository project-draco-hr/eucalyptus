{
  boolean hasEm=this.em != null && this.em.isOpen();
  boolean hasSession=this.session.get() != null && this.session.get().isOpen();
  boolean hasTx=this.transaction != null && this.transaction.isActive();
  if (hasEm && hasSession && hasTx) {
    return true;
  }
 else {
    this.cleanup();
    return false;
  }
}
