{
  this.eventLog(TxState.BEGIN,TxEvent.COMMIT);
  try {
    this.verifyOpen();
  }
 catch (  final RuntimeException ex) {
    this.rollback();
    this.eventLog(TxState.FAIL,TxEvent.COMMIT);
    PersistenceExceptions.throwFiltered(ex);
    throw ex;
  }
  if (this.guard.apply(TxUnroll.SAFELY))   try {
    this.transaction.commit();
    this.eventLog(TxState.END,TxEvent.COMMIT);
  }
 catch (  final RuntimeException e) {
    this.rollback();
    this.eventLog(TxState.FAIL,TxEvent.COMMIT);
    PersistenceExceptions.throwFiltered(e);
    throw e;
  }
 finally {
    this.cleanup();
  }
}
