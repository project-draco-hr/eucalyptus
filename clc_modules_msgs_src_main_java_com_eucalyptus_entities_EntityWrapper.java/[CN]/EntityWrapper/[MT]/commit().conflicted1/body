{
  this.eventLog(TxState.BEGIN,TxEvent.COMMIT);
  try {
    this.verifyOpen();
  }
 catch (  RuntimeException ex) {
    this.cleanup();
    this.eventLog(TxState.FAIL,TxEvent.COMMIT);
    PersistenceExceptions.throwFiltered(ex);
    throw ex;
  }
  try {
    this.transaction.commit();
    this.eventLog(TxState.END,TxEvent.COMMIT);
  }
 catch (  final RuntimeException e) {
    if ((this.transaction != null) && this.transaction.isActive()) {
      this.transaction.rollback();
      LOG.debug(e,e);
    }
    this.eventLog(TxState.FAIL,TxEvent.COMMIT);
    PersistenceExceptions.throwFiltered(e);
    throw e;
  }
 finally {
    this.cleanup();
  }
}
