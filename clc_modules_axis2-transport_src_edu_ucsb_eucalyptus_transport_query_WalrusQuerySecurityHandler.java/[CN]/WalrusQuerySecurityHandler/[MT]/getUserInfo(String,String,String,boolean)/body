{
  signature=signature.replaceAll("=","");
  String queryKey=findQueryKey(accessKeyID);
  String authSig=checkSignature(queryKey,data);
  if (decode) {
    try {
      authSig=URLDecoder.decode(authSig,"UTF-8");
    }
 catch (    Exception ex) {
      throw new QuerySecurityException(ex.getMessage());
    }
  }
  if (!authSig.equals(signature))   throw new QuerySecurityException("User authentication failed. Could not verify signature");
  return findUserId(accessKeyID);
}
