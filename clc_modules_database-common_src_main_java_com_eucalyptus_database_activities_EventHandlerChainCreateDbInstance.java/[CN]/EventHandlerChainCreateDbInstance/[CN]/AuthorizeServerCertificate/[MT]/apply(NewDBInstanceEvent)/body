{
  final String userId=evt.getUserId();
  final String systemUserId=getSystemUserId();
  String acctNumber=null;
  try {
    acctNumber=Accounts.lookupUserById(userId).getAccountNumber();
  }
 catch (  final AuthException ex) {
    throw new EventHandlerException("Failed to lookup account number",ex);
  }
  String certName=null;
  String certArn=null;
  try {
    roleName=this.getChain().findHandler(IamRoleSetup.class).getResult().get(0);
  }
 catch (  final Exception ex) {
    throw new EventHandlerException("failed to find the created role name",ex);
  }
  try {
    certName=this.getChain().findHandler(UploadServerCertificate.class).getResult().get(0);
  }
 catch (  final Exception ex) {
    throw new EventHandlerException("failed to find the uploaded cert name",ex);
  }
  try {
    final ServerCertificateType cert=EuareClient.getInstance().getServerCertificate(systemUserId,certName);
    certArn=cert.getServerCertificateMetadata().getArn();
  }
 catch (  final Exception ex) {
    throw new EventHandlerException("failed to lookup server certificate",ex);
  }
  final String policyName=String.format("%s-%s-%s",SERVER_CERT_ROLE_POLICY_NAME_PREFIX,acctNumber,evt.getDbInstanceIdentifier());
  final String rolePolicyDoc=ROLE_SERVER_CERT_POLICY_DOCUMENT.replace("CERT_ARN_PLACEHOLDER",certArn);
  try {
    final GetRolePolicyResult rolePolicy=EuareClient.getInstance().getRolePolicy(systemUserId,roleName,policyName);
    if (rolePolicy != null && policyName.equals(rolePolicy.getPolicyName()))     this.createdPolicyName=policyName;
  }
 catch (  final Exception ex) {
    ;
  }
  if (this.createdPolicyName == null) {
    try {
      EuareClient.getInstance().putRolePolicy(systemUserId,roleName,policyName,rolePolicyDoc);
      createdPolicyName=policyName;
    }
 catch (    final Exception ex) {
      throw new EventHandlerException("failed to authorize server certificate",ex);
    }
  }
}
