{
  LOG.info("Testing object listing");
  int entityCount=10;
  ObjectEntity testEntity=null;
  String key="objectkey";
  Bucket bucket=new Bucket("testbucket_" + UUID.randomUUID().toString().replace("-",""));
  ArrayList<ObjectEntity> testEntities=new ArrayList<ObjectEntity>(entityCount);
  final boolean useVersioning=false;
  CallableWithRollback<PutObjectResponseType,Boolean> fakeModifier=new CallableWithRollback<PutObjectResponseType,Boolean>(){
    @Override public PutObjectResponseType call() throws S3Exception, Exception {
      return getFakeSuccessfulPUTResponse(useVersioning);
    }
    @Override public Boolean rollback(    PutObjectResponseType arg) throws S3Exception, Exception {
      return true;
    }
  }
;
  try {
    for (int i=0; i < entityCount; i++) {
      testEntity=generateFakeValidEntity(bucket.getBucketName(),key + String.valueOf(i),false);
      testEntities.add(testEntity);
      ObjectManagers.getInstance().create(bucket,testEntity,fakeModifier);
    }
    PaginatedResult<ObjectEntity> r=ObjectManagers.getInstance().listPaginated(bucket,100,null,null,null);
    for (    ObjectEntity e : r.getEntityList()) {
      System.out.println(e.toString());
    }
    Assert.assertTrue(r.getEntityList().size() == entityCount);
  }
 catch (  Exception e) {
    LOG.error("Transaction error",e);
    Assert.fail("Failed getting listing");
  }
 finally {
    for (    ObjectEntity obj : testEntities) {
      try {
        ObjectManagers.getInstance().delete(bucket,obj,null);
      }
 catch (      Exception e) {
        LOG.error("Error deleteing entity: " + obj.toString(),e);
      }
    }
  }
}
