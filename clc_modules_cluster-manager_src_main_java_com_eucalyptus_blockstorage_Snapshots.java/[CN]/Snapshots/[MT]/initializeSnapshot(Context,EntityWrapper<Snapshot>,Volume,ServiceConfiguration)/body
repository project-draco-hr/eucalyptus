{
  String newId=null;
  Snapshot snap=null;
  while (true) {
    newId=Crypto.generateId(ctx.getUserFullName().getUniqueId(),SnapshotManager.ID_PREFIX);
    try {
      db.getUnique(Snapshot.named(newId));
    }
 catch (    EucalyptusCloudException e) {
      snap=new Snapshot(ctx.getUserFullName(),newId,vol.getDisplayName(),sc.getName(),sc.getPartition());
      snap.setVolumeSize(vol.getSize());
      db.add(snap);
      break;
    }
  }
  return snap;
}
