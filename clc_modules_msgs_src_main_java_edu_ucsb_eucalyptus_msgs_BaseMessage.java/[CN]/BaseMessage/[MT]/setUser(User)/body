{
  if (user == null) {
    this.setUser(FakePrincipals.nobodyUser());
  }
 else {
    this.userId=user.getName();
    this.effectiveUserId=(user.isSystemAdmin() || user.isSystemInternal()) ? FakePrincipals.systemUser().getName() : user.getName();
  }
  return this;
}
