{
  if (EucalyptusProperties.disableNetworking) {
    return;
  }
 else   if (addresses.size() < runningVms.size()) {
    LOG.error("Number of running VMs is greater than number of assigned addresses!");
  }
 else {
    AddressUtil.updateAddressingMode();
    for (    VmInfo vm : runningVms) {
      String addr=addresses.remove(0);
      try {
        VmInstance realVm=VmInstances.getInstance().lookup(vm.getInstanceId());
        Address address=Addresses.getInstance().lookup(addr);
        String vmIp=realVm.getNetworkConfig().getIpAddress();
        String vmId=realVm.getInstanceId();
        address.setInstanceId(vmId);
        address.setInstanceAddress(vmIp);
        LOG.debug(EventRecord.caller(address.getClass(),State.ASSIGN_ADDRESSES,address.toString(),vmIp,vmId));
        AddressUtil.dispatchAssignAddress(address,realVm);
      }
 catch (      Exception e) {
        LOG.error(e,e);
      }
    }
  }
  for (  String addr : addresses) {
    AddressUtil.releaseAddress(addr);
    LOG.warn("Released unused public address: " + addr);
  }
}
