{
  if (EucalyptusProperties.disableNetworking) {
    return;
  }
 else   if (addresses.size() < runningVms.size()) {
    LOG.error("Number of running VMs is greater than number of assigned addresses!");
  }
 else {
    AddressUtil.updateAddressingMode();
    for (    VmInfo vm : runningVms) {
      String addr=addresses.remove(0);
      try {
        VmInstance realVm=VmInstances.getInstance().lookup(vm.getInstanceId());
        Address address=Addresses.getInstance().lookup(addr);
        address.setInstanceId(realVm.getInstanceId());
        address.setInstanceAddress(realVm.getNetworkConfig().getIpAddress());
        AddressUtil.dispatchAssignAddress(address,realVm);
      }
 catch (      Exception e) {
        LOG.error(e,e);
      }
    }
  }
  for (  String addr : addresses) {
    try {
      new AddressManager().ReleaseAddress(Admin.makeMsg(ReleaseAddressType.class,addr));
      LOG.warn("Released unused public address: " + addr);
    }
 catch (    EucalyptusCloudException e) {
    }
  }
}
