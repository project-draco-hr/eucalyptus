{
  final Object o=event.getMessage();
  if (o instanceof MappingHttpRequest) {
    final MappingHttpMessage httpRequest=(MappingHttpMessage)o;
    final SOAPEnvelope envelope=httpRequest.getSoapEnvelope();
    final Element secNode=WSSecurity.getSecurityElement(envelope);
    final XMLSignature sig=WSSecurity.getXMLSignature(secNode);
    SecurityContext.enqueueSignature(sig.getTextFromTextChild());
    final X509Certificate cert=WSSecurity.verifySignature(secNode,sig);
    if (cert != null) {
      if (!cert.equals(SystemCredentialProvider.getCredentialProvider(Component.eucalyptus).getCertificate())) {
        throw new WSSecurityException(WSSecurityException.FAILED_AUTHENTICATION);
      }
    }
    Contexts.lookup(((MappingHttpMessage)o).getCorrelationId()).setUser(Users.lookupSystemAdmin());
  }
}
