{
  try {
    final MuleMessage reply=this.msgReceiver.routeMessage(new DefaultMuleMessage(msg),true);
    if (reply != null) {
      ReplyQueue.handle(this.msgReceiver.getService().getName(),reply,msg);
    }
 else {
      Contexts.lookup(msg.getCorrelationId()).clear();
      ctx.getChannel().write(new MappingHttpResponse(request.getProtocolVersion(),HttpResponseStatus.INTERNAL_SERVER_ERROR)).addListener(ChannelFutureListener.CLOSE);
    }
  }
 catch (  Exception e1) {
    LOG.error(e1,e1);
    EucalyptusErrorMessageType errMsg=new EucalyptusErrorMessageType(this.msgReceiver.getService().getName(),msg,(e1.getCause() != null ? e1.getCause() : e1).getMessage());
    errMsg.setCorrelationId(msg.getCorrelationId());
    errMsg.setException(e1.getCause() != null ? e1.getCause() : e1);
    Contexts.lookup(errMsg.getCorrelationId()).clear();
    Channels.write(ctx.getChannel(),errMsg);
  }
}
