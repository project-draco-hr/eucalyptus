{
  if (e instanceof MessageEvent) {
    MessageEvent msge=(MessageEvent)e;
    if (msge.getMessage() instanceof NullPayload) {
      return;
    }
    if (msge.getMessage() instanceof IsData) {
      ctx.sendDownstream(msge);
    }
 else     if (msge.getMessage() instanceof EucalyptusMessage) {
      MappingHttpMessage request=requestLocal.get(ctx.getChannel());
      EucalyptusMessage reply=(EucalyptusMessage)((MessageEvent)e).getMessage();
      if (reply == null) {
        LOG.warn("Received a null response for request: " + request.getMessageString());
        reply=new EucalyptusErrorMessageType(this.getClass().getSimpleName(),(EucalyptusMessage)request.getMessage(),"Received a NULL reply");
      }
      LOG.info(EventRecord.create(this.getClass().getSimpleName(),reply.getUserId(),reply.getCorrelationId(),EventType.MSG_SERVICED,(System.currentTimeMillis() - startTime)));
      if (reply instanceof WalrusDataGetResponseType) {
        if (reply instanceof GetObjectResponseType) {
          GetObjectResponseType getObjectResponse=(GetObjectResponseType)reply;
          LOG.debug(getObjectResponse);
          if (getObjectResponse.getBase64Data() == null)           return;
        }
 else {
          return;
        }
      }
      MappingHttpResponse response=new MappingHttpResponse(request.getProtocolVersion());
      DownstreamMessageEvent newEvent=new DownstreamMessageEvent(ctx.getChannel(),e.getFuture(),response,null);
      response.setMessage(reply);
      ctx.sendDownstream(newEvent);
    }
 else     if (msge.getMessage() instanceof String) {
      ctx.sendDownstream(e);
    }
 else {
      LOG.debug("Non-specific type being written to the channel. Not dropping this message causes breakage.");
    }
  }
 else {
    ctx.sendDownstream(e);
  }
}
