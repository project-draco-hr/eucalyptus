{
  if (e instanceof MessageEvent) {
    final MessageEvent msge=(MessageEvent)e;
    if (msge.getMessage() instanceof NullPayload) {
      return;
    }
    if (msge.getMessage() instanceof IsData) {
      ctx.sendDownstream(msge);
    }
 else     if (msge.getMessage() instanceof EucalyptusMessage) {
      final MappingHttpMessage request=this.requestLocal.get(ctx.getChannel());
      EucalyptusMessage reply=(EucalyptusMessage)((MessageEvent)e).getMessage();
      if (reply == null) {
        ServiceSinkHandler.LOG.warn("Received a null response for request: " + request.getMessageString());
        reply=new EucalyptusErrorMessageType(this.getClass().getSimpleName(),(EucalyptusMessage)request.getMessage(),"Received a NULL reply");
      }
      ServiceSinkHandler.LOG.info(EventRecord.create(this.getClass().getSimpleName(),reply.getUserId(),reply.getCorrelationId(),EventType.MSG_SERVICED,(System.currentTimeMillis() - this.startTime)));
      if (reply instanceof WalrusDataGetResponseType) {
        if (reply instanceof GetObjectResponseType) {
          final GetObjectResponseType getObjectResponse=(GetObjectResponseType)reply;
          ServiceSinkHandler.LOG.debug(getObjectResponse);
          if (getObjectResponse.getBase64Data() == null) {
            return;
          }
        }
 else {
          return;
        }
      }
      final MappingHttpResponse response=new MappingHttpResponse(request.getProtocolVersion());
      final DownstreamMessageEvent newEvent=new DownstreamMessageEvent(ctx.getChannel(),e.getFuture(),response,null);
      response.setMessage(reply);
      ctx.sendDownstream(newEvent);
    }
 else     if (msge.getMessage() instanceof HttpResponse) {
      ctx.sendDownstream(e);
    }
 else {
      ServiceSinkHandler.LOG.debug("Non-specific type being written to the channel. Not dropping this message causes breakage.");
    }
  }
 else {
    ctx.sendDownstream(e);
  }
}
