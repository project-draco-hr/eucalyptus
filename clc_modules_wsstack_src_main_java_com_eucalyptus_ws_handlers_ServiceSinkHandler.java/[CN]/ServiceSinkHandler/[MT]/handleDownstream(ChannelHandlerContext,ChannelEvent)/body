{
  if (e instanceof MessageEvent) {
    MessageEvent msge=(MessageEvent)e;
    if (msge.getMessage() instanceof IsData) {
      ctx.sendDownstream(msge);
    }
 else     if (msge.getMessage() instanceof EucalyptusMessage) {
      MappingHttpMessage request=requestLocal.get(ctx.getChannel());
      EucalyptusMessage reply=(EucalyptusMessage)((MessageEvent)e).getMessage();
      if (reply == null) {
        LOG.warn("Received a null response for request: " + request.getMessageString());
        reply=new EucalyptusErrorMessageType(this.getClass().getSimpleName(),(EucalyptusMessage)request.getMessage(),"Received a NULL reply");
      }
      LOG.info(EventRecord.create(this.getClass().getSimpleName(),reply.getUserId(),reply.getCorrelationId(),EventType.MSG_SERVICED,(System.currentTimeMillis() - startTime)));
      if (reply instanceof WalrusDataGetResponseType) {
        if (reply instanceof GetObjectResponseType) {
          GetObjectResponseType getObjectResponse=(GetObjectResponseType)reply;
          if (getObjectResponse.getBase64Data() == null)           return;
        }
 else {
          return;
        }
      }
      MappingHttpResponse response=new MappingHttpResponse(request.getProtocolVersion());
      DownstreamMessageEvent newEvent=new DownstreamMessageEvent(ctx.getChannel(),e.getFuture(),response,null);
      response.setMessage(reply);
      newEvent.getFuture().addListener(ChannelFutureListener.CLOSE);
      ctx.sendDownstream(newEvent);
    }
 else {
      LOG.warn("Closing channel due to unknown message event type!!!");
      ctx.getChannel().close();
    }
  }
}
