{
  Registry registry=MuleServer.getMuleContext().getRegistry();
  Messaging.dispatch("vm://RequestQueue",msg);
  LOG.warn("Message dispatched");
  EucalyptusMessage reply=ReplyQueue.getReply(msg.getCorrelationId());
  LOG.warn("Reply received");
  LOG.info(EventRecord.create(this.getClass().getSimpleName(),msg.getUserId(),msg.getCorrelationId(),EventType.MSG_SERVICED,(System.currentTimeMillis() - startTime)));
  if (reply == null) {
    reply=new EucalyptusErrorMessageType(this.getClass().getSimpleName(),msg,"Received a NULL reply");
  }
  MappingHttpResponse response=new MappingHttpResponse(message.getProtocolVersion());
  response.setMessage(reply);
  if (!(reply instanceof WalrusDataGetResponseType))   Channels.write(ctx.getChannel(),response);
}
