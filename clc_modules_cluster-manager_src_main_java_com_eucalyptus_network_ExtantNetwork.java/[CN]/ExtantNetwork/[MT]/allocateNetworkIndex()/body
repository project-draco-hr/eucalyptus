{
  EntityTransaction db=Entities.get(ExtantNetwork.class);
  SetReference<PrivateNetworkIndex,VmInstance> ref=null;
  if (this.getIndexes().isEmpty()) {
    this.initNetworkIndexes();
  }
  for (  PrivateNetworkIndex idx : Iterables.filter(this.getIndexes(),PrivateNetworkIndex.filterFree())) {
    try {
      ref=idx.allocate();
      break;
    }
 catch (    Exception ex1) {
      continue;
    }
  }
  if (ref != null) {
    Entities.merge(this);
    db.commit();
    return ref;
  }
 else {
    db.rollback();
    throw new TransactionExecutionException("Failed to allocate a private network index in network: " + this.displayName);
  }
}
