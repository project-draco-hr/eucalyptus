{
  if (!NetworkGroups.networkingConfiguration().hasNetworking()) {
    return PrivateNetworkIndex.bogus().allocate();
  }
 else   if (!Entities.isPersistent(this)) {
    throw new TransientEntityException(this.toString());
  }
 else {
    EntityTransaction db=Entities.get(ExtantNetwork.class);
    SetReference<PrivateNetworkIndex,VmInstance> ref=null;
    try {
      PrivateNetworkIndex netIdx=null;
      for (      Long i : Numbers.shuffled(NetworkGroups.networkIndexInterval())) {
        try {
          Entities.uniqueResult(PrivateNetworkIndex.create(this,i));
          continue;
        }
 catch (        Exception ex) {
          try {
            netIdx=PrivateNetworkIndex.create(this,i);
            this.getIndexes().add(netIdx);
            break;
          }
 catch (          Exception ex1) {
            continue;
          }
        }
      }
      if (netIdx != null) {
        return netIdx.allocate();
      }
 else {
        throw new TransactionExecutionException("Failed to allocate a private network index in network: " + this.displayName);
      }
    }
 catch (    TransactionException ex) {
      throw ex;
    }
catch (    Exception ex) {
      throw new TransactionExecutionException("Failed to allocate a private network index in network: " + this.displayName,ex);
    }
  }
}
