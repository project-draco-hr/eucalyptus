{
  if (!NetworkGroups.networkingConfiguration().hasNetworking()) {
    try {
      return PrivateNetworkIndex.bogus().allocate();
    }
 catch (    final ResourceAllocationException ex) {
      throw new RuntimeException("BUG BUG BUG: failed to call PrivateNetworkIndex.allocate() on the .bogus() index.");
    }
  }
 else   if (!Entities.isPersistent(this)) {
    throw new TransientEntityException(this.toString());
  }
 else {
    try {
      return Entities.uniqueResult(PrivateNetworkIndex.named(this,idx));
    }
 catch (    final Exception ex) {
      return Entities.persist(PrivateNetworkIndex.create(this,idx)).allocate();
    }
  }
}
