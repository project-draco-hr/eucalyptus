{
  ClusterState.trim();
  try {
    Network network=Networks.getInstance().lookup(networkName);
    Integer vlan=network.getVlan();
    if (vlan == null) {
      vlan=ClusterState.availableVlans.pollFirst();
      network.setVlan(vlan);
      if (vlan == null)       throw new NotEnoughResourcesAvailable("Not enough resources available: vlan tags");
    }
    NetworkToken token=network.getClusterToken(clusterName);
    LOG.debug(String.format(EucalyptusProperties.DEBUG_FSTRING,EucalyptusProperties.TokenState.preallocate,token));
    return token;
  }
 catch (  NoSuchElementException e) {
    LOG.debug(e,e);
    throw new NotEnoughResourcesAvailable("Failed to create registry entry for network named: " + networkName);
  }
}
