{
  if (user == null) {
    throw new SerializableException("Invalid RPC arguments");
  }
  if (user.getUserName().equalsIgnoreCase("eucalyptus")) {
    throw new SerializableException("User 'eucalyptus' is not allowed");
  }
  if (user.getUserName().matches(".*[^\\w\\-\\.@]+.*")) {
    throw new SerializableException("Invalid characters in the username");
  }
  if (user.getUserName().length() < 1 || user.getUserName().length() > 30) {
    throw new SerializableException("Invalid length of username");
  }
  load_props();
  boolean admin=false;
  try {
    SessionInfo session=verifySession(sessionId);
    UserInfoWeb requestingUser=verifyUser(session,session.getUserId(),session.getAccountId(),true);
    if (!requestingUser.isAdministrator().booleanValue()) {
      user.setAdministrator(false);
      throw new SerializableException("Administrative privileges required");
    }
 else {
      admin=true;
    }
  }
 catch (  Exception e) {
  }
  long now=System.currentTimeMillis();
  user.setPasswordExpires(new Long(now + pass_expiration_ms));
  user.setConfirmationCode(Crypto.generateSessionToken(user.getUserName()));
  EucalyptusManagement.addWebUser(user);
  String response;
  if (admin) {
    user.setApproved(true);
    user.setEnabled(true);
    response=notifyUserApproved(user);
  }
 else {
    user.setApproved(false);
    user.setEnabled(false);
    notifyAdminOfSignup(user);
    response=thanks_for_signup;
  }
  EucalyptusManagement.commitWebUser(user);
  return response;
}
