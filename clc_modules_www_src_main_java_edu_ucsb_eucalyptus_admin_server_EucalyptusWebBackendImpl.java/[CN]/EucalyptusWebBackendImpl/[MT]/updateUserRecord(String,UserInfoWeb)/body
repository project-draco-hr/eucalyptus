{
  SessionInfo session=verifySession(sessionId);
  UserInfoWeb callerRecord=verifyUser(session,session.getUserId(),true);
  String userName=newRecord.getUserName();
  UserInfoWeb oldRecord;
  try {
    oldRecord=EucalyptusManagement.getWebUser(userName);
  }
 catch (  Exception e) {
    throw new SerializableException("Username '" + userName + "' not found");
  }
  if (!callerRecord.isAdministrator() && !callerRecord.getUserName().equals(userName)) {
    throw new SerializableException("Operation restricted to owner and administrator");
  }
  if (callerRecord.isAdministrator()) {
    if (oldRecord.getEmail().equalsIgnoreCase(UserInfo.BOGUS_ENTRY)) {
      long now=System.currentTimeMillis();
      oldRecord.setPasswordExpires(new Long(now + pass_expiration_ms));
      oldRecord.setPassword(newRecord.getPassword());
    }
    if (!callerRecord.getUserName().equals(userName))     oldRecord.setPassword(newRecord.getPassword());
    if (oldRecord.isAdministrator() != newRecord.isAdministrator())     oldRecord.setAdministrator(newRecord.isAdministrator());
    if (oldRecord.isEnabled() != newRecord.isEnabled())     oldRecord.setEnabled(newRecord.isEnabled());
    if (!oldRecord.isConfirmed() && newRecord.isConfirmed()) {
      oldRecord.setConfirmed(true);
      oldRecord.setEnabled(true);
      oldRecord.setApproved(true);
    }
  }
  oldRecord.setRealName(newRecord.getRealName());
  oldRecord.setEmail(newRecord.getEmail());
  oldRecord.setTelephoneNumber(newRecord.getTelephoneNumber());
  oldRecord.setAffiliation(newRecord.getAffiliation());
  oldRecord.setProjectDescription(newRecord.getProjectDescription());
  oldRecord.setProjectPIName(newRecord.getProjectPIName());
  EucalyptusManagement.commitWebUser(oldRecord);
  return "Account of user '" + userName + "' was updated";
}
