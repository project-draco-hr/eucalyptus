{
  SessionInfo session=verifySession(sessionId);
  UserInfoWeb callerRecord=verifyUser(session,session.getUserId(),true);
  String userName=newRecord.getUserName();
  UserInfoWeb oldRecord;
  try {
    oldRecord=EucalyptusManagement.getWebUser(userName);
  }
 catch (  Exception e) {
    throw new SerializableException("Username '" + userName + "' not found");
  }
  if (!callerRecord.isAdministrator() && !callerRecord.getUserName().equals(userName)) {
    throw new SerializableException("Operation restricted to owner and administrator");
  }
  if (oldRecord.isAdministrator() && oldRecord.getEmail().equalsIgnoreCase(UserInfo.BOGUS_ENTRY)) {
    long now=System.currentTimeMillis();
    oldRecord.setPasswordExpires(new Long(now + pass_expiration_ms));
  }
  oldRecord.setRealName(newRecord.getRealName());
  oldRecord.setEmail(newRecord.getEmail());
  oldRecord.setPassword(newRecord.getPassword());
  oldRecord.setTelephoneNumber(newRecord.getTelephoneNumber());
  oldRecord.setAffiliation(newRecord.getAffiliation());
  oldRecord.setProjectDescription(newRecord.getProjectDescription());
  oldRecord.setProjectPIName(newRecord.getProjectPIName());
  oldRecord.setAdministrator(newRecord.isAdministrator());
  oldRecord.setEnabled(newRecord.isEnabled());
  if (!oldRecord.isConfirmed() && newRecord.isConfirmed()) {
    oldRecord.setConfirmed(true);
    oldRecord.setEnabled(true);
    oldRecord.setApproved(true);
  }
  EucalyptusManagement.commitWebUser(oldRecord);
  return "Account of user '" + userName + "' was updated";
}
