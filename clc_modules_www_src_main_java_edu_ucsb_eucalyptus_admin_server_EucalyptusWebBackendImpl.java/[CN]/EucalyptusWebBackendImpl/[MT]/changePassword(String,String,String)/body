{
  SessionInfo session=verifySession(sessionId);
  UserInfoWeb user=verifyUser(session,session.getUserId(),session.getAccountId(),false);
  LOG.debug("Input: old=" + oldPassword + ", new="+ newPassword);
  LOG.debug("Database: " + user.getPassword());
  if (!isPasswordExpired((UserInfoWeb)user)) {
    if (!Crypto.generateHashedPassword(oldPassword).equals(user.getPassword())) {
      throw new SerializableException("Old password is incorrect");
    }
  }
  user.setPassword(Crypto.generateHashedPassword(newPassword));
  final long now=System.currentTimeMillis();
  user.setPasswordExpires(new Long(now + pass_expiration_ms));
  EucalyptusManagement.commitWebUser(user);
  return "Password has been changed";
}
