{
  if (web_user == null) {
    throw new SerializableException("Invalid RPC arguments");
  }
  String response;
  if (web_user.getPassword() == null) {
    try {
      UserInfoWeb db_user=EucalyptusManagement.getWebUser(web_user.getUserName(),web_user.getAccountName());
      if (!db_user.isConfirmed() || !db_user.isEnabled()) {
        throw new SerializableException("Illegal request");
      }
      if (db_user.getEmail().equalsIgnoreCase(web_user.getEmail())) {
        long expires=System.currentTimeMillis() + recovery_expiration_ms;
        db_user.setConfirmationCode(String.format("%015d",expires) + Crypto.generateSessionToken(db_user.getUserName()));
        EucalyptusManagement.commitWebUser(db_user);
        notifyUserRecovery(db_user);
      }
    }
 catch (    Exception e) {
    }
    response="Please, check your email for further instructions.";
  }
 else {
    String code=web_user.getConfirmationCode();
    if (code == null) {
      throw new SerializableException("Insufficient parameters");
    }
    UserInfoWeb db_user;
    try {
      db_user=EucalyptusManagement.getWebUserByCode(code);
      long expires=Long.parseLong(code.substring(0,15));
      long now=System.currentTimeMillis();
      if (now > expires) {
        throw new SerializableException("Recovery attempt expired");
      }
      db_user.setConfirmationCode("-unset-");
      db_user.setPassword(web_user.getPassword());
      db_user.setPasswordExpires(new Long(now + pass_expiration_ms));
      EucalyptusManagement.commitWebUser(db_user);
    }
 catch (    Exception e) {
      throw new SerializableException("Incorrect code");
    }
    response="Your password has been reset.";
  }
  return response;
}
