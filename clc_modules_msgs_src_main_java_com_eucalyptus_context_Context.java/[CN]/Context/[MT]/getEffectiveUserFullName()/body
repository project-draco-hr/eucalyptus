{
  String effectiveUserId=this.getRequest().getEffectiveUserId();
  if (this.getRequest() != null && FakePrincipals.SYSTEM_USER_ERN.getUserName().equals(effectiveUserId)) {
    return FakePrincipals.SYSTEM_USER_ERN;
  }
 else   if (this.getRequest() == null || effectiveUserId == null) {
    return FakePrincipals.NOBODY_USER_ERN;
  }
 else   if (!effectiveUserId.equals(this.getUserFullName().getUserName())) {
    try {
      return UserFullName.getInstance(Accounts.lookupUserByName(effectiveUserId));
    }
 catch (    RuntimeException ex) {
      LOG.error(ex);
      return UserFullName.getInstance(this.getUser());
    }
catch (    AuthException ex) {
      LOG.error(ex,ex);
      return UserFullName.getInstance(this.getUser());
    }
  }
 else {
    return UserFullName.getInstance(this.getUser());
  }
}
