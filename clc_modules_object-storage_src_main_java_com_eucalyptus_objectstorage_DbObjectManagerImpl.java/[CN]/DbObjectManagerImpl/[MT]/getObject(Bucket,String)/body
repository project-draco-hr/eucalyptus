{
  EntityTransaction db=Entities.get(ObjectEntity.class);
  try {
    Criteria search=Entities.createCriteria(ObjectEntity.class);
    ObjectEntity searchExample=new ObjectEntity(bucket.getBucketName(),null,null);
    searchExample.setUploadId(uploadId);
    searchExample.setPartNumber(null);
    List<ObjectEntity> results=search.add(Example.create(searchExample)).add(ObjectEntity.QueryHelpers.getNotDeletingRestriction()).add(ObjectEntity.QueryHelpers.getIsPendingRestriction()).list();
    db.commit();
    if (results.size() > 0) {
      return results.get(0);
    }
 else {
      throw new InternalErrorException("Unable to get pending object entity for: " + bucket.getBucketName() + " "+ uploadId);
    }
  }
  finally {
    if (db != null && db.isActive()) {
      db.rollback();
    }
  }
}
