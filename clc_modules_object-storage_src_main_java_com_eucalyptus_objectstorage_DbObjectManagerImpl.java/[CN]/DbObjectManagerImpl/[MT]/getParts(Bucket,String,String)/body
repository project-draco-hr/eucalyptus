{
  EntityTransaction db=Entities.get(PartEntity.class);
  HashMap<Integer,PartEntity> parts=new HashMap<Integer,PartEntity>();
  try {
    Criteria search=Entities.createCriteria(PartEntity.class);
    PartEntity searchExample=new PartEntity(bucket.getBucketName(),objectKey,uploadId,null);
    searchExample.setUuid(null);
    List<PartEntity> results=search.add(Example.create(searchExample)).add(ObjectEntity.QueryHelpers.getNotPendingRestriction()).list();
    db.commit();
    for (    PartEntity result : results) {
      parts.put(result.getPartNumber(),result);
    }
    return parts;
  }
  finally {
    if (db != null && db.isActive()) {
      db.rollback();
    }
  }
}
