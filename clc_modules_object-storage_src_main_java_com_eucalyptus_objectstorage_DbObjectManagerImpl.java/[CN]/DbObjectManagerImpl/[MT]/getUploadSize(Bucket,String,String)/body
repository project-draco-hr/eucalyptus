{
  long size=0;
  EntityTransaction db=Entities.get(ObjectEntity.class);
  try {
    Criteria search=Entities.createCriteria(ObjectEntity.class);
    ObjectEntity searchExample=new ObjectEntity(bucket.getBucketName(),objectKey,null);
    searchExample.setUploadId(uploadId);
    List<ObjectEntity> results=search.add(Example.create(searchExample)).add(ObjectEntity.QueryHelpers.getNotDeletingRestriction()).add(ObjectEntity.QueryHelpers.getNotPendingRestriction()).addOrder(Order.desc("objectModifiedTimestamp")).list();
    db.commit();
    for (    ObjectEntity object : results) {
      size+=object.getSize();
    }
  }
  finally {
    if (db != null && db.isActive()) {
      db.rollback();
    }
  }
  return size;
}
