{
  boolean allowed=requestUser.isSystemAdmin() || (requestUser.getAccount().getAccountNumber().equals(account.getAccountNumber()) && (Permissions.isAuthorized(PolicySpec.VENDOR_IAM,PolicySpec.IAM_RESOURCE_USER,"",account,PolicySpec.IAM_CREATEUSER,requestUser) && Permissions.canAllocate(PolicySpec.VENDOR_IAM,PolicySpec.IAM_RESOURCE_USER,"",PolicySpec.IAM_CREATEUSER,requestUser,1L)));
  if (!allowed) {
    throw new AuthException("Failed to authorize user creation");
  }
}
