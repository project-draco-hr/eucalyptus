{
  boolean allowed=false;
  try {
    allowed=requestUser.isSystemAdmin() || (requestUser.getAccount().getAccountNumber().equals(account.getAccountNumber()) && !user.isAccountAdmin() && (requestUser.isAccountAdmin() || Permissions.isAuthorized(PolicySpec.VENDOR_IAM,PolicySpec.IAM_RESOURCE_USER,Accounts.getUserFullName(user),account,PolicySpec.IAM_PUTUSERPOLICY,requestUser)));
  }
 catch (  Exception e) {
    LOG.error(e,e);
  }
  if (!allowed) {
    throw new EucalyptusServiceException("Operation is not authorized");
  }
}
