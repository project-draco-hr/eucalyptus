{
  try {
    this.delegate.commit();
  }
 catch (  RuntimeException e) {
    if (this.delegate != null && this.delegate.isActive()) {
      this.delegate.rollback();
      this.delegate=null;
      LOG.debug(e,e);
      throw e;
    }
  }
 finally {
    outstanding.remove(this.txUuid);
    this.em.close();
  }
}
