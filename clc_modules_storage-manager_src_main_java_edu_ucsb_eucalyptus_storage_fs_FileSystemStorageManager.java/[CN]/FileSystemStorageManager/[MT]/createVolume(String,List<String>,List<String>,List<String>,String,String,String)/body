{
  String snapshotLoDev=null;
  ArrayList<String> loDevices=new ArrayList<String>();
  for (  String snapshot : snapshotSet) {
    String loDevName=createLoopback(rootDirectory + FILE_SEPARATOR + bucket+ FILE_SEPARATOR+ snapshot);
    if (loDevName.length() == 0)     throw new EucalyptusCloudException("could not create loopback device for " + snapshot);
    if (snapshot.equals(snapshotId))     snapshotLoDev=loDevName;
    loDevices.add(loDevName);
  }
  int i=0;
  ArrayList<String> absoluteLvNames=new ArrayList<String>();
  String snapshotAbsoluteLvName=null;
  for (  String snapshot : snapshotSet) {
    String absoluteLvName=lvmRootDirectory + FILE_SEPARATOR + vgNames.get(i)+ FILE_SEPARATOR+ lvNames.get(i);
    if (i == 0)     enableLogicalVolume(absoluteLvName);
    if (snapshotId.equals(snapshot))     snapshotAbsoluteLvName=absoluteLvName;
    absoluteLvNames.add(absoluteLvName);
    ++i;
  }
  String volumeKey="walrusvol-" + Hashes.getRandom(16);
  String volumePath=rootDirectory + FILE_SEPARATOR + bucket+ FILE_SEPARATOR+ volumeKey;
  createVolumeFromLv(snapshotAbsoluteLvName,volumePath);
  if (!(new File(volumePath).exists()))   throw new EucalyptusCloudException("Unable to create file " + volumePath);
  for (  String absoluteLvName : absoluteLvNames) {
    String returnValue=disableLogicalVolume(absoluteLvName);
  }
  for (  String loDevice : loDevices) {
    String returnValue=removeLoopback(loDevice);
  }
  return volumeKey;
}
