{
  AbstractKeyStore eucaKeyStore=EucaKeyStore.getInstance();
  KeyTool keyTool=new KeyTool();
  KeyPair sysKp=keyTool.getKeyPair();
  X509Certificate sysX509=keyTool.getCertificate(sysKp,EucalyptusProperties.getDName(EucalyptusProperties.NAME));
  KeyPair wwwKp=keyTool.getKeyPair();
  X509Certificate wwwX509=keyTool.getCertificate(wwwKp,EucalyptusProperties.getDName(EucalyptusProperties.WWW_NAME));
  eucaKeyStore.addKeyPair(EucalyptusProperties.NAME,sysX509,sysKp.getPrivate(),EucalyptusProperties.NAME);
  eucaKeyStore.addKeyPair(EucalyptusProperties.WWW_NAME,wwwX509,wwwKp.getPrivate(),EucalyptusProperties.NAME);
  eucaKeyStore.store();
  if (!eucaKeyStore.check()) {
    throw new GeneralSecurityException("Created new keystore, but check still fails. eeek.");
  }
}
