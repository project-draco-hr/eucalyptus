{
  AWSCredentials credentials;
  try {
    credentials=mapCredentials(requestUser);
  }
 catch (  Exception e) {
    LOG.error("Error mapping credentials for user " + (requestUser != null ? requestUser.getUserId() : "null") + " for walrus backend call. This is likely to lead to a connection leak!",e);
    InternalErrorException ex=new InternalErrorException("Cannot return s3client to pool due to inability to map credentials for user: " + (requestUser != null ? requestUser.getUserId() : "null"));
    ex.initCause(e);
    throw ex;
  }
  try {
    GenericObjectPool<OsgInternalS3Client> pool=getClientPool(credentials,this.getUpstreamEndpoint(),this.doUsePathStyle());
    pool.returnObject(pooledClient);
  }
 catch (  Exception e) {
    LOG.error("failed to return s3client to pool, this connection is now leaked",e);
  }
}
