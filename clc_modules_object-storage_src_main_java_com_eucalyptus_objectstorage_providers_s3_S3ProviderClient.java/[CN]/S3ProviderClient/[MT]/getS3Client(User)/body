{
  AWSCredentials credentials;
  try {
    credentials=mapCredentials(requestUser);
  }
 catch (  Exception e) {
    LOG.error("Error mapping credentials for user " + (requestUser != null ? requestUser.getUserId() : "null") + " for walrus backend call.",e);
    throw new InternalErrorException("Cannot construct s3client due to inability to map credentials for user: " + (requestUser != null ? requestUser.getUserId() : "null"),e);
  }
  try {
    OsgInternalS3Client internalS3Client=getClientPool(credentials,this.getUpstreamEndpoint(),this.doUsePathStyle()).borrowObject();
    return internalS3Client;
  }
 catch (  Exception e) {
    LOG.error("exception thrown retrieving internal s3 client",e);
    throw new InternalErrorException("Cannot get s3client from pool",e);
  }
}
