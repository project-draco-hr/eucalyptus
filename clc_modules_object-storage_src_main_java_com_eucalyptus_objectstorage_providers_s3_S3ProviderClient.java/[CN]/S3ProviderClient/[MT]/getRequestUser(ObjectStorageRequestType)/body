{
  try {
    if (Contexts.lookup(request.getCorrelationId()).getUser() != null) {
      return Contexts.lookup(request.getCorrelationId()).getUser();
    }
 else     if (!Strings.isNullOrEmpty(request.getAccessKeyID())) {
      return Accounts.lookupUserByAccessKeyId(request.getAccessKeyID());
    }
 else {
      return Contexts.lookup(request.getCorrelationId()).getUser();
    }
  }
 catch (  Exception e) {
    LOG.error("Lookup of user and canonical id failed",e);
    throw new EucalyptusCloudException("No user identity found for credential mapping to s3-backend");
  }
}
