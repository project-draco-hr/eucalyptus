{
  ListAllMyBucketsResponseType reply=request.getReply();
  try {
    User requestUser=getRequestUser(request);
    ListAllMyBucketsList myBucketList=new ListAllMyBucketsList();
    myBucketList.setBuckets(new ArrayList<BucketListEntry>());
    AmazonS3Client s3Client=this.getS3Client(requestUser,request.getAccessKeyID());
    ListBucketsRequest listRequest=new ListBucketsRequest();
    List<Bucket> result=s3Client.listBuckets(listRequest);
    for (    Bucket b : result) {
      myBucketList.getBuckets().add(new BucketListEntry(b.getName(),DateFormatter.dateToHeaderFormattedString(b.getCreationDate())));
    }
    reply.setBucketList(myBucketList);
  }
 catch (  AmazonServiceException ex) {
    LOG.debug("Got service error from backend: " + ex.getMessage(),ex);
    throw S3ExceptionMapper.fromAWSJavaSDK(ex);
  }
  return reply;
}
