{
  final RegisterImageType req=new RegisterImageType();
  req.setAmiId(CreateImageTask.this.getImageId());
  req.setName(CreateImageTask.this.imageName);
  final List<VmCreateImageSnapshot> snapshots=CreateImageTask.this.getSnapshots();
  final List<BlockDeviceMappingItemType> devices=Lists.newArrayList();
  for (  final VmCreateImageSnapshot snapshot : snapshots) {
    if (snapshot.isRootDevice())     req.setRootDeviceName(snapshot.getDeviceName());
    final BlockDeviceMappingItemType device=new BlockDeviceMappingItemType();
    device.setDeviceName(snapshot.getDeviceName());
    final EbsDeviceMapping ebsMap=new EbsDeviceMapping();
    ebsMap.setSnapshotId(snapshot.getSnapshotId());
    device.setEbs(ebsMap);
    devices.add(device);
  }
  req.setBlockDeviceMappings((ArrayList<BlockDeviceMappingItemType>)devices);
  return req;
}
