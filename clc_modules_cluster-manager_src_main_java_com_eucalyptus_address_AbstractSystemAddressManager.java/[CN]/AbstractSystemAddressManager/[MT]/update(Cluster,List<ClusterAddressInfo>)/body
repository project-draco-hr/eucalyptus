{
  if (!cluster.getState().isAddressingInitialized()) {
    try {
      Helper.loadStoredAddresses(cluster);
    }
 catch (    Throwable e) {
      LOG.warn("Error while trying to load stored cluster address info for " + cluster.toString(),e);
    }
  }
  for (  ClusterAddressInfo addrInfo : ccList) {
    Address address=Helper.lookupOrCreate(cluster,addrInfo);
    if (address.isAllocated() && Address.UNALLOCATED_USERID.equals(address.getUserId())) {
      address.allocate(Component.eucalyptus.name());
      address.clearPending();
      cluster.getState().clearOrphan(addrInfo);
    }
 else     if (address.isAssigned()) {
      try {
        VmInstance vm=VmInstances.getInstance().lookupByInstanceIp(addrInfo.getInstanceIp());
        if (!address.isAssigned()) {
          address.assign(vm.getInstanceId(),addrInfo.getInstanceIp());
          address.clearPending();
        }
        cluster.getState().clearOrphan(addrInfo);
      }
 catch (      NoSuchElementException e) {
        InetAddress addr=null;
        try {
          addr=Inet4Address.getByName(addrInfo.getInstanceIp());
        }
 catch (        UnknownHostException e1) {
          LOG.debug(e1,e1);
        }
        if (addr == null || !addr.isLoopbackAddress()) {
          cluster.getState().handleOrphan(addrInfo);
        }
      }
    }
  }
}
