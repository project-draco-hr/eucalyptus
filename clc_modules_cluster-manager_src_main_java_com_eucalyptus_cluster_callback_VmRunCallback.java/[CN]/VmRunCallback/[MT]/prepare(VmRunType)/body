{
  for (  String vmId : msg.getInstanceIds()) {
    try {
      VmInstance vm=VmInstances.getInstance().lookup(vmId);
      if (!VmState.PENDING.equals(vm.getState())) {
        throw new EucalyptusClusterException("Intercepted a RunInstances request for an instance which has meanwhile been terminated.");
      }
    }
 catch (    Exception e) {
      LOG.debug(e,e);
    }
  }
  try {
    Clusters.getInstance().lookup(token.getCluster()).getNodeState().submitToken(token);
  }
 catch (  Exception e2) {
    LOG.debug(e2,e2);
    throw e2;
  }
}
