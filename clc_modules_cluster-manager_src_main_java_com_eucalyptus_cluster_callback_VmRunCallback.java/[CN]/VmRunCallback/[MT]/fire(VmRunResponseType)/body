{
  if (!reply.get_return()) {
    throw new EucalyptusClusterException("Failed to run instance: " + this.getRequest().getInstanceId());
  }
  Logs.extreme().error(reply);
  Function<VmRunResponseType,Boolean> redeemToken=new Function<VmRunResponseType,Boolean>(){
    @Override public Boolean apply(    final VmRunResponseType reply){
      try {
        VmRunCallback.this.token.redeem();
      }
 catch (      Exception ex) {
        Logs.extreme().error(ex,ex);
      }
      for (      final VmInfo vmInfo : reply.getVms()) {
        final VmInstance vm=VmInstances.lookup(vmInfo.getInstanceId());
        vm.updateAddresses(vmInfo.getNetParams().getIpAddress(),vmInfo.getNetParams().getIgnoredPublicIp());
      }
      return true;
    }
  }
;
  try {
    Entities.asTransaction(VmInstance.class,redeemToken).apply(reply);
  }
 catch (  RuntimeException ex) {
    LOG.error(ex,ex);
    throw ex;
  }
}
