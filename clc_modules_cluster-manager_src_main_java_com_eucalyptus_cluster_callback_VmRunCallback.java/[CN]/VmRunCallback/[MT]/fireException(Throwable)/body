{
  EntityTransaction db=Entities.get(VmInstance.class);
  try {
    LOG.debug("-> Release resource tokens for unused resources.");
    try {
      this.token.release();
    }
 catch (    final Exception ex) {
      LOG.error(ex.getMessage());
      Logs.extreme().error(ex,ex);
    }
    final PrivateNetworkIndex networkIndex=this.token.getNetworkIndex();
    try {
      LOG.debug("-> Release network index allocation: " + networkIndex);
      networkIndex.teardown();
    }
 catch (    final Exception ex) {
      LOG.error(ex.getMessage());
      Logs.extreme().error(ex,ex);
    }
    final Address addr=this.token.getAddress();
    LOG.debug("-> Release addresses from failed vm run allocation: " + addr);
    try {
      addr.release();
    }
 catch (    final Exception ex) {
      LOG.error(ex.getMessage());
      Logs.extreme().error(ex,ex);
    }
    LOG.debug(LogUtil.header("Failing run instances because of: " + e.getMessage()),e);
    LOG.debug(LogUtil.subheader(this.getRequest().toString()));
    db.commit();
  }
 catch (  Exception ex) {
    Logs.exhaust().error(ex,ex);
    db.commit();
  }
}
