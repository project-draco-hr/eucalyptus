{
  String message=getMessageString(buffer);
  String[] parts=message.split(boundary);
  for (  String part : parts) {
    Map<String,String> keyMap=getFormField(part,"name");
    Set<String> keys=keyMap.keySet();
    for (    String key : keys) {
      if (WalrusProperties.FormField.file.toString().equals(key)) {
        String contentType=getContentType(formFields,part,boundary);
        if (contentType != null) {
          getFirstChunk(formFields,buffer,contentType,boundary);
        }
        formFields.put(WalrusProperties.IGNORE_PREFIX + key,keyMap.get(key));
      }
 else       if (WalrusProperties.CONTENT_TYPE.toLowerCase().equals(key.toLowerCase())) {
        formFields.put(WalrusProperties.CONTENT_TYPE,keyMap.get(key));
      }
 else {
        if (!"submit".equals(key)) {
          formFields.put(key,keyMap.get(key));
        }
      }
    }
  }
}
