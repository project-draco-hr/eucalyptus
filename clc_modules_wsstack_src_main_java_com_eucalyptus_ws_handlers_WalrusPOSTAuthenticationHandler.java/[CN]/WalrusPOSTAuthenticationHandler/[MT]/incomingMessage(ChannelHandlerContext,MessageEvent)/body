{
  if (event.getMessage() instanceof MappingHttpRequest) {
    MappingHttpRequest httpRequest=(MappingHttpRequest)event.getMessage();
    Map formFields=httpRequest.getFormFields();
    String boundary=processPOSTHeaders(httpRequest,formFields);
    processPOSTParams(boundary,formFields,httpRequest.getContent());
    checkPolicy(httpRequest,formFields);
    handle(httpRequest);
  }
 else   if (event.getMessage() instanceof DefaultHttpChunk) {
    DefaultHttpChunk httpChunk=(DefaultHttpChunk)event.getMessage();
    ChannelBuffer newBuffer=getDataChunk(httpChunk.getContent(),boundary);
    if (newBuffer != null) {
      DefaultHttpChunk newChunk=new DefaultHttpChunk(newBuffer);
      UpstreamMessageEvent newEvent=new UpstreamMessageEvent(ctx.getChannel(),newChunk,null);
      ctx.sendUpstream(newEvent);
    }
  }
}
