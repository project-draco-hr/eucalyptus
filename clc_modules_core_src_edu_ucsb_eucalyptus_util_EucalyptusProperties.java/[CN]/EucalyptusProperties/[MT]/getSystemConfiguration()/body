{
  EntityWrapper<SystemConfiguration> confDb=new EntityWrapper<SystemConfiguration>();
  SystemConfiguration conf=null;
  try {
    conf=confDb.getUnique(new SystemConfiguration());
  }
 catch (  EucalyptusCloudException e) {
    confDb.rollback();
    throw new EucalyptusCloudException("Failed to load system configuration",e);
  }
  if (conf.getRegistrationId() == null) {
    conf.setRegistrationId(UUID.randomUUID().toString());
  }
  if (conf.getSystemReservedPublicAddresses() == null) {
    conf.setSystemReservedPublicAddresses(10);
  }
  if (conf.getMaxUserPublicAddresses() == null) {
    conf.setMaxUserPublicAddresses(5);
  }
  if (conf.isDoDynamicPublicAddresses() == null) {
    conf.setDoDynamicPublicAddresses(true);
  }
  confDb.commit();
  String walrusUrl=null;
  try {
    walrusUrl=(new URL(conf.getStorageUrl() + "/")).toString();
  }
 catch (  MalformedURLException e) {
    throw new EucalyptusCloudException("System is misconfigured: cannot parse Walrus URL.",e);
  }
  return conf;
}
