{
  User user=context.getUser();
  if (user != null && !user.equals(Principals.nobodyUser())) {
    final Set<QueryIdCredential> queryIdCreds=context.getSubject().getPublicCredentials(QueryIdCredential.class);
    if (!queryIdCreds.isEmpty()) {
      msg.setProperty("accessKeyID",Iterables.getOnlyElement(queryIdCreds).getQueryId());
    }
 else {
      msg.setProperty("accessKeyID",Accounts.getFirstActiveAccessKeyId(user));
    }
  }
  msg.setProperty("timeStamp",new Date());
}
