{
  ArrayList<String> ancestorIds=Lists.newArrayList();
  try {
    String[] imagePathParts=manifestPath.split("/");
    Document inputSource=ObjectStorageUtil.getManifestData(ComponentIds.lookup(Eucalyptus.class).getFullName(),imagePathParts[0],imagePathParts[1]);
    XPath xpath=XPathFactory.newInstance().newXPath();
    NodeList ancestors=null;
    try {
      ancestors=(NodeList)xpath.evaluate("/manifest/image/ancestry/ancestor_ami_id/text()",inputSource,XPathConstants.NODESET);
      if (ancestors == null)       return ancestorIds;
      for (int i=0; i < ancestors.getLength(); i++) {
        for (        String ancestorId : ancestors.item(i).getNodeValue().split(",")) {
          ancestorIds.add(ancestorId);
        }
      }
    }
 catch (    XPathExpressionException e) {
      LOG.error(e,e);
    }
  }
 catch (  EucalyptusCloudException e) {
    LOG.error(e,e);
  }
catch (  DOMException e) {
    LOG.error(e,e);
  }
  return ancestorIds;
}
