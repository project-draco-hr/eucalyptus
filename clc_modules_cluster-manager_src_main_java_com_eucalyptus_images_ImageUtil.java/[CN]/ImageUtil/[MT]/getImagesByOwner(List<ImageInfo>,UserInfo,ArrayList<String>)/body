{
  EntityWrapper<ImageInfo> db=new EntityWrapper<ImageInfo>();
  List<ImageDetails> repList=Lists.newArrayList();
  if (owners.remove("self"))   owners.add(user.getUserName());
  try {
    for (    String userName : owners) {
      Iterable<ImageInfo> results=Iterables.filter(db.query(ImageInfo.byOwnerId(userName)),new Predicate<ImageInfo>(){
        @Override public boolean apply(        ImageInfo arg0){
          return (imgList.isEmpty() || imgList.contains(arg0)) && (arg0.getImagePublic() || arg0.isAllowed(user));
        }
      }
);
      repList.addAll(Lists.transform(Lists.newArrayList(results),ImageInfo.TO_IMAGE_DETAILS));
    }
    db.commit();
  }
 catch (  Throwable e) {
    LOG.debug(e,e);
    db.rollback();
  }
  return repList;
}
