{
  if (this.allocInfo.getBootSet().getMachine() instanceof BlockStorageImageInfo) {
    final ServiceConfiguration sc=Partitions.lookupService(Storage.class,this.cluster.getPartition());
    final VirtualBootRecord root=this.allocInfo.getVmTypeInfo().lookupRoot();
    if (root.isBlockStorage()) {
      for (int i=0; i < this.allocInfo.getAllocationTokens().size(); i++) {
        final BlockStorageImageInfo imgInfo=((BlockStorageImageInfo)this.allocInfo.getBootSet().getMachine());
        final int sizeGb=(int)Math.ceil(imgInfo.getImageSizeBytes() / (1024l * 1024l * 1024l));
        LOG.debug("About to prepare root volume using bootable block storage: " + imgInfo + " and vbr: "+ root);
        final Volume vol=Volumes.createStorageVolume(sc,this.allocInfo.getOwnerFullName(),imgInfo.getSnapshotId(),sizeGb,this.allocInfo.getRequest());
        if (imgInfo.getDeleteOnTerminate()) {
          this.allocInfo.getTransientVolumes().add(vol);
        }
 else {
          this.allocInfo.getPersistentVolumes().add(vol);
        }
      }
    }
  }
}
