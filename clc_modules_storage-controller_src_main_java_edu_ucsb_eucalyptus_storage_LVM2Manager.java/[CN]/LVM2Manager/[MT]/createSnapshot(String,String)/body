{
  EntityWrapper<LVMVolumeInfo> db=new EntityWrapper<LVMVolumeInfo>();
  LVMVolumeInfo lvmVolumeInfo=new LVMVolumeInfo(volumeId);
  LVMVolumeInfo foundLVMVolumeInfo=db.getUnique(lvmVolumeInfo);
  ArrayList<String> returnValues=new ArrayList<String>();
  if (foundLVMVolumeInfo != null) {
    LVMVolumeInfo snapshotInfo=new LVMVolumeInfo(snapshotId);
    snapshotInfo.setSnapshotOf(volumeId);
    File snapshotDir=new File(StorageProperties.storageRootDirectory);
    snapshotDir.mkdirs();
    String vgName=foundLVMVolumeInfo.getVgName();
    String lvName="lv-snap-" + Hashes.getRandom(4);
    String absoluteLVName=lvmRootDirectory + PATH_SEPARATOR + vgName+ PATH_SEPARATOR+ foundLVMVolumeInfo.getLvName();
    int size=foundLVMVolumeInfo.getSize();
    long snapshotSize=(size * StorageProperties.GB) / 2;
    String rawFileName=StorageProperties.storageRootDirectory + "/" + volumeId+ Hashes.getRandom(6);
    String loDevName=createLoopback(rawFileName,snapshotSize);
    createSnapshotLogicalVolume(loDevName,vgName,absoluteLVName,lvName);
    String snapRawFileName=StorageProperties.storageRootDirectory + "/" + snapshotId;
    String snapLoDevName=createLoopback(snapRawFileName,size);
    String absoluteSnapLVName=lvmRootDirectory + PATH_SEPARATOR + vgName+ PATH_SEPARATOR+ lvName;
    duplicateLogicalVolume(absoluteSnapLVName,snapLoDevName);
    String returnValue=removeLogicalVolume(absoluteSnapLVName);
    if (returnValue.length() == 0) {
      throw new EucalyptusCloudException("Unable to remove logical volume " + absoluteSnapLVName);
    }
    returnValue=reduceVolumeGroup(vgName,loDevName);
    if (returnValue.length() == 0) {
      throw new EucalyptusCloudException("Unable to reduce volume group " + vgName + " logical volume: "+ loDevName);
    }
    returnValue=removePhysicalVolume(loDevName);
    if (returnValue.length() == 0) {
      throw new EucalyptusCloudException("Unable to remove physical volume " + loDevName);
    }
    returnValue=removeLoopback(loDevName);
    snapshotInfo.setLoDevName(snapLoDevName);
    snapshotInfo.setStatus(StorageProperties.Status.available.toString());
    snapshotInfo.setVbladePid(-1);
    snapshotInfo.setSize(size);
    returnValues.add(vgName);
    returnValues.add(lvName);
    db.add(snapshotInfo);
  }
  db.commit();
  return returnValues;
}
