{
  EntityWrapper<LVMVolumeInfo> db=StorageController.getEntityWrapper();
  LVMVolumeInfo lvmVolumeInfo=new LVMVolumeInfo(volumeId);
  LVMVolumeInfo foundVolumeInfo=db.getUnique(lvmVolumeInfo);
  if (foundVolumeInfo != null) {
    String vgName="vg-" + Hashes.getRandom(4);
    String lvName="lv-" + Hashes.getRandom(4);
    lvmVolumeInfo=new LVMVolumeInfo();
    File volumeFile=new File(StorageProperties.storageRootDirectory + PATH_SEPARATOR + foundVolumeInfo.getVolumeId());
    String rawFileName=StorageProperties.storageRootDirectory + "/" + dupVolumeId;
    int size=(int)(volumeFile.length() / StorageProperties.GB);
    try {
      String loDevName=createLoopback(rawFileName,size);
      createLogicalVolume(loDevName,vgName,lvName);
      String absoluteLVName=lvmRootDirectory + PATH_SEPARATOR + vgName+ PATH_SEPARATOR+ lvName;
      String absoluteVolumeLVName=lvmRootDirectory + PATH_SEPARATOR + foundVolumeInfo.getVgName()+ PATH_SEPARATOR+ foundVolumeInfo.getLvName();
      duplicateLogicalVolume(absoluteVolumeLVName,absoluteLVName);
      lvmVolumeInfo.setVolumeId(dupVolumeId);
      lvmVolumeInfo.setLoDevName(loDevName);
      lvmVolumeInfo.setPvName(loDevName);
      lvmVolumeInfo.setVgName(vgName);
      lvmVolumeInfo.setLvName(lvName);
      lvmVolumeInfo.setStatus(StorageProperties.Status.available.toString());
      lvmVolumeInfo.setSize(size);
      lvmVolumeInfo.setVbladePid(-1);
      db.add(lvmVolumeInfo);
      db.commit();
    }
 catch (    ExecutionException ex) {
      db.rollback();
      String error="Unable to run command: " + ex.getMessage();
      LOG.error(error);
      throw new EucalyptusCloudException(error);
    }
  }
 else {
    db.rollback();
    throw new EucalyptusCloudException("Could not dup volume " + volumeId);
  }
}
