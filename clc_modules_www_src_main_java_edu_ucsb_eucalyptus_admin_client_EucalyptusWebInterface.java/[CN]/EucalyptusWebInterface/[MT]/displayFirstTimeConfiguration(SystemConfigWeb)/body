{
  VerticalPanel gpanel=new VerticalPanel();
  gpanel.setSpacing(25);
  gpanel.setHorizontalAlignment(HasHorizontalAlignment.ALIGN_CENTER);
  final Grid g1=new Grid(2,3);
  g1.getColumnFormatter().setWidth(0,"240");
  g1.getColumnFormatter().setWidth(1,"180");
  g1.getColumnFormatter().setWidth(2,"180");
  int i=0;
  final int newPassword1_row=i;
  g1.setWidget(i,0,new Label("Administrator's new password:"));
  g1.getCellFormatter().setHorizontalAlignment(i,0,HasHorizontalAlignment.ALIGN_RIGHT);
  final PasswordTextBox newCleartextPassword1_box=new PasswordTextBox();
  newCleartextPassword1_box.setFocus(true);
  newCleartextPassword1_box.setWidth("180");
  g1.setWidget(i++,1,newCleartextPassword1_box);
  final int newPassword2_row=i;
  g1.setWidget(i,0,new Label("The password, again:"));
  g1.getCellFormatter().setHorizontalAlignment(i,0,HasHorizontalAlignment.ALIGN_RIGHT);
  final PasswordTextBox newCleartextPassword2_box=new PasswordTextBox();
  newCleartextPassword2_box.setWidth("180");
  g1.setWidget(i++,1,newCleartextPassword2_box);
  gpanel.add(g1);
  final Grid g2=new Grid(1,3);
  g2.getColumnFormatter().setWidth(0,"240");
  g2.getColumnFormatter().setWidth(1,"180");
  g2.getColumnFormatter().setWidth(2,"180");
  i=0;
  final int emailAddress_row=i;
  g2.setWidget(i,0,new Label("Administrator's email address:"));
  g2.getCellFormatter().setHorizontalAlignment(i,0,HasHorizontalAlignment.ALIGN_RIGHT);
  final TextBox emailAddress_box=new TextBox();
  emailAddress_box.setWidth("180");
  g2.setWidget(i++,1,emailAddress_box);
  VerticalPanel epanel=new VerticalPanel();
  epanel.setHorizontalAlignment(HasHorizontalAlignment.ALIGN_CENTER);
  epanel.setSpacing(5);
  epanel.add(g2);
  HTML emailChangeMsg=new HTML(admin_email_change_text);
  emailChangeMsg.setWidth("300");
  emailChangeMsg.setStyleName("euca-small-text");
  epanel.add(emailChangeMsg);
  gpanel.add(epanel);
  final Grid g3=new Grid(1,3);
  g3.getColumnFormatter().setWidth(0,"240");
  g3.getColumnFormatter().setWidth(1,"180");
  g3.getColumnFormatter().setWidth(2,"180");
  i=0;
  final int cloudUrl_row=i;
  g3.setWidget(i,0,new Label("Cloud Host:"));
  g3.getCellFormatter().setHorizontalAlignment(i,0,HasHorizontalAlignment.ALIGN_RIGHT);
  final TextBox cloudUrl_box=new TextBox();
  cloudUrl_box.setWidth("180");
  cloudUrl_box.setText(conf.getCloudHost());
  g3.setWidget(i++,1,cloudUrl_box);
  VerticalPanel cpanel=new VerticalPanel();
  cpanel.setHorizontalAlignment(HasHorizontalAlignment.ALIGN_CENTER);
  cpanel.setSpacing(5);
  cpanel.add(g3);
  HTML cloudUrlMsg=new HTML(admin_cloud_ip_setup_text);
  cloudUrlMsg.setWidth("300");
  cloudUrlMsg.setStyleName("euca-small-text");
  cpanel.add(cloudUrlMsg);
  gpanel.add(cpanel);
  EucaButton change_button=new EucaButton("Submit",new ClickHandler(){
    public void onClick(    ClickEvent event){
      boolean formOk=true;
      g1.clearCell(0,2);
      g1.clearCell(1,2);
      g2.clearCell(0,2);
      g3.clearCell(0,2);
      if (newCleartextPassword1_box.getText().length() < minPasswordLength) {
        Label l=new Label("Password is too short!");
        l.setStyleName("euca-error-hint");
        g1.setWidget(newPassword1_row,2,l);
        formOk=false;
      }
      if (!newCleartextPassword1_box.getText().equals(newCleartextPassword2_box.getText())) {
        Label l=new Label("Passwords do not match!");
        l.setStyleName("euca-error-hint");
        g1.setWidget(newPassword2_row,2,l);
        formOk=false;
      }
      if (emailAddress_box.getText().length() < 1 || emailAddress_box.getText().equalsIgnoreCase("n/a")) {
        Label l=new Label("Email address is empty or n/a!");
        l.setStyleName("euca-error-hint");
        g2.setWidget(emailAddress_row,2,l);
        formOk=false;
      }
      if (cloudUrl_box.getText().length() < 1) {
        Label l=new Label("Cloud URL is empty!");
        l.setStyleName("euca-error-hint");
        g3.setWidget(cloudUrl_row,2,l);
        formOk=false;
      }
      if (!formOk) {
        label_box.setText("Please, fix the errors and try again:");
        label_box.setStyleName("euca-greeting-warning");
        return;
      }
      label_box.setText("Checking with the server...");
      label_box.setStyleName("euca-greeting-pending");
      loggedInUser.setEmail(emailAddress_box.getText());
      loggedInUser.setPassword(GWTUtils.md5(newCleartextPassword1_box.getText()));
      EucalyptusWebBackend.App.getInstance().updateUserRecord(sessionId,loggedInUser,new AsyncCallback(){
        public void onSuccess(        final Object result){
          label_box.setText("Refreshing user data...");
          EucalyptusWebBackend.App.getInstance().getUserRecord(sessionId,null,new AsyncCallback(){
            public void onSuccess(            Object result2){
              loggedInUser=(UserInfoWeb)((List)result2).get(0);
              conf.setCloudHost(cloudUrl_box.getText());
              EucalyptusWebBackend.App.getInstance().setSystemConfig(sessionId,conf,new AsyncCallback(){
                public void onSuccess(                final Object result){
                  currentTabIndex=CONF_DEFAULT_PAGE;
                  displayDefaultPage("");
                }
                public void onFailure(                Throwable caught){
                  displayErrorPage("Failed to save the cloud URL (check 'Configuration' tab).");
                }
              }
);
            }
            public void onFailure(            Throwable caught){
              displayLoginErrorPage(caught.getMessage());
            }
          }
);
        }
        public void onFailure(        Throwable caught){
          loggedInUser.setEmail("");
          String m=caught.getMessage();
          label_box.setText(m);
          label_box.setStyleName("euca-greeting-warning");
        }
      }
);
    }
  }
);
  EucalyptusKeyboardListener sl=new EucalyptusKeyboardListener(change_button);
  change_button.addKeyboardListener(sl);
  newCleartextPassword1_box.addKeyboardListener(sl);
  newCleartextPassword2_box.addKeyboardListener(sl);
  emailAddress_box.addKeyboardListener(sl);
  cloudUrl_box.addKeyboardListener(sl);
  HTML message=new HTML(admin_first_time_config_text);
  message.setWidth("600");
  VerticalPanel vpanel=new VerticalPanel();
  vpanel.setSpacing(15);
  vpanel.setHorizontalAlignment(HasHorizontalAlignment.ALIGN_CENTER);
  if (logo != null) {
    vpanel.add(logo);
  }
  label_box.setText("First-time Configuration");
  label_box.setStyleName("euca-greeting-normal");
  vpanel.add(label_box);
  vpanel.add(message);
  vpanel.add(gpanel);
  vpanel.add(change_button);
  VerticalPanel wrapper=new VerticalPanel();
  wrapper.add(vpanel);
  wrapper.setSize("100%","100%");
  wrapper.setCellHorizontalAlignment(vpanel,VerticalPanel.ALIGN_CENTER);
  wrapper.setCellVerticalAlignment(vpanel,VerticalPanel.ALIGN_MIDDLE);
  RootPanel.get().clear();
  RootPanel.get().add(wrapper);
}
