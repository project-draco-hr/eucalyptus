{
  if (doDebug) {
    Exception e=new Exception();
    e.fillInStackTrace();
    for (    StackTraceElement ste : e.getStackTrace()) {
      if (ste.getClassName().equals(EntityWrapper.class.getCanonicalName()) || ste.getMethodName().matches("getEntityWrapper")) {
        continue;
      }
 else {
        LOG.debug("CREATE CONNECTION " + ste.toString());
        break;
      }
    }
  }
  EntityManagerFactoryImpl anemf=(EntityManagerFactoryImpl)EntityWrapper.getEntityManagerFactory(persistenceContext);
  if (doDebug) {
    anemf.getSessionFactory().getStatistics().setStatisticsEnabled(true);
    LOG.debug("Hibernate statistics: " + anemf.getSessionFactory().getStatistics());
  }
  this.em=anemf.createEntityManager();
  this.session=(Session)em.getDelegate();
  this.tx=em.getTransaction();
  tx.begin();
}
