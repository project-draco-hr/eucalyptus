{
  Date now=new Date();
  for (  final MetricDatum datum : metricDatum) {
    scrub(datum,now);
    final ArrayList<Dimension> dimensions=datum.getDimensions().getMember();
    queue(new Supplier<MetricQueueItem>(){
      @Override public MetricQueueItem get(){
        MetricQueueItem metricMetadata=new MetricQueueItem();
        metricMetadata.setAccountId(ownerAccountId);
        metricMetadata.setUserId(ownerId);
        metricMetadata.setMetricName(datum.getMetricName());
        metricMetadata.setNamespace(nameSpace);
        metricMetadata.setDimensionMap(makeDimensionMap(dimensions));
        metricMetadata.setMetricType(MetricType.Custom);
        metricMetadata.setUnits(Units.fromValue(datum.getUnit()));
        metricMetadata.setTimestamp(datum.getTimestamp());
        if (datum.getValue() != null) {
          metricMetadata.setSampleMax(datum.getValue());
          metricMetadata.setSampleMin(datum.getValue());
          metricMetadata.setSampleSum(datum.getValue());
          metricMetadata.setSampleSize(1.0);
        }
 else         if ((datum.getStatisticValues() != null) && (datum.getStatisticValues().getMaximum() != null) && (datum.getStatisticValues().getMinimum() != null)&& (datum.getStatisticValues().getSum() != null)&& (datum.getStatisticValues().getSampleCount() != null)) {
          metricMetadata.setSampleMax(datum.getStatisticValues().getMaximum());
          metricMetadata.setSampleMin(datum.getStatisticValues().getMinimum());
          metricMetadata.setSampleSum(datum.getStatisticValues().getSum());
          metricMetadata.setSampleSize(datum.getStatisticValues().getSampleCount());
        }
 else {
          throw new RuntimeException("Values missing");
        }
        return metricMetadata;
      }
    }
);
  }
}
