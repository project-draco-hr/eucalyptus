{
synchronized (EntityWrapper.class) {
    if (!emf.containsKey(persistenceContext)) {
      emf.put(persistenceContext,Persistence.createEntityManagerFactory(persistenceContext));
      EntityManager em=emf.get(persistenceContext).createEntityManager();
      EntityTransaction tx=em.getTransaction();
      tx.begin();
      Session s=(Session)em.getDelegate();
      try {
        Connection conn=s.connection();
        Statement stmt=conn.createStatement();
        stmt.execute("SET WRITE_DELAY 100 MILLIS");
        conn.commit();
      }
 catch (      SQLException e) {
        LOG.error(e,e);
      }
      tx.commit();
      em.close();
    }
    return emf.get(persistenceContext);
  }
}
