{
  if ((eucaHome=System.getProperty("euca.upgrade.new.dir")) == null) {
    throw new RuntimeException("Failed to find required 'euca.upgrade.new.dir' property");
  }
 else   if ((eucaOld=System.getProperty("euca.upgrade.old.dir")) == null) {
    throw new RuntimeException("Failed to find required 'euca.upgrade.old.dir' property");
  }
 else   if ((eucaNewVersion=System.getProperty("euca.upgrade.new.version")) == null) {
    throw new RuntimeException("Failed to find required 'euca.upgrade.new.version' property");
  }
 else   if ((eucaOldVersion=System.getProperty("euca.upgrade.old.version")) == null) {
    throw new RuntimeException("Failed to find required 'euca.upgrade.old.version' property");
  }
 else   if ((eucaSource=System.getProperty("euca.upgrade.source")) == null) {
    throw new RuntimeException("Failed to find required 'euca.upgrade.source' property");
  }
 else   if ((eucaDest=System.getProperty("euca.upgrade.destination")) == null) {
    throw new RuntimeException("Failed to find required 'euca.upgrade.destination' property");
  }
 else {
    StandalonePersistence.setupSystemProperties();
    StandalonePersistence.setupConfigurations();
    StandalonePersistence.setupInitProviders();
  }
  try {
    StandalonePersistence.runDiscovery();
    StandalonePersistence.setupProviders();
    StandalonePersistence.setupNewDatabase();
    StandalonePersistence.setupOldDatabase();
    StandalonePersistence.runUpgrade();
    dest.getDb().stop();
    System.exit(0);
  }
 catch (  Exception e) {
    LOG.error(e,e);
    e.printStackTrace();
    dest.getDb().stop();
    System.exit(-1);
  }
}
