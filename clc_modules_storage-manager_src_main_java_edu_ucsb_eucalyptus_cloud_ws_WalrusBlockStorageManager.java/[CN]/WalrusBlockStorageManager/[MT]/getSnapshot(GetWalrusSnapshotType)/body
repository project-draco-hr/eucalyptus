{
  GetWalrusSnapshotResponseType reply=(GetWalrusSnapshotResponseType)request.getReply();
  if (!WalrusProperties.enableSnapshots) {
    LOG.warn("Snapshots not enabled. Please check pre-conditions and restart Walrus.");
    return reply;
  }
  String snapshotId=request.getKey();
  EntityWrapper<WalrusSnapshotInfo> db=new EntityWrapper<WalrusSnapshotInfo>();
  WalrusSnapshotInfo snapshotInfo=new WalrusSnapshotInfo(snapshotId);
  List<WalrusSnapshotInfo> snapshotInfos=db.query(snapshotInfo);
  if (snapshotInfos.size() > 0) {
    WalrusSnapshotInfo foundSnapshotInfo=snapshotInfos.get(0);
    String bucketName=foundSnapshotInfo.getSnapshotBucket();
    GetObjectType getObjectType=new GetObjectType();
    getObjectType.setBucket(bucketName);
    getObjectType.setUserId(request.getUserId());
    getObjectType.setEffectiveUserId(request.getEffectiveUserId());
    getObjectType.setKey(snapshotId);
    getObjectType.setDeleteAfterGet(false);
    getObjectType.setGetData(true);
    getObjectType.setInlineData(false);
    getObjectType.setGetMetaData(false);
    getObjectType.setIsCompressed(true);
    try {
      walrusManager.getObject(getObjectType);
    }
 catch (    EucalyptusCloudException ex) {
      LOG.error(ex,ex);
      throw ex;
    }
  }
 else {
    db.rollback();
    throw new NoSuchEntityException(snapshotId);
  }
  return reply;
}
