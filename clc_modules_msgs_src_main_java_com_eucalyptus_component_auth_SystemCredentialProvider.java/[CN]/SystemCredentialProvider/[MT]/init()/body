{
  if (this.componentId.hasCredentials()) {
    if (EucaKeyStore.getInstance().containsEntry(this.name)) {
      try {
        SystemCredentialProvider.certs.put(this.name,EucaKeyStore.getInstance().getCertificate(this.name));
        SystemCredentialProvider.keypairs.put(this.name,EucaKeyStore.getInstance().getKeyPair(this.name,this.name));
        return;
      }
 catch (      Exception e) {
        SystemCredentialProvider.certs.remove(this);
        SystemCredentialProvider.keypairs.remove(this);
        LOG.fatal("Failed to read keys from the keystore.  Please repair the keystore by hand.");
        LOG.fatal(e,e);
        throw e;
      }
    }
 else     if (Components.lookup(Eucalyptus.class).isLocal()) {
      this.createSystemCredentialProviderKey(this.name);
      return;
    }
    throw new RuntimeException("Failed to load credentials because of an unknown error.");
  }
}
