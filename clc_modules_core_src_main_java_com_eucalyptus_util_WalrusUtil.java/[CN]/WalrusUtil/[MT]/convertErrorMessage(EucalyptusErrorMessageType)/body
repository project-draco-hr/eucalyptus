{
  EucalyptusMessage errMsg;
  Throwable ex=errorMessage.getException();
  if (ex instanceof WalrusException) {
    WalrusException e=(WalrusException)ex;
    errMsg=new WalrusErrorMessageType(e.getMessage(),e.getCode(),e.getStatus(),e.getResourceType(),e.getResource(),errorMessage.getCorrelationId(),ipAddress,e.getLogData());
    errMsg.setCorrelationId(errorMessage.getCorrelationId());
  }
 else {
    errMsg=errorMessage;
  }
  return errMsg;
}
