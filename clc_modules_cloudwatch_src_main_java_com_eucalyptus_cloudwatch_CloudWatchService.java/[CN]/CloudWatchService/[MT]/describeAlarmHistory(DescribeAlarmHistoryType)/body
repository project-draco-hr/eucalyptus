{
  DescribeAlarmHistoryResponseType reply=request.getReply();
  final Context ctx=Contexts.lookup();
  if (!hasActionPermission(PolicySpec.CLOUDWATCH_DESCRIBEALARMHISTORY,ctx)) {
    throw new EucalyptusCloudException();
  }
  final OwnerFullName ownerFullName=ctx.getUserFullName();
  final String accountId=ownerFullName.getAccountNumber();
  final String alarmName=request.getAlarmName();
  final Date endDate=request.getEndDate();
  final HistoryItemType historyItemType=request.getHistoryItemType() == null ? null : HistoryItemType.valueOf(request.getHistoryItemType());
  final Integer maxRecords=request.getMaxRecords();
  final Date startDate=request.getStartDate();
  Collection<AlarmHistory> results=AlarmManager.describeAlarmHistory(accountId,alarmName,endDate,historyItemType,maxRecords,startDate);
  AlarmHistoryItems alarmHistoryItems=new AlarmHistoryItems();
  alarmHistoryItems.setMember(Lists.newArrayList(Collections2.<AlarmHistory,AlarmHistoryItem>transform(results,AlarmHistoryFunction.INSTANCE)));
  reply.getDescribeAlarmHistoryResult().setAlarmHistoryItems(alarmHistoryItems);
  return reply;
}
