{
  ListMetricsResponseType reply=request.getReply();
  final Context ctx=Contexts.lookup();
  if (!hasActionPermission(PolicySpec.CLOUDWATCH_LISTMETRICS,ctx)) {
    throw new EucalyptusCloudException();
  }
  final OwnerFullName ownerFullName=ctx.getUserFullName();
  final String namespace=request.getNamespace();
  final String metricName=request.getMetricName();
  final Map<String,String> dimensionMap=transform(request.getDimensions());
  final Date after=new Date(System.currentTimeMillis() - 2 * 7 * 24* 60* 60* 1000L);
  final Date before=null;
  final Collection<ListMetric> results=ListMetricManager.listMetrics(ownerFullName.getAccountNumber(),metricName,namespace,dimensionMap,after,before);
  final Metrics metrics=new Metrics();
  metrics.setMember(Lists.newArrayList(Collections2.<ListMetric,Metric>transform(results,ListMetricFunction.INSTANCE)));
  final ListMetricsResult listMetricsResult=new ListMetricsResult();
  listMetricsResult.setMetrics(metrics);
  reply.setListMetricsResult(listMetricsResult);
  return reply;
}
