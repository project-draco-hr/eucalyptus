{
  PutMetricDataResponseType reply=request.getReply();
  final Context ctx=Contexts.lookup();
  if (!hasActionPermission(PolicySpec.CLOUDWATCH_PUTMETRICDATA,ctx)) {
    throw new EucalyptusCloudException();
  }
  final OwnerFullName ownerFullName=ctx.getUserFullName();
  final String nameSpace=request.getNamespace();
  final List<MetricDatum> metricDatum=Lists.newArrayList(request.getMetricData().getMember());
  final Boolean isUserAccountAdmin=ctx.getUser().isAccountAdmin();
  if (nameSpace.startsWith(SystemMetricPrefix) && isUserAccountAdmin) {
    MetricDataQueue.getInstance().insertMetricData(ownerFullName.getUserId(),ownerFullName.getAccountNumber(),nameSpace,metricDatum,MetricType.System);
  }
 else   if (!nameSpace.startsWith(SystemMetricPrefix)) {
    MetricDataQueue.getInstance().insertMetricData(ownerFullName.getUserId(),ownerFullName.getAccountNumber(),nameSpace,metricDatum,MetricType.Custom);
  }
 else {
    LOG.debug("Unknown metric data type");
  }
  return reply;
}
