{
  InstanceUsageArtEntity totalEntity=totals.getInstanceTotals();
  InstanceUsageArtEntity newEntity=instance.getUsage();
  totalEntity.addDurationMs(newEntity.getDurationMs());
  if (totalEntity.getCpuPercentAvg() == null && newEntity.getCpuPercentAvg() != null) {
    totalEntity.setCpuPercentAvg(newEntity.getCpuPercentAvg());
    totalEntity.addDurationMs(newEntity.getDurationMs());
  }
 else   if (newEntity.getCpuPercentAvg() != null && totalEntity.getCpuPercentAvg() != null) {
    double newWeightedAverage=(totalEntity.getCpuPercentAvg() * (double)totalEntity.getDurationMs() + (double)newEntity.getCpuPercentAvg() * (double)newEntity.getDurationMs()) / ((double)totalEntity.getDurationMs() + (double)newEntity.getDurationMs());
    totalEntity.setCpuPercentAvg(newWeightedAverage);
  }
  totalEntity.setDiskIoMegs(plus(totalEntity.getDiskIoMegs(),newEntity.getDiskIoMegs()));
  totalEntity.setNetIoBetweenZoneInMegs(plus(totalEntity.getNetIoBetweenZoneInMegs(),newEntity.getNetIoBetweenZoneInMegs()));
  totalEntity.setNetIoWithinZoneInMegs(plus(totalEntity.getNetIoWithinZoneInMegs(),newEntity.getNetIoWithinZoneInMegs()));
  totalEntity.setNetIoPublicIpInMegs(plus(totalEntity.getNetIoPublicIpInMegs(),newEntity.getNetIoPublicIpInMegs()));
  totalEntity.setNetIoBetweenZoneOutMegs(plus(totalEntity.getNetIoBetweenZoneOutMegs(),newEntity.getNetIoBetweenZoneOutMegs()));
  totalEntity.setNetIoWithinZoneOutMegs(plus(totalEntity.getNetIoWithinZoneOutMegs(),newEntity.getNetIoWithinZoneOutMegs()));
  totalEntity.setNetIoPublicIpOutMegs(plus(totalEntity.getNetIoPublicIpOutMegs(),newEntity.getNetIoPublicIpOutMegs()));
  totalEntity.setInstanceCnt(totalEntity.getInstanceCnt() + 1);
  Map<String,InstanceUsageArtEntity> typeTotals=totals.getTypeTotals();
  if (!typeTotals.containsKey(instance.getInstanceType().toLowerCase())) {
    typeTotals.put(instance.getInstanceType().toLowerCase(),new InstanceUsageArtEntity());
  }
  InstanceUsageArtEntity typeTotal=typeTotals.get(instance.getInstanceType().toLowerCase());
  typeTotal.setInstanceCnt(typeTotal.getInstanceCnt() + 1);
  typeTotal.setDurationMs(typeTotal.getDurationMs() + totalEntity.getDurationMs());
}
