{
  RunInstancesType msg=vmAllocInfo.getRequest();
  String imageId=msg.getImageId();
  VmTypeInfo vmType=vmAllocInfo.getVmTypeInfo();
  Partition partition=vmAllocInfo.getPartition();
  BootableSet bootSet=Emis.newBootableSet(vmType,partition,imageId);
  vmAllocInfo.setPlatform(bootSet.getMachine().getPlatform().name());
  vmAllocInfo.getPlatform();
  if (bootSet.isLinux()) {
    bootSet=Emis.bootsetWithKernel(bootSet);
    bootSet=Emis.bootsetWithRamdisk(bootSet);
  }
  Emis.checkStoredImage(bootSet);
  bootSet.populateVirtualBootRecord(vmType);
  return vmAllocInfo;
}
