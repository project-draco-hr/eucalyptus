{
  EntityWrapper<InstanceAttributes> entityWrapper=EntityWrapper.get(InstanceAttributes.class);
  Session sess=null;
  try {
    sess=entityWrapper.getSession();
    @SuppressWarnings("rawtypes") Iterator iter=sess.createQuery("from StorageUsageSnapshot as sus" + " where sus.timestampMs > ?" + " and sus.timestampMs < ?"+ " order by sus.timestamp").setLong(0,period.getBeginningMs()).setLong(1,period.getEndingMs()).iterate();
    return new StorageUsageSnapshotIterator(iter);
  }
 catch (  Exception ex) {
    log.error(ex);
    entityWrapper.rollback();
    throw new RuntimeException(ex);
  }
}
