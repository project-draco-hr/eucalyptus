{
  ModifyImageAttributeResponseType reply=(ModifyImageAttributeResponseType)request.getReply();
  Context ctx=Contexts.lookup();
  if (request.getAttribute() != null)   request.applyAttribute();
  if (request.getProductCodes().isEmpty()) {
    reply.set_return(ImageUtil.modifyImageInfo(ctx.getUser(),request.getImageId(),request.getAdd(),request.getRemove()));
  }
 else {
    EntityWrapper<ImageInfo> db=EntityWrapper.get(ImageInfo.class);
    ImageInfo imgInfo=null;
    try {
      imgInfo=db.getUnique(Images.exampleWithImageId(request.getImageId()));
      for (      String productCode : request.getProductCodes()) {
        imgInfo.addProductCode(productCode);
      }
      db.commit();
      reply.set_return(true);
    }
 catch (    EucalyptusCloudException e) {
      db.rollback();
      reply.set_return(false);
    }
  }
  return reply;
}
