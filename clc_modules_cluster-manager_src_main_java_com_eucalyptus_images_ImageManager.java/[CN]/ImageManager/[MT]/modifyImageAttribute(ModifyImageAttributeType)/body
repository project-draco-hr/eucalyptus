{
  ModifyImageAttributeResponseType reply=(ModifyImageAttributeResponseType)request.getReply();
  if (request.getAttribute() != null)   request.applyAttribute();
  if (request.getProductCodes().isEmpty()) {
    reply.set_return(ImageUtil.modifyImageInfo(request.getUser(),request.getImageId(),request.getAdd(),request.getRemove()));
  }
 else {
    EntityWrapper<ImageInfo> db=new EntityWrapper<ImageInfo>();
    ImageInfo imgInfo=null;
    try {
      imgInfo=db.getUnique(Images.exampleWithImageId(request.getImageId()));
      for (      String productCode : request.getProductCodes()) {
        ProductCode prodCode=new ProductCode(productCode);
        if (!imgInfo.getProductCodes().contains(prodCode)) {
          imgInfo.getProductCodes().add(prodCode);
        }
      }
      db.commit();
      reply.set_return(true);
    }
 catch (    EucalyptusCloudException e) {
      db.rollback();
      reply.set_return(false);
    }
  }
  return reply;
}
