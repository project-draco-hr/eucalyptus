{
  RunInstancesType msg=vmAllocInfo.getRequest();
  String imageId=msg.getImageId();
  BootableSet bootSet=Emis.newBootableSet(imageId);
  vmAllocInfo.setPlatform(bootSet.getMachine().getPlatform().name());
  if (bootSet.isLinux()) {
    bootSet=Emis.bootsetWithKernel(bootSet);
    bootSet=Emis.bootsetWithRamdisk(bootSet);
{
      ImageUtil.checkStoredImage(bootSet.getKernel());
      ImageUtil.checkStoredImage(bootSet.getRamdisk());
    }
  }
  ArrayList<String> ancestorIds=Lists.newArrayList();
  Emis.checkStoredImage(bootSet);
  VmTypeInfo vmType=vmAllocInfo.getVmTypeInfo();
  bootSet.populateVirtualBootRecord(vmType);
  return vmAllocInfo;
}
