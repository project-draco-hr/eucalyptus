{
  DeregisterImageResponseType reply=request.getReply();
  Context ctx=Contexts.lookup();
  User requestUser=ctx.getUser();
  Account requestAccount=ctx.getAccount();
  try {
    ImageInfo imgInfo=EntityWrapper.get(ImageInfo.class).lookupAndClose(Images.exampleWithImageId(request.getImageId()));
    if (requestUser.isAccountAdmin() && imgInfo.getOwnerAccountId().equals(ctx.getAccount().getId())) {
      Images.deregisterImage(imgInfo.getDisplayName());
    }
 else     if (ctx.hasAdministrativePrivileges()) {
      Images.deregisterImage(imgInfo.getDisplayName());
    }
 else {
      throw new EucalyptusCloudException("Only the owner of a registered image or the administrator can deregister it.");
    }
    return reply;
  }
 catch (  NoSuchImageException ex) {
    LOG.trace(ex);
    reply.set_return(false);
    return reply;
  }
catch (  NoSuchElementException ex) {
    LOG.trace(ex);
    reply.set_return(false);
    return reply;
  }
}
