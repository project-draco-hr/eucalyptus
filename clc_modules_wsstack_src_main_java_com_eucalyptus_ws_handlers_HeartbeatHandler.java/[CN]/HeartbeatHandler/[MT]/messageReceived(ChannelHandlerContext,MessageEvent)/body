{
  Object message=((MessageEvent)e).getMessage();
  if (message instanceof MappingHttpRequest) {
    MappingHttpRequest request=((MappingHttpRequest)message);
    if (HttpMethod.GET.equals(request.getMethod())) {
      handleGet(ctx,request);
    }
 else     if (!initialized.get() && pending.compareAndSet(false,true)) {
      try {
        handleInitialize(ctx,request);
      }
 catch (      Exception ex) {
        LOG.error(ex,ex);
        throw ex;
      }
 finally {
        pending.set(false);
      }
    }
 else     if (initialized.get() && request.getMessage() instanceof HeartbeatType) {
      handleHeartbeat(request);
    }
 else {
      ChannelFuture writeFuture=ctx.getChannel().write(new DefaultHttpResponse(request.getProtocolVersion(),HttpResponseStatus.NOT_ACCEPTABLE));
      writeFuture.addListener(ChannelFutureListener.CLOSE);
    }
  }
 else {
    super.messageReceived(ctx,e);
  }
}
