{
  HeartbeatType hb=(HeartbeatType)request.getMessage();
  List<String> registeredComponents=Lists.newArrayList();
  for (  ComponentType started : hb.getStarted()) {
    try {
      URI uri=URI.create(started.getUri());
      String componentName=started.getComponent();
      final Component c=safeLookupComponent(componentName);
      c.buildService(new ComponentConfiguration(started.getName(),uri.getHost(),uri.getPort(),uri.getPath()){
        @Override public com.eucalyptus.bootstrap.Component getComponent(){
          return c.getPeer();
        }
      }
);
    }
 catch (    ServiceRegistrationException ex) {
      LOG.error(ex,ex);
    }
catch (    NoSuchElementException ex) {
      LOG.error(ex,ex);
    }
  }
  for (  ComponentType stopped : hb.getStarted()) {
    if (Components.contains(stopped.getComponent())) {
      Components.lookup(stopped.getComponent()).removeService(null);
    }
  }
  for (  HeartbeatComponentType component : hb.getComponents()) {
    if (!initializedComponents.contains(component.getComponent()) && !com.eucalyptus.bootstrap.Component.eucalyptus.isLocal()) {
      System.exit(123);
    }
    registeredComponents.add(component.getComponent());
  }
  if (!registeredComponents.containsAll(initializedComponents) && !com.eucalyptus.bootstrap.Component.eucalyptus.isLocal()) {
    System.exit(123);
  }
}
