{
  LOG.debug("Starting cluster message queue: " + Thread.currentThread().getName());
  while (!this.finished.get()) {
    try {
      final QueuedEvent event=this.msgQueue.poll(this.pollInterval,TimeUnit.MILLISECONDS);
      if (event != null) {
        LOG.debug("-> Dequeued message of type " + event.getCallback().getClass().getSimpleName());
        final long start=System.currentTimeMillis();
        try {
          event.getCallback().send(this.clusterName);
        }
 catch (        final Throwable e) {
          LOG.debug(e,e);
        }
        LOG.info(EventRecord.here(ClusterMessageQueue.class,EventType.QUEUE,this.clusterName,event.getCallback().getClass().getSimpleName(),EventType.QUEUE_TIME.name(),Long.toString(start - event.getStartTime()),EventType.SERVICE_TIME.name(),Long.toString(System.currentTimeMillis() - start),EventType.QUEUE_LENGTH.name(),Long.toString(this.msgQueue.size())));
      }
    }
 catch (    final Throwable e) {
      LOG.error(e,e);
    }
  }
  LOG.debug("Shutting down cluster message queue: " + Thread.currentThread().getName());
}
