{
  final StartInstancesResponseType reply=request.getReply();
  for (  String instanceId : request.getInstancesSet()) {
    EntityTransaction db=Entities.get(VmInstance.class);
    try {
      final VmInstance vm=RestrictedTypes.doPrivileged(instanceId,VmInstance.class);
      try {
        VmInstances.start(vm);
        final int oldCode=vm.getState().getCode(), newCode=VmState.PENDING.getCode();
        final String oldState=vm.getState().getName(), newState=VmState.PENDING.getName();
        reply.getInstancesSet().add(new TerminateInstancesItemType(vm.getInstanceId(),oldCode,oldState,newCode,newState));
      }
 catch (      MetadataException ex1) {
        LOG.error(ex1,ex1);
      }
      db.commit();
    }
 catch (    Exception ex) {
      Logs.exhaust().error(ex,ex);
      db.rollback();
    }
  }
  return reply;
}
