{
  if (event.getMessage() instanceof MappingHttpMessage) {
    MappingHttpMessage httpMessage=(MappingHttpMessage)event.getMessage();
    ByteArrayOutputStream byteOut=new ByteArrayOutputStream();
    httpMessage.getSoapEnvelope().serialize(byteOut);
    ChannelBuffer buffer=ChannelBuffers.wrappedBuffer(byteOut.toByteArray());
    httpMessage.addHeader(HttpHeaders.Names.CONTENT_LENGTH,String.valueOf(buffer.readableBytes()));
    httpMessage.addHeader(HttpHeaders.Names.CONTENT_TYPE,"text/xml; charset=UTF-8");
    httpMessage.setContent(buffer);
  }
}
