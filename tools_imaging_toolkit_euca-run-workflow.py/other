import os
import subprocess
import argparse
import sys
WORKFLOWS = {'down-bundle-fs/up-bundle': WF_DownBundleFS_UpBundle(), 'down-bundle/write-raw': WF_DownBundle_WriteRaw(), 'down-bundle/up-vmdk': WF_DownBundle_UpVMDK(), }
parser = argparse.ArgumentParser(description='Run an Imaging Toolkit workflow.')
parser.add_argument('-l', '--list', required=False, help='Lists the available workflows', action='store_true')
parser.add_argument('--name', metavar='WORKFLOW', required=False, help='Name of the workflow to run')
for name in WORKFLOWS:
    WORKFLOWS[name].add_arguments(parser)
args = parser.parse_args()
for name in WORKFLOWS:
    WORKFLOWS[name].check_deps(args)
if args.list:
    for name in WORKFLOWS:
        if (len(WORKFLOWS[name].problems) == 0):
            print ('%30s: %s' % (name, WORKFLOWS[name].description))
    sys.exit(0)
if (args.name == None):
    print 'workflow name is required'
    sys.exit(1)
try:
    WORKFLOWS[args.name].execute(args)
except KeyError:
    print (("unknown workflow '" + args.name) + "'")
    sys.exit(2)
except WF_InsufficientArguments as e:
    print (("insufficient arguments for workflow '" + args.name) + "'")
except WF_InsufficientDependencies as e:
    print (("workflow '" + args.name) + "' is unavailable! Problems:")
    for problem in e.args[0]:
        print ('\t - ' + problem)
