{
  EntityWrapper<ClusterConfiguration> db=Configuration.getEntityWrapper();
  EntityWrapper<ClusterCredentials> credDb=Credentials.getEntityWrapper();
  try {
    ClusterConfiguration clusterConfig=db.getUnique(ClusterConfiguration.byClusterName(request.getName()));
    ClusterCredentials clusterCredentials=new ClusterCredentials(clusterConfig.getClusterName());
    String directory=SubDirectory.KEYS.toString() + File.separator + clusterConfig.getClusterName();
    db.delete(clusterConfig);
    credDb.delete(clusterCredentials);
    File keyDir=new File(directory);
    for (    File f : keyDir.listFiles()) {
      if (!f.delete()) {
        LOG.warn("Failed to delete key file: " + f.getAbsolutePath());
      }
    }
    if (!keyDir.delete()) {
      LOG.warn("Failed to delete key directory: " + keyDir.getAbsolutePath());
    }
  }
 catch (  EucalyptusCloudException e) {
    db.rollback();
    credDb.rollback();
    throw e;
  }
  DeregisterClusterResponseType reply=(DeregisterClusterResponseType)request.getReply();
  reply.set_return(true);
  return reply;
}
