{
  final DescribeComponentsResponseType reply=(DescribeComponentsResponseType)request.getReply();
  final List<ComponentInfoType> listConfigs=reply.getRegistered();
  if (DescribeComponentsType.class.equals(request.getClass())) {
    for (    final Component c : Components.list()) {
      if (c.lookupServices().isEmpty()) {
        listConfigs.add(new ComponentInfoType(String.format("%-15.15s",c.getComponentId().name().toUpperCase()),c.getComponentId().name(),"",c.getState().toString(),""));
      }
 else {
        for (        final ServiceConfiguration conf : c.lookupServiceConfigurations()) {
          try {
            listConfigs.add(new ComponentInfoType(String.format("%-15.15s",conf.getComponentId().name().toUpperCase()) + (conf.getPartition() != null ? conf.getPartition() : "-"),conf.getFullName().toString(),conf.getHostName(),conf.lookupStateMachine().getState().toString(),""));
          }
 catch (          final Exception ex) {
            LOG.error(ex,ex);
            listConfigs.add(new ComponentInfoType(String.format("%-15.15s",conf.getComponentId().name().toUpperCase()) + (conf.getPartition() != null ? conf.getPartition() : "-"),conf.getFullName().toString(),conf.getHostName(),"none",""));
          }
          for (          final String d : Collections2.transform(conf.lookupDetails(),Functions.toStringFunction())) {
            listConfigs.add(new ComponentInfoType(String.format("%-15.15s",conf.getComponentId().name().toUpperCase()) + (conf.getPartition() != null ? conf.getPartition() : "-"),conf.getName(),"detail",d,""));
          }
        }
      }
    }
  }
 else {
    for (    final ServiceConfiguration conf : ServiceBuilderRegistry.handles(request.getClass()).list()) {
      try {
        final Service s=Components.lookup(conf.getComponentId()).lookupService(conf);
        listConfigs.add(new ComponentInfoType(conf.getPartition(),conf.getName(),conf.getHostName(),conf.lookupStateMachine().getState().toString(),Collections2.transform(conf.lookupDetails(),Functions.toStringFunction())));
      }
 catch (      final NoSuchElementException ex) {
        listConfigs.add(new ComponentInfoType(conf.getPartition(),conf.getName(),conf.getHostName(),Component.State.NOTREADY.toString(),"unknown"));
        LOG.error(ex,ex);
      }
    }
  }
  return reply;
}
