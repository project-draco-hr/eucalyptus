{
  DescribeComponentsResponseType reply=(DescribeComponentsResponseType)request.getReply();
  List<ComponentInfoType> listConfigs=reply.getRegistered();
  if (DescribeComponentsType.class.equals(request.getClass())) {
    for (    Component c : Components.list()) {
      if (c.lookupServices().isEmpty()) {
        listConfigs.add(new ComponentInfoType(String.format("%-15.15s",c.getComponentId().name().toUpperCase()),c.getComponentId().name(),"",c.getState().toString(),""));
      }
 else {
        for (        Service s : c.lookupServices()) {
          ServiceConfiguration conf=s.getServiceConfiguration();
          listConfigs.add(new ComponentInfoType(String.format("%-15.15s",conf.getComponentId().name().toUpperCase()) + (conf.getPartition() != null ? conf.getPartition() : "-"),conf.getName(),conf.getHostName(),s.getState().toString(),""));
          for (          String d : s.getDetails()) {
            listConfigs.add(new ComponentInfoType(String.format("%-15.15s",conf.getComponentId().name().toUpperCase()) + (conf.getPartition() != null ? conf.getPartition() : "-"),conf.getName(),"detail",d,""));
          }
        }
      }
    }
  }
 else {
    for (    ServiceConfiguration conf : ServiceBuilderRegistry.handles(request.getClass()).list()) {
      try {
        Service s=Components.lookup(conf.getComponentId()).lookupService(conf);
        listConfigs.add(new ComponentInfoType(conf.getPartition(),conf.getName(),conf.getHostName(),s.getState().toString(),s.getDetails()));
      }
 catch (      NoSuchElementException ex) {
        listConfigs.add(new ComponentInfoType(conf.getPartition(),conf.getName(),conf.getHostName(),Component.State.NOTREADY.toString(),"unknown"));
        LOG.error(ex,ex);
      }
    }
  }
  return reply;
}
