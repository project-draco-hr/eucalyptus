{
  final DescribeComponentsResponseType reply=(DescribeComponentsResponseType)request.getReply();
  final List<ComponentInfoType> listConfigs=reply.getRegistered();
  if (DescribeComponentsType.class.equals(request.getClass())) {
    for (    final Component c : Components.list()) {
      if (!c.hasLocalService()) {
        listConfigs.add(new ComponentInfoType(){
{
            setType(c.getComponentId().name());
            setPartition(c.getComponentId().getPartition());
            setName("");
            setHostName("");
            setFullName("");
            setState(c.getState().toString());
            setDetail("");
          }
        }
);
      }
 else {
        final ServiceConfiguration config=c.getLocalServiceConfiguration();
        listConfigs.add(new ComponentInfoType(){
{
            setType(config.getComponentId().name());
            setPartition(config.getPartition());
            setName(config.getName());
            setHostName(config.getHostName());
            setFullName(config.getFullName().toString());
            setState(config.lookupState().toString());
            setDetail(config.lookupDetails().isEmpty() || !Boolean.TRUE.equals(request.getVerbose()) ? "" : config.lookupDetails().iterator().next().toString());
          }
        }
);
      }
    }
  }
 else {
    for (    final ServiceConfiguration config : ServiceBuilderRegistry.handles(request.getClass()).list()) {
      try {
        listConfigs.add(new ComponentInfoType(){
{
            setType(config.getComponentId().name());
            setPartition(config.getPartition());
            setName(config.getName());
            setHostName(config.getHostName());
            setFullName(config.getFullName().toString());
            setState(config.lookupState().toString());
            setDetail(config.lookupDetails().isEmpty() || !Boolean.TRUE.equals(request.getVerbose()) ? "" : config.lookupDetails().iterator().next().toString());
          }
        }
);
      }
 catch (      final NoSuchElementException ex) {
        LOG.error(ex,ex);
        listConfigs.add(new ComponentInfoType(){
{
            setType(config.getComponentId().name());
            setPartition(config.getPartition());
            setName(config.getName());
            setHostName(config.getHostName());
            setFullName(config.getFullName().toString());
            setState(config.lookupComponent().getState().toString());
            setDetail(config.lookupDetails().isEmpty() || !Boolean.TRUE.equals(request.getVerbose()) ? "" : config.lookupDetails().iterator().next().toString());
          }
        }
);
      }
    }
  }
  return reply;
}
