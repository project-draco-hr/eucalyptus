{
  GetMetricStatisticsResponseType reply=request.getReply();
  final Context ctx=Contexts.lookup();
  try {
    checkActionPermission(PolicySpec.CLOUDWATCH_GETMETRICSTATISTICS,ctx);
    final OwnerFullName ownerFullName=ctx.getUserFullName();
    Statistics statistics=CloudWatchBackendServiceFieldValidator.validateStatistics(request.getStatistics());
    final String namespace=CloudWatchBackendServiceFieldValidator.validateNamespace(request.getNamespace(),true);
    final String metricName=CloudWatchBackendServiceFieldValidator.validateMetricName(request.getMetricName(),true);
    final Date startTime=MetricUtils.stripSeconds(CloudWatchBackendServiceFieldValidator.validateStartTime(request.getStartTime(),true));
    final Date endTime=MetricUtils.stripSeconds(CloudWatchBackendServiceFieldValidator.validateEndTime(request.getEndTime(),true));
    final Integer period=CloudWatchBackendServiceFieldValidator.validatePeriod(request.getPeriod(),true);
    CloudWatchBackendServiceFieldValidator.validateDateOrder(startTime,endTime,"StartTime","EndTime",true,true);
    CloudWatchBackendServiceFieldValidator.validateNotTooManyDataPoints(startTime,endTime,period,1440L);
    final Units units=CloudWatchBackendServiceFieldValidator.validateUnits(request.getUnit(),false);
    final Map<String,String> dimensionMap=TransformationFunctions.DimensionsToMap.INSTANCE.apply(CloudWatchBackendServiceFieldValidator.validateDimensions(request.getDimensions()));
    Collection<MetricStatistics> metrics;
    metrics=MetricManager.getMetricStatistics(ownerFullName.getAccountNumber(),metricName,namespace,dimensionMap,CloudWatchBackendServiceFieldValidator.getMetricTypeFromNamespace(namespace),units,startTime,endTime,period);
    reply.getGetMetricStatisticsResult().setLabel(metricName);
    ArrayList<Datapoint> datapoints=CloudWatchBackendServiceFieldValidator.convertMetricStatisticsToDatapoints(statistics,metrics);
    if (datapoints.size() > 0) {
      Datapoints datapointsReply=new Datapoints();
      datapointsReply.setMember(datapoints);
      reply.getGetMetricStatisticsResult().setDatapoints(datapointsReply);
    }
  }
 catch (  Exception ex) {
    handleException(ex);
  }
  return reply;
}
