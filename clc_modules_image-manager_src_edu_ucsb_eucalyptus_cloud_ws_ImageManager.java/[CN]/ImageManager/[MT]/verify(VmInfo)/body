{
  SystemConfiguration conf=EucalyptusProperties.getSystemConfiguration();
  String walrusUrl=getStorageUrl(conf);
  ArrayList<String> productCodes=Lists.newArrayList();
  ImageInfo diskInfo=null, kernelInfo=null, ramdiskInfo=null;
  String diskUrl=null, kernelUrl=null, ramdiskUrl=null;
  EntityWrapper<ImageInfo> db=new EntityWrapper<ImageInfo>();
  try {
    diskInfo=db.getUnique(ImageInfo.named(vmInfo.getImageId()));
    for (    ProductCode p : diskInfo.getProductCodes()) {
      productCodes.add(p.getValue());
    }
    diskUrl=this.getImageUrl(walrusUrl,diskInfo);
  }
 catch (  EucalyptusCloudException e) {
  }
  ArrayList<String> ancestorIds=this.getAncestors(vmInfo.getOwnerId(),diskInfo.getImageLocation());
  VmImageInfo vmImgInfo=new VmImageInfo(vmInfo.getImageId(),vmInfo.getKernelId(),vmInfo.getRamdiskId(),diskUrl,null,null,productCodes);
  vmImgInfo.setAncestorIds(ancestorIds);
  return vmImgInfo;
}
