{
  if (event.getMessage() instanceof MappingHttpRequest) {
    MappingHttpRequest httpRequest=(MappingHttpRequest)event.getMessage();
    if (httpRequest.getMessage() instanceof WalrusRequestType) {
      WalrusRequestType request=(WalrusRequestType)httpRequest.getMessage();
      BucketLogData logData=request.getLogData();
      if (logData != null) {
        logData.setTotalTime(System.currentTimeMillis());
        logData.setUri(httpRequest.getUri());
        String referrer=httpRequest.getHeader(HttpHeaders.Names.REFERER);
        if (referrer != null)         logData.setReferrer(referrer);
        String userAgent=httpRequest.getHeader(HttpHeaders.Names.USER_AGENT);
        if (userAgent != null)         logData.setUserAgent(userAgent);
        logData.setTimestamp(String.format("[%1$td/%1$tb/%1$tY:%1$tH:%1$tM:%1$tS %1$tz]",Calendar.getInstance()));
        User user=httpRequest.getUser();
        if (user != null)         logData.setAccessorId(user.getUserName());
        if (request.getBucket() != null)         logData.setBucketName(request.getBucket());
        if (request.getKey() != null)         logData.setKey(request.getKey());
        logData.setSourceAddress(ctx.getChannel().getRemoteAddress().toString());
      }
    }
  }
}
