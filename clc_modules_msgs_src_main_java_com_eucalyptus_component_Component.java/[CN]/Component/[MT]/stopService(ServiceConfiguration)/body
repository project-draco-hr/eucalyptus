{
  EventRecord.caller(Component.class,EventType.COMPONENT_SERVICE_STOPPED,this.getName(),config.getName(),config.getUri().toString()).info();
  if (config.isLocal()) {
    if (State.ENABLED.equals(this.stateMachine.getState())) {
      try {
        final CheckedListenableFuture<Component> future=new TransitionFuture<Component>();
        this.stateMachine.transition(State.DISABLED).addListener(new Runnable(){
          @Override public void run(){
            try {
              Component.this.stateMachine.transition(State.STOPPED);
              Component.this.serviceRegistry.deregister(config);
              future.set(Component.this);
            }
 catch (            Throwable ex) {
              Exceptions.trace(new ServiceRegistrationException("Failed to stop service: " + config + " because of: "+ ex.getMessage(),ex));
              future.setException(ex);
            }
          }
        }
,Threads.currentThreadExecutor());
        return future;
      }
 catch (      Throwable ex) {
        throw new ServiceRegistrationException("Failed to disable service: " + config + " because of: "+ ex.getMessage(),ex);
      }
    }
 else     if (State.DISABLED.equals(this.stateMachine.getState()) || State.NOTREADY.equals(this.stateMachine.getState())) {
      try {
        return Component.this.stateMachine.transition(State.STOPPED);
      }
 catch (      Throwable ex) {
        throw new ServiceRegistrationException("Failed to stop service: " + config + " because of: "+ ex.getMessage(),ex);
      }
    }
 else {
      return Futures.predestinedFuture(this);
    }
  }
 else {
    this.getBuilder().fireStop(config);
    return Futures.predestinedFuture(this);
  }
}
