{
  EventRecord.caller(Component.class,EventType.COMPONENT_SERVICE_START,this.getName(),config.getName(),config.getUri().toString()).info();
  try {
    this.serviceRegistry.register(this.serviceRegistry.lookup(config));
  }
 catch (  NoSuchElementException ex1) {
    this.serviceRegistry.register(new Service(this.getComponentId(),config));
  }
  if (config.isLocal()) {
    this.stateMachine.setGoal(this.serviceRegistry.getServices().isEmpty() ? State.ENABLED : State.DISABLED);
    if (this.inState(State.LOADED)) {
      final CheckedListenableFuture<Component> future=Futures.newGenericFuture();
      try {
        this.stateMachine.transition(Transition.STARTING).addListener(new Callable<Component>(){
          @Override public Component call(){
            try {
              Component.this.stateMachine.transition(State.DISABLED);
              future.set(Component.this);
            }
 catch (            Throwable ex) {
              future.setException(ex);
              Exceptions.trace(new ServiceRegistrationException("Failed to mark service disabled: " + config + " because of: "+ ex.getMessage(),ex));
            }
            return Component.this;
          }
        }
);
      }
 catch (      Throwable ex) {
        future.setException(new ServiceRegistrationException("Failed to start service: " + config + " because of: "+ ex.getMessage(),ex));
      }
      return future;
    }
 else     if (this.inState(State.NOTREADY)) {
      try {
        return this.stateMachine.transition(State.DISABLED);
      }
 catch (      Throwable ex) {
        final CheckedListenableFuture<Component> future=Futures.newGenericFuture();
        future.setException(new ServiceRegistrationException("Failed to mark service disabled: " + config + " because of: "+ ex.getMessage(),ex));
        return future;
      }
    }
 else {
      return Futures.predestinedFuture(this);
    }
  }
 else {
    this.getBuilder().fireStart(config);
    return Futures.predestinedFuture(this);
  }
}
