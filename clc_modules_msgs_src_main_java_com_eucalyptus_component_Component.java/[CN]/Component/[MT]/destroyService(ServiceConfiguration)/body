{
  try {
    Service remove=this.serviceRegistry.deregister(config);
    if (remove.getServiceConfiguration().isLocal()) {
      if (State.STOPPED.ordinal() < this.stateMachine.getState().ordinal()) {
        this.stopService(config);
      }
      try {
        EventRecord.caller(Component.class,EventType.COMPONENT_SERVICE_DESTROY,this.getName(),remove.getName(),remove.getUri().toString()).info();
        return this.stateMachine.transition(Transition.DESTROYING);
      }
 catch (      Throwable ex) {
        throw new ServiceRegistrationException("Failed to destroy service: " + config + " because of: "+ ex.getMessage(),ex);
      }
    }
 else {
      return Futures.predestinedFuture(this);
    }
  }
 catch (  NoSuchElementException ex) {
    throw new ServiceRegistrationException("Failed to find service corresponding to: " + config,ex);
  }
}
