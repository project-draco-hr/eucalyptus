{
  Service service=this.serviceRegistry.hasLocalService() ? new ComplexService(this.serviceRegistry.lookup(config)) : new ComplexService(config);
  this.serviceRegistry.register(service);
  if (State.INITIALIZED.equals(this.getState())) {
    try {
      return this.getLocalService().transition(Transition.LOADING);
    }
 catch (    Throwable ex) {
      throw new ServiceRegistrationException("Failed to load service: " + config + " because of: "+ ex.getMessage(),ex);
    }
  }
 else   if (State.LOADED.equals(this.getState())) {
    return Futures.predestinedFuture(this.getLocalService().getServiceConfiguration());
  }
 else {
    return Futures.predestinedFuture(this.getLocalService().getServiceConfiguration());
  }
}
