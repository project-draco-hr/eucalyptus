{
  Service service=null;
  if (config.isLocal() && !this.serviceRegistry.hasLocalService()) {
    service=this.serviceRegistry.register(config);
    try {
      service.transition(State.INITIALIZED);
    }
 catch (    IllegalStateException ex) {
      LOG.error(ex,ex);
      throw new ServiceRegistrationException("Loading service " + config + " failed because of: "+ ex.getMessage(),ex);
    }
catch (    NoSuchElementException ex) {
      LOG.error(ex,ex);
      throw new ServiceRegistrationException("Loading service " + config + " failed because of: "+ ex.getMessage(),ex);
    }
catch (    ExistingTransitionException ex) {
      LOG.error(ex,ex);
      throw new ServiceRegistrationException("Loading service " + config + " failed because of: "+ ex.getMessage(),ex);
    }
  }
 else   if (this.serviceRegistry.hasService(config)) {
    service=this.serviceRegistry.lookup(config);
  }
 else {
    service=this.serviceRegistry.register(config);
  }
  if (State.INITIALIZED.equals(service.getState())) {
    try {
      return service.transition(Transition.LOADING);
    }
 catch (    Throwable ex) {
      throw new ServiceRegistrationException("Failed to load service: " + config + " because of: "+ ex.getMessage(),ex);
    }
  }
 else   if (State.LOADED.equals(service.getState())) {
    return Futures.predestinedFuture(service.getServiceConfiguration());
  }
 else {
    return Futures.predestinedFuture(service.getServiceConfiguration());
  }
}
