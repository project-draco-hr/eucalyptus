{
  for (  Grant grant : newGrants) {
    boolean found=false;
    for (    GrantInfo gInfo : grants) {
      if (grant.getGrantee().getCanonicalUser() != null) {
        if (grant.getGrantee().getCanonicalUser().equals(gInfo.getUserId()))         found=true;
      }
 else {
        if (grant.getGrantee().getGroup().equals(gInfo.getGrantGroup()))         found=true;
        if (WalrusProperties.ALL_USERS_GROUP.equals(gInfo.getGrantGroup())) {
          readAllUsers(grant.getPermission());
          break;
        }
      }
      if (found) {
        gInfo.setPermission(grant.getPermission());
        break;
      }
    }
    if (!found) {
      GrantInfo grantInfo=new GrantInfo();
      if (grant.getGrantee().getCanonicalUser() != null) {
        grantInfo.setUserId(grant.getGrantee().getCanonicalUser().getDisplayName());
      }
 else {
        grantInfo.setGrantGroup(grant.getGrantee().getGroup().getUri());
        if (WalrusProperties.ALL_USERS_GROUP.equals(grantInfo.getGrantGroup())) {
          readAllUsers(grant.getPermission());
          continue;
        }
      }
      String permission=grant.getPermission();
      grantInfo.setPermission(permission);
      grants.add(grantInfo);
    }
  }
}
