{
  if (Bootstrap.isFinished() && Hosts.isCoordinator()) {
    final List<Availability> resourceAvailability=Lists.newArrayList();
    for (    final Cluster cluster : Clusters.getInstance().listValues()) {
      long total=0;
      try {
        total=Transactions.find(new StorageInfo(cluster.getPartition())).getMaxTotalVolumeSizeInGb();
      }
 catch (      TransactionException e) {
        logger.debug("Error finding capacity for " + cluster.getPartition(),e);
      }
      resourceAvailability.add(new Availability(total,Math.max(total - StorageUtil.getBlockStorageTotalSize(cluster.getPartition()),0),Lists.<Tag>newArrayList(new ResourceAvailabilityEvent.Dimension("availabilityZone",cluster.getPartition()),new ResourceAvailabilityEvent.Dimension("cluster",cluster.getName()))));
    }
    try {
      ListenerRegistry.getInstance().fireEvent(new ResourceAvailabilityEvent(StorageEBS,resourceAvailability));
    }
 catch (    Exception ex) {
      logger.error(ex,ex);
    }
  }
}
