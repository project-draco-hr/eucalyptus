def run(self, command, data=None):
    command = command.split('|')
    command = map(shlex.split, command)
    for c in command:
        if len(self.history):
            data = self.history[(-1)].std_out
        p = subprocess.Popen(c, universal_newlines=True, shell=False, env=os.environ, stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE)
        (out, err) = p.communicate(input=data)
        r = Response(process=p)
        r.command = c
        r.std_out = out
        r.std_err = err
        r.status_code = p.returncode
        self.history.append(r)
    return self.status
