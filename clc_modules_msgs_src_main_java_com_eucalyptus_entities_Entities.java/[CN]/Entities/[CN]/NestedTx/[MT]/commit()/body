{
  this.record.logEvent(TxState.BEGIN,TxEvent.COMMIT);
  try {
    this.transaction.commit();
    this.record.logEvent(TxState.END,TxEvent.COMMIT);
  }
 catch (  final RuntimeException e) {
    this.rollback();
    this.record.logEvent(TxState.FAIL,TxEvent.COMMIT);
    PersistenceExceptions.throwFiltered(e);
    throw e;
  }
 finally {
    this.cleanup();
  }
}
