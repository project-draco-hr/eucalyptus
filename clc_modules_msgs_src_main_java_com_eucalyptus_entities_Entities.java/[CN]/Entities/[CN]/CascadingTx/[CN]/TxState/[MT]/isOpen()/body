{
  final boolean hasEm=(this.em != null) && this.em.isOpen();
  final boolean hasSession=(this.sessionRef.get() != null) && this.sessionRef.get().isOpen();
  final boolean hasTx=(this.transaction != null) && this.transaction.isActive();
  if (hasEm && hasSession && hasTx) {
    return true;
  }
 else {
    this.doCleanup();
    return false;
  }
}
