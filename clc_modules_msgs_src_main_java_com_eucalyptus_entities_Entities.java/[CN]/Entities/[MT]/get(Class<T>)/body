{
  Ats ats=Ats.inClassHierarchy(type);
  if (!ats.has(PersistenceContext.class)) {
    throw new RuntimeException("Attempting to create an entity wrapper instance for non persistent type: " + type.getCanonicalName() + ".  Class hierarchy contains: \n"+ ats.toString());
  }
 else {
    final PersistenceContext persistenceContext=ats.get(PersistenceContext.class);
    EntityWrapper<T> entityWrapper=tl.lookup(persistenceContext);
    return entityWrapper;
  }
}
