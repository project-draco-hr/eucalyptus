{
  try {
    Object id=null;
    try {
      id=Entities.getTransaction(example).getTxState().getEntityManager().getEntityManagerFactory().getPersistenceUnitUtil().getIdentifier(example);
    }
 catch (    final Exception ex) {
    }
    if (id != null) {
      final T res=(T)Entities.getTransactionState(example).getEntityManager().find(example.getClass(),id);
      if (res == null) {
        throw new NoSuchElementException("@Id: " + id);
      }
 else {
        return res;
      }
    }
 else     if ((example instanceof HasNaturalId) && (((HasNaturalId)example).getNaturalId() != null)) {
      final String natId=((HasNaturalId)example).getNaturalId();
      final T ret=(T)Entities.getTransactionState(example).getSession().createCriteria(example.getClass()).add(Restrictions.naturalId().set("naturalId",natId)).setCacheable(true).setMaxResults(1).setFetchSize(1).setFirstResult(0).uniqueResult();
      if (ret == null) {
        throw new NoSuchElementException("@NaturalId: " + natId);
      }
      return ret;
    }
 else {
      final T ret=(T)Entities.getTransactionState(example).getSession().createCriteria(example.getClass()).add(Example.create(example).enableLike(MatchMode.EXACT)).setCacheable(true).setMaxResults(1).setFetchSize(1).setFirstResult(0).uniqueResult();
      if (ret == null) {
        throw new NoSuchElementException("example: " + LogUtil.dumpObject(example));
      }
      return ret;
    }
  }
 catch (  final RuntimeException ex) {
    Logs.exhaust().trace(ex,ex);
    final Exception newEx=PersistenceExceptions.throwFiltered(ex);
    throw new TransactionInternalException(newEx.getMessage(),newEx);
  }
}
