{
  if (!isPersistent(newObject)) {
    try {
      return uniqueResult(newObject);
    }
 catch (    Exception ex) {
      LOG.error(ex,ex);
      throw new RuntimeException(ex);
    }
  }
 else {
    try {
      T persistedObject=getTransaction(newObject).getTxState().getEntityManager().merge(newObject);
      return persistedObject == newObject ? newObject : persistedObject;
    }
 catch (    final RuntimeException ex) {
      PersistenceExceptions.throwFiltered(ex);
      throw ex;
    }
  }
}
