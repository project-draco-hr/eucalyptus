{
  String txId=makeTxRootName(tx);
  txLog.remove(txStateThreadLocal.toString() + tx.getRecord().getPersistenceContext());
  txStateThreadLocal.get().remove(tx.getRecord().getPersistenceContext());
  if (txId.equals(txStateThreadLocal.get())) {
    for (    Entry<String,CascadingTx> e : txStateThreadLocal.get().entrySet()) {
      LOG.error("Found stranded transaction: " + e.getKey() + " started at: "+ e.getValue().getRecord().getStack());
      try {
        e.getValue().rollback();
      }
 catch (      Exception ex) {
        LOG.trace(ex,ex);
      }
    }
    txStateThreadLocal.get().clear();
    txStateThreadLocal.remove();
  }
}
