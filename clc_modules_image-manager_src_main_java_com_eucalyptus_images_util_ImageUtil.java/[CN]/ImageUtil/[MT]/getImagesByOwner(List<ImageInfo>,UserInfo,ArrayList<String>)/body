{
  EntityWrapper<ImageInfo> db=new EntityWrapper<ImageInfo>();
  List<ImageDetails> repList=Lists.newArrayList();
  if (owners.remove("self"))   owners.add(user.getUserName());
  try {
    for (    String userName : owners) {
      List<ImageInfo> results=db.query(ImageInfo.byOwnerId(userName));
      for (      ImageInfo img : results) {
        ImageDetails imgDetails=img.getAsImageDetails();
        if (img.isAllowed(user) && (imgList.isEmpty() || imgList.contains(imgDetails.getImageId()))) {
          repList.add(imgDetails);
        }
      }
    }
    db.commit();
  }
 catch (  Throwable e) {
    LOG.debug(e,e);
    db.rollback();
  }
  return repList;
}
