{
  for (  LaunchPermissionItemType perm : changeList) {
    if (perm.isGroup()) {
      UserGroupInfo target=new UserGroupInfo(perm.getGroup());
      if (adding && !imgInfo.getUserGroups().contains(target)) {
        EntityWrapper<UserGroupInfo> dbGroup=db.recast(UserGroupInfo.class);
        try {
          target=dbGroup.getUnique(target);
        }
 catch (        EucalyptusCloudException e) {
        }
 finally {
          imgInfo.getUserGroups().add(target);
          if ("all".equals(target.getName()))           imgInfo.setPublic(true);
        }
      }
 else       if (!adding && imgInfo.getUserGroups().contains(target)) {
        if ("all".equals(target.getName()))         imgInfo.setPublic(false);
      }
 else       if (!adding) {
        throw new EucalyptusCloudException("image attribute: cant remove nonexistant permission.");
      }
    }
 else     if (perm.isUser()) {
      UserInfo target=new UserInfo(perm.getUserId());
      if (adding && !imgInfo.getPermissions().contains(target)) {
        EntityWrapper<UserInfo> dbUser=db.recast(UserInfo.class);
        try {
          target=dbUser.getUnique(target);
        }
 catch (        EucalyptusCloudException e) {
          throw new EucalyptusCloudException("image attribute: invalid user id.");
        }
 finally {
          imgInfo.getPermissions().add(target);
        }
      }
 else       if (!adding && imgInfo.getPermissions().contains(target)) {
        imgInfo.getPermissions().remove(target);
      }
 else       if (!adding) {
        throw new EucalyptusCloudException("image attribute: cant remove nonexistant permission.");
      }
    }
  }
}
