{
  EntityWrapper<ImageInfo> db=new EntityWrapper<ImageInfo>();
  List<ImageDetails> repList=Lists.newArrayList();
  try {
    List<ImageInfo> results=db.query(new ImageInfo());
    for (    ImageInfo img : results) {
      ImageDetails imgDetails=img.getAsImageDetails();
      if (img.isAllowed(user) && (imgList.isEmpty() || imgList.contains(imgDetails.getImageId()))) {
        repList.add(imgDetails);
      }
    }
    db.commit();
  }
 catch (  Throwable e) {
    db.commit();
    ImageManager.LOG.debug(e,e);
  }
  return repList;
}
