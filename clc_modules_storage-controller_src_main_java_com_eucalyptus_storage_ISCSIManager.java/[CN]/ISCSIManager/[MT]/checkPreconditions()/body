{
  Long timeout=DirectStorageInfo.getStorageInfo().getTimeoutInMillis();
  CommandOutput output=execute(new String[]{ROOT_WRAP,"tgtadm","--help"},timeout);
  if (output.returnValue != 0 || StringUtils.isNotBlank(output.error)) {
    Faults.forComponent(Storage.class).havingId(TGT_CORRUPTED).withVar("component","Storage Controller").withVar("operation","tgtadm --help").withVar("error",output.error).log();
    throw new EucalyptusCloudException("tgtadm not found: Is tgt installed?");
  }
  output=execute(new String[]{ROOT_WRAP,"tgtadm","--lld","iscsi","--mode","target","--op","show"},timeout);
  if (output.returnValue != 0 || StringUtils.isNotBlank(output.error)) {
    LOG.warn("Unable to connect to tgt daemon. Is tgtd loaded?");
    LOG.info("Attempting to start tgtd ISCSI daemon");
    output=execute(new String[]{ROOT_WRAP,"service",TGT_SERVICE_NAME,"status"},timeout);
    if (output.returnValue != 0 || StringUtils.isNotBlank(output.error)) {
      output=execute(new String[]{ROOT_WRAP,"service",TGT_SERVICE_NAME,"start"},timeout);
      if (output.returnValue != 0 || StringUtils.isNotBlank(output.error)) {
        Faults.forComponent(Storage.class).havingId(TGT_CORRUPTED).withVar("component","Storage Controller").withVar("operation","service tgt start").withVar("error",output.error).log();
        throw new EucalyptusCloudException("Unable to start tgt daemon. Cannot proceed.");
      }
    }
 else {
      output=execute(new String[]{ROOT_WRAP,"service","tgt","start"},timeout);
      if (output.returnValue != 0 || StringUtils.isNotBlank(output.error)) {
        Faults.forComponent(Storage.class).havingId(TGT_CORRUPTED).withVar("component","Storage Controller").withVar("operation","service tgt start").withVar("error",output.error).log();
        throw new EucalyptusCloudException("Unable to start tgt daemon. Cannot proceed.");
      }
    }
  }
}
