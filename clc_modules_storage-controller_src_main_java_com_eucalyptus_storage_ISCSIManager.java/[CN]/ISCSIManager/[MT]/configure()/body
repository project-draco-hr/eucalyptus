{
  EntityWrapper<ISCSIMetaInfo> db=StorageProperties.getEntityWrapper();
  ISCSIMetaInfo metaInfo=new ISCSIMetaInfo();
  try {
    List<ISCSIMetaInfo> metaInfoList=db.query(metaInfo);
    if (metaInfoList.size() <= 0) {
      metaInfo.setStorePrefix(StorageProperties.STORE_PREFIX);
      metaInfo.setStoreNumber(0);
      metaInfo.setStoreUser("eucalyptus");
      metaInfo.setTid(1);
      db.add(metaInfo);
      db.commit();
    }
  }
 catch (  Exception e) {
    db.rollback();
    LOG.error(e);
  }
  EntityWrapper<CHAPUserInfo> dbUser=StorageProperties.getEntityWrapper();
  try {
    CHAPUserInfo userInfo=dbUser.getUnique(new CHAPUserInfo("eucalyptus"));
    if (!checkUser("eucalyptus")) {
      try {
        addUser("eucalyptus",BlockStorageUtil.decryptSCTargetPassword(userInfo.getEncryptedPassword()));
      }
 catch (      ExecutionException e1) {
        LOG.error(e1);
        return;
      }
    }
  }
 catch (  EucalyptusCloudException ex) {
    String password=Hashes.getRandom(20);
    try {
      addUser("eucalyptus",password);
    }
 catch (    ExecutionException e1) {
      LOG.error(e1);
      dbUser.rollback();
      return;
    }
    CHAPUserInfo userInfo;
    try {
      userInfo=new CHAPUserInfo("eucalyptus",BlockStorageUtil.encryptSCTargetPassword(password));
      dbUser.add(userInfo);
    }
 catch (    EucalyptusCloudException e) {
      LOG.error(e);
    }
  }
 finally {
    dbUser.commit();
  }
}
