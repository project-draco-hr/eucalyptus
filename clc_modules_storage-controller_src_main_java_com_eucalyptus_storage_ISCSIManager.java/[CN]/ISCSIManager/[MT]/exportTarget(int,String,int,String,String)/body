{
  try {
    Runtime rt=Runtime.getRuntime();
    Process proc=rt.exec(new String[]{"sudo","tgtadm","--lld","iscsi","--op","new","--mode","target","--tid",String.valueOf(tid),"-T",name});
    StreamConsumer error=new StreamConsumer(proc.getErrorStream());
    StreamConsumer output=new StreamConsumer(proc.getInputStream());
    error.start();
    output.start();
    proc.waitFor();
    output.join();
    String errorValue=error.getReturnValue();
    if (errorValue.length() > 0)     throw new EucalyptusCloudException(errorValue);
    proc=rt.exec(new String[]{"sudo","tgtadm","--lld","iscsi","--op","new","--mode","logicalunit","--tid",String.valueOf(tid),"--lun",String.valueOf(lun),"-b",path});
    error=new StreamConsumer(proc.getErrorStream());
    output=new StreamConsumer(proc.getInputStream());
    error.start();
    output.start();
    proc.waitFor();
    output.join();
    errorValue=error.getReturnValue();
    if (errorValue.length() > 0)     throw new EucalyptusCloudException(errorValue);
    proc=rt.exec(new String[]{"sudo","tgtadm","--lld","iscsi","--op","bind","--mode","account","--tid",String.valueOf(tid),"--user",user});
    error=new StreamConsumer(proc.getErrorStream());
    output=new StreamConsumer(proc.getInputStream());
    error.start();
    output.start();
    proc.waitFor();
    output.join();
    errorValue=error.getReturnValue();
    if (errorValue.length() > 0)     throw new EucalyptusCloudException(errorValue);
    proc=rt.exec(new String[]{"sudo","tgtadm","--lld","iscsi","--op","bind","--mode","target","--tid",String.valueOf(tid),"-I","ALL"});
    error=new StreamConsumer(proc.getErrorStream());
    output=new StreamConsumer(proc.getInputStream());
    error.start();
    output.start();
    proc.waitFor();
    output.join();
    errorValue=error.getReturnValue();
    if (errorValue.length() > 0)     throw new EucalyptusCloudException(errorValue);
  }
 catch (  Throwable t) {
    LOG.error(t);
  }
}
