{
  RunInstancesResponseType reply=allocInfo.getRequest().getReply();
  Context ctx=Contexts.lookup();
  List<String> networkNames=new ArrayList<String>();
  if (allocInfo.getNetworks() != null) {
    for (    Network vmNet : allocInfo.getNetworks())     networkNames.add(vmNet.getNetworkName());
  }
  ReservationInfoType reservation=new ReservationInfoType(allocInfo.getReservationId(),ctx.getUserFullName().getNamespace(),networkNames);
  for (  ResourceToken allocToken : allocInfo.getAllocationTokens())   for (  String instId : allocToken.getInstanceIds()) {
    reservation.getInstancesSet().add(VmInstances.getInstance().lookup(instId).getAsRunningInstanceItemType());
  }
  reply.setRsvInfo(reservation);
  return reply;
}
