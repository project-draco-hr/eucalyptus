{
  while (true) {
    Iterator iter=ManagementFactory.getMemoryPoolMXBeans().iterator();
    while (iter.hasNext()) {
      MemoryPoolMXBean item=(MemoryPoolMXBean)iter.next();
      String name=item.getName();
      MemoryType type=item.getType();
      MemoryUsage usage=item.getUsage();
      LOG.debug("Checking memory pool " + name + " of type"+ type);
      if (usage.getMax() - usage.getUsed() < THRESHOLD) {
        if (!alreadyFaulted.contains(name + ":" + type.toString())) {
          FaultSubsystem.forComponent(Eucalyptus.INSTANCE).havingId(MXBEAN_OUT_OF_MEMORY_FAULT_ID).withVar("component","eucalyptus").withVar("name",name).log();
          alreadyFaulted.add(name + ":" + type.toString());
        }
      }
    }
    try {
      Thread.sleep(POLL_TIME);
    }
 catch (    InterruptedException ex) {
      LOG.warn("Polling thread interrupted");
    }
  }
}
