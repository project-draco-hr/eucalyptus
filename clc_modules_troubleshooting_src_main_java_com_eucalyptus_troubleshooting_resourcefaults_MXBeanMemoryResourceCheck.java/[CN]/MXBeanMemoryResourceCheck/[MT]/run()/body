{
  while (true) {
    Iterator iter=ManagementFactory.getMemoryPoolMXBeans().iterator();
    while (iter.hasNext()) {
      MemoryPoolMXBean item=(MemoryPoolMXBean)iter.next();
      String name=item.getName();
      MemoryType type=item.getType();
      MemoryUsage usage=item.getUsage();
      LOG.debug("Checking memory pool " + name + " of type"+ type);
      if (usage.getMax() - usage.getUsed() < THRESHOLD) {
        FaultSubsystem.forComponent(Eucalyptus.class).havingId(MXBEAN_OUT_OF_MEMORY_FAULT_ID).withVar("component",Eucalyptus.INSTANCE.getFaultLogPrefix()).withVar("name",name).log();
      }
    }
    try {
      Thread.sleep(POLL_TIME);
    }
 catch (    InterruptedException ex) {
      LOG.warn("Polling thread interrupted");
    }
  }
}
