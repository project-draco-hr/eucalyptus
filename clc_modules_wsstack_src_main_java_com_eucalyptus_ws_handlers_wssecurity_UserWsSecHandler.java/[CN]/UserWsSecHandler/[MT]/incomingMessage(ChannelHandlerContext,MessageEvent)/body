{
  final Object o=event.getMessage();
  if (o instanceof MappingHttpMessage) {
    final MappingHttpMessage httpRequest=(MappingHttpMessage)o;
    SOAPEnvelope envelope=httpRequest.getSoapEnvelope();
    X509Certificate cert=WSSecurity.getVerifiedCertificate(envelope);
    String userName=CredentialProvider.getUserName(cert);
    User user=CredentialProvider.getUser(userName);
    httpRequest.setUser(user);
  }
}
