{
  this.verifySession(Param.session.getRaw(req));
  final ReportType reportType=ReportType.valueOf(Param.type.get(req));
  final ReportFormat format=ReportFormat.valueOf(Param.format.get(req));
  final long start=Long.parseLong(Param.start.get(req));
  final long end=Long.parseLong(Param.end.get(req));
  final Period period=new Period(start,end);
  final ReportingCriterion criterion=ReportingCriterion.valueOf(Param.criterion.get(req));
  final Units displayUnits=Units.DEFAULT_DISPLAY_UNITS;
  ReportingCriterion groupByCriterion=null;
  String groupByParam=req.getParameter(Param.groupByCriterion.name());
  if (groupByParam != null && !groupByParam.equalsIgnoreCase("NONE")) {
    groupByCriterion=ReportingCriterion.valueOf(Param.groupByCriterion.get(req));
  }
  LOG.info(String.format("Params: type:%s format:%s period:%s" + "criterion:%s groupBy:%s",reportType,format,period,criterion,groupByCriterion));
  setContentTypeHeader(res,format,Param.type.get(req));
  ReportGenerator.getInstance().generateReport(reportType,format,period,criterion,groupByCriterion,displayUnits,res.getOutputStream());
}
