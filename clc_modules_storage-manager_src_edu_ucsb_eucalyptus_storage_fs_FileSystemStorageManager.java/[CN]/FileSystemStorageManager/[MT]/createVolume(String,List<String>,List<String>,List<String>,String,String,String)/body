{
  String snapshotLoDev=null;
  ArrayList<String> loDevices=new ArrayList<String>();
  for (  String snapshot : snapshotSet) {
    String loDevName=createLoopback(rootDirectory + FILE_SEPARATOR + bucket+ FILE_SEPARATOR+ snapshot);
    if (loDevName.length() == 0)     throw new EucalyptusCloudException("could not create loopback device for " + snapshot);
    if (snapshot.equals(snapshotId))     snapshotLoDev=loDevName;
    loDevices.add(loDevName);
  }
  int i=0;
  ArrayList<String> absoluteLvNames=new ArrayList<String>();
  String snapshotAbsoluteLvName=null;
  for (  String snapshot : snapshotSet) {
    String absoluteLvName=lvmRootDirectory + FILE_SEPARATOR + vgNames.get(i)+ FILE_SEPARATOR+ lvNames.get(i);
    String returnValue=enableLogicalVolume(absoluteLvName);
    if (snapshotId == snapshot)     snapshotAbsoluteLvName=absoluteLvName;
    absoluteLvNames.add(absoluteLvName);
    ++i;
  }
  String volumeKey="walrusvol-" + UUID.randomUUID();
  String volumePath=rootDirectory + FILE_SEPARATOR + bucket+ FILE_SEPARATOR+ volumeKey;
  String returnValue=createVolumeFromLv(snapshotAbsoluteLvName,volumePath);
  for (  String absoluteLvName : absoluteLvNames) {
    returnValue=disableLogicalVolume(absoluteLvName);
  }
  for (  String loDevice : loDevices) {
    returnValue=removeLoopback(loDevice);
  }
  return volumeKey;
}
