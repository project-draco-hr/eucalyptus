{
  if (period.getBeginningMs() >= lastSnapshot.getTimestampMs() || period.getEndingMs() <= firstSnapshot.getTimestampMs()) {
    log.debug("duration=0, period does not overlap at all, report:" + period.getBeginningMs() + "-"+ period.getEndingMs()+ ", snaps:"+ firstSnapshot.getTimestampMs()+ "-"+ lastSnapshot.getTimestampMs());
    return 0l;
  }
 else {
    long truncatedBeginMs=Math.max(period.getBeginningMs(),firstSnapshot.getTimestampMs());
    long truncatedEndMs=Math.min(period.getEndingMs(),lastSnapshot.getTimestampMs());
    log.debug("truncated:" + truncatedBeginMs + "-"+ truncatedEndMs);
    return (truncatedEndMs - truncatedBeginMs) / 1000;
  }
}
