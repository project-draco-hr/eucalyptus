{
  List<String> macs=Lists.transform(instanceIds,new Function<String,String>(){
    @Override public String apply(    String instanceId){
      return VmInstances.getAsMAC(instanceId);
    }
  }
);
  VmRunType run=new VmRunType(rsvId,userData,childToken.getAmount(),imgInfo,vmInfo,keyInfo,instanceIds,macs,vlan,networkNames,netIndexes);
  VmRunCallback cb=new VmRunCallback(run,this,childToken);
  if (!addrList.isEmpty()) {
    cb.then(new SuccessCallback<VmRunResponseType>(){
      @Override public void apply(      VmRunResponseType response){
        Iterator<String> addrs=addrList.iterator();
        for (        VmInfo vmInfo : response.getVms()) {
          Address addr=Addresses.getInstance().lookup(addrs.next());
          VmInstance vm=VmInstances.getInstance().lookup(vmInfo.getInstanceId());
          AddressCategory.assign(addr,vm).dispatch(addr.getCluster());
        }
      }
    }
);
  }
  return cb;
}
