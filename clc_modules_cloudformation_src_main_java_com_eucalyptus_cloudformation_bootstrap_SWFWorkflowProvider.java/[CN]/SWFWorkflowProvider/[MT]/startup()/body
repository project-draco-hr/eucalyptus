{
  if (!Topology.isEnabled(SimpleWorkflow.class)) {
    throw new Exception("SimpleWorkflow must be enabled/registered to use Eucalyptus SWF");
  }
  simpleWorkflowClient=new AmazonSimpleWorkflowClient(new CloudFormationAWSCredentialsProvider());
  simpleWorkflowClient.setEndpoint(ServiceUris.remote(Topology.lookup(SimpleWorkflow.class)).toString());
  try {
    simpleWorkflowClient.registerDomain(new RegisterDomainRequest().withName(SWF_DOMAIN).withWorkflowExecutionRetentionPeriodInDays("1"));
  }
 catch (  DomainAlreadyExistsException ex) {
    LOG.debug("SWF domain " + SWF_DOMAIN + " already exists");
  }
  stackWorkflowWorker=new WorkflowWorker(simpleWorkflowClient,SWF_DOMAIN,SWF_TASKLIST);
  stackWorkflowWorker.addWorkflowImplementationType(CreateStackWorkflowImpl.class);
  stackWorkflowWorker.addWorkflowImplementationType(DeleteStackWorkflowImpl.class);
  stackWorkflowWorker.start();
  stackActivityWorker=new ActivityWorker(simpleWorkflowClient,SWF_DOMAIN,SWF_TASKLIST);
  stackActivityWorker.addActivitiesImplementation(new StackActivityImpl());
  stackActivityWorker.start();
}
