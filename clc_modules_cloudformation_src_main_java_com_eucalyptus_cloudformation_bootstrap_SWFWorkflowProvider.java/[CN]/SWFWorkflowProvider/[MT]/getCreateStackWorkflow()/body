{
  CreateStackWorkflow createStackWorkflow;
  if (createStackWorkflowWorker != null) {
    LOG.info("Using SWF mode for create");
    WorkflowClientFactory workflowClientFactory=new WorkflowClientFactory(simpleWorkflowClient,SWF_DOMAIN,SWF_TASKLIST);
    WorkflowDescriptionTemplate workflowDescriptionTemplate=new CreateStackWorkflowDescriptionTemplate();
    InterfaceBasedWorkflowClient<CreateStackWorkflow> client=workflowClientFactory.getNewWorkflowClient(CreateStackWorkflow.class,workflowDescriptionTemplate,new WorkflowTags());
    createStackWorkflow=new CreateStackWorkflowClient(client);
  }
 else {
    LOG.info("Using local mode for create (in SWF)");
    createStackWorkflow=new CreateStackWorkflowImpl();
    ((CreateStackWorkflowImpl)createStackWorkflow).setWorkflowOperations(LocalWorkflowOperations.<StackActivity>of(new StackActivityImpl()));
  }
  return createStackWorkflow;
}
