{
  Network net=vm.getNetworks().get(0);
  for (  Cluster cluster : Clusters.getInstance().listValues()) {
    if (net.hasToken(cluster.getName()) && net.getClusterToken(cluster.getName()).getIndexes().isEmpty()) {
      try {
        net.removeToken(cluster.getName());
      }
 catch (      NoSuchElementException e1) {
        LOG.debug(e1,e1);
      }
    }
  }
  try {
    Cluster cluster=Clusters.getInstance().lookup(vm.getPlacement());
    if (!net.hasTokens()) {
      Clusters.dispatchClusterEvent(cluster,new StopNetworkCallback(new NetworkToken(cluster.getName(),vm.getOwnerId(),net.getNetworkName(),net.getVlan())));
    }
  }
 catch (  NoSuchElementException e) {
    LOG.debug(e,e);
  }
}
