{
  Multimap<String,VmInstance> userVms=Multimaps.newArrayListMultimap();
  for (  VmInstance v : VmInstances.getInstance().listValues())   userVms.put(v.getOwnerId(),v);
  NavigableSet<NetworkToken> revokedTokens=Sets.newTreeSet();
  for (  Network activeNet : Networks.getInstance().listValues()) {
    String user=activeNet.getUserName();
    LOG.debug(LogUtil.subheader(activeNet.toString()));
    Multimap<String,String> clusterNetworkMap=Multimaps.newArrayListMultimap();
    for (    VmInstance vm : userVms.get(user)) {
      clusterNetworkMap.get(vm.getPlacement()).addAll(vm.getNetworkNames());
    }
  }
  for (  NetworkToken token : revokedTokens)   SystemState.dispatchStopNetwork(token);
}
