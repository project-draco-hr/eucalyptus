{
  for (  Address address : Addresses.getInstance().listValues()) {
    if (vm.getInstanceId().equals(address.getInstanceId())) {
      if (address.getInstanceAddress() != null) {
        ClusterConfiguration config=Clusters.getInstance().lookup(address.getCluster()).getConfiguration();
        SystemState.dispatch(vm.getPlacement(),new UnassignAddressCallback(config,address),Admin.makeMsg(UnassignAddressType.class,address.getName(),address.getInstanceAddress()));
      }
      if (Component.eucalyptus.name().equals(address.getUserId())) {
        try {
          (new AddressManager()).ReleaseAddress(Admin.makeMsg(ReleaseAddressType.class,address.getName()));
        }
 catch (        EucalyptusCloudException e) {
        }
      }
    }
  }
  ClusterConfiguration config=Clusters.getInstance().lookup(vm.getPlacement()).getConfiguration();
  SystemState.dispatch(vm.getPlacement(),new TerminateCallback(config),Admin.makeMsg(TerminateInstancesType.class,vm.getInstanceId()));
}
