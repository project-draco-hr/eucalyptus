{
  for (  Address address : Addresses.getInstance().listValues()) {
    if (vm.getInstanceId().equals(address.getInstanceId())) {
      if (Component.eucalyptus.name().equals(address.getUserId())) {
        try {
          (new AddressManager()).ReleaseAddress(Admin.makeMsg(ReleaseAddressType.class,address.getName()));
        }
 catch (        EucalyptusCloudException e) {
        }
      }
    }
  }
  ClusterConfiguration config=Clusters.getInstance().lookup(vm.getPlacement()).getConfiguration();
  SystemState.dispatch(vm.getPlacement(),new TerminateCallback(),Admin.makeMsg(TerminateInstancesType.class,vm.getInstanceId()));
  int index=vm.getNetworkIndex();
  for (  Network net : vm.getNetworks()) {
    LOG.info("Returning address index: " + index);
    net.getAvailableAddresses().add(index);
    break;
  }
}
