{
  for (  Address address : Addresses.getInstance().listValues()) {
    if (vm.getInstanceId().equals(address.getInstanceId())) {
      if (Component.eucalyptus.name().equals(address.getUserId())) {
        AddressManager.unassignAddressFromVm(address,vm);
        AddressManager.releaseAddress(address);
      }
    }
  }
  try {
    Clusters.sendClusterEvent(vm.getPlacement(),QueuedEvent.make(new TerminateCallback(),Admin.makeMsg(TerminateInstancesType.class,vm.getInstanceId())));
  }
 catch (  Exception e) {
    LOG.debug(e);
  }
  int index=vm.getNetworkIndex();
  for (  Network net : vm.getNetworks()) {
    LOG.info("Returning address index: " + index);
    net.getAvailableAddresses().add(index);
    break;
  }
}
