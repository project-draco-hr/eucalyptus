{
  UpdateARecordResponseType reply=(UpdateARecordResponseType)request.getReply();
  String zone=request.getZone();
  if (zone.endsWith("."))   zone+=DNSProperties.DOMAIN + ".";
 else   zone+="." + DNSProperties.DOMAIN + ".";
  String name=request.getName();
  if (name.endsWith("."))   name+=DNSProperties.DOMAIN + ".";
 else   name+="." + DNSProperties.DOMAIN + ".";
  String address=request.getAddress();
  long ttl=request.getTtl();
  try (final TransactionResource db=Entities.transactionFor(ARecordInfo.class)){
    ARecordInfo aRecordInfo=new ARecordInfo();
    aRecordInfo.setName(name);
    aRecordInfo.setAddress(address);
    aRecordInfo.setZone(zone);
    List<ARecordInfo> arecords=Entities.query(aRecordInfo);
    if (arecords.size() > 0) {
      aRecordInfo=arecords.get(0);
      if (!zone.equals(aRecordInfo.getZone())) {
        db.rollback();
        throw new EucalyptusCloudException("Sorry, record already associated with a zone. Remove the record and try again.");
      }
      aRecordInfo.setAddress(address);
      aRecordInfo.setTtl(ttl);
      try {
        ARecord arecord=new ARecord(Name.fromString(name),DClass.IN,ttl,Address.getByAddress(address));
        ZoneManager.updateARecord(zone,arecord);
      }
 catch (      Exception ex) {
        LOG.error(ex);
      }
    }
 else {
      try {
        ARecordInfo searchARecInfo=new ARecordInfo();
        searchARecInfo.setZone(zone);
        ARecord record=new ARecord(new Name(name),DClass.IN,ttl,Address.getByAddress(address));
        ZoneManager.addRecord(zone,record,false);
        aRecordInfo=new ARecordInfo();
        aRecordInfo.setName(name);
        aRecordInfo.setAddress(address);
        aRecordInfo.setTtl(ttl);
        aRecordInfo.setZone(zone);
        aRecordInfo.setRecordclass(DClass.IN);
        Entities.persist(aRecordInfo);
      }
 catch (      Exception ex) {
        LOG.error(ex);
      }
    }
    db.commit();
  }
   return reply;
}
