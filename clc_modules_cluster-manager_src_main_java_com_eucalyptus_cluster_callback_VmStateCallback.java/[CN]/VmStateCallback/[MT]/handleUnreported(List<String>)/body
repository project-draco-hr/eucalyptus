{
  for (  final String vmId : unreportedVms) {
    EntityTransaction db1=Entities.get(VmInstance.class);
    try {
      VmInstance vm=VmInstances.cachedLookup(vmId);
      if (VmInstances.Timeout.UNREPORTED.apply(vm)) {
        VmInstances.terminated(vm);
      }
 else       if (VmInstances.Timeout.SHUTTING_DOWN.apply(vm)) {
        VmInstances.terminated(vm);
      }
 else       if (VmInstances.Timeout.TERMINATED.apply(vm)) {
        VmInstances.delete(vm);
      }
      if (Databases.isSynchronizing()) {
        db1.rollback();
      }
 else {
        db1.commit();
      }
    }
 catch (    final Exception ex) {
      Logs.extreme().error(ex,ex);
      db1.rollback();
    }
  }
}
