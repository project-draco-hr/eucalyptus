{
  BundleState bundleState=BundleState.mapper.apply(runVm.getBundleTaskStateName());
  if (!BundleState.none.equals(bundleState)) {
    vm.getRuntimeState().updateBundleTaskState(bundleState);
    VmInstances.terminated(vm);
  }
 else   if (VmState.SHUTTING_DOWN.apply(vm)) {
    VmInstances.terminated(vm);
  }
 else   if (VmState.STOPPING.apply(vm)) {
    VmInstances.stopped(vm);
  }
 else   if (VmStateSet.RUN.apply(vm) && vm.getSplitTime() > VM_STATE_SETTLE_TIME) {
    if (vm.isBlockStorage()) {
      VmInstances.stopped(vm);
    }
 else {
      VmInstances.shutDown(vm);
    }
  }
}
