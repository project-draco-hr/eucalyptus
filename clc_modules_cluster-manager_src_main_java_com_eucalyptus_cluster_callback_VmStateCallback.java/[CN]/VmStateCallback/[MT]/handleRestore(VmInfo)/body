{
  final VmState runVmState=VmState.Mapper.get(runVm.getStateName());
  if (VmStateSet.RUN.contains(runVmState)) {
    try {
      final VmInstance vm=VmInstances.cachedLookup(runVm.getInstanceId());
      if (vm != null && !(VmState.TERMINATED.apply(vm) && VmInstance.Reason.EXPIRED.apply(vm))) {
        return false;
      }
    }
 catch (    Exception ex) {
      LOG.error(ex);
      Logs.extreme().error(ex,ex);
    }
    try {
      return VmInstance.RestoreAllocation.INSTANCE.apply(runVm);
    }
 catch (    Throwable ex) {
      LOG.error(ex);
      Logs.extreme().error(ex,ex);
    }
  }
  return false;
}
