{
  Logs.extreme().info("Terminating instance: " + vm.getInstanceId(),new RuntimeException());
  try {
    Address address=null;
    if (NetworkGroups.networkingConfiguration().hasNetworking()) {
      try {
        address=Addresses.getInstance().lookup(vm.getPublicAddress());
        if (address.isSystemOwned()) {
          EventRecord.caller(VmInstances.class,EventType.VM_TERMINATING,"SYSTEM_ADDRESS",address.toString()).debug();
          Addresses.release(address);
        }
 else {
          EventRecord.caller(VmInstances.class,EventType.VM_TERMINATING,"USER_ADDRESS",address.toString()).debug();
          AsyncRequests.newRequest(address.unassign().getCallback()).dispatch(vm.getPartition());
        }
      }
 catch (      final NoSuchElementException e) {
      }
catch (      final Throwable e1) {
        LOG.debug(e1,e1);
      }
    }
    final Cluster cluster=Clusters.lookup(Topology.lookup(ClusterController.class,vm.lookupPartition()));
    VmInstances.cleanUpAttachedVolumes(vm);
    AsyncRequests.newRequest(new TerminateCallback(vm.getInstanceId())).dispatch(cluster.getConfiguration());
  }
 catch (  final Throwable e) {
    LOG.error(e,e);
  }
}
