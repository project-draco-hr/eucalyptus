{
  updateAddressingMode();
  DescribeAddressesResponseType reply=(DescribeAddressesResponseType)request.getReply();
  boolean isAdmin=request.isAdministrator();
  for (  Address address : Addresses.getInstance().listValues()) {
    try {
      VmInstances.getInstance().lookup(address.getInstanceId());
    }
 catch (    NoSuchElementException e) {
      EntityWrapper<Address> db=new EntityWrapper<Address>();
      try {
        Address addr=db.getUnique(new Address(address.getName()));
        addr.unassign();
        db.commit();
      }
 catch (      EucalyptusCloudException ex) {
        db.rollback();
      }
      address.unassign();
    }
    if (isAdmin || address.getUserId().equals(request.getUserId())) {
      reply.getAddressesSet().add(address.getDescription(isAdmin));
    }
  }
  if (request.isAdministrator())   for (  Address address : Addresses.getInstance().listDisabledValues())   reply.getAddressesSet().add(new DescribeAddressesResponseItemType(address.getName(),Address.UNALLOCATED_USERID));
  return reply;
}
