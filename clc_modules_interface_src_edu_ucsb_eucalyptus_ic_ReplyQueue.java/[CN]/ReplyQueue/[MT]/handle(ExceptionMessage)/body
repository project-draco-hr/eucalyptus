{
  Throwable exception=exMsg.getException();
  Object payload=null;
  EucalyptusMessage msg=null;
  if (exception instanceof MessagingException) {
    MessagingException ex=(MessagingException)exception;
    MuleMessage muleMsg=ex.getUmoMessage();
    if (payload instanceof RequestTransactionScript) {
      msg=((RequestTransactionScript)payload).getRequestMessage();
    }
 else {
      try {
        msg=parsePayload(muleMsg.getPayload());
      }
 catch (      Exception e) {
        LOG.error("Bailing out of error handling: don't have the correlationId for the caller!");
        LOG.error(e,e);
        return;
      }
    }
    EucalyptusErrorMessageType errMsg=getErrorMessageType(exMsg,msg);
    replies.putMessage(errMsg);
  }
}
