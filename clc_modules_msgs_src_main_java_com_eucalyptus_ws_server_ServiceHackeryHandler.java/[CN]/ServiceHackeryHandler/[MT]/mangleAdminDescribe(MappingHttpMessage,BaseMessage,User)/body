{
  final String userAgent=request.getHeader(HttpHeaders.Names.USER_AGENT);
  if ((userAgent != null) && userAgent.matches(".*EucalyptusAdminAccess") && msg.getClass().getSimpleName().startsWith("Describe")) {
    msg.setEffectiveUserId(msg.getUserId());
  }
 else   if ((user != null)) {
    msg.setUserId(user.getName());
    msg.setEffectiveUserId(user.isSystemAdmin() ? "eucalyptus" : user.getName());
  }
}
