{
  Context ctx=Contexts.lookup();
  EntityWrapper<Snapshot> db=EntityWrapper.get(Snapshot.class);
  Volume vol;
  try {
    vol=Transactions.find(Volume.named(ctx.getUserFullName(),request.getVolumeId()));
  }
 catch (  ExecutionException ex1) {
    throw new EucalyptusCloudException(ex1);
  }
  ServiceConfiguration sc=Partitions.lookupService(Storage.class,vol.getPartition());
  vol=Volumes.checkVolumeReady(vol);
  Snapshot snap=Snapshots.initializeSnapshot(ctx.getUserFullName(),vol,sc);
  snap=Snapshots.startCreateSnapshot(vol,snap);
  CreateSnapshotResponseType reply=(CreateSnapshotResponseType)request.getReply();
  edu.ucsb.eucalyptus.msgs.Snapshot snapMsg=snap.morph(new edu.ucsb.eucalyptus.msgs.Snapshot());
  snapMsg.setProgress("0%");
  snapMsg.setOwnerId(snap.getOwnerAccountNumber());
  snapMsg.setVolumeSize(vol.getSize().toString());
  reply.setSnapshot(snapMsg);
  return reply;
}
