{
  AWSEC2NetworkInterfaceAttachmentResourceAction action=(AWSEC2NetworkInterfaceAttachmentResourceAction)resourceAction;
  ServiceConfiguration configuration=Topology.lookup(Compute.class);
  AttachNetworkInterfaceType attachNetworkInterfaceType=MessageHelper.createMessage(AttachNetworkInterfaceType.class,action.info.getEffectiveUserId());
  if (action.properties.getInstanceId() != null) {
    DescribeInstancesType describeInstancesType=MessageHelper.createMessage(DescribeInstancesType.class,action.info.getEffectiveUserId());
    describeInstancesType.setInstancesSet(Lists.newArrayList(action.properties.getInstanceId()));
    DescribeInstancesResponseType describeInstancesResponseType=AsyncRequests.<DescribeInstancesType,DescribeInstancesResponseType>sendSync(configuration,describeInstancesType);
    if (describeInstancesResponseType.getReservationSet() == null || describeInstancesResponseType.getReservationSet().isEmpty()) {
      throw new ValidationErrorException("No such instance " + action.properties.getInstanceId());
    }
    attachNetworkInterfaceType.setInstanceId(action.properties.getInstanceId());
  }
  if (action.properties.getNetworkInterfaceId() != null) {
    DescribeNetworkInterfacesType describeNetworkInterfacesType=MessageHelper.createMessage(DescribeNetworkInterfacesType.class,action.info.getEffectiveUserId());
    describeNetworkInterfacesType.setNetworkInterfaceIdSet(action.convertNetworkInterfaceIdSet(action.properties.getNetworkInterfaceId()));
    DescribeNetworkInterfacesResponseType describeNetworkInterfacesResponseType=AsyncRequests.<DescribeNetworkInterfacesType,DescribeNetworkInterfacesResponseType>sendSync(configuration,describeNetworkInterfacesType);
    if (describeNetworkInterfacesResponseType.getNetworkInterfaceSet() == null || describeNetworkInterfacesResponseType.getNetworkInterfaceSet().getItem() == null || describeNetworkInterfacesResponseType.getNetworkInterfaceSet().getItem().isEmpty()) {
      throw new ValidationErrorException("No such network interface " + action.properties.getNetworkInterfaceId());
    }
    attachNetworkInterfaceType.setNetworkInterfaceId(action.properties.getNetworkInterfaceId());
  }
  attachNetworkInterfaceType.setDeviceIndex(action.properties.getDeviceIndex());
  AttachNetworkInterfaceResponseType attachNetworkInterfaceResponseType=AsyncRequests.<AttachNetworkInterfaceType,AttachNetworkInterfaceResponseType>sendSync(configuration,attachNetworkInterfaceType);
  action.info.setPhysicalResourceId(attachNetworkInterfaceResponseType.getAttachmentId());
  action.info.setReferenceValueJson(JsonHelper.getStringFromJsonNode(new TextNode(action.info.getPhysicalResourceId())));
  return action;
}
