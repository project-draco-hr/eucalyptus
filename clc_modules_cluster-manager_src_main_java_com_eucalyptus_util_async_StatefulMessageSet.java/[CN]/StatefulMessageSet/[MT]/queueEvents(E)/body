{
  for (  final Request event : this.messages.get(state)) {
    if (event.getCallback() instanceof BroadcastCallback) {
      final BroadcastCallback callback=(BroadcastCallback)event.getCallback();
      this.pendingEvents.addAll(Lists.transform(Clusters.getInstance().listValues(),new Function<Cluster,CheckedListenableFuture>(){
        public CheckedListenableFuture apply(        Cluster c){
          EventRecord.caller(StatefulMessageSet.class,EventType.VM_STARTING,state.name(),c.getName(),event.getClass().getSimpleName()).info();
          return Callbacks.newClusterRequest(callback.newInstance().regardingUserRequest(callback.getRequest())).dispatch(c.getServiceEndpoint());
        }
      }
));
    }
 else {
      this.pendingEvents.add(event.dispatch(cluster.getServiceEndpoint()));
      EventRecord.caller(StatefulMessageSet.class,EventType.VM_STARTING,state.name(),cluster.getName(),event.getClass().getSimpleName()).info();
    }
  }
}
