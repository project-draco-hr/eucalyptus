{
  for (  final Request event : this.messages.get(state)) {
    if (event.getCallback() instanceof BroadcastCallback) {
      final BroadcastCallback callback=(BroadcastCallback)event.getCallback();
      this.pendingEvents.addAll(Lists.transform(Clusters.getInstance().listValues(),new Function<Cluster,CheckedListenableFuture>(){
        public CheckedListenableFuture apply(        Cluster c){
          EventRecord.caller(StatefulMessageSet.class,EventType.VM_STARTING,state.name(),c.getName(),event.getClass().getSimpleName()).info();
          Request request=AsyncRequests.newRequest(callback.newInstance());
          request.getRequest().regardingUserRequest(callback.getRequest());
          return request.dispatch(c.getConfiguration());
        }
      }
));
    }
 else {
      this.pendingEvents.add(event.dispatch(cluster.getConfiguration()));
      EventRecord.caller(StatefulMessageSet.class,EventType.VM_STARTING,state.name(),cluster.getName(),event.getClass().getSimpleName()).info();
    }
  }
}
