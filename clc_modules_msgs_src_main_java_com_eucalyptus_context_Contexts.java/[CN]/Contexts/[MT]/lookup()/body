{
  BaseMessage parent=null;
  MuleMessage muleMsg=null;
  if (RequestContext.getEvent() != null && RequestContext.getEvent().getMessage() != null) {
    muleMsg=RequestContext.getEvent().getMessage();
  }
 else   if (RequestContext.getEventContext() != null && RequestContext.getEventContext().getMessage() != null) {
    muleMsg=RequestContext.getEventContext().getMessage();
  }
 else {
    throw new IllegalContextAccessException("Cannot access context implicitly using lookup(V) outside of a service.");
  }
  Object o=muleMsg.getPayload();
  if (o != null && o instanceof BaseMessage) {
    String correlationId=((BaseMessage)o).getCorrelationId();
    try {
      return Contexts.lookup(correlationId);
    }
 catch (    NoSuchContextException e) {
      LOG.error(e,e);
      throw new IllegalContextAccessException("Cannot access context implicitly using lookup(V) when not handling a request.",e);
    }
  }
 else {
    throw new IllegalContextAccessException("Cannot access context implicitly using lookup(V) when not handling a request.");
  }
}
