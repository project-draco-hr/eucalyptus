{
  BaseMessage parent=null;
  MuleMessage muleMsg=null;
  if (RequestContext.getEvent() != null && RequestContext.getEvent().getMessage() != null) {
    muleMsg=RequestContext.getEvent().getMessage();
  }
 else   if (RequestContext.getEventContext() != null && RequestContext.getEventContext().getMessage() != null) {
    muleMsg=RequestContext.getEventContext().getMessage();
  }
 else {
    throw new NoSuchContextException("Failed to determine current event context.");
  }
  Object o=muleMsg.getPayload();
  if (o != null && o instanceof BaseMessage) {
    String correlationId=((BaseMessage)o).getCorrelationId();
    return Contexts.lookup(correlationId);
  }
 else {
    throw new NoSuchContextException("Event context does not have enough information to recover the context.");
  }
}
