{
  final Context ctx=Contexts.lookup();
  final String groupName=request.getGroupName();
  if (Strings.startsWith("sg-").apply(groupName)) {
    throw new ClientComputeException("InvalidParameterValue","Value (" + groupName + ") for parameter GroupName is invalid. Group names may not be in the format sg-*");
  }
  if (!CharMatcher.ASCII.matchesAllOf(groupName)) {
    throw new ClientComputeException("InvalidParameterValue","Value (" + groupName + ") for parameter GroupName is invalid. Character sets beyond ASCII are not supported.");
  }
  final CreateSecurityGroupResponseType reply=(CreateSecurityGroupResponseType)request.getReply();
  try {
    Supplier<NetworkGroup> allocator=new Supplier<NetworkGroup>(){
      @Override public NetworkGroup get(){
        try {
          return NetworkGroups.create(ctx.getUserFullName(),groupName,request.getGroupDescription());
        }
 catch (        MetadataException ex) {
          throw new RuntimeException(ex);
        }
      }
    }
;
    final NetworkGroup group=RestrictedTypes.allocateUnitlessResource(allocator);
    reply.setGroupId(group.getGroupId());
    return reply;
  }
 catch (  final Exception ex) {
    String cause=Exceptions.causeString(ex);
    if (cause.contains("DuplicateMetadataException"))     throw new EucalyptusCloudException("The security group '" + groupName + "' already exists");
 else     throw new EucalyptusCloudException("CreateSecurityGroup failed because: " + cause,ex);
  }
}
