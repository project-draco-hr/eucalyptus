{
  final Context ctx=Contexts.lookup();
  NetworkGroups.createDefault(ctx.getUserFullName());
  if (!RestrictedTypes.isContextAuthorized(null)) {
  }
  final String action=PolicySpec.requestToAction(request);
  if (!ctx.hasAdministrativePrivileges()) {
    if (!Permissions.isAuthorized(PolicySpec.VENDOR_EC2,PolicySpec.EC2_RESOURCE_SECURITYGROUP,"",ctx.getAccount(),action,ctx.getUser())) {
      throw new EucalyptusCloudException("Not authorized to create network group for " + ctx.getUser());
    }
    if (!Permissions.canAllocate(PolicySpec.VENDOR_EC2,PolicySpec.EC2_RESOURCE_SECURITYGROUP,"",action,ctx.getUser(),1L)) {
      throw new EucalyptusCloudException("Quota exceeded to create network group for " + ctx.getUser());
    }
  }
  final CreateSecurityGroupResponseType reply=(CreateSecurityGroupResponseType)request.getReply();
  final NetworkGroup newGroup=NetworkGroups.create(ctx.getUserFullName(),request.getGroupName(),request.getGroupDescription());
  try {
    EntityWrapper.get(NetworkGroup.class).mergeAndCommit(newGroup);
    return reply;
  }
 catch (  final Exception ex) {
    Logs.extreme().error(ex,ex);
    throw new EucalyptusCloudException("CreatSecurityGroup failed because: " + ex.getMessage(),ex);
  }
}
