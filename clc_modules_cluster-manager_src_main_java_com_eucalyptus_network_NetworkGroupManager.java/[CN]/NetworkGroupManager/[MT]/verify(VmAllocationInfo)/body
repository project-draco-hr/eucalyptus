{
  NetworkGroupUtil.makeDefault(vmAllocInfo.getRequest().getUserId());
  ArrayList<String> networkNames=new ArrayList<String>(vmAllocInfo.getRequest().getGroupSet());
  if (networkNames.size() < 1) {
    networkNames.add("default");
  }
  Map<String,NetworkRulesGroup> networkRuleGroups=new HashMap<String,NetworkRulesGroup>();
  for (  String groupName : networkNames) {
    NetworkRulesGroup group=NetworkGroupUtil.getUserNetworkRulesGroup(vmAllocInfo.getRequest().getUserId(),groupName);
    networkRuleGroups.put(groupName,group);
    vmAllocInfo.getNetworks().add(group.getVmNetwork());
  }
  ArrayList<String> userNetworks=new ArrayList<String>(networkRuleGroups.keySet());
  if (!userNetworks.containsAll(networkNames)) {
    networkNames.removeAll(userNetworks);
    throw new EucalyptusCloudException("Failed to find " + networkNames);
  }
  return vmAllocInfo;
}
