{
  if (event.getMessage() instanceof MappingHttpRequest) {
    try {
      MappingHttpRequest httpRequest=(MappingHttpRequest)event.getMessage();
      removeDuplicateHeaderValues(httpRequest);
      canonicalizeHeaders(httpRequest);
      if (httpRequest.containsHeader(WalrusProperties.Headers.S3UploadPolicy.toString())) {
        checkUploadPolicy(httpRequest);
      }
      handle(httpRequest);
    }
 catch (    Exception ex) {
      Channels.fireExceptionCaught(ctx,ex);
    }
  }
}
