{
  String[] signedHeaderArray=signedHeaders.split(";");
  StringBuilder canonHeader=new StringBuilder();
  boolean foundHost=false;
  for (  String headerName : signedHeaderArray) {
    String headerNameString=headerName.toLowerCase().trim();
    if ("host".equals(headerNameString)) {
      foundHost=true;
    }
    String value=httpRequest.getHeader(headerName);
    if (value != null) {
      value=value.trim();
      String[] parts=value.split("\n");
      value="";
      for (      String part : parts) {
        part=part.trim();
        value+=part + " ";
      }
      value=value.trim();
    }
 else {
      value="";
    }
    canonHeader.append(headerNameString).append(":").append(value).append('\n');
  }
  if (!foundHost) {
    throw new AccessDeniedException("Host header not found when canonicalizing headers");
  }
  return canonHeader.toString().trim();
}
