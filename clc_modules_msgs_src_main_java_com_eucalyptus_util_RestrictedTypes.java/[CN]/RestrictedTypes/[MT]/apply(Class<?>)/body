{
  try {
    final Context ctx=Contexts.lookup();
    final Class<? extends BaseMessage> msgType=ctx.getRequest().getClass();
    final Ats ats=findPolicyAnnotations(rscType,msgType);
    final PolicyVendor vendor=ats.get(PolicyVendor.class);
    final PolicyResourceType type=ats.get(PolicyResourceType.class);
    final String action=getIamActionByMessageType();
    final User requestUser=ctx.getUser();
    final Map<String,String> evaluatedKeys=ctx.evaluateKeys();
    return Permissions.createEvaluationContext(vendor.value(),type.value(),action,requestUser,evaluatedKeys);
  }
 catch (  AuthException e) {
    throw Exceptions.toUndeclared(e);
  }
}
