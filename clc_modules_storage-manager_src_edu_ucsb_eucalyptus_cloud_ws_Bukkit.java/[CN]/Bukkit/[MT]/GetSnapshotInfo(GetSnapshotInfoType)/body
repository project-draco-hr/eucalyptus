{
  GetSnapshotInfoResponseType reply=(GetSnapshotInfoResponseType)request.getReply();
  String snapshotId=request.getKey();
  ArrayList<String> snapshotSet=reply.getSnapshotSet();
  EntityWrapper<WalrusSnapshotInfo> db=new EntityWrapper<WalrusSnapshotInfo>();
  WalrusSnapshotInfo snapshotInfo=new WalrusSnapshotInfo(snapshotId);
  List<WalrusSnapshotInfo> snapshotInfos=db.query(snapshotInfo);
  if (snapshotInfos.size() > 0) {
    WalrusSnapshotInfo foundSnapshotInfo=snapshotInfos.get(0);
    EntityWrapper<WalrusVolumeInfo> dbVol=db.recast(WalrusVolumeInfo.class);
    try {
      String volumeId=foundSnapshotInfo.getVolumeId();
      WalrusVolumeInfo volumeInfo=dbVol.getUnique(new WalrusVolumeInfo(volumeId));
      List<WalrusSnapshotInfo> walrusSnapshotInfos=volumeInfo.getSnapshotSet();
      snapshotSet.add(volumeId);
      for (      WalrusSnapshotInfo walrusSnapshotInfo : walrusSnapshotInfos) {
        snapshotSet.add(walrusSnapshotInfo.getSnapshotId());
      }
    }
 catch (    Exception ex) {
      dbVol.rollback();
      db.rollback();
      throw new NoSuchEntityException(foundSnapshotInfo.getVolumeId());
    }
    dbVol.commit();
  }
 else {
    db.rollback();
    throw new NoSuchEntityException(snapshotId);
  }
  db.commit();
  return reply;
}
