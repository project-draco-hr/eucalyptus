{
  WalrusSemaphore semaphore=imageMessenger.getSemaphore(bucketName + "/" + objectKey);
  while (semaphore.inUse()) {
    try {
synchronized (semaphore) {
        semaphore.wait();
      }
    }
 catch (    InterruptedException ex) {
      LOG.error(ex);
    }
  }
  imageMessenger.removeSemaphore(bucketName + "/" + objectKey);
  try {
    EntityWrapper<ImageCacheInfo> db=new EntityWrapper<ImageCacheInfo>();
    ImageCacheInfo searchImageCacheInfo=new ImageCacheInfo(bucketName,objectKey);
    List<ImageCacheInfo> foundImageCacheInfos=db.query(searchImageCacheInfo);
    if (foundImageCacheInfos.size() > 0) {
      ImageCacheInfo foundImageCacheInfo=foundImageCacheInfos.get(0);
      if (foundImageCacheInfo.getInCache() && (imageCachers.get(bucketName + objectKey) == null)) {
        db.delete(foundImageCacheInfo);
        storageManager.deleteObject(bucketName,foundImageCacheInfo.getImageName());
      }
      db.commit();
    }
 else {
      db.rollback();
      LOG.warn("Cannot find image in cache" + bucketName + "/"+ objectKey);
    }
  }
 catch (  Exception ex) {
    LOG.warn(ex,ex);
  }
}
