{
  EntityWrapper<WalrusSnapshotInfo> db=new EntityWrapper<WalrusSnapshotInfo>();
  WalrusSnapshotInfo snapshotInfo=new WalrusSnapshotInfo();
  snapshotInfo.setTransferred(false);
  List<WalrusSnapshotInfo> snapshotInfos=db.query(snapshotInfo);
  for (  WalrusSnapshotInfo snapInfo : snapshotInfos) {
    String snapSetId=snapInfo.getSnapshotSetId();
    EntityWrapper<WalrusSnapshotSet> dbSet=db.recast(WalrusSnapshotSet.class);
    List<WalrusSnapshotSet> snapsets=dbSet.query(new WalrusSnapshotSet(snapSetId));
    if (snapsets.size() > 0) {
      WalrusSnapshotSet snapset=snapsets.get(0);
      List<WalrusSnapshotInfo> snapList=snapset.getSnapshotSet();
      if (snapList.contains(snapInfo))       snapList.remove(snapInfo);
    }
    db.delete(snapInfo);
    try {
      storageManager.deleteObject(snapInfo.getSnapshotSetId(),snapInfo.getSnapshotId());
    }
 catch (    Exception ex) {
      LOG.error(ex);
    }
  }
  db.commit();
}
