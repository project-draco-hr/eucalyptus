{
  GetStackPolicyResponseType reply=request.getReply();
  try {
    final Context ctx=Contexts.lookup();
    checkActionPermission(PolicySpec.CLOUDFORMATION_GETSTACKPOLICY,ctx);
    User user=ctx.getUser();
    String userId=user.getUserId();
    String accountId=user.getAccount().getAccountNumber();
    String stackName=request.getStackName();
    if (stackName == null) {
      throw new ValidationErrorException("StackName must not be null");
    }
    StackEntity stackEntity=StackEntityManager.getAnyStackByNameOrId(stackName,accountId);
    if (stackEntity == null) {
      throw new ValidationErrorException("Stack " + stackName + " does not exist");
    }
    GetStackPolicyResult getStackPolicyResult=new GetStackPolicyResult();
    getStackPolicyResult.setStackPolicyBody(stackEntity.getStackPolicy());
    reply.setGetStackPolicyResult(getStackPolicyResult);
  }
 catch (  Exception ex) {
    LOG.error(ex,ex);
    handleException(ex);
  }
  return reply;
}
