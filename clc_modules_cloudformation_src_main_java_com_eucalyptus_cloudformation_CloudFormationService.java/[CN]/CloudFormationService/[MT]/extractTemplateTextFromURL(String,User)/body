{
  URL url=null;
  try {
    url=new URL(templateUrl);
  }
 catch (  MalformedURLException e) {
    throw new ValidationErrorException("Invalid template url " + templateUrl);
  }
  boolean inWhitelist=WhiteListURLMatcher.urlIsAllowed(url,URL_DOMAIN_WHITELIST);
  if (inWhitelist) {
    try {
      return copyStreamToString(url.openStream());
    }
 catch (    UnknownHostException ex) {
      throw new ValidationErrorException("Invalid template url " + templateUrl);
    }
catch (    IOException ex) {
    }
  }
  String[] validHostBucketSuffixes=new String[]{"walrus","objectstorage"};
  String[] validServicePaths=new String[]{ObjectStorageProperties.LEGACY_WALRUS_SERVICE_PATH,ComponentIds.lookup(ObjectStorage.class).getServicePath()};
  String[] validDomains=new String[]{removeLastDot(DomainNames.externalSubdomain().toString())};
  S3Helper.BucketAndKey bucketAndKey=S3Helper.getBucketAndKeyFromUrl(url,validServicePaths,validHostBucketSuffixes,validDomains);
  EucaS3Client eucaS3Client=EucaS3ClientFactory.getEucaS3Client(user);
  try {
    return eucaS3Client.getObjectContent(bucketAndKey.getBucket(),bucketAndKey.getKey());
  }
 catch (  Exception ex) {
    LOG.error(ex,ex);
    throw new ValidationErrorException("Unable to read object");
  }
}
