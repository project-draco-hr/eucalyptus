{
  final byte[] in=this.data;
  Message query;
  byte[] response=null;
  try {
    query=new Message(in);
    ConnectionHandler.setRemoteInetAddress(this.packet.getAddress());
    try {
      response=generateReply(query,in,this.packet.getLength(),null);
    }
 catch (    RuntimeException ex) {
      response=errorMessage(query,Rcode.SERVFAIL);
      throw ex;
    }
 finally {
      ConnectionHandler.removeRemoteInetAddress();
    }
    if (response == null)     return false;
  }
 catch (  Exception e) {
    if (response != null) {
      response=formerrMessage(in);
    }
 else {
      LOG.trace(e);
      return false;
    }
  }
  try {
    final DatagramPacket outdp=new DatagramPacket(response,response.length,this.packet.getAddress(),this.packet.getPort());
    this.socket.send(outdp);
  }
 catch (  Exception e) {
    LOG.trace(e);
  }
  return true;
}
