{
  EntityWrapper<WalrusInfo> db=EntityWrapper.get(WalrusInfo.class);
  WalrusInfo walrusInfo=null;
  try {
    walrusInfo=db.getUnique(new WalrusInfo());
  }
 catch (  Exception ex) {
    int capacity=WalrusProperties.DEFAULT_INITIAL_CAPACITY;
    try {
      long bytesAvailable=new File(WalrusProperties.bucketRootDirectory).getUsableSpace();
      capacity=(int)(bytesAvailable / WalrusProperties.G);
      capacity=(capacity > 1 ? capacity - 1 : capacity);
    }
 catch (    Exception e) {
      Log.warn("Unable to detect usable space in the directory:" + WalrusProperties.bucketRootDirectory + " because of exception: "+ e.getMessage()+ ". Using Walrus default: "+ WalrusProperties.DEFAULT_INITIAL_CAPACITY+ "GB");
    }
    walrusInfo=new WalrusInfo(WalrusProperties.NAME,WalrusProperties.bucketRootDirectory,WalrusProperties.MAX_BUCKETS_PER_ACCOUNT,(int)(WalrusProperties.MAX_BUCKET_SIZE / WalrusProperties.M),(int)(WalrusProperties.IMAGE_CACHE_SIZE / WalrusProperties.M),WalrusProperties.MAX_TOTAL_SNAPSHOT_SIZE,capacity);
    db.add(walrusInfo);
  }
 finally {
    db.commit();
  }
  return walrusInfo;
}
