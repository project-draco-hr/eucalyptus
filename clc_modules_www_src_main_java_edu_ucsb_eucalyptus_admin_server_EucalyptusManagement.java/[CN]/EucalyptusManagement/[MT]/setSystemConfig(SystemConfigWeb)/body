{
  EntityWrapper<SystemConfiguration> db=new EntityWrapper<SystemConfiguration>();
  try {
    SystemConfiguration sysConf=db.getUnique(new SystemConfiguration());
    sysConf.setStorageUrl(systemConfig.getStorageUrl());
    sysConf.setStorageDir(systemConfig.getStoragePath());
    sysConf.setDefaultKernel(systemConfig.getDefaultKernelId());
    sysConf.setDefaultRamdisk(systemConfig.getDefaultRamdiskId());
    sysConf.setStorageMaxBucketsPerUser(systemConfig.getStorageMaxBucketsPerUser());
    sysConf.setStorageMaxBucketSizeInMB(systemConfig.getStorageMaxBucketSizeInMB());
    sysConf.setStorageMaxCacheSizeInMB(systemConfig.getStorageMaxCacheSizeInMB());
    sysConf.setStorageMaxTotalVolumeSizeInGb(systemConfig.getStorageVolumesTotalInGB());
    sysConf.setStorageMaxTotalSnapshotSizeInGb(systemConfig.getStorageSnapshotsTotalInGB());
    sysConf.setStorageInterface(systemConfig.getStorageInterface());
    sysConf.setStorageMaxVolumeSizeInGB(systemConfig.getStorageMaxVolumeSizeInGB());
    sysConf.setStorageVolumesDir(systemConfig.getStorageVolumesPath());
    sysConf.setDnsDomain(systemConfig.getDnsDomain());
    sysConf.setNameserver(systemConfig.getNameserver());
    sysConf.setNameserverAddress(systemConfig.getNameserverAddress());
    sysConf.setMaxUserPublicAddresses(systemConfig.getMaxUserPublicAddresses());
    sysConf.setDoDynamicPublicAddresses(systemConfig.isDoDynamicPublicAddresses());
    sysConf.setSystemReservedPublicAddresses(systemConfig.getSystemReservedPublicAddresses());
    sysConf.setZeroFillVolumes(systemConfig.getZeroFillVolumes());
    db.commit();
    WalrusProperties.update();
    StorageProperties.update();
  }
 catch (  EucalyptusCloudException e) {
    db.add(new SystemConfiguration(systemConfig.getStorageUrl(),systemConfig.getDefaultKernelId(),systemConfig.getDefaultRamdiskId(),systemConfig.getStoragePath(),systemConfig.getStorageMaxBucketsPerUser(),systemConfig.getStorageMaxBucketSizeInMB(),systemConfig.getStorageMaxCacheSizeInMB(),systemConfig.getStorageVolumesTotalInGB(),systemConfig.getStorageSnapshotsTotalInGB(),systemConfig.getStorageInterface(),systemConfig.getStorageMaxVolumeSizeInGB(),systemConfig.getStorageVolumesPath(),systemConfig.getMaxUserPublicAddresses(),systemConfig.isDoDynamicPublicAddresses(),systemConfig.getSystemReservedPublicAddresses(),systemConfig.getZeroFillVolumes(),systemConfig.getDnsDomain(),systemConfig.getNameserver(),systemConfig.getNameserverAddress()));
    db.commit();
    WalrusProperties.update();
    StorageProperties.update();
    DNSProperties.update();
  }
}
