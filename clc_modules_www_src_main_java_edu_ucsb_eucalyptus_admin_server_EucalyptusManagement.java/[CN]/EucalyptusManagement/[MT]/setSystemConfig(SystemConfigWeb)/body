{
  EntityWrapper<SystemConfiguration> db=new EntityWrapper<SystemConfiguration>();
  try {
    SystemConfiguration sysConf=db.getUnique(new SystemConfiguration());
    sysConf.setStorageUrl(systemConfig.getWalrusUrl());
    sysConf.setStorageDir(systemConfig.getBucketsRootDirectory());
    sysConf.setDefaultKernel(systemConfig.getDefaultKernelId());
    sysConf.setDefaultRamdisk(systemConfig.getDefaultRamdiskId());
    sysConf.setStorageMaxBucketsPerUser(systemConfig.getMaxBucketsPerUser());
    sysConf.setStorageMaxBucketSizeInMB(systemConfig.getMaxBucketSizeInMB());
    sysConf.setStorageMaxCacheSizeInMB(systemConfig.getMaxCacheSizeInMB());
    sysConf.setStorageMaxTotalSnapshotSizeInGb(systemConfig.getSnapshotsTotalInGB());
    sysConf.setDnsDomain(systemConfig.getDnsDomain());
    sysConf.setNameserver(systemConfig.getNameserver());
    sysConf.setNameserverAddress(systemConfig.getNameserverAddress());
    sysConf.setMaxUserPublicAddresses(systemConfig.getMaxUserPublicAddresses());
    sysConf.setDoDynamicPublicAddresses(systemConfig.isDoDynamicPublicAddresses());
    sysConf.setSystemReservedPublicAddresses(systemConfig.getSystemReservedPublicAddresses());
    sysConf.setZeroFillVolumes(systemConfig.getZeroFillVolumes());
    db.commit();
    WalrusProperties.update();
    StorageProperties.update();
  }
 catch (  EucalyptusCloudException e) {
    db.add(new SystemConfiguration(systemConfig.getWalrusUrl(),systemConfig.getDefaultKernelId(),systemConfig.getDefaultRamdiskId(),systemConfig.getBucketsRootDirectory(),systemConfig.getMaxBucketsPerUser(),systemConfig.getMaxBucketSizeInMB(),systemConfig.getMaxCacheSizeInMB(),systemConfig.getSnapshotsTotalInGB(),systemConfig.getMaxUserPublicAddresses(),systemConfig.isDoDynamicPublicAddresses(),systemConfig.getSystemReservedPublicAddresses(),systemConfig.getZeroFillVolumes(),systemConfig.getDnsDomain(),systemConfig.getNameserver(),systemConfig.getNameserverAddress()));
    db.commit();
    WalrusProperties.update();
    StorageProperties.update();
    DNSProperties.update();
  }
}
