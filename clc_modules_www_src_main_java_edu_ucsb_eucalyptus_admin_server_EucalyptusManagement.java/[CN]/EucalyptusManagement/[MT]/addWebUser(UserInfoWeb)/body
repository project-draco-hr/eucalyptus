{
  EntityWrapper<UserInfo> dbWrapper=new EntityWrapper<UserInfo>();
  List<UserInfo> userList=dbWrapper.query(new UserInfo(webUser.getUserName()));
  if (userList.size() != 0) {
    dbWrapper.rollback();
    throw EucalyptusManagement.makeFault("User already exists");
  }
  webUser.setConfirmationCode(UserManagement.generateConfirmationCode(webUser.getUserName()));
  webUser.setCertificateCode(UserManagement.generateCertificateCode(webUser.getUserName()));
  webUser.setSecretKey(UserManagement.generateSecretKey(webUser.getUserName()));
  webUser.setQueryId(UserManagement.generateQueryId(webUser.getUserName()));
  UserInfo newUser=EucalyptusManagement.fromClient(webUser);
  newUser.setReservationId(0l);
  newUser.getNetworkRulesGroup().add(NetworkRulesGroup.getDefaultGroup());
  dbWrapper.add(newUser);
  dbWrapper.commit();
  try {
    CredentialProvider.addUser(newUser.getUserName(),newUser.isAdministrator());
  }
 catch (  UserExistsException e) {
    LOG.error(e);
  }
}
