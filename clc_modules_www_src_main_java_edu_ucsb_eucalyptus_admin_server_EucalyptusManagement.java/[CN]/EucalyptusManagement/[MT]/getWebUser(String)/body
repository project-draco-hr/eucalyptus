{
  EntityWrapper<UserInfo> dbWrapper=new EntityWrapper<UserInfo>();
  List<UserInfo> userList=dbWrapper.query(new UserInfo(userName));
  if (userList.size() != 1) {
    try {
      if ("admin".equals(userName)) {
        UserInfo u=UserManagement.generateAdmin();
        dbWrapper.add(u);
        UserGroupInfo allGroup=new UserGroupInfo("all");
        dbWrapper.getSession().persist(new Counters());
        dbWrapper.commit();
        return EucalyptusManagement.fromServer(u);
      }
 else {
        dbWrapper.rollback();
        throw EucalyptusManagement.makeFault("User does not exist");
      }
    }
 catch (    Exception e) {
      dbWrapper.rollback();
      throw EucalyptusManagement.makeFault("User does not exist");
    }
  }
  dbWrapper.commit();
  return EucalyptusManagement.fromServer(userList.get(0));
}
