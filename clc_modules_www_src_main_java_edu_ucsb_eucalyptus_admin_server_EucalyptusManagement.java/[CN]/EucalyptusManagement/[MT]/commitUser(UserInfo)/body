{
  UserInfo searchUser=new UserInfo(user.getUserName());
  EntityWrapper<UserInfo> db=new EntityWrapper<UserInfo>();
  List<UserInfo> userList=db.query(searchUser);
  UserInfo target=userList.get(0);
  if (userList.size() != 1) {
    db.rollback();
    throw EucalyptusManagement.makeFault("User does not exist");
  }
  update(target,user);
  try {
    User u=Users.lookupUser(user.getUserName());
    u.setIsAdministrator(user.isAdministrator());
    u.setIsEnabled(user.isEnabled());
    db.commit();
  }
 catch (  NoSuchUserException e) {
    db.rollback();
    LOG.error(e);
    throw EucalyptusManagement.makeFault("Unable to update user");
  }
}
