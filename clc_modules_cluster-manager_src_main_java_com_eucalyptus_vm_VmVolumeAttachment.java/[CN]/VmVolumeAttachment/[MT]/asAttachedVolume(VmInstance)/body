{
  return new Function<VmVolumeAttachment,AttachedVolume>(){
    @Override public AttachedVolume apply(    VmVolumeAttachment vol){
      AttachedVolume attachment=null;
      if (vm == null && vol.getVmInstance() == null) {
        throw new NoSuchElementException("Failed to transform volume attachment because it no longer exists: " + vol);
      }
 else       if (vm == null) {
        attachment=new AttachedVolume(vol.getVolumeId(),vol.getVmInstance().getInstanceId(),vol.getDevice(),vol.getRemoteDevice());
      }
 else {
        attachment=new AttachedVolume(vol.getVolumeId(),vm.getInstanceId(),vol.getDevice(),vol.getRemoteDevice());
      }
      attachment.setAttachTime(vol.getAttachTime());
      attachment.setStatus(vol.getStatus());
      if (!attachment.getDevice().replaceAll("unknown,requested:","").startsWith("/dev/")) {
        attachment.setDevice("/dev/" + attachment.getDevice().replaceAll("unknown,requested:",""));
      }
      return attachment;
    }
  }
;
}
