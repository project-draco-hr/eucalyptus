{
  EucaSemaphore semaphore=EucaSemaphoreDirectory.getSemaphore(bucketName + "/" + objectKey);
  while (semaphore.inUse()) {
    try {
synchronized (semaphore) {
        semaphore.wait();
      }
    }
 catch (    InterruptedException ex) {
      LOG.error(ex);
    }
  }
  EucaSemaphoreDirectory.removeSemaphore(bucketName + "/" + objectKey);
  EntityWrapper<ImageCacheInfo> db=EntityWrapper.get(ImageCacheInfo.class);
  ImageCacheInfo searchImageCacheInfo=new ImageCacheInfo(bucketName,objectKey);
  List<ImageCacheInfo> foundImageCacheInfos=db.queryEscape(searchImageCacheInfo);
  if (foundImageCacheInfos.size() > 0) {
    ImageCacheInfo foundImageCacheInfo=foundImageCacheInfos.get(0);
    LOG.info("Attempting to flush cached image: " + bucketName + "/"+ objectKey);
    if (foundImageCacheInfo.getInCache() && (imageCachers.get(bucketName + objectKey) == null)) {
      db.delete(foundImageCacheInfo);
      storageManager.deleteObject(bucketName,foundImageCacheInfo.getImageName());
    }
    db.commit();
  }
 else {
    db.rollback();
    LOG.warn("Cannot find image in cache" + bucketName + "/"+ objectKey);
  }
}
