{
  try {
    brokerService=new BrokerService();
    brokerService.setBrokerName(brokerName);
    brokerService.setDataDirectory(brokerDataDir);
    brokerService.addConnector(brokerUrl);
    if (remoteBrokerUrl != null) {
      brokerService.addNetworkConnector(remoteBrokerUrl);
    }
    brokerService.setUseJmx(true);
    brokerThread=new JmsBrokerThread(brokerService);
    brokerThread.start();
    Thread.sleep(1000);
    if (brokerThread.getStartException() != null) {
      throw brokerThread.getStartException();
    }
  }
 catch (  Exception ex) {
    throw new QueueRuntimeException(ex);
  }
  log.info("Broker started");
}
