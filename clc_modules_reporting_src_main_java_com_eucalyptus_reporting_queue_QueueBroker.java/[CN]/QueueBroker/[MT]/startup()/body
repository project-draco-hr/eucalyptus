{
  try {
    brokerService=new BrokerService();
    brokerService.setBrokerName(brokerName);
    brokerService.setDataDirectory(brokerDataDir);
    brokerService.addConnector(brokerUrl);
    ActiveMQDestination[] dests=new ActiveMQDestination[destinations.size()];
    destinations.toArray(dests);
    brokerService.setDestinations(dests);
    brokerThread=new JmsBrokerThread(brokerService);
    brokerThread.start();
    Thread.sleep(1000);
    if (brokerThread.getStartException() != null) {
      throw brokerThread.getStartException();
    }
  }
 catch (  Exception ex) {
    throw new QueueRuntimeException(ex);
  }
  log.info("Broker started");
}
