{
  GetWalrusSnapshotSizeResponseType reply=(GetWalrusSnapshotSizeResponseType)request.getReply();
  String snapshotId=request.getKey();
  EntityWrapper<WalrusSnapshotInfo> db=WalrusControl.getEntityWrapper();
  WalrusSnapshotInfo snapshotInfo=new WalrusSnapshotInfo(snapshotId);
  List<WalrusSnapshotInfo> snapshotInfos=db.query(snapshotInfo);
  int size=0;
  if (snapshotInfos.size() > 0) {
    WalrusSnapshotInfo foundSnapshotInfo=snapshotInfos.get(0);
    size=foundSnapshotInfo.getSize();
  }
  db.commit();
  Channel channel=request.getChannel();
  if (channel != null) {
    DefaultHttpResponse httpResponse=new DefaultHttpResponse(HttpVersion.HTTP_1_1,HttpResponseStatus.OK);
    httpResponse.addHeader(HttpHeaders.Names.CONTENT_LENGTH,String.valueOf(0));
    httpResponse.addHeader("SnapshotSize",String.valueOf(size));
    channel.write(httpResponse);
  }
 else {
    throw new EucalyptusCloudException("Could not get channel to write response");
  }
  return reply;
}
