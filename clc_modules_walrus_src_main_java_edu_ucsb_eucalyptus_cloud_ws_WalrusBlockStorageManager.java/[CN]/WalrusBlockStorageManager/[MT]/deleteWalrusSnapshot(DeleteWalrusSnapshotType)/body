{
  DeleteWalrusSnapshotResponseType reply=(DeleteWalrusSnapshotResponseType)request.getReply();
  String snapshotId=request.getKey();
  EntityWrapper<WalrusSnapshotInfo> db=EntityWrapper.get(WalrusSnapshotInfo.class);
  WalrusSnapshotInfo snapshotInfo=new WalrusSnapshotInfo(snapshotId);
  List<WalrusSnapshotInfo> snapshotInfos=db.query(snapshotInfo);
  reply.set_return(true);
  if (snapshotInfos.size() > 0) {
    WalrusSnapshotInfo foundSnapshotInfo=snapshotInfos.get(0);
    db.delete(foundSnapshotInfo);
    db.commit();
    SnapshotDeleter snapshotDeleter=new SnapshotDeleter(request.getUserId(),request.getEffectiveUserId(),foundSnapshotInfo.getSnapshotBucket(),snapshotId);
    snapshotDeleter.start();
  }
 else {
    db.rollback();
    throw new NoSuchSnapshotException(snapshotId);
  }
  return reply;
}
