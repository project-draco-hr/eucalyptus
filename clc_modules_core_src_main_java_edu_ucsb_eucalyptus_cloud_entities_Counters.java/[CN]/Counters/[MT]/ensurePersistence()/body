{
  long modulus=100l;
  if (tempId < 0) {
    Counters find=null;
    EntityManager em=DatabaseUtil.getEntityManagerFactory(Component.eucalyptus.name() + "_general").createEntityManager();
    Session session=(Session)em.getDelegate();
    List<Counters> found=(List<Counters>)session.createSQLQuery("select * from counters").addEntity(Counters.class).list();
    if (found.isEmpty()) {
      EntityTransaction tx=em.getTransaction();
      tx.begin();
      Counters newCounters=new Counters();
      em.persist(newCounters);
      em.flush();
      tx.commit();
      find=newCounters;
    }
 else     find=found.get(0);
    tempId=find.getMessageId() + modulus;
    em.close();
  }
 else   if (tempId % modulus == 0) {
    EntityManager em=DatabaseUtil.getEntityManagerFactory(Component.eucalyptus.name() + "_general").createEntityManager();
    Session session=(Session)em.getDelegate();
    Transaction tx=session.beginTransaction();
    tx.begin();
    Counters find=(Counters)session.createSQLQuery("select * from counters").addEntity(Counters.class).list().get(0);
    tempId+=modulus;
    find.setMessageId(tempId);
    session.save(find);
    tx.commit();
    em.close();
  }
}
