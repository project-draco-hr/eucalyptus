{
  Cluster.State currentState=this.stateMachine.getState();
  Component.State externalState=this.configuration.lookupState();
  List<Throwable> currentErrors=Lists.newArrayList();
  currentErrors.addAll(this.pendingErrors);
  if (!currentErrors.isEmpty()) {
    CheckException ex=ServiceChecks.Severity.ERROR.transform(this.configuration,currentErrors);
    throw ex;
  }
 else   if (currentState.ordinal() < State.DISABLED.ordinal() || (Component.State.ENABLED.equals(externalState) && Cluster.State.ENABLING.ordinal() >= currentState.ordinal())) {
    IllegalStateException ex=new IllegalStateException("Cluster is currently reported as " + externalState + " but is really "+ currentState+ ":  please see logs for additional information.");
    this.pendingErrors.add(ex);
    throw ServiceChecks.Severity.ERROR.transform(this.configuration,ex);
  }
}
