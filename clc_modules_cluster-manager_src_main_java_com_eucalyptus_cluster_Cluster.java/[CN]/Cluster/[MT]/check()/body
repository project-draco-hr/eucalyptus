{
  final Cluster.State currentState=this.stateMachine.getState();
  final Component.State externalState=this.configuration.lookupState();
  final List<Throwable> currentErrors=Lists.newArrayList();
  currentErrors.addAll(this.pendingErrors);
  if (Cluster.State.NOTREADY.equals(currentState)) {
    try {
      notreadyTransition().call().get();
    }
 catch (    Exception ex) {
      Exceptions.maybeInterrupted(ex);
      throw Faults.failure(this.configuration,ex);
    }
  }
 else   if (Cluster.State.ENABLED.equals(currentState)) {
    try {
      enabledTransition().call().get();
    }
 catch (    Exception ex) {
      Exceptions.maybeInterrupted(ex);
      throw Faults.failure(this.configuration,ex);
    }
  }
 else   if (Cluster.State.DISABLED.equals(currentState)) {
    try {
      disabledTransition().call().get();
    }
 catch (    Exception ex) {
      Exceptions.maybeInterrupted(ex);
      throw Faults.failure(this.configuration,ex);
    }
  }
 else   if (!currentErrors.isEmpty()) {
    throw Faults.failure(this.configuration,currentErrors);
  }
 else   if ((currentState.ordinal() < State.DISABLED.ordinal()) || (Component.State.ENABLED.equals(externalState) && (Cluster.State.ENABLING.ordinal() >= currentState.ordinal()))) {
    final IllegalStateException ex=new IllegalStateException("Cluster is currently reported as " + externalState + " but is really "+ currentState+ ":  please see logs for additional information.");
    this.pendingErrors.add(ex);
    throw Faults.failure(this.configuration,currentErrors);
  }
}
