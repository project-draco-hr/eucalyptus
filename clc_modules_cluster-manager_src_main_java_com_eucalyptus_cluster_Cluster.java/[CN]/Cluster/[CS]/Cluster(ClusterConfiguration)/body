{
  super();
  this.configuration=configuration;
  this.fullName=configuration.getFullName();
  this.state=new ClusterState(configuration.getName());
  this.nodeState=new ClusterNodeState(configuration.getName());
  this.nodeMap=new ConcurrentSkipListMap<String,NodeInfo>();
  this.threadFactory=Threads.lookup(com.eucalyptus.component.id.ClusterController.class,Cluster.class,this.getFullName().toString());
  this.stateMachine=new StateMachineBuilder<Cluster,State,Transition>(this,State.DOWN){
{
      in(State.DOWN).run(new Callback<Cluster>(){
        @Override public void fire(        Cluster t){
          try {
            Cluster.this.stateMachine.startTransitionTo(State.AUTHENTICATING);
          }
 catch (          IllegalStateException ex) {
            LOG.error(ex,ex);
          }
catch (          ExistingTransitionException ex) {
            LOG.debug(ex.getMessage());
          }
catch (          Exception ex) {
            LOG.error(ex,ex);
          }
        }
      }
);
      in(State.AUTHENTICATING).run(new Callback<Cluster>(){
        @Override public void fire(        Cluster t){
          try {
            Cluster.this.stateMachine.startTransitionTo(State.CHECK_SERVICE_READY);
          }
 catch (          IllegalStateException ex) {
            LOG.error(ex,ex);
          }
catch (          ExistingTransitionException ex) {
            LOG.debug(ex.getMessage());
          }
catch (          Exception ex) {
            LOG.error(ex,ex);
          }
        }
      }
);
      in(State.CHECK_SERVICE_READY).run(new Callback<Cluster>(){
        @Override public void fire(        Cluster t){
          try {
            Cluster.this.stateMachine.startTransitionTo(State.DISABLED);
          }
 catch (          IllegalStateException ex) {
            LOG.error(ex,ex);
          }
catch (          ExistingTransitionException ex) {
            LOG.debug(ex.getMessage());
          }
catch (          Exception ex) {
            LOG.error(ex,ex);
          }
        }
      }
);
      from(State.DOWN).to(State.AUTHENTICATING).on(Transition.START).noop();
      from(State.AUTHENTICATING).to(State.CHECK_SERVICE_READY).on(Transition.INIT_CERTS).error(State.DOWN).run(newRefresh(ClusterCertsCallback.class));
      from(State.CHECK_SERVICE_READY).to(State.DISABLED).on(Transition.INIT_SERVICES).error(State.DOWN).run(newRefresh(ServiceStateCallback.class));
      on(Transition.INIT_RESOURCES).from(State.STARTING).to(State.STARTING_RESOURCES).error(State.DOWN).run(newRefresh(ResourceStateCallback.class));
      on(Transition.INIT_NET).from(State.STARTING_RESOURCES).to(State.STARTING_NET).error(State.DOWN).run(newRefresh(NetworkStateCallback.class));
      on(Transition.INIT_VMS).from(State.STARTING_NET).to(State.STARTING_VMS).error(State.DOWN).run(newRefresh(VmStateCallback.class));
      on(Transition.INIT_ADDRS).from(State.STARTING_VMS).to(State.STARTING_ADDRS).error(State.DOWN).run(newRefresh(PublicAddressStateCallback.class));
      on(Transition.INIT_VMS2).from(State.STARTING_ADDRS).to(State.STARTING_VMS2).error(State.DOWN).run(newRefresh(VmStateCallback.class));
      on(Transition.INIT_ADDRS2).from(State.STARTING_VMS2).to(State.RUNNING_ADDRS).error(State.DOWN).run(newRefresh(PublicAddressStateCallback.class));
      on(Transition.RUNNING_RSC).from(State.RUNNING_ADDRS).to(State.RUNNING_RSC).error(State.DOWN).run(newRefresh(ResourceStateCallback.class));
      on(Transition.RUNNING_NET).from(State.RUNNING_RSC).to(State.RUNNING_NET).error(State.DOWN).run(newRefresh(NetworkStateCallback.class));
      on(Transition.RUNNING_VMS).from(State.RUNNING_NET).to(State.RUNNING_VMS).error(State.DOWN).run(newRefresh(VmStateCallback.class));
      on(Transition.RUNNING_ADDRS).from(State.RUNNING_VMS).to(State.RUNNING_SERVICE_CHECK).error(State.DOWN).run(newRefresh(PublicAddressStateCallback.class));
      on(Transition.RUNNING_SERVICES).from(State.RUNNING_SERVICE_CHECK).to(State.RUNNING_ADDRS).error(State.DOWN).run(newRefresh(ServiceStateCallback.class));
      on(Transition.ENABLE).from(State.DISABLED).to(State.DOWN).noop();
    }
  }
.newAtomicMarkedState();
}
