{
  for (  final QueuedEventCallback event : this.messages.get(state)) {
    if (event instanceof BroadcastCallback) {
      final BroadcastCallback callback=(BroadcastCallback)event;
      this.pendingEvents.addAll(Lists.transform(Clusters.getInstance().listValues(),new Function<Cluster,QueuedEventCallback>(){
        public QueuedEventCallback apply(        Cluster c){
          EventRecord.caller(StatefulMessageSet.class,EventType.VM_STARTING,state.name(),c.getName(),event.getClass().getSimpleName()).info();
          return callback.newInstance().regardingUserRequest(callback.getRequest()).dispatch(c);
        }
      }
));
    }
 else {
      this.pendingEvents.add(event.dispatch(cluster));
      EventRecord.caller(StatefulMessageSet.class,EventType.VM_STARTING,state.name(),cluster.getName(),event.getClass().getSimpleName()).info();
    }
  }
}
