{
  ConcurrentNavigableMap<String,Address> unusedAddresses=Addresses.getInstance().getDisabledMap();
  Map.Entry<String,Address> addressEntry=unusedAddresses.pollFirstEntry();
  if (addressEntry == null) {
    AddressManager.LOG.debug(LogUtil.header(LogUtil.dumpObject(Addresses.getInstance())));
    throw new EucalyptusCloudException(ExceptionList.ERR_SYS_INSUFFICIENT_ADDRESS_CAPACITY);
  }
  Address address=addressEntry.getValue();
  address.allocate(userId);
  return address;
}
